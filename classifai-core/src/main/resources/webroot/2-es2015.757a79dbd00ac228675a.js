(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{i5u5:function(t,e,n){"use strict";n.r(e),n.d(e,"ImageLabellingLayoutModule",function(){return ge});var i=n("ofXK");function o(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}var a=n("SxV6"),s=n("1G5W"),l=n("XNiG"),c=n("fXoL"),r=n("tyNb"),h=n("/uUt"),g=n("cxbk"),b=n("tk/3"),d=n("14na");let u=(()=>{class t{constructor(t,e,n){this.http=t,this.mode=e,this.router=n,this.hostPort=g.a.baseURL,this.imageLabellingMode=null,this.getBase64Thumbnail=(t,e)=>this.http.get(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/uuid/${e}/imgsrc`),this.updateLabelList=(t,e)=>this.http.put(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/newlabels`,{label_list:e.length>0?e:["default"]}),this.updateProjectProgress=(t,e,n)=>this.http.put(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/uuid/${e}/update`,Object.assign({},n)),this.mode.imgLabelMode$.pipe(Object(h.a)()).subscribe(t=>t?this.imageLabellingMode=t:this.router.navigate(["/"]))}checkIfBboxMetaType(t){return Array.isArray(t)?void 0!==t[0].bnd_box:void 0!==t.bnd_box}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(b.b),c.Qb(d.a),c.Qb(r.a))},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var m=n("1F7/"),f=n("LY9J"),v=n("2Vo4");const _={annotation:-1,isDlbClick:!1};let y=(()=>{class t{constructor(){this.labelStateSubject=new v.a(_),this.labelStaging$=this.labelStateSubject.asObservable(),this.setState=t=>{this.labelStateSubject.next(t?Object.assign(Object.assign({},_),t):_)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const x={scroll:!1,drag:!1,draw:!1,fitCenter:!1,clear:!1,isActiveModal:!1};let p=(()=>{class t{constructor(){this.actionSubject=new v.a(x),this.action$=this.actionSubject.asObservable(),this.setState=t=>{this.actionSubject.next(t?Object.assign(Object.assign({},x),t):x)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),M=(()=>{class t{constructor(t){this._imgLblApiService=t,this.getRouteState=t=>{const{state:e}=t;return Object.assign({},e)},this.displayLabelList=(t,e)=>t.map(t=>t.label_list?Object.assign(Object.assign({},t),{label_list:e}):t),this.calculateIndex=(t,e,n)=>{let i=e;return 1===t?i>=n-1?n-1:i+=1:i<=0?0:e-=1},this.checkAnnotationMetadataProp=({bnd_box:t,polygons:e})=>null!=t?t:e,this.changeAnnotationLabel=(t,{label:e,index:n})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:i,polygons:a}=t,s=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},s),{bnd_box:null==i?void 0:i.map((t,i)=>i===n?Object.assign(Object.assign({},t),{label:e}):t),polygons:null==a?void 0:a.map((t,i)=>i===n?Object.assign(Object.assign({},t),{label:e}):t)})})}):t),this.deleteAnnotation=(t,e)=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:n,polygons:i}=t,a=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},a),{bnd_box:null==n?void 0:n.filter((t,n)=>n!==e),polygons:null==i?void 0:i.filter((t,n)=>n!==e)})})}):t),this.submitLabel=(t,e,n,{mainLabelRegion:i,subLabelRegion:a})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:s,polygons:l}=t,c=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},c),{bnd_box:null==s?void 0:s.map((t,o)=>o===n?Object.assign(Object.assign({},t),{region:i,subLabel:t.subLabel&&t.subLabel.length>0?[...t.subLabel,{label:e,region:a}]:[{label:e,region:a}]}):t),polygons:null==l?void 0:l.map((t,o)=>o===n?Object.assign(Object.assign({},t),{region:i,subLabel:t.subLabel&&t.subLabel.length>0?[...t.subLabel,{label:e,region:a}]:[{label:e,region:a}]}):t)})})}):t),this.removeSubLabel=(t,{selectedAnnoIndex:e,selectedSubLabelIndex:n})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:i,polygons:a}=t,s=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},s),{bnd_box:null==i?void 0:i.map((t,i)=>{var o;return i===e?Object.assign(Object.assign({},t),{subLabel:null===(o=t.subLabel)||void 0===o?void 0:o.filter((t,e)=>e!==n)}):t}),polygons:null==a?void 0:a.map((t,i)=>{var o;return i===e?Object.assign(Object.assign({},t),{subLabel:null===(o=t.subLabel)||void 0===o?void 0:o.filter((t,e)=>e!==n)}):t})})})}):t),this.setLocalStorageProjectProgress=(t,e)=>{localStorage.setItem(`${t}_${this._imgLblApiService.imageLabellingMode}`,JSON.stringify({cache:e}))},this.getLocalStorageProjectProgress=t=>{const e=localStorage.getItem(`${t}_${this._imgLblApiService.imageLabellingMode}`);return e?JSON.parse(e):null},this.updateProjectProgress=(t,e)=>{t.forEach(({annotation:t})=>{t&&(this.setLocalStorageProjectProgress(e,t),null==t||t.forEach(t=>{this._imgLblApiService.updateProjectProgress(e,t.uuid,t).pipe(Object(a.a)()).subscribe(({})=>{})}))})}}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(u))},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var w=n("x2Se");let S=(()=>{class t{transform(t){return t?t.split("\\").slice(-1)[0]:""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=c.Gb({name:"fileNameSlice",type:t,pure:!0}),t})();function P(t,e){if(1&t&&(c.Kb(0),c.Ib(1,"div",7),c.Mb(2,"label",8),c.lc(3),c.Wb(4,"fileNameSlice"),c.Lb(),c.Jb()),2&t){const t=c.Vb();c.xb(3),c.mc(c.Xb(4,1,t._onChange.thumbnailName))}}function C(t,e){1&t&&c.Ib(0,"label",8)}function O(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"label"),c.lc(2),c.Lb(),c.Jb()),2&t){const t=c.Vb(3);c.xb(2),c.oc("",t._onChange.currentThumbnailIndex||0," / ",t._onChange.totalNumThumbnail,"")}}function L(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",10),c.Mb(2,"img",11),c.Tb("click",function(){return c.gc(t),c.Vb().$implicit.onClick()}),c.Lb(),c.Lb(),c.Mb(3,"div",12),c.jc(4,O,3,2,"ng-container",13),c.Lb(),c.Jb()}if(2&t){const t=c.Vb(),e=t.$implicit,n=t.index,i=c.Vb();c.xb(2),c.ac("ngClass",i.conditionalIconTheme())("src",e.imgPath,c.hc)("alt",e.alt)("title",e.hoverLabel),c.yb("data-index",n+e.alt),c.xb(2),c.ac("ngIf",i._onChange&&i._onChange.totalNumThumbnail)}}function k(t,e){if(1&t){const t=c.Nb();c.Mb(0,"div",10),c.Mb(1,"img",11),c.Tb("click",function(){return c.gc(t),c.Vb().$implicit.onClick()}),c.Lb(),c.Lb()}if(2&t){const t=c.Vb(),e=t.$implicit,n=t.index,i=c.Vb();c.xb(1),c.ac("ngClass",i.conditionalIconTheme())("src",e.imgPath,c.hc)("alt",e.alt)("title",e.hoverLabel),c.yb("data-index",n+e.alt)}}function I(t,e){if(1&t&&(c.Kb(0),c.jc(1,L,5,6,"ng-container",2),c.jc(2,k,2,5,"ng-template",null,9,c.kc),c.Jb()),2&t){const t=e.index,n=c.ec(3);c.xb(1),c.ac("ngIf",0===t)("ngIfElse",n)}}function j(t,e){1&t&&(c.Kb(0),c.Ib(1,"hr",14),c.Jb())}function B(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"div",10),c.Mb(2,"img",11),c.Tb("click",function(){return e.$implicit.onClick()}),c.Lb(),c.Lb(),c.jc(3,j,2,0,"ng-container",13),c.Jb()),2&t){const t=e.$implicit,n=e.index,i=c.Vb();c.xb(2),c.ac("ngClass",i.conditionalIconTheme())("src",t.imgPath,c.hc)("alt",t.alt)("title",t.hoverLabel),c.yb("data-index",n+t.alt),c.xb(1),c.ac("ngIf",1===n)}}let A=(()=>{class t{constructor(){this._onClick=new c.n,this.bindImagePath=()=>{this.jsonSchema={logosCenter:[{imgPath:"../../../assets/icons/previous.svg",hoverLabel:"Pervious",alt:"Previous",onClick:()=>this.emitParentEvent({thumbnailAction:-1})},{imgPath:"../../../assets/icons/next.svg",hoverLabel:"Next",alt:"Next",onClick:()=>this.emitParentEvent({thumbnailAction:1})}],logosEnd:[{imgPath:"../../../assets/icons/undo.svg",hoverLabel:"Undo",alt:"Undo",onClick:()=>null},{imgPath:"../../../assets/icons/redo.svg",hoverLabel:"Redo",alt:"Redo",onClick:()=>null},{imgPath:"../../../assets/icons/zoom_in.svg",hoverLabel:"Zoom In",alt:"Zoom In",onClick:()=>null},{imgPath:"../../../assets/icons/zoom_out.svg",hoverLabel:"Zoom Out",alt:"Zoom Out",onClick:()=>null}]}},this.emitParentEvent=({url:t,thumbnailAction:e})=>{this._onClick.emit({url:t,thumbnailAction:e})},this.conditionalIconTheme=()=>"utility-icon-light"}ngOnInit(){this.bindImagePath()}ngOnChanges(t){const{totalNumThumbnail:e}=t._onChange.currentValue;this._onChange.totalNumThumbnail=e,this.bindImagePath()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-info"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick"},features:[c.vb],decls:9,vars:4,consts:[[1,"header-container"],[1,"container-flex-start"],[4,"ngIf","ngIfElse"],["defaultName",""],[1,"container-flex-center"],[4,"ngFor","ngForOf"],[1,"container-flex-end"],[1,"indicator"],[1,"imageTitle"],["renderOtherIcons",""],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"],[1,"totalThumbnail"],[4,"ngIf"],[1,"horizontal-line"]],template:function(t,e){if(1&t&&(c.Mb(0,"div",0),c.Mb(1,"div",1),c.jc(2,P,5,3,"ng-container",2),c.jc(3,C,1,0,"ng-template",null,3,c.kc),c.Lb(),c.Mb(5,"div",4),c.jc(6,I,4,2,"ng-container",5),c.Lb(),c.Mb(7,"div",6),c.jc(8,B,4,6,"ng-container",5),c.Lb(),c.Lb()),2&t){const t=c.ec(4);c.xb(2),c.ac("ngIf",e._onChange.thumbnailName)("ngIfElse",t),c.xb(4),c.ac("ngForOf",e.jsonSchema.logosCenter),c.xb(2),c.ac("ngForOf",e.jsonSchema.logosEnd)}},directives:[i.k,i.j,i.i],pipes:[S],styles:[".header-container[_ngcontent-%COMP%]{min-width:100vw;max-width:100vw;min-height:3.5vh;max-height:3.5vh;background:#525353;outline:.0625vw inset #fff;display:flex;justify-content:space-between;z-index:1000;position:absolute}.container-flex-start[_ngcontent-%COMP%]{display:flex;align-items:baseline;margin-left:3vw;min-height:inherit;max-height:inherit}.container-flex-center[_ngcontent-%COMP%]{display:flex;margin-left:8vw}.container-flex-end[_ngcontent-%COMP%]{display:flex;margin-right:19vw}.logo-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw}.logo[_ngcontent-%COMP%], .utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.1vw;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active{background:#696969}.utility-icon-dark[_ngcontent-%COMP%]:active{background:#a9a9a9}.position-absolute[_ngcontent-%COMP%]{position:absolute}.utility-icon-container[_ngcontent-%COMP%]{display:flex;min-height:3.5vh;max-height:3.5vh}.totalThumbnail[_ngcontent-%COMP%]{font-size:1.7vh;padding:.4vw 1vw 0;display:inline-block;color:#fff;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.img-container[_ngcontent-%COMP%]:hover   .img-description[_ngcontent-%COMP%]{visibility:visible;opacity:1}.imageTitle[_ngcontent-%COMP%]{font-size:2vh;color:#fff;align-items:center;margin-left:1vw;max-width:20vw;min-width:20vw;min-height:inherit;max-height:inherit;position:absolute;margin-top:.5vh;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.indicator[_ngcontent-%COMP%]{height:.8vh;width:.4vw;background-color:#bbb;border-radius:50%;position:absolute;top:1.2vh}.horizontal-line[_ngcontent-%COMP%]{padding:1vh 0;margin:0 1vw;border:.01rem solid #707070}"],changeDetection:0}),t})();function D(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"img",4),c.Tb("click",function(){c.gc(t);const e=c.Vb(),n=e.index,i=e.$implicit;return c.Vb().getIndex(n),i.onClick()}),c.Lb(),c.Jb()}if(2&t){const t=c.Vb(),e=t.$implicit,n=t.index,i=c.Vb();c.xb(1),c.ac("ngClass",i.conditionalIconTheme())("ngStyle",(null==e?null:e.toggleable)&&i.conditionalActiveIcon(n))("src",e.imgPath,c.hc)("alt",e.alt)("title",e.hoverLabel),c.yb("data-index",n)}}function E(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"div",2),c.jc(2,D,2,6,"ng-container",3),c.Lb(),c.Jb()),2&t){const t=e.$implicit;c.xb(2),c.ac("ngIf",t)}}let z=(()=>{class t{constructor(t,e){this._imgLabelState=t,this._annotateService=e,this._currentUrl="",this._navigate=new c.n,this.resetSelectedAnnotate=()=>{this._annotateService.setState({annotation:-1})},this.bindImagePath=()=>{this.jsonSchema={logos:[{imgPath:"../../../assets/icons/pointer.svg",hoverLabel:"Pointer",alt:"Pointer",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!0,scroll:!0})}},"/imglabel/bndbox"===this._currentUrl?{imgPath:"../../../assets/icons/rec_bounding_box.svg",hoverLabel:"Rectangular Bounding Box",alt:"RectangularBB",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})}}:{imgPath:"../../../assets/icons/polygon.svg",hoverLabel:"Polygon",alt:"Polygon",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})}},{imgPath:"../../../assets/icons/eraser.svg",hoverLabel:"Eraser",alt:"Eraser",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1,clear:!0})}},{imgPath:"../../../assets/icons/fit_center.svg",hoverLabel:"Fit Center",alt:"Fit Center",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1})}},{imgPath:"../../../assets/icons/save.svg",hoverLabel:"Save",alt:"Save",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1})}}]}},this.getIndex=t=>{this.iconIndex=t},this.conditionalIconTheme=()=>"utility-icon-light-theme",this.conditionalActiveIcon=t=>t===this.iconIndex?{background:"rgb(59 59 59)",outline:"darkgrey inset 0.1vw"}:null}ngOnInit(){this.bindImagePath()}ngOnChanges(t){this.bindImagePath()}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(p),c.Hb(y))},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-left-sidebar"]],inputs:{_onChange:"_onChange",_currentUrl:"_currentUrl"},outputs:{_navigate:"_navigate"},features:[c.vb],decls:2,vars:1,consts:[[1,"utility-left-sidebar-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[4,"ngIf"],[3,"ngClass","ngStyle","src","alt","title","click"]],template:function(t,e){1&t&&(c.Mb(0,"div",0),c.jc(1,E,3,1,"ng-container",1),c.Lb()),2&t&&(c.xb(1),c.ac("ngForOf",e.jsonSchema.logos))},directives:[i.j,i.k,i.i,i.l],styles:[".utility-left-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.6vh;min-width:2.14vw;max-width:2.14vw;min-height:95.4vh;max-height:95.4vh;background:#525353;outline:.0625vw inset #fff;border:none;z-index:1000}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-dark-theme[_ngcontent-%COMP%], .utility-icon-light-theme[_ngcontent-%COMP%]{min-width:1.52vw;max-width:1.52vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light-theme-active[_ngcontent-%COMP%], .utility-icon-light-theme[_ngcontent-%COMP%]:active, .utility-icon-light-theme[_ngcontent-%COMP%]:focus{background:#a9a9a9}.utility-icon-dark-theme-active[_ngcontent-%COMP%], .utility-icon-dark-theme[_ngcontent-%COMP%]:active, .utility-icon-dark-theme[_ngcontent-%COMP%]:focus{background:#3b3b3b}"],changeDetection:0}),t})();var X=n("oSzE"),Y=n("DlmY");function R(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Y.a;++e<n;)this.add(t[e])}R.prototype.add=R.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},R.prototype.has=function(t){return this.__data__.has(t)};var T=R,V=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},N=function(t,e,n,i,o,a){var s=1&n,l=t.length,c=e.length;if(l!=c&&!(s&&c>l))return!1;var r=a.get(t);if(r&&a.get(e))return r==e;var h=-1,g=!0,b=2&n?new T:void 0;for(a.set(t,e),a.set(e,t);++h<l;){var d=t[h],u=e[h];if(i)var m=s?i(u,d,h,e,t,a):i(d,u,h,t,e,a);if(void 0!==m){if(m)continue;g=!1;break}if(b){if(!V(e,function(t,e){if(!b.has(e)&&(d===t||o(d,t,n,i,a)))return b.push(e)})){g=!1;break}}else if(d!==u&&!o(d,u,n,i,a)){g=!1;break}}return a.delete(t),a.delete(e),g},$=n("ylTp"),F=n("Ce4a"),U=n("YHEm"),J=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n},K=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},W=$.a?$.a.prototype:void 0,H=W?W.valueOf:void 0,G=n("TFwu"),Z=Object.prototype.hasOwnProperty,q=n("YM6B"),Q=n("/1FC"),tt=n("WOAq"),et=n("oYcn"),nt="[object Object]",it=Object.prototype.hasOwnProperty,ot=n("EUcb"),at=function t(e,n,i,o,a){return e===n||(null==e||null==n||!Object(ot.a)(e)&&!Object(ot.a)(n)?e!=e&&n!=n:function(t,e,n,i,o,a){var s=Object(Q.a)(t),l=Object(Q.a)(e),c=s?"[object Array]":Object(q.a)(t),r=l?"[object Array]":Object(q.a)(e),h=(c="[object Arguments]"==c?nt:c)==nt,g=(r="[object Arguments]"==r?nt:r)==nt,b=c==r;if(b&&Object(tt.a)(t)){if(!Object(tt.a)(e))return!1;s=!0,h=!1}if(b&&!h)return a||(a=new X.a),s||Object(et.a)(t)?N(t,e,n,i,o,a):function(t,e,n,i,o,a,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new F.a(t),new F.a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Object(U.a)(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=J;case"[object Set]":if(l||(l=K),t.size!=e.size&&!(1&i))return!1;var c=s.get(t);if(c)return c==e;i|=2,s.set(t,e);var r=N(l(t),l(e),i,o,a,s);return s.delete(t),r;case"[object Symbol]":if(H)return H.call(t)==H.call(e)}return!1}(t,e,c,n,i,o,a);if(!(1&n)){var d=h&&it.call(t,"__wrapped__"),u=g&&it.call(e,"__wrapped__");if(d||u){var m=d?t.value():t,f=u?e.value():e;return a||(a=new X.a),o(m,f,n,i,a)}}return!!b&&(a||(a=new X.a),function(t,e,n,i,o,a){var s=1&n,l=Object(G.a)(t),c=l.length;if(c!=Object(G.a)(e).length&&!s)return!1;for(var r=c;r--;){var h=l[r];if(!(s?h in e:Z.call(e,h)))return!1}var g=a.get(t);if(g&&a.get(e))return g==e;var b=!0;a.set(t,e),a.set(e,t);for(var d=s;++r<c;){var u=t[h=l[r]],m=e[h];if(i)var f=s?i(m,u,h,e,t,a):i(u,m,h,t,e,a);if(!(void 0===f?u===m||o(u,m,n,i,a):f)){b=!1;break}d||(d="constructor"==h)}if(b&&!d){var v=t.constructor,_=e.constructor;v==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _||(b=!1)}return a.delete(t),a.delete(e),b}(t,e,n,i,o,a))}(e,n,i,o,t,a))};let st=(()=>{class t{constructor(t){this.el=t,this.srcAttr=null,this.canLazyLoad=()=>window&&"IntersectionObserver"in window,this.lazyLoadImage=()=>{new IntersectionObserver(t=>{t.forEach(({isIntersecting:t})=>{t?this.loadImage():this.unloadImage()})}).observe(this.el.nativeElement)},this.loadImage=()=>{this.srcAttr=this.src},this.unloadImage=()=>{this.srcAttr=""}}ngAfterViewInit(){this.canLazyLoad()?this.lazyLoadImage():this.loadImage()}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(c.l))},t.\u0275dir=c.Cb({type:t,selectors:[["img","imgLazyLoad",""]],hostVars:1,hostBindings:function(t,e){2&t&&c.yb("src",e.srcAttr,c.hc)},inputs:{src:"src"}}),t})();function lt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",9),c.Tb("click",function(){c.gc(t);const n=e.$implicit,i=e.index;return c.Vb(3).onClick(n,i)}),c.Mb(2,"div"),c.Ib(3,"img",10),c.Lb(),c.Mb(4,"div",11),c.Mb(5,"label"),c.lc(6),c.Wb(7,"fileNameSlice"),c.Lb(),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=e.$implicit;c.xb(3),c.ac("src",t.img_thumbnail,c.hc),c.xb(3),c.nc("",c.Xb(7,2,t.img_path)," ")}}function ct(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",4),c.Mb(2,"label",5),c.lc(3),c.Lb(),c.Mb(4,"span",6),c.Mb(5,"div",7),c.Tb("click",function(){c.gc(t);const e=c.Vb().$implicit;return c.Vb().onClose(e)}),c.lc(6,"x"),c.Lb(),c.Lb(),c.Mb(7,"section",8),c.jc(8,lt,8,4,"ng-container",1),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=c.Vb(),e=t.$implicit,n=t.index,i=c.Vb();c.xb(1),c.ac("ngClass",i.checkCloseToggle(e)),c.yb("data-index",n),c.xb(2),c.mc(e.name),c.xb(5),c.ac("ngForOf",i._thumbnailList)}}function rt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",19),c.Tb("click",function(){c.gc(t);const e=c.Vb(4);return e.onDisplayInputModal(),e.onIconClick({tabType:"label",action:1})}),c.lc(2," + "),c.Lb(),c.Jb()}}function ht(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",20),c.Mb(2,"input",21),c.Tb("change",function(e){return c.gc(t),c.Vb(4).onChangeInputLabel(e)})("keydown.enter",function(e){return c.gc(t),c.Vb(4).validateInputLabel(e)}),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=c.Vb(4);c.xb(2),c.ac("ngClass",t.invalidInput?"input-invalid":null)("value",t.inputLabel)}}function gt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"span",24),c.Tb("click",function(){c.gc(t);const e=c.Vb().$implicit;return c.Vb(4).onDeleteLabel(e)}),c.lc(2,"Delete"),c.Lb(),c.Jb()}if(2&t){const t=c.Vb(5);c.xb(1),c.ac("ngClass",t.clickAbilityToggle?"pointer":null)}}function bt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",22),c.Mb(2,"label",23),c.Mb(3,"div",24),c.Tb("click",function(){c.gc(t);const n=e.$implicit,i=c.Vb(4);return i.clickAbilityToggle?i.onClickLabel(n):null}),c.lc(4),c.Lb(),c.Lb(),c.Mb(5,"label",25),c.jc(6,gt,3,1,"ng-container",16),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=e.$implicit,n=e.index,i=c.Vb(4);c.xb(1),c.ac("ngClass",t===i.selectedLabel?"label-active":null),c.xb(2),c.ac("ngClass",i.clickAbilityToggle?"pointer":null),c.xb(1),c.nc(" ",t," "),c.xb(2),c.ac("ngIf",!i.action&&n>0)}}function dt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",4),c.Mb(2,"label",5),c.lc(3),c.Lb(),c.Mb(4,"div",13),c.Mb(5,"span",14),c.Mb(6,"div",7),c.Tb("click",function(){c.gc(t);const e=c.Vb(2).$implicit;return c.Vb().onClose(e)}),c.lc(7,"x"),c.Lb(),c.Lb(),c.Ib(8,"span",15),c.Mb(9,"span",15),c.jc(10,rt,3,0,"ng-container",16),c.jc(11,ht,3,2,"ng-container",16),c.Lb(),c.Lb(),c.Mb(12,"div",17),c.Mb(13,"div",18),c.jc(14,bt,7,4,"ng-container",1),c.Lb(),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=c.Vb(2),e=t.$implicit,n=t.index,i=c.Vb();c.xb(1),c.ac("ngClass",i.checkCloseToggle(e)),c.yb("data-index",n),c.xb(2),c.mc(e.name),c.xb(7),c.ac("ngIf",i._thumbnailList.length>0),c.xb(1),c.ac("ngIf",i.displayInputLabel),c.xb(3),c.ac("ngForOf",e.label_list)}}function ut(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",19),c.Tb("click",function(){return c.gc(t),c.Vb(4).onDeleteAnnotation()}),c.lc(2,"-"),c.Lb(),c.Jb()}}function mt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"label",28),c.Tb("click",function(){c.gc(t);const n=e.index,i=e.$implicit,o=c.Vb(6);return o.clickAbilityToggle?o.onClickAnnotation(n,i):null}),c.Mb(2,"div",29),c.lc(3),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=e.$implicit,n=e.index,i=c.Vb(6);c.xb(1),c.ac("ngClass",n===i.selectedIndexAnnotation?"annotation-active":null),c.yb("data-index",n),c.xb(1),c.ac("ngClass",i.clickAbilityToggle?"pointer":null),c.xb(1),c.oc(" ",t.label," : ",t.id," ")}}function ft(t,e){if(1&t&&(c.Kb(0),c.jc(1,mt,4,5,"ng-container",1),c.Jb()),2&t){const t=e.$implicit;c.xb(1),c.ac("ngForOf",t.bnd_box)}}function vt(t,e){if(1&t&&(c.Kb(0),c.jc(1,ft,2,1,"ng-container",1),c.Jb()),2&t){const t=c.Vb(3).$implicit;c.xb(1),c.ac("ngForOf",t.annotation)}}function _t(t,e){if(1&t){const t=c.Nb();c.Mb(0,"div",26),c.Mb(1,"label",5),c.lc(2),c.Lb(),c.Mb(3,"div",13),c.Mb(4,"span",14),c.Mb(5,"div",7),c.Tb("click",function(){c.gc(t);const e=c.Vb(2).$implicit;return c.Vb().onClose(e)}),c.lc(6,"x"),c.Lb(),c.Lb(),c.Ib(7,"span",15),c.Mb(8,"span",15),c.jc(9,ut,3,0,"ng-container",16),c.Lb(),c.Lb(),c.Mb(10,"div",17),c.Mb(11,"div",18),c.Mb(12,"div",27),c.jc(13,vt,2,1,"ng-container",16),c.Lb(),c.Lb(),c.Lb(),c.Lb()}if(2&t){const t=c.Vb(2),e=t.$implicit,n=t.index,i=c.Vb();c.ac("ngClass",i.checkCloseToggle(e)),c.yb("data-index",n),c.xb(2),c.mc(e.name),c.xb(7),c.ac("ngIf",i._thumbnailList.length>0),c.xb(4),c.ac("ngIf",null==e?null:e.annotation)}}function yt(t,e){if(1&t&&(c.jc(0,dt,15,6,"ng-container",2),c.jc(1,_t,14,5,"ng-template",null,12,c.kc)),2&t){const t=c.ec(2),e=c.Vb().index;c.ac("ngIf",1===e)("ngIfElse",t)}}function xt(t,e){if(1&t&&(c.Kb(0),c.jc(1,ct,9,4,"ng-container",2),c.jc(2,yt,3,2,"ng-template",null,3,c.kc),c.Jb()),2&t){const t=e.index,n=c.ec(3);c.xb(1),c.ac("ngIf",0===t)("ngIfElse",n)}}let pt=(()=>{class t{constructor(t,e){this._annotateService=t,this._imgLblState=e,this._thumbnailList=[],this._tabStatus=[],this._onClose=new c.n,this._onClickThumbNail=new c.n,this._onClickLabel=new c.n,this._onEnterLabel=new c.n,this._onChangeAnnotationLabel=new c.n,this._onDeleteAnnotation=new c.n,this.action=-1,this.displayInputLabel=!1,this.inputLabel="",this.selectedIndexAnnotation=-1,this.selectedLabel="",this.unsubscribe$=new l.a,this.clickAbilityToggle=!1,this.invalidInput=!1,this.onClose=t=>{this._onClose.emit({name:t.name,closed:!0})},this.onClick=(t,e)=>{this._onClickThumbNail.emit(Object.assign(Object.assign({},t),{thumbnailIndex:e}))},this.onDisplayInputModal=()=>{this.displayInputLabel=!this.displayInputLabel,this.inputLabel=""},this.validateInputLabel=({target:t})=>{const{value:e}=t,n=e.trim();if(n)if(n.match(/^[a-zA-Z0-9-]*$/))if(this._tabStatus.some(({label_list:t})=>t&&t.length?t.some(t=>t===n):null))this.invalidInput=!0,console.error("Invalid existing label input");else{this.invalidInput=!1;const t=this._tabStatus.map(({label_list:t})=>t||[]).filter(t=>t.length>0)[0];this._onEnterLabel.emit({action:1,label_list:t?[...t,e]:[e]}),this.displayInputLabel=!1}else this.invalidInput=!0,console.error("Invalid input value")},this.onIconClick=({action:t})=>{this.action=t},this.onChangeInputLabel=t=>{const{value:e}=t.target;this.inputLabel=e},this.onDeleteLabel=t=>{const[{label_list:e}]=this._tabStatus.filter(t=>t.label_list);this._onClickLabel.emit({selectedLabel:t,label_list:e&&e.length>0?e:[],action:0})},this.onClickLabel=t=>{this.selectedLabel=t,this.selectedIndexAnnotation>-1&&this._onChangeAnnotationLabel.emit({label:t,index:this.selectedIndexAnnotation})},this.onClickAnnotation=(t,{label:e})=>{this.selectedLabel=e,this._annotateService.setState({annotation:t})},this.onDeleteAnnotation=()=>{this.selectedIndexAnnotation>-1&&this._onDeleteAnnotation.emit(this.selectedIndexAnnotation)},this.checkCloseToggle=({closed:t})=>t?"closed":null,this.checkStateEqual=(t,e)=>!at(t,e)}ngOnInit(){this._imgLblState.action$.pipe(Object(s.a)(this.unsubscribe$)).subscribe(({draw:t})=>this.clickAbilityToggle=t),this._thumbnailList.length>0&&this._annotateService.labelStaging$.pipe(Object(s.a)(this.unsubscribe$)).subscribe(({annotation:t})=>{var e;this.selectedIndexAnnotation=t;const[{annotation:n}]=this._tabStatus.filter(t=>t.annotation),i=null==n?void 0:n.map(({bnd_box:e,polygons:n})=>e?e.find((e,n)=>n===t):n?n.find((e,n)=>n===t):void 0)[0];this.selectedLabel=null!==(e=null==i?void 0:i.label)&&void 0!==e?e:""})}ngOnChanges(t){if(t._thumbnailList){const{currentValue:e}=t._thumbnailList;this._thumbnailList=Object.assign([],this._thumbnailList,[...e])}if(t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){const{currentValue:e}=t._tabStatus;this._tabStatus=[...e]}}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(y),c.Hb(p))},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-project"]],inputs:{_thumbnailList:"_thumbnailList",_tabStatus:"_tabStatus"},outputs:{_onClose:"_onClose",_onClickThumbNail:"_onClickThumbNail",_onClickLabel:"_onClickLabel",_onEnterLabel:"_onEnterLabel",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onDeleteAnnotation:"_onDeleteAnnotation"},features:[c.vb],decls:2,vars:1,consts:[[1,"tab-container"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["nonThumbnailTab",""],[1,"utility-right-project-container","tab","flex-fill-remaining","flex-content",3,"ngClass"],[1,"tab-name"],[1,"tab-close-thumbnail"],[1,"div-close",3,"click"],[1,"utility-inner-container","scroll"],[1,"img-container",3,"click"],["imgLazyLoad","",1,"img",3,"src"],[1,"img-name"],["annotationTab",""],[1,"flex-tab-icons"],[1,"tab-close-thumbnailless"],[1,"tab-extra-icons"],[4,"ngIf"],["id","inner-container",1,"utility-inner-container"],[1,"flex-item"],[1,"extra-icons",3,"click"],[1,"label-input"],["type","text","placeholder","Enter Label",1,"input",3,"ngClass","value","change","keydown.enter"],[1,"flex-center-width",3,"ngClass"],[1,"label"],[3,"ngClass","click"],[1,"action"],[1,"utility-right-project-container","tab","flex-fill-remaining",3,"ngClass"],[1,"flex-center-width"],[1,"label",3,"ngClass","click"],[3,"ngClass"]],template:function(t,e){1&t&&(c.Mb(0,"div",0),c.jc(1,xt,4,2,"ng-container",1),c.Lb()),2&t&&(c.xb(1),c.ac("ngForOf",e._tabStatus))},directives:[i.j,i.k,i.i,st],pipes:[S],styles:['.tab-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;right:0;position:fixed;z-index:1000;min-width:18.5vw;max-width:18.5vw}.utility-right-project-container[_ngcontent-%COMP%]{height:100%;min-width:16.3vw;max-width:16.3vw;background:#696969;outline:.0625vw inset #fff;border:none;z-index:1000;align-items:stretch}.utility-right-project-container[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;min-width:8.5vw;max-width:8.5vw;min-height:4vh;max-height:4vh;background:#383535;z-index:-1;font-size:1.5vh;line-height:3vh;color:#fff;padding:.5vh 0 0 2vw}.tab[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;overflow:hidden}.tab[_ngcontent-%COMP%]:before{position:absolute;content:"";top:4vh;min-width:100vw;max-width:100vw;min-height:93vh;max-height:93vh;background:#383535;z-index:-1}.flex-fixed[_ngcontent-%COMP%]{flex:0 1 25vh}.flex-fill-remaining[_ngcontent-%COMP%]{flex:1 1 auto}.flex-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%}.tab-name[_ngcontent-%COMP%]{font-size:1.7vh;padding:.5vw 2vw 0;display:inline-block;color:#fff;position:absolute}.tab-close-thumbnail[_ngcontent-%COMP%]{vertical-align:middle;color:#696969;font-size:2vh;line-height:4vh;margin-left:3vw;justify-content:center;display:inline-grid}.div-close[_ngcontent-%COMP%], .tab-close-thumbnail[_ngcontent-%COMP%]{float:right;min-height:4vh;max-height:4vh;text-align:center}.div-close[_ngcontent-%COMP%]{min-width:1.6vw;max-width:1.6vw;color:#fff;cursor:pointer}.div-close[_ngcontent-%COMP%]:active{background:grey}.utility-inner-container[_ngcontent-%COMP%]{padding:2.5vh 0 0 .2vw;scroll-behavior:smooth;overflow:hidden auto;z-index:100;min-width:16vw;max-width:16vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.img-container[_ngcontent-%COMP%], .utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.img-container[_ngcontent-%COMP%]{font-size:1.5vh;color:#fff;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;cursor:pointer}.img[_ngcontent-%COMP%]{max-height:4.3vh;min-height:4.3vh;min-width:3vw;max-width:3vw;outline:.0625vw inset #fff}.img-name[_ngcontent-%COMP%]{margin-left:.5vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.closed[_ngcontent-%COMP%]{display:none}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute}.flex-item[_ngcontent-%COMP%]{align-items:center;flex-direction:column;font-size:1.5vh;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.flex-center-width[_ngcontent-%COMP%], .flex-item[_ngcontent-%COMP%]{display:flex;justify-content:center}.flex-center-width[_ngcontent-%COMP%]{width:90%;flex-wrap:wrap}.label[_ngcontent-%COMP%]{flex:1 1 80%;display:flex;justify-content:center;margin:.25vh 0}.pointer[_ngcontent-%COMP%]{cursor:pointer}.annotation-active[_ngcontent-%COMP%], .label-active[_ngcontent-%COMP%]{border:.15vw solid #ff0}.action[_ngcontent-%COMP%]{flex:1 1 20%}.utility-info-btn[_ngcontent-%COMP%]{font-size:1vw;min-width:0;max-width:0;min-height:2.5vh;max-height:2.5vh;line-height:0;right:21vh;position:absolute;background:#383535;border:none;color:#fff}.flex-tab-icons[_ngcontent-%COMP%]{display:flex;width:100%}.tab-close-thumbnailless[_ngcontent-%COMP%]{float:right;vertical-align:middle;min-height:4vh;max-height:4vh;color:#696969;font-size:2vh;line-height:4vh;text-align:center;flex:1 0 60%;justify-content:right;display:inline-grid}.extra-icons[_ngcontent-%COMP%]{cursor:pointer}.extra-icons[_ngcontent-%COMP%]:active{background:grey}.tab-extra-icons[_ngcontent-%COMP%]{float:right;vertical-align:middle;font-size:1.7vh;line-height:4vh;text-align:center;color:#fff;flex:1 0 15%}.tab-text[_ngcontent-%COMP%]{font-size:1.7vh;min-width:6vw;max-width:6vw}.inner-content[_ngcontent-%COMP%]{max-height:25vh;min-height:25vh;min-width:3vw;max-width:3vw}.label-input[_ngcontent-%COMP%]{position:absolute;z-index:1000;margin-left:-4vw}.input[_ngcontent-%COMP%]{border-radius:10vw;border:none;outline:none;padding:.3vw 0 .3vw 1vw;box-shadow:0 0 .3vw;min-height:2vh;max-height:2vh;min-width:6vw;max-width:6vw;font-size:1.7vh}.input-invalid[_ngcontent-%COMP%]{border:.2vw solid red}']}),t})();function Mt(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"div",3),c.Mb(2,"label"),c.Mb(3,"img",4),c.Tb("click",function(){return e.$implicit.onClick()}),c.Lb(),c.Lb(),c.Lb(),c.Jb()),2&t){const t=e.$implicit,n=e.index,i=c.Vb();c.xb(3),c.ac("ngClass",i.conditionalIconTheme())("src",t.imgPath,c.hc)("alt",t.alt)("title",t.hoverLabel),c.yb("data-index",n)}}let wt=(()=>{class t{constructor(){this._onClick=new c.n,this.bindImagePath=()=>{this.jsonSchema={logos:[{imgPath:"../../../assets/icons/folder.svg",hoverLabel:"Folder / Files",alt:"Folder",onClick:()=>this._onClick.emit({name:"project",closed:!1})},{imgPath:"../../../assets/icons/tag.svg",hoverLabel:"Label",alt:"Label",onClick:()=>this._onClick.emit({name:"label",closed:!1})},{imgPath:"../../../assets/icons/bounding_box.svg",hoverLabel:"Annotation",alt:"Annotation",onClick:()=>this._onClick.emit({name:"annotation",closed:!1})},{imgPath:"../../../assets/icons/statistic.svg",hoverLabel:"Statistic",alt:"Statistic",onClick:()=>null}]}},this.conditionalIconTheme=()=>"utility-icon-light"}ngOnInit(){this.bindImagePath()}ngOnChanges(t){this.bindImagePath()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-right-sidebar"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick"},features:[c.vb],decls:3,vars:1,consts:[[1,"utility-right-sidebar-container"],[1,"utility-inner-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"]],template:function(t,e){1&t&&(c.Mb(0,"div",0),c.Mb(1,"div",1),c.jc(2,Mt,4,5,"ng-container",2),c.Lb(),c.Lb()),2&t&&(c.xb(2),c.ac("ngForOf",e.jsonSchema.logos))},directives:[i.j,i.i],styles:[".utility-right-sidebar-container[_ngcontent-%COMP%]{position:absolute;min-width:2.2vw;max-width:2.2vw;min-height:95.5vh;max-height:95.5vh;background:#525353;outline:.0625vw inset #fff;z-index:1000}.utility-inner-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw;position:absolute}.utility-icon-container[_ngcontent-%COMP%], .utility-inner-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active{background:#696969}.utility-icon-dark[_ngcontent-%COMP%]:active{background:#a9a9a9}.input-none[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t})();function St(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"div",3),c.lc(2),c.Lb(),c.Jb()),2&t){const t=c.Vb(2);c.xb(2),c.nc("Image: ",t.thumbnailType,"")}}function Pt(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"div",2),c.Mb(2,"div",3),c.lc(3),c.Lb(),c.jc(4,St,3,1,"ng-container",1),c.Mb(5,"div",3),c.lc(6),c.Lb(),c.Lb(),c.Jb()),2&t){const t=c.Vb();c.xb(3),c.nc("Size: ",t.thumbnailSize,""),c.xb(1),c.ac("ngIf",t.thumbnailType),c.xb(2),c.oc("Dimension: ",t._thumbnailInfo.img_ori_w," x ",t._thumbnailInfo.img_ori_h,"")}}let Ct=(()=>{class t{constructor(){this._imgSrc="",this.thumbnailSize="",this.thumbnailType="",this.formatBytes=(t,e=2)=>{if(0===t)return"0 Bytes";const n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}ngOnInit(){}ngOnChanges(t){if(t._thumbnailInfo&&t._imgSrc){const{currentValue:e}=t._thumbnailInfo,{currentValue:n}=t._imgSrc;this._thumbnailInfo=Object.assign(Object.assign({},this._thumbnailInfo),e),this.thumbnailSize=this.formatBytes(n.length);const i=n.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(i&&i.length){const t=i[1].split("/")[1];this.thumbnailType=t}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-footer"]],inputs:{_thumbnailInfo:"_thumbnailInfo",_imgSrc:"_imgSrc"},features:[c.vb],decls:3,vars:3,consts:[[1,"footer-container"],[4,"ngIf"],[1,"footer-label-container"],[1,"footer-label"]],template:function(t,e){1&t&&(c.Mb(0,"div",0),c.jc(1,Pt,7,4,"ng-container",1),c.Wb(2,"json"),c.Lb()),2&t&&(c.xb(1),c.ac("ngIf","{}"!=c.Xb(2,1,e._thumbnailInfo)))},directives:[i.k],pipes:[i.e],styles:[".footer-container[_ngcontent-%COMP%]{position:absolute;background:#525353;outline:.0625vw inset #fff;border:none;min-height:2.3vh;max-height:2.3vh;min-width:100vw;max-width:100vw;bottom:0}.footer-label-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:baseline;width:40%}.footer-label[_ngcontent-%COMP%]{font-size:1.6vh;color:#fff;flex:0 1 30%;outline:none;border-right:1px solid #fff;text-align:center}.border-right[_ngcontent-%COMP%]{border-right:1rem #fff}"],changeDetection:0}),t})();var Ot=n("44N4"),Lt=n("XIp8");class kt{constructor(){}stringifyObject(t){try{return JSON.stringify(t)}catch(e){return console.log("StringifyObject(content) ----\x3e ",e.name+": ",e.message),""}}deepCloneObject(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.log("DeepCloneObject(content) ----\x3e ",e.name+": ",e.message),null}}deepCloneVariable(t){try{const e=t?JSON.parse(JSON.stringify({item:t})):"",{item:n}=e;return n}catch(e){return console.log("DeepCloneVariable(variable) ----\x3e ",e.name+": ",e.message),""}}generateUniquesID(){try{let t="";const e=new Date;return t+=e.getDate().toString(),t+=(e.getMonth()+1).toString(),t+=e.getFullYear().toString(),t+=e.getHours().toString(),t+=e.getMinutes().toString(),t+=e.getSeconds().toString(),t+=e.getMilliseconds().toString(),parseInt(t,10)}catch(t){return console.log("GenerateUniquesID() ----\x3e ",t.name+": ",t.message),-1}}matchStringHead(t,e){try{return e.substr(0,t.length)===t}catch(n){return console.log("MatchStringHead(StrToMatch:string, oristr:string) ----\x3e ",n.name+": ",n.message),!1}}getFilename(t){try{const e=this.deepCloneVariable(t).split("\\").join("/").split("/");return e[e.length-1]}catch(e){return console.log("GetFilename(strs) ----\x3e ",e.name+": ",e.message),""}}GetFoldername(t){try{const e=JSON.parse(JSON.stringify({st:t})).st.split("\\").join("/").split("/");return e.pop(),e.join("/")}catch(e){return console.log("GetFoldername(strs) ----\x3e ",e.name+": ",e.message),""}}RemoveHTMLElement(t){var e;try{const n=document.getElementById(t);null!=n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}catch(n){console.log("RemoveHTMLElement(ids) ----\x3e ",n.name+": ",n.message)}}}let It=(()=>{class t{constructor(){this.globalXY={x:0,y:0},this.panXY={x:0,y:0},this.currentClickedBox={box:-1,pos:"o"},this.lineOffset=3,this.anchrSize=2.5,this.currentDrawing={x1:0,x2:0,y1:0,y2:0},this.currentSelectedBndBox=-1,this.util=new kt}getdiffXY(t,e){try{const n={diffX:0,diffY:0};return null!=t&&null!=e&&(n.diffX=this.globalXY.x+(t-this.panXY.x),n.diffY=this.globalXY.y+(e-this.panXY.y)),n}catch(n){return console.log("ObjectDetection GetdiffXY(offsetX: number,offsetY: number): { diffX: number; diffY: number }",n.name+": ",n.message),{diffX:-1,diffY:-1}}}setCurrentX1Y1(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x1=t,this.currentDrawing.y1=e)}catch(n){console.log("ObjectDetection setCurrentX1Y1(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}setCurrentX2Y2(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x2=t,this.currentDrawing.y2=e)}catch(n){console.log("ObjectDetection setCurrentX2Y2(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}moveAllBbox(t,e,n,i){try{for(const i of t){const t=i.x2-i.x1,o=i.y2-i.y1;i.x1=Object(Lt.a)(e+i.distancetoImg.x),i.y1=Object(Lt.a)(n+i.distancetoImg.y),i.x2=Object(Lt.a)(i.x1+t),i.y2=Object(Lt.a)(i.y1+o)}i(!0)}catch(o){}}calScaleTofitScreen(t,e,n,i){try{const o={factor:-1,newX:-1,newY:-1};return o.factor=Math.min(n/t,i/e),o.factor=o.factor-.05*o.factor,o.newX=n/2-t/2*o.factor,o.newY=i/2-e/2*o.factor,o}catch(o){return{factor:-1,newX:-1,newY:-1}}}deleteSingleBox(t,e,n){try{t.splice(e,1),this.currentSelectedBndBox=-1,this.currentClickedBox={box:-1,pos:"o"},n(!0)}catch(i){}}keyboardMoveBox(t,e,n,i,o,a,s){try{const l=e.x2-e.x1,c=e.y2-e.y1;"up"===t?this.moveBoxWithinPointPath(n,i,o,a,0,-3,e)&&(e.y1-=3,e.y2=Object(Lt.a)(e.y1+l)):"down"===t?this.moveBoxWithinPointPath(n,i,o,a,0,3,e)&&(e.y1+=3,e.y2=Object(Lt.a)(e.y1+l)):"left"===t?this.moveBoxWithinPointPath(n,i,o,a,-3,0,e)&&(e.x1-=3,e.x2=Object(Lt.a)(e.x1+c)):"right"===t&&this.moveBoxWithinPointPath(n,i,o,a,3,0,e)&&(e.x1+=3,e.x2=Object(Lt.a)(e.x1+c)),s(!0)}catch(l){}}mouseMoveBox(t,e,n){try{if(this.moveBoxWithinPointPath(n.img_x,n.img_y,n.img_w,n.img_h,t-this.currentDrawing.x1,e-this.currentDrawing.y1,n.bnd_box[this.currentSelectedBndBox])){this.setCurrentX2Y2(t,e);const i=this.currentDrawing.x2-this.currentDrawing.x1,o=this.currentDrawing.y2-this.currentDrawing.y1;this.setCurrentX1Y1(this.currentDrawing.x2,this.currentDrawing.y2),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"l"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x1+=i),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"t"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y1+=o),"i"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos&&"r"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x2+=i),"i"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos&&"b"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y2+=o)}}catch(i){console.log("ObjectDetection mouseMoveBox(MouseX:number, MouseY:number, CurrMeta:Metadata):void",i.name+": ",i.message)}}getCurrentSelectedBox(){try{return this.currentSelectedBndBox}catch(t){return-1}}setCurrentSelectedbBox(t){try{this.currentSelectedBndBox=t}catch(e){console.log("ObjectDetection setCurrentSelectedbBox(newNUM:number):void",e.name+": ",e.message)}}mouseUpDrawEnable(t,e){try{const n={selBox:-1,isNew:!1};if(-1===this.currentClickedBox.box&&null!==this.tmpbox)t.bnd_box.push(this.tmpbox),this.currentSelectedBndBox=t.bnd_box.length-1,t.bnd_box[this.currentSelectedBndBox].label="default",n.isNew=!0,n.selBox=Object(Lt.a)(this.currentSelectedBndBox);else{if(t.bnd_box[this.currentSelectedBndBox].x1>t.bnd_box[this.currentSelectedBndBox].x2){const e=Object(Lt.a)(t.bnd_box[this.currentSelectedBndBox].x1);t.bnd_box[this.currentSelectedBndBox].x1=Object(Lt.a)(t.bnd_box[this.currentSelectedBndBox].x2),t.bnd_box[this.currentSelectedBndBox].x2=e}if(t.bnd_box[this.currentSelectedBndBox].y1>t.bnd_box[this.currentSelectedBndBox].y2){const e=Object(Lt.a)(t.bnd_box[this.currentSelectedBndBox].y1);t.bnd_box[this.currentSelectedBndBox].y1=Object(Lt.a)(t.bnd_box[this.currentSelectedBndBox].y2),t.bnd_box[this.currentSelectedBndBox].y2=e}}return this.currentClickedBox={box:-1,pos:"o"},this.setCurrentX1Y1(0,0),this.setCurrentX2Y2(0,0),this.tmpbox=null,e(!0),n}catch(n){return console.log("ObjectDetection MouseUpDrawEnable(CurrMeta: Metadata): number",n.name+": ",n.message),{selBox:-1,isNew:!1}}}panRectangle(t,e,n,i){try{for(const i of t){const t=i.x2-i.x1,o=i.y2-i.y1;i.x1=e+i.distancetoImg.x,i.y1=n+i.distancetoImg.y,i.x2=i.x1+t,i.y2=i.y1+o}i(!0)}catch(o){console.log("ObjectDetection panRectangle(bbox:Boundingbox[], img_X:number, img_Y:number)",o.name+": ",o.message)}}scaleAllBoxes(t,e,n,i,o){try{for(const o of e){console.log(o);const e=o.distancetoImg.x*t+n,a=o.distancetoImg.y*t+i,s=e+(o.x2-o.x1)*t,l=a+(o.y2-o.y1)*t;o.x1=Object(Lt.a)(e),o.y1=Object(Lt.a)(a),o.x2=Object(Lt.a)(s),o.y2=Object(Lt.a)(l);const c=o.x1-n,r=o.y1-i;o.distancetoImg.x=Object(Lt.a)(c),o.distancetoImg.y=Object(Lt.a)(r)}o(!0)}catch(a){console.log("ObjectDetection scaleAllBoxes(scalefactor: number,boxes:Boundingbox[],imgX:number,imgY:number)",a.name+": ",a.message)}}mouseMoveDrawEnable(t,e,n){try{-1===this.currentClickedBox.box?this.setCurrentX2Y2(t,e):this.mouseMoveBox(t,e,n)}catch(i){console.log("ObjectDetection MouseMoveDrawEnable(MouseX: number,MouseY: number,SelectedMeta: Metadata): void",i.name+": ",i.message)}}mouseDownDrawEnable(t,e,n){try{return this.getCurrentClickBox(t,e,n),this.setCurrentX1Y1(t,e),this.setCurrentX2Y2(t,e),this.currentSelectedBndBox=-1!==this.currentClickedBox.box?this.currentClickedBox.box:-1,this.currentClickedBox.box}catch(i){return console.log("ObjectDetection MouseDownDrawEnable(MouseX:number,MouseY:number,BBox:Boundingbox[]):number",i.name+": ",i.message),-1}}setPanXY(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}setGlobalXY(t,e){try{return!(!t||!e||(this.globalXY.x=t,this.globalXY.y=e,0))}catch(n){return console.log("ObjectDetection SetGlobalXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}changeLabel(t,e){t&&e&&(t.label=e)}moveBoxWithinPointPath(t,e,n,i,o,a,s){try{return!(s.x1+o<t||s.x2+o>t+n||s.y1+a<e||s.y2+a>e+i)}catch(l){return console.log("ObjectDetection isWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, addx:number, addy:number, box:Boundingbox):Boolean",l.name+": ",l.message),!1}}mouseClickWithinPointPath(t,e,n,i,o,a){try{return o>t&&o<t+n&&a>e&&a<e+i}catch(s){return console.log("ObjectDetection mouseClickWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, coorX:number,):boolean",s.name+": ",s.message),!1}}drawAllBoxOn(t,e){try{if(t.length>0)for(const[n,i]of t.entries())n===this.currentClickedBox.box||n===this.currentSelectedBndBox?(i.color="rgba(0,255,0,1.0)",i.lineWidth=2,this.drawEachBoxOn(i,e,!0)):(i.color="rgba(255,255,0,0.8)",i.lineWidth=1,this.drawEachBoxOn(i,e,!1));if(-1===this.currentClickedBox.box&&-1===this.currentSelectedBndBox){for(const s of t)s.color="rgba(255,255,0,0.8)",this.drawEachBoxOn(s,e,!1);const{x1:n,x2:i,y1:o,y2:a}=this.currentDrawing;this.tmpbox=this.generateNewBox(n,i,o,a),this.tmpbox&&this.drawEachBoxOn(this.tmpbox,e,!0)}}catch(n){console.log("redraw(boundbox) ----\x3e ",n.name+": ",n.message)}}drawEachBoxOn(t,e,n){try{if(e){const i=t.x1+(t.x2-t.x1)/2,o=t.y1+(t.y2-t.y1)/2;e.strokeStyle="white",e.fillStyle="black",e.font="bold 12px Arial",e.strokeText(t.label,t.x1+10,t.y1+15),e.fillText(t.label,t.x1+10,t.y1+15),e.strokeStyle=t.color,e.beginPath(),e.rect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),e.lineWidth=t.lineWidth,e.stroke(),e.fillStyle=t.color,n&&(e.beginPath(),e.fillRect(t.x1-this.anchrSize,t.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x1-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x1-this.anchrSize,t.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(i-this.anchrSize,t.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(i-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(i-this.anchrSize,t.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x2-this.anchrSize,t.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x2-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x2-this.anchrSize,t.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize))}}catch(i){console.log("ObjectDetection drawEachBoxOn(box:Boundingbox, context:CanvasRenderingContext2D, isSelected:boolean):void",i.name+": ",i.message)}}generateNewBox(t,e,n,i){try{const o=t<e?t:e,a=n<i?n:i,s=t>e?t:e,l=n>i?n:i;return s-o>this.lineOffset&&l-a>this.lineOffset?{x1:o,y1:a,x2:s,y2:l,lineWidth:2,color:"rgba(0,255,0,1.0)",distancetoImg:{x:0,y:0},label:"default",id:this.util.generateUniquesID()}:null}catch(o){return console.log("ObjectDetection GenerateNewBox(x1:number,x2:number,y1:number,y2:number):Boundingbox",o.name+": ",o.message),null}}getBBoxDistfromImg(t,e,n){try{for(const{x1:i,y1:o,distancetoImg:a}of t){const t=i-e,s=o-n;a.x=Object(Lt.a)(t),a.y=Object(Lt.a)(s)}}catch(i){console.log("ObjectDetection GetBBoxDistfromImg(bbox:Boundingbox[],imgX:number,imgY:number)",i.name+": ",i.message)}}getCurrentClickBox(t,e,n){try{return this.currentClickedBox=this.mouseClickOnBoxes(t,e,n),this.currentClickedBox}catch(i){return console.log("ObjectDetection getCurrentClickBox(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}mouseClickOnBoxes(t,e,n){try{for(let i=0;i<n.length;++i){const o=n[i].x1+(n[i].x2-n[i].x1)/2,a=n[i].y1+(n[i].y2-n[i].y1)/2;if(n[i].x1-this.lineOffset<t&&t<n[i].x1+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tl"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"bl"};if(a-this.lineOffset<e&&e<a+this.lineOffset)return{box:i,pos:"l"}}else if(n[i].x2-this.lineOffset<t&&t<n[i].x2+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tr"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"br"};if(a-this.lineOffset<e&&e<a+this.lineOffset)return{box:i,pos:"r"}}else if(o-this.lineOffset<t&&t<o+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"t"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"b"};if(n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}else if(n[i].x1-this.lineOffset<t&&t<n[i].x2+this.lineOffset&&n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}return{box:-1,pos:"o"}}catch(i){return console.log("ObjectDetection mouseClickOnBoxes(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),jt=(()=>{class t{constructor(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.maxStageSize=51,this.allowUndo=!1,this.allowRedo=!1,this.utility=new kt,this.removeLastArray=t=>t.splice(-1,1)[0]}appendStages(t){t&&(this.redoArr=[],this.allowRedo=!1,0===this.currentArr.length?this.currentArr.push(this.utility.deepCloneVariable(t)):(this.undoArr.length===this.maxStageSize&&this.undoArr.splice(0,1),this.undoArr.push(this.removeLastArray(this.currentArr)),this.currentArr.push(this.utility.deepCloneVariable(t)),this.allowUndo=!0))}clearAllStages(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.allowUndo=!1,this.allowRedo=!1}undo(){if(this.allowRedo=!0,this.undoArr.length>0){this.redoArr.push(this.removeLastArray(this.currentArr));const t=this.removeLastArray(this.undoArr);return this.currentArr.push(t),this.allowUndo=0!==this.undoArr.length,t}return null}redo(){let t=null;return 0!==this.redoArr.length&&(this.undoArr.push(this.removeLastArray(this.currentArr)),t=this.removeLastArray(this.redoArr),this.currentArr.push(t),this.allowRedo=0!==this.redoArr.length),this.allowUndo=this.undoArr.length>0,t}clearRedundantStages(){var t,e;(null===(t=this.currentArr[0])||void 0===t?void 0:t.meta)&&"Polygons"in this.currentArr[0].meta||this.undoArr.length>0&&(!this.isStateChange((null===(e=this.undoArr[this.undoArr.length-1])||void 0===e?void 0:e.meta).bnd_box)||(this.currentArr.pop(),this.currentArr.push(this.removeLastArray(this.undoArr))))}isAllowRedo(){return this.allowRedo}isAllowUndo(){return this.allowUndo}isMethodChange(t){var e;return(null===(e=this.currentArr[0])||void 0===e?void 0:e.method)!==t}replaceStages(t){!t||(this.currentArr[0]=this.utility.deepCloneVariable(t))}isStateChange(t){return null!=t&&!(!this.isAnnotationChange(t)&&!this.isLabelChange(t))}isLabelChange(t){var e,n,i,o;if((null===(e=this.currentArr[0])||void 0===e?void 0:e.meta)&&"Polygons"in(null===(n=this.currentArr[0])||void 0===n?void 0:n.meta)){const e=t,n=(null===(i=this.currentArr[0])||void 0===i?void 0:i.meta).polygons;if(e.length!==n.length)return!0;for(const[t,{label:i}]of n.entries());}else{const e=t,n=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).bnd_box;if(e.length!==n.length)return!0;for(const[t,{label:i}]of n.entries())if(e[t].label!==i)return!0}return!1}isAnnotationChange(t){var e,n,i,o;if((null===(e=this.currentArr[0])||void 0===e?void 0:e.meta)&&"Polygons"in(null===(n=this.currentArr[0])||void 0===n?void 0:n.meta)){if(this.currentArr.length<1)return!0;{const e=t,n=(null===(i=this.currentArr[0])||void 0===i?void 0:i.meta).polygons;return e.length!==n.length||!!n.some(({coorPt:t},n)=>e.some(({coorPt:e},i)=>t[n].x!==e[i].x||t[n].y!==e[i].y))||null}}if(this.currentArr.length<1)return!0;{const e=t,n=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).bnd_box;if(e.length!==n.length)return!0;for(const[t,{x1:i,x2:o,y1:a,y2:s}]of e.entries())return i!==n[t].x1||o!==n[t].x2||a!==n[t].y1||s!==n[t].y2||null}return!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),Bt=(()=>{class t{constructor(){this.MEMO=null,this.utility=new kt}copy(t){!t||(this.MEMO=this.utility.deepCloneVariable(t))}paste(){return this.MEMO?"coorPt"in this.MEMO?this.polygonPaste():this.boundingBoxPaste():null}isAvailable(){return!!this.MEMO}clear(){this.MEMO=null}polygonPaste(){const t=this.utility.deepCloneObject(this.MEMO);let{coorPt:e,id:n}=t;for(const i of e)i.x+=8,i.y+=8,i.distancetoImg.x=0,i.distancetoImg.y=0;return n=this.utility.generateUniquesID(),t}boundingBoxPaste(){const t=this.utility.deepCloneObject(this.MEMO);let{x1:e,x2:n,y1:i,y2:o,id:a,distancetoImg:s}=t;const l=n-e,c=o-i;return e+=8,i+=8,n=e+l,o=i+c,a=this.utility.generateUniquesID(),s.x=0,s.y=0,t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const At=["canvasdrawing"],Dt=["crossh"],Et=["crossv"];let zt=(()=>{class t{constructor(t,e,n,i,o){this._boundingBoxCanvas=t,this._imgLblStateService=e,this._undoRedoService=n,this._copyPasteService=i,this._annotateSelectState=o,this.img=new Image,this.mousedown=!1,this._imgSrc="",this._onChangeMetadata=new c.n}ngOnInit(){this._imgLblStateService.action$.subscribe(t=>(this.boundingBoxState=t,this.isFitCenter(),this.isClearCanvas())),this._annotateSelectState.labelStaging$.subscribe(t=>(this.annotateState=t,this.annotateStateOnChange()))}ngOnChanges(t){var e,n;try{t._selectMetadata&&this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),!t._imgSrc.currentValue||(this.initCanvas(),this.context=(null===(n=null===(e=this.mycanvas)||void 0===e?void 0:e.nativeElement)||void 0===n?void 0:n.getContext("2d"))?this.mycanvas.nativeElement.getContext("2d"):null,this._undoRedoService.clearAllStages(),this.loadImages(t._imgSrc.currentValue))}catch(i){}}emitMetadata(){this._onChangeMetadata.emit(this._selectMetadata)}annotateStateMakeChange(t){null!==t&&this._annotateSelectState.setState(t)}rulesMakeChange(t,e,n){try{const i=Object(Lt.a)(this.boundingBoxState);null===t||(i.scroll=t),null===e||(i.fitCenter=e),null===n||(i.clear=n),this._imgLblStateService.setState(i)}catch(i){}}isClearCanvas(){try{this.boundingBoxState.clear&&(this._selectMetadata.bnd_box=[],this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.rulesMakeChange(null,null,!1),this.emitMetadata())}catch(t){}}isFitCenter(){try{this.boundingBoxState.fitCenter&&this.imgFitToCenter()}catch(t){}}annotateStateOnChange(){this.annotateState&&this._boundingBoxCanvas.setCurrentSelectedbBox(this.annotateState.annotation)}imgFitToCenter(){try{const t=this._boundingBoxCanvas.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._boundingBoxCanvas.scaleAllBoxes(t.factor,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,()=>{}),this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._boundingBoxCanvas.setGlobalXY(t.newX,t.newY),this._boundingBoxCanvas.moveAllBbox(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,t=>{if(t){const t=Object(Lt.a)(this._selectMetadata);return this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:t,method:"zoom"}):this._undoRedoService.replaceStages({meta:t,method:"zoom"})}return{}}),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata(),this.rulesMakeChange(null,!1,null)}catch(t){}}keyStrokeEvent(t){try{if(!this.mousedown){const{isActiveModal:e}=this.boundingBoxState;if(!t.ctrlKey||"c"!==t.key&&"C"!==t.key||e)if(!t.ctrlKey||"v"!==t.key&&"V"!==t.key||e){if(!t.ctrlKey||!t.shiftKey||"z"!==t.key&&"Z"!==t.key||e){if(!t.ctrlKey||"z"!==t.key&&"Z"!==t.key||e)e||"Delete"!==t.key&&"Backspace"!==t.key?"ArrowLeft"!==t.key||e?"ArrowRight"!==t.key||e?"ArrowUp"!==t.key||e?"ArrowDown"===t.key&&!e&&this.keyMoveBox("down"):this.keyMoveBox("up"):this.keyMoveBox("right"):this.keyMoveBox("left"):this._boundingBoxCanvas.deleteSingleBox(this._selectMetadata.bnd_box,this.annotateState.annotation,t=>{!t||(this.annotateStateMakeChange({annotation:-1,isDlbClick:!1}),this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())});else if(this._undoRedoService.isAllowUndo()){const t=this._undoRedoService.undo();this._selectMetadata=Object(Lt.a)(null==t?void 0:t.meta),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}}else if(this._undoRedoService.isAllowRedo()){const t=this._undoRedoService.redo();this._selectMetadata=Object(Lt.a)(null==t?void 0:t.meta),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}}else this._copyPasteService.isAvailable()&&(this._selectMetadata.bnd_box.push(this._copyPasteService.paste()),this.annotateStateMakeChange({annotation:this._selectMetadata.bnd_box.length-1,isDlbClick:!1}),this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y)),this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata(),this.mycanvas.nativeElement.focus();else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation])}}catch(e){}}toggleEvent(t){try{this.annotateState.annotation>-1&&(this._undoRedoService.clearRedundantStages(),this.annotateStateMakeChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){}}mouseScroll(t){try{const e=Math.max(-1,Math.min(1,-t.deltaY||-t.detail));e&&this.boundingBoxState.scroll&&this.zoomImage(e)}catch(e){console.log("MouseScroll(event: WheelEvent)",e.name+": ",e.message)}}mouseDown(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)&&(this.mousedown=!0,this.rulesMakeChange(!1,null,null),this.boundingBoxState.drag&&this._boundingBoxCanvas.setPanXY(t.offsetX,t.offsetY),this.boundingBoxState.draw)){const e=this._boundingBoxCanvas.mouseDownDrawEnable(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.annotateStateMakeChange({annotation:e,isDlbClick:!1}),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}}catch(e){console.log("MouseDown(event: MouseEvent)",e.name+": ",e.message)}}mouseUp(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)){if(this.boundingBoxState.drag&&this.mousedown&&this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.boundingBoxState.draw&&this.mousedown){const t=this._boundingBoxCanvas.mouseUpDrawEnable(this._selectMetadata,t=>{!t||!this._undoRedoService.isStateChange(this._selectMetadata.bnd_box)||this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"})});!t.isNew||this.annotateStateMakeChange({annotation:t.selBox,isDlbClick:!1})}this.mousedown=!1,this.rulesMakeChange(!0,null,null),this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this.emitMetadata()}}catch(e){console.log("MouseUp(event: MouseEvent)",e.name+": ",e.message)}}mouseMove(t){try{if(this._selectMetadata)if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)){if(this.boundingBoxState.drag&&this.mousedown){const e=this._boundingBoxCanvas.getdiffXY(t.offsetX,t.offsetY);this._selectMetadata.img_x=e.diffX,this._selectMetadata.img_y=e.diffY,this._boundingBoxCanvas.panRectangle(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,t=>{if(t){const t=Object(Lt.a)(this._selectMetadata);return this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:t,method:"pan"}):this._undoRedoService.replaceStages({meta:t,method:"pan"})}return{}}),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}this.boundingBoxState.draw&&this.mousedown&&(this._boundingBoxCanvas.mouseMoveDrawEnable(t.offsetX,t.offsetY,this._selectMetadata),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h))}else"-1"===this.crossh.nativeElement.style.zIndex&&"hidden"===this.crossh.nativeElement.style.visibility&&"-1"===this.crossv.nativeElement.style.zIndex&&"hidden"===this.crossv.nativeElement.style.visibility||(this.crossh.nativeElement.style.zIndex="-1",this.crossh.nativeElement.style.visibility="hidden",this.crossv.nativeElement.style.zIndex="-1",this.crossv.nativeElement.style.visibility="hidden")}catch(e){console.log("MouseMove(event: MouseEvent)",e.name+": ",e.message)}}mouseOut(t){try{this.boundingBoxState.drag&&this.mousedown&&(this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)),this.mousedown=!1}catch(e){console.log("MouseOut(event: MouseEvent)",e.name+": ",e.message)}}initCanvas(){try{this.mycanvas.nativeElement.style.width="80%",this.mycanvas.nativeElement.style.height="90%",this.mycanvas.nativeElement.width=this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.height=this.mycanvas.nativeElement.offsetHeight}catch(t){}}loadImages(t){try{console.log(this.context),this.img.src=t,this.img.onload=()=>{this._selectMetadata.img_w=this._selectMetadata.img_w<1?this._selectMetadata.img_ori_w:this._selectMetadata.img_w,this._selectMetadata.img_h=this._selectMetadata.img_h<1?this._selectMetadata.img_ori_h:this._selectMetadata.img_h,this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.imgFitToCenter(),this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"})}}catch(e){}}keyMoveBox(t){try{this._boundingBoxCanvas.keyboardMoveBox(t,this._selectMetadata.bnd_box[this.annotateState.annotation],this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t=>{!t||(this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())})}catch(e){}}redrawImages(t,e,n,i){var o;try{this.clearcanvas(),null===(o=this.context)||void 0===o||o.drawImage(this.img,t,e,n,i),this._boundingBoxCanvas.drawAllBoxOn(this._selectMetadata.bnd_box,this.context),this.mycanvas.nativeElement.focus()}catch(a){}}clearcanvas(){var t;try{null===(t=this.context)||void 0===t||t.clearRect(0,0,this.mycanvas.nativeElement.width,this.mycanvas.nativeElement.height)}catch(e){}}zoomImage(t){try{t>0?(this._selectMetadata.img_w*=1.1,this._selectMetadata.img_h*=1.1,this._boundingBoxCanvas.scaleAllBoxes(1.1,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,t=>{!t||(this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"zoom"}),this.emitMetadata())})):.9*this._selectMetadata.img_w>100&&.9*this._selectMetadata.img_h>100&&(this._selectMetadata.img_w*=.9,this._selectMetadata.img_h*=.9,this._boundingBoxCanvas.scaleAllBoxes(.9,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,t=>{if(t){const t=Object(Lt.a)(this._selectMetadata);this.emitMetadata(),this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:t,method:"zoom"}):this._undoRedoService.replaceStages({meta:t,method:"zoom"})}})),this._copyPasteService.isAvailable()&&this._copyPasteService.clear(),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}catch(e){}}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(It),c.Hb(p),c.Hb(jt),c.Hb(Bt),c.Hb(y))},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-object-detection"]],viewQuery:function(t,e){if(1&t&&(c.pc(At,!0),c.pc(Dt,!0),c.pc(Et,!0)),2&t){let t;c.dc(t=c.Ub())&&(e.mycanvas=t.first),c.dc(t=c.Ub())&&(e.crossh=t.first),c.dc(t=c.Ub())&&(e.crossv=t.first)}},hostBindings:function(t,e){1&t&&c.Tb("keydown",function(t){return e.keyStrokeEvent(t)},!1,c.fc)("dblclick",function(t){return e.toggleEvent(t)})("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[c.vb],decls:7,vars:0,consts:[[1,"canvasstyle"],["canvasdrawing",""],[1,"crosses","cross-h"],["crossh",""],[1,"crosses","cross-v"],["crossv",""]],template:function(t,e){1&t&&(c.Mb(0,"div"),c.Ib(1,"canvas",0,1),c.Ib(3,"div",2,3),c.Ib(5,"div",4,5),c.Lb())},styles:[".cross-h[_ngcontent-%COMP%]{width:100%;height:1px;margin-top:-1px;opacity:.8}.cross-v[_ngcontent-%COMP%]{height:100%;width:1px;margin-left:-1px;opacity:.8}.crosses[_ngcontent-%COMP%]{position:fixed;background-color:#ff0;box-shadow:0 0 5px #646464;pointer-events:none;visibility:hidden}.canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}"],changeDetection:0}),t})();var Xt=n("CfRg"),Yt=function(t){return Object(Xt.a)(t,4)};let Rt=(()=>{class t{constructor(){this.globalXY={x:-1,y:-1},this.panXY={x:0,y:0},this.clickPoint={polygonIndex:-1,pointIndex:-1},this.radius=3.5,this.distanceOffset=8,this.tmpPolygon={color:"",coorPt:[],id:0,label:"",lineWidth:0,region:"",subLabel:[]},this.selectedPolygonIndex=-1,this.util=new kt,this.isNewPoly=!1}mouseDownDraw({offsetX:t,offsetY:e},n,{width:i,height:o},a,s,l,c){return this.setGlobalXY({img_x:t,img_y:e}),this.selectedPolygonIndex=this.findPolygonArea(t,e,n),this.clickPoint=this.findClickPoint(t,e,n),this.isNewPolygon()&&l?this.setPanXY({offsetX:t,offsetY:e}):!this.tmpPolygon&&this.selectedPolygonIndex<0||c?(this.setPolygonsLineWidth(n,-1),this.selectedPolygonIndex=-1,this.setNewpolygon(!0),this.pushTmpPoint(t,e,n.img_x,n.img_y,n.polygons.length)):this.isNewPolygon()?(this.pushTmpPoint(t,e,n.img_x,n.img_y,n.polygons.length),this.drawNewPolygon(n,a,s,i,o,!1),this.drawfromPreviousPoint(t,e,s)):(this.setNewpolygon(!1),this.selectedPolygonIndex=this.findPolygonArea(t,e,n)>-1?this.findPolygonArea(t,e,n):this.findClickPoint(t,e,n).polygonIndex,this.setPolygonsLineWidth(n,this.selectedPolygonIndex)),this.selectedPolygonIndex}mouseMoveDraw(t,e,n,i,o,a,s,l,c,r){if(this.isNewPolygon()&&l&&c){const e=a-this.getPanX(),n=s-this.getPanY();t&&(t.img_x=this.getGlobalX()+e,t.img_y=this.getGlobalY()+n,this.panPolygons(t,t.img_x,t.img_y,!0),r("pan"))}else this.isNewPolygon()?(this.drawNewPolygon(t,e,n,i,o,!1),this.drawfromPreviousPoint(a,s,n)):this.selectedPolygonIndex>-1&&c?this.mouseMovePolygon(a,s,t,n,this.selectedPolygonIndex,e,i,o):(this.setPolygonCoordinate(a,s,t,this.clickPoint.polygonIndex,this.clickPoint.pointIndex),r("draw"))}setPanXY({offsetX:t,offsetY:e}){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("setPanXY",n),!1}}getPanX(){return this.panXY.x}getPanY(){return this.panXY.y}setSelectedPolygonIndex(t){t&&(this.selectedPolygonIndex=t)}getselectedPolygonIndex(){return this.selectedPolygonIndex}mouseClickWithinPointPath({img_x:t,img_y:e,img_w:n,img_h:i},{offsetX:o,offsetY:a}){return o>t&&o<t+n&&a>e&&a<e+i}calScaleToFitScreen({img_w:t,img_h:e},{offsetWidth:n,offsetHeight:i}){try{const o={factor:-1,newX:-1,newY:-1},a=Math.min(n/t,i/e);return o.factor=a-.05*a,o.newX=n/2-t/2*o.factor,o.newY=i/2-e/2*o.factor,o}catch(o){return console.log("calScaleToFitScreen",o),{factor:-1,newX:-1,newY:-1}}}pushTmpPoint(t,e,n,i,o){try{const a=t-n,s=e-i;this.tmpPolygon?this.tmpPolygon.coorPt.push({x:t,y:e,distancetoImg:{x:a,y:s}}):this.generateNewtmpPolygon(o)}catch(a){console.log("pushTmpPoint",a)}}removeLastPoint(t,e,n,i,o){try{return this.tmpPolygon&&this.tmpPolygon.coorPt.length>1?(this.tmpPolygon.coorPt.pop(),!1):(this.resetDrawing(t,e,n,i,o),!0)}catch(a){return console.log("removeLastPoint",a),!1}}calculatePointDistance(t,e,n,i){try{const o=t-n,a=e-i;return Math.sqrt(o*o+a*a)}catch(o){return void console.log("calculatePointDistance",o)}}generateNewtmpPolygon(t){try{const e=this.util.generateUniquesID(),n=(t+1).toString();this.tmpPolygon={coorPt:[],label:"default",id:e,lineWidth:2,color:"#FFFAFA",region:n,subLabel:[]}}catch(e){console.log("generateNewtmpPolygon",e)}}resetDrawing(t,e,n,i,o){try{this.tmpPolygon=null,this.setNewpolygon(!1),this.redraw(t,n,e,i,o,t.img_w,t.img_h,t.img_x,t.img_y,-1)}catch(a){console.log("resetDrawing",a)}}setNewpolygon(t){this.isNewPoly=t}redraw(t,e,n,i,o,a,s,l,c,r){try{n.restore(),n.clearRect(0,0,i,o),n.save(),n.beginPath(),n.rect(l,c,a,s),n.clip(),n.beginPath(),n.drawImage(e,l,c,a,s),this.drawAllPolygon(t,n,r)}catch(h){console.log("redraw",h)}}drawAllPolygon(t,e,n){try{this.validatePolygonMetadata(t.polygons)&&(this.drawAllPolygonLine(t,e,1),this.drawAllPolygonsDots(t,e,n,this.radius,1),this.plotAllFloatLabel(t,1))}catch(i){console.log("drawAllPolygon",i)}}validatePolygonMetadata(t){return t.length>0}drawAllPolygonLine({polygons:t},e,n){try{for(let i=0;i<n;++i){e.lineWidth=t[i].lineWidth,e.strokeStyle=t[i].color,e.fillStyle=t[i].color,e.beginPath(),e.moveTo(t[i].coorPt[0].x,t[i].coorPt[0].y);for(let n=0;n<t[i].coorPt.length;++n)n+1<t[i].coorPt.length&&e.lineTo(t[i].coorPt[n+1].x,t[i].coorPt[n+1].y);e.closePath(),e.stroke()}}catch(i){console.log("drawAllPolygonLine",i)}}drawAllPolygonsDots({polygons:t},e,n,i,o){try{for(let a=0;a<o;++a)if(a===n){e.strokeStyle="green",e.fillStyle="green";for(const[n]of t[a].coorPt.entries())e.beginPath(),e.arc(t[a].coorPt[n].x,t[a].coorPt[n].y,i,0,2*Math.PI),e.fill(),e.closePath(),e.stroke()}}catch(a){console.log("drawAllPolygonsDots",a)}}plotAllFloatLabel(t,e){try{this.clearAllDIV(t,1);for(let n=0;n<e;++n){const e=t.polygons[n].region.toString(),i=this.createDIV(e,t.polygons[n].id,t.polygons[n].coorPt[0].x,t.polygons[n].coorPt[0].y),o=document.getElementById("");o&&i&&o.appendChild(i)}}catch(n){console.log("plotAllFloatLabel",n)}}clearAllDIV({polygons:t},e){try{for(let n=0;n<e;++n)this.util.RemoveHTMLElement("float_"+t[n].id.toString())}catch(n){console.log("clearAllDIV",n)}}createDIV(t,e,n,i){try{const o=document.createElement("div");return o.id="float_"+e.toString(),o.style.position="absolute",o.style.top=(i+this.radius+.5).toString()+"px",o.style.left=(n+this.radius+.5).toString()+"px",o.style.backgroundColor="rgba(255,255,255,0.5)",o.style.pointerEvents="none",o.style.color="black",o.innerText=t,o}catch(o){console.log("createDIV",o)}}setGlobalXY({img_x:t,img_y:e}){try{this.globalXY.x=t,this.globalXY.y=e}catch(n){console.log("setGlobalXY",n)}}getGlobalX(){return this.globalXY.x}getGlobalY(){return this.globalXY.y}mouseMovePolygon(t,e,n,i,o,a,s,l){try{const c=t-this.globalXY.x,r=e-this.globalXY.y;if(this.withinPointPath(n,n.img_x,n.img_y,n.img_w,n.img_h,o,c,r)){this.globalXY.x=t,this.globalXY.y=e;for(const[t]of n.polygons[o].coorPt.entries())n.polygons[o].coorPt[t].x+=c,n.polygons[o].coorPt[t].y+=r;this.redraw(n,a,i,s,l,n.img_w,n.img_h,n.img_x,n.img_y,o)}}catch(c){console.log("mouseMovePolygon",c)}}keyboardMovePolygon(t,e,n,i,o,a,s,l){try{if(void 0!==n&&-1!==n&&t){const c=t.img_x,r=t.img_y,h=t.img_w,g=t.img_h,b=-3;switch(e){case"up":if(this.withinPointPath(t,c,r,h,g,n,0,b))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].y+=b;break;case"left":if(this.withinPointPath(t,c,r,h,g,n,b,0))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].x+=b;break;case"down":if(this.withinPointPath(t,c,r,h,g,n,0,b))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].y+=b;break;case"right":if(this.withinPointPath(t,c,r,h,g,n,b,0))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].x+=b}this.redraw(t,o,i,a,s,t.img_w,t.img_h,t.img_x,t.img_y,n),this.validateXYDistance(t),l(!0)}return!0}catch(c){return console.log("keyboardMovePolygon",c),!0}}withinPointPath({polygons:t},e,n,i,o,a,s,l){try{for(const[c]of t[a].coorPt.entries())if(t[a].coorPt[c].x+s<e||t[a].coorPt[c].x+s>e+i||t[a].coorPt[c].y+l<n||t[a].coorPt[c].y+l>n+o)return!1;return!0}catch(c){return!1}}validateXYDistance({polygons:t,img_x:e,img_y:n}){try{for(const[i]of t.entries())for(const[o]of t[i].coorPt.entries()){const a=t[i].coorPt[o].y-n;t[i].coorPt[o].distancetoImg.x=t[i].coorPt[o].x-e,t[i].coorPt[o].distancetoImg.y=a}}catch(i){console.log("validateXYDistance",i)}}setPolygonsLineWidth({polygons:t},e){try{for(let n=0;n<t.length;++n)t[n].lineWidth=n===e?2:1}catch(n){console.log("setPolygonsLineWidth",n)}}drawNewPolygon(t,e,n,i,o,a){try{if(this.redraw(t,e,n,i,o,t.img_w,t.img_h,t.img_x,t.img_y,-1),this.tmpPolygon){for(const[t]of this.tmpPolygon.coorPt.entries())n.strokeStyle="green",n.fillStyle="green",n.beginPath(),n.arc(this.tmpPolygon.coorPt[t].x,this.tmpPolygon.coorPt[t].y,this.radius,0,2*Math.PI),n.fill(),n.closePath(),n.stroke();n.beginPath(),n.lineWidth=this.tmpPolygon.lineWidth,n.strokeStyle=this.tmpPolygon.color,n.fillStyle=this.tmpPolygon.color,n.moveTo(this.tmpPolygon.coorPt[0].x,this.tmpPolygon.coorPt[0].y);for(let t=0;t<this.tmpPolygon.coorPt.length;++t)t+1<this.tmpPolygon.coorPt.length&&n.lineTo(this.tmpPolygon.coorPt[t+1].x,this.tmpPolygon.coorPt[t+1].y)}a?(n.closePath(),n.stroke(),this.tmpPolygon&&(t.polygons.push(Object(Lt.a)(this.tmpPolygon)),this.setPolygonsLineWidth(t,t.polygons.length-1),this.tmpPolygon=null),this.setNewpolygon(!1),this.redraw(t,e,n,i,o,t.img_w,t.img_h,t.img_x,t.img_y,t.polygons.length-1)):n.stroke()}catch(s){console.log("drawNewPolygon",s)}}drawfromPreviousPoint(t,e,n){try{this.tmpPolygon&&this.tmpPolygon.coorPt.length>0&&(n.beginPath(),n.moveTo(this.tmpPolygon.coorPt[this.tmpPolygon.coorPt.length-1].x,this.tmpPolygon.coorPt[this.tmpPolygon.coorPt.length-1].y),n.lineTo(t,e),n.stroke())}catch(i){console.log("drawfromPreviousPoint",i)}}returnTempPoly(){try{return null!=this.tmpPolygon?this.tmpPolygon:null}catch(t){return console.log("returnTempPoly",t),null}}setPolygonCoordinate(t,e,{polygons:n},i,o){try{-1!==i&&-1!==o&&(n[i].coorPt[o].x=t,n[i].coorPt[o].y=e)}catch(a){console.log("setPolygonCoordinate",a)}}insidePolygonArea(t,e,n){try{let i=!1;for(let o=0,a=t.length-1;o<t.length;a=o++)t[o].y>n!=t[a].y>n&&e<(t[a].x-t[o].x)*(n-t[o].y)/(t[a].y-t[o].y)+t[o].x&&(i=!i);return i}catch(i){return console.log("insidePolygonArea",i),!1}}calPolygonArea({coorPt:t}){try{let e=0,n=t.length-1;for(let i=0;i<t.length;++i)e+=(t[n].x+t[i].x)*(t[n].y-t[i].y),n=i;return Math.abs(e/2)}catch(e){return console.log("calPolygonArea",e),-1}}findPolygonArea(t,e,{polygons:n}){try{let i=-1,o=1e7;for(let a=0;a<n.length;++a)if(this.insidePolygonArea(n[a].coorPt,t,e)){const t=this.calPolygonArea(n[a]);t<o&&(i=a,o=t)}return i}catch(i){return console.log("findPolygonArea",i),-1}}findClickPoint(t,e,n){try{let i;const o={polygonIndex:-1,pointIndex:-1};for(let a=0;a<n.polygons.length;++a)for(let s=0;s<n.polygons[a].coorPt.length;++s)if(i=Math.sqrt(Math.pow(t-n.polygons[a].coorPt[s].x,2)+Math.pow(e-n.polygons[a].coorPt[s].y,2)),i<=this.radius){o.polygonIndex=a,o.pointIndex=s;break}return o}catch(i){return console.log("findClickPoint",i),{polygonIndex:-1,pointIndex:-1}}}isNewPolygon(){try{return this.isNewPoly}catch(t){return console.log("isNewPolygon",t),!1}}deleteSinglePolygon(t,e,n){}scalePolygons(t,{factor:e,newX:n,newY:i},o){try{const{polygons:a}=t;for(const[t]of a.entries())for(const[o]of a[t].coorPt.entries())a[t].coorPt[o].x=a[t].coorPt[o].distancetoImg.x*e+n,a[t].coorPt[o].y=a[t].coorPt[o].distancetoImg.y*e+i,a[t].coorPt[o].distancetoImg.x=a[t].coorPt[o].x-n,a[t].coorPt[o].distancetoImg.y=a[t].coorPt[o].y-i;this.setPolygonsLineWidth(t,-1),o&&o(!0)}catch(a){console.log("scalePolygons",a)}}panPolygons({polygons:t},e,n,i){try{if(i&&this.tmpPolygon)for(const[t]of this.tmpPolygon.coorPt.entries())this.tmpPolygon.coorPt[t].x=e+this.tmpPolygon.coorPt[t].distancetoImg.x,this.tmpPolygon.coorPt[t].y=n+this.tmpPolygon.coorPt[t].distancetoImg.y;for(const[i]of t.entries())for(const[o]of t[i].coorPt.entries())t[i].coorPt[o].x=e+t[i].coorPt[o].distancetoImg.x,t[i].coorPt[o].y=n+t[i].coorPt[o].distancetoImg.y}catch(o){console.log("panPolygons",o)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const Tt=["canvasdrawing"],Vt=["crossh"],Nt=["crossv"];let $t=(()=>{class t{constructor(t,e,n,i,o){this._segCanvasService=t,this._imgLblStateService=e,this._undoRedoService=n,this._copyPasteService=i,this._annotateSelectState=o,this.image=new Image,this.mousedown=!1,this.altDown=!1,this.ctrlHold=!1,this._imgSrc="",this._onChangeMetadata=new c.n}ngOnInit(){this._imgLblStateService.action$.subscribe(t=>(this.segState=t,this.isFitCenter(),this.isClearCanvas())),this._annotateSelectState.labelStaging$.subscribe(t=>(this.annotateState=t,this.annotateStateOnChange()))}ngOnChanges(t){var e;(null===(e=t._imgSrc)||void 0===e?void 0:e.currentValue)&&(this.initializeCanvas(),this.loadImage(t._imgSrc.currentValue))}initializeCanvas(){this.mycanvas.nativeElement.style.width="80%",this.mycanvas.nativeElement.style.height="90%",this.mycanvas.nativeElement.width=this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.height=this.mycanvas.nativeElement.offsetHeight,this.context=this.mycanvas.nativeElement.getContext("2d")}loadImage(t){this.image.src=t,this.image.onload=()=>{let{img_w:t,img_h:e,img_ori_w:n,img_ori_h:i}=this._selectMetadata;this._selectMetadata.img_w=t<1?n:t,this._selectMetadata.img_h=e<1?i:e,this.imgFitToCenter(),this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"})}}emitMetadata(){this._onChangeMetadata.emit(this._selectMetadata)}annotateStateMakeChange(t){t&&this._annotateSelectState.setState(t)}annotateStateOnChange(){this.annotateState&&this._segCanvasService.setSelectedPolygonIndex(this.annotateState.annotation)}rulesMakeChange(t,e,n){try{const i=Yt(this.segState);t&&(i.scroll=t),e&&(i.fitCenter=e),n&&(i.clear=n),this._imgLblStateService.setState(i)}catch(i){console.log("rulesMakeChange",i)}}imgFitToCenter(){try{const t=this._segCanvasService.calScaleToFitScreen(this._selectMetadata,this.mycanvas.nativeElement);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._segCanvasService.scalePolygons(this._selectMetadata,t);const{img_x:e,img_y:n}=this._selectMetadata;this._segCanvasService.setGlobalXY({img_x:t.newX,img_y:t.newY}),this._segCanvasService.panPolygons(this._selectMetadata,e,n,!1);const i=Object(Lt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:i,method:"zoom"}):this._undoRedoService.replaceStages({meta:i,method:"zoom"}),this.redrawImage(this._selectMetadata),this.emitMetadata()}catch(t){console.log("imgFitToCenter",t)}}isClearCanvas(){try{this.segState.clear&&(this._selectMetadata.polygons=[],this.redrawImage(this._selectMetadata),this.rulesMakeChange(void 0,void 0,!1),this.emitMetadata())}catch(t){console.log("isClearCanvas",t)}}isFitCenter(){this.segState.fitCenter&&this.imgFitToCenter()}redrawImage({img_x:t,img_y:e,img_w:n,img_h:i}){try{this.clearcanvas(),this.context&&(this.context.drawImage(this.image,t,e,n,i),this._segCanvasService.drawAllPolygon(this._selectMetadata,this.context,this.annotateState.annotation),this.mycanvas.nativeElement.focus())}catch(o){console.log("redrawImage",o)}}clearcanvas(){var t;const{width:e,height:n}=this.mycanvas.nativeElement;null===(t=this.context)||void 0===t||t.clearRect(0,0,e,n)}keyMoveBox(t){try{this.context&&this._segCanvasService.keyboardMovePolygon(this._selectMetadata,t,this.annotateState.annotation,this.context,this.image,this._selectMetadata.img_w,this._selectMetadata.img_h,t=>{t&&(this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())})}catch(e){console.log("keyMoveBox",e)}}zoomImage(t){try{if(t>0){const t=1.1,{img_x:e,img_y:n}=this._selectMetadata;this._selectMetadata.img_w*=t,this._selectMetadata.img_h*=t,this._segCanvasService.scalePolygons(this._selectMetadata,{factor:t,newX:e,newY:n},t=>{t&&(this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"zoom"}),this.emitMetadata())})}else{const t=.9;let{img_w:e,img_h:n,img_x:i,img_y:o}=this._selectMetadata;e*t>100&&n*t>100&&(this._selectMetadata.img_w*=t,this._selectMetadata.img_h*=t,this._segCanvasService.scalePolygons(this._selectMetadata,{factor:t,newX:i,newY:o},t=>{if(t){const t=Object(Lt.a)(this._selectMetadata);this.emitMetadata(),this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:t,method:"zoom"}):this._undoRedoService.replaceStages({meta:t,method:"zoom"})}}))}this._copyPasteService.isAvailable()&&this._copyPasteService.clear(),this.redrawImage(this._selectMetadata)}catch(e){console.log("zoomImage",e)}}mouseScroll({detail:t,deltaY:e}){try{const n=Math.max(-1,Math.min(1,-e||-t));n&&this.segState.scroll&&this.zoomImage(n)}catch(n){console.log("mouseScroll",n)}}toggleEvent(t){try{this.annotateState.annotation>-1&&(this._undoRedoService.clearRedundantStages(),this.annotateStateMakeChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){console.log("toggleEvent",e)}}keyStrokeEvent({ctrlKey:t,shiftKey:e,key:n}){try{if(!this.mousedown){const{isActiveModal:i}=this.segState;if(!t||"c"!==n&&"C"!==n||i)if(!t||"v"!==n&&"V"!==n||i){if(!t||!e||"z"!==n&&"Z"!==n||i){if(!t||"z"!==n&&"Z"!==n||i)i||"Delete"!==n&&"Backspace"!==n?"ArrowLeft"!==n||i?"ArrowRight"!==n||i?"ArrowUp"!==n||i?"ArrowDown"===n&&!i&&this.keyMoveBox("down"):this.keyMoveBox("up"):this.keyMoveBox("right"):this.keyMoveBox("left"):this._segCanvasService.deleteSinglePolygon(this._selectMetadata,this.annotateState.annotation,t=>{t&&(this.annotateStateMakeChange({annotation:-1,isDlbClick:!1}),this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())});else if(this._undoRedoService.isAllowUndo()){const t=this._undoRedoService.undo();this._selectMetadata=Object(Lt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else if(this._undoRedoService.isAllowRedo()){const t=this._undoRedoService.redo();this._selectMetadata=Object(Lt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else this._copyPasteService.isAvailable()&&(this._selectMetadata.polygons.push(this._copyPasteService.paste()),this.annotateStateMakeChange({annotation:this._selectMetadata.polygons.length-1,isDlbClick:!1}),this._segCanvasService.validateXYDistance(this._selectMetadata)),this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata(),this.mycanvas.nativeElement.focus();else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.polygons[this.annotateState.annotation])}}catch(i){console.log("keyStrokeEvent",i)}}mouseDown(t){try{if(this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t)&&(this.mousedown=!0,this.segState.drag&&this._segCanvasService.setPanXY(t),this.segState.draw&&this.context)){const e=this._segCanvasService.mouseDownDraw(t,this._selectMetadata,this.mycanvas.nativeElement,this.image,this.context,this.ctrlHold,this.altDown);this.annotateStateMakeChange(Yt({annotation:e,isDlbClick:!1})),this.redrawImage(this._selectMetadata)}}catch(e){console.log("mouseDown",e)}}mouseUp(t){try{this._selectMetadata&&this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t)&&(this.mousedown=!0,(this.segState.drag&&this.mousedown||this._segCanvasService.isNewPolygon()&&this.ctrlHold&&this.mousedown)&&this._segCanvasService.setGlobalXY(this._selectMetadata),this.segState.draw&&!this._segCanvasService.isNewPolygon()&&this.annotateState.annotation>-1&&this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&this._undoRedoService.appendStages({meta:Object(Lt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.setGlobalXY({img_x:-1,img_y:-1}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.emitMetadata())}catch(e){console.log("mouseUp",e)}}mouseMove(t){try{if(this._selectMetadata&&this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.mousedown=!0,this.segState.drag&&this.mousedown){const e=t.offsetX-this._segCanvasService.getPanX(),n=t.offsetY-this._segCanvasService.getPanY();this._selectMetadata.img_x=this._segCanvasService.getGlobalX()+e,this._selectMetadata.img_y=this._segCanvasService.getGlobalY()+n,this._segCanvasService.panPolygons(this._selectMetadata,this._selectMetadata.img_x,this._selectMetadata.img_y,!1),this.redrawImage(this._selectMetadata),this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:this._selectMetadata,method:"pan"}):this._undoRedoService.replaceStages({meta:this._selectMetadata,method:"pan"})}this.segState.draw&&this.mousedown&&this.context&&this._segCanvasService.mouseMoveDraw(this._selectMetadata,this.image,this.context,this.mycanvas.nativeElement.width,this.mycanvas.nativeElement.height,t.offsetX,t.offsetY,this.ctrlHold,this.mousedown,t=>{this.redrawImage(this._selectMetadata),"pan"===t&&(this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:this._selectMetadata,method:"pan"}):this._undoRedoService.replaceStages({meta:this._selectMetadata,method:"pan"}))})}else"-1"===this.crossh.nativeElement.style.zIndex&&"hidden"===this.crossh.nativeElement.style.visibility&&"-1"===this.crossv.nativeElement.style.zIndex&&"hidden"===this.crossv.nativeElement.style.visibility||(this.crossh.nativeElement.style.zIndex="-1",this.crossh.nativeElement.style.visibility="hidden",this.crossv.nativeElement.style.zIndex="-1",this.crossv.nativeElement.style.visibility="hidden")}catch(e){console.log("mouseMove",e)}}mouseOut(t){try{this.segState.drag&&this.mousedown&&(this._segCanvasService.setGlobalXY(this._selectMetadata),this.redrawImage(this._selectMetadata)),this.mousedown=!1}catch(e){console.log("mouseOut",e)}}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(Rt),c.Hb(p),c.Hb(jt),c.Hb(Bt),c.Hb(y))},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-segmentation"]],viewQuery:function(t,e){if(1&t&&(c.pc(Tt,!0),c.pc(Vt,!0),c.pc(Nt,!0)),2&t){let t;c.dc(t=c.Ub())&&(e.mycanvas=t.first),c.dc(t=c.Ub())&&(e.crossh=t.first),c.dc(t=c.Ub())&&(e.crossv=t.first)}},hostBindings:function(t,e){1&t&&c.Tb("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("dblclick",function(t){return e.toggleEvent(t)})("keydown",function(t){return e.keyStrokeEvent(t)},!1,c.fc)("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[c.vb],decls:7,vars:0,consts:[[1,"canvasstyle"],["canvasdrawing",""],[1,"crosses","cross-h"],["crossh",""],[1,"crosses","cross-v"],["crossv",""]],template:function(t,e){1&t&&(c.Mb(0,"div"),c.Ib(1,"canvas",0,1),c.Ib(3,"div",2,3),c.Ib(5,"div",4,5),c.Lb())},styles:[".cross-h[_ngcontent-%COMP%]{width:100%;height:1px;margin-top:-1px;opacity:.8}.cross-v[_ngcontent-%COMP%]{height:100%;width:1px;margin-left:-1px;opacity:.8}.crosses[_ngcontent-%COMP%]{position:fixed;background-color:#ff0;box-shadow:0 0 5px #646464;pointer-events:none;visibility:hidden}.canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}"],changeDetection:0}),t})();var Ft=n("3Pt+");const Ut=["subLabelSelect"];function Jt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"image-labelling-object-detection",21),c.Tb("_onChangeMetadata",function(e){return c.gc(t),c.Vb().onChangeMetadata(e)}),c.Lb(),c.Jb()}if(2&t){const t=c.Vb();c.xb(1),c.ac("_selectMetadata",t.selectedMetaData)("_imgSrc",t.imgSrc)}}function Kt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"image-labelling-segmentation",21),c.Tb("_onChangeMetadata",function(e){return c.gc(t),c.Vb().onChangeMetadata(e)}),c.Lb(),c.Jb()}if(2&t){const t=c.Vb();c.xb(1),c.ac("_selectMetadata",t.selectedMetaData)("_imgSrc",t.imgSrc)}}function Wt(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"option",22),c.lc(2),c.Lb(),c.Jb()),2&t){const t=e.$implicit,n=c.Vb(2);c.xb(1),c.ac("value",t)("selected",t===n.currentAnnotationLabel),c.xb(1),c.nc(" ",t," ")}}function Ht(t,e){if(1&t&&(c.Kb(0),c.jc(1,Wt,3,3,"ng-container",14),c.Jb()),2&t){const t=e.$implicit;c.xb(1),c.ac("ngForOf",t.label_list)}}function Gt(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"option",22),c.lc(2),c.Lb(),c.Jb()),2&t){const t=e.$implicit,n=c.Vb().$implicit;c.xb(1),c.ac("value",t)("selected",n.label_list[0].label),c.xb(1),c.nc(" ",t," ")}}function Zt(t,e){if(1&t&&(c.Kb(0),c.jc(1,Gt,3,3,"ng-container",14),c.Jb()),2&t){const t=e.$implicit;c.xb(1),c.ac("ngForOf",t.label_list)}}function qt(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"div",23),c.lc(2),c.Lb(),c.Jb()),2&t){const t=c.Vb();c.xb(2),c.nc(" ",t.subLabelValidateMsg," ")}}function Qt(t,e){if(1&t){const t=c.Nb();c.Kb(0),c.Mb(1,"div",24),c.Mb(2,"label",25),c.lc(3),c.Lb(),c.Mb(4,"label",26),c.lc(5),c.Lb(),c.Ib(6,"span",27),c.Mb(7,"button",28),c.Tb("click",function(){c.gc(t);const n=e.index,i=c.Vb(2).index;return c.Vb(3).onRemoveSubLabel(i,n)}),c.lc(8," X "),c.Lb(),c.Lb(),c.Jb()}if(2&t){const t=e.$implicit;c.xb(3),c.nc("Label: ",t.label,""),c.xb(2),c.nc("Region Info: ",t.region,"")}}function te(t,e){if(1&t&&(c.Kb(0),c.Mb(1,"h2",10),c.lc(2,"Added Sub Label"),c.Lb(),c.jc(3,Qt,9,2,"ng-container",14),c.Jb()),2&t){const t=c.Vb().$implicit;c.xb(3),c.ac("ngForOf",t.subLabel)}}function ee(t,e){if(1&t&&(c.Kb(0),c.jc(1,te,4,1,"ng-container",5),c.Jb()),2&t){const t=e.$implicit,n=e.index,i=c.Vb(3);c.xb(1),c.ac("ngIf",(null==t||null==t.subLabel?null:t.subLabel.length)>0&&n===i.currentAnnotationIndex)}}function ne(t,e){if(1&t&&(c.Kb(0),c.jc(1,ee,2,1,"ng-container",14),c.Jb()),2&t){const t=e.$implicit;c.xb(1),c.ac("ngForOf",null==t?null:t.bnd_box)}}function ie(t,e){if(1&t&&(c.Kb(0),c.jc(1,ne,2,1,"ng-container",14),c.Jb()),2&t){const t=e.$implicit;c.xb(1),c.ac("ngForOf",t.annotation)}}const oe=[{path:"",component:(()=>{class t{constructor(t,e,n,i,c,r,h,g){this._router=t,this._imgLblApiService=e,this._modalService=n,this._dataSetService=i,this._annotateService=c,this._imgLblActionService=r,this._imgLblLayoutService=h,this._imgLblModeService=g,this.currentUrl="",this.selectedProjectName="",this.imgSrc="",this.loading=!1,this.thumbnailList=[],this.unsubscribe$=new l.a,this.tabStatus=[{name:"Project",closed:!1},{name:"Label",closed:!1,label_list:[]},{name:"Annotation",closed:!1,annotation:[]}],this.mainLabelRegionVal="",this.subLabelRegionVal="",this.subLabelValidateMsg="",this.currentAnnotationLabel="",this.currentAnnotationIndex=-1,this.currentImageDisplayIndex=-1,this.updateProjectProgress=()=>{this._imgLblLayoutService.updateProjectProgress(this.tabStatus,this.selectedProjectName)},this.onChangeMetadata=t=>{this.tabStatus=this.tabStatus.map(e=>e.annotation?Object.assign(Object.assign({},e),{annotation:[t]}):e),this.updateProjectProgress()},this.onToggleTab=({name:t,closed:e})=>{!this.tabStatus.some(n=>n.name.toLowerCase()===t.toLowerCase()&&n.closed===e)&&(this.tabStatus=this.tabStatus.map(n=>n.name.toLowerCase()===t.toLowerCase()?Object.assign(Object.assign({},n),{closed:e}):Object.assign({},n)))},this.navigateByUrl=({url:t})=>{t?this._router.navigate([t]):console.error("No url received from child component")},this.navigateByAction=({thumbnailAction:t})=>{if(t){const e=this._imgLblLayoutService.calculateIndex(t,this.currentImageDisplayIndex,this.thumbnailList.length);if(e!==this.currentImageDisplayIndex){this.currentImageDisplayIndex=e;const t=this.thumbnailList.find((t,n)=>n===e),n=this.thumbnailList.findIndex((t,n)=>n===e);t&&-1!==n&&this.displayImage(Object.assign(Object.assign({},t),{thumbnailIndex:n}))}}},this.displayImage=(t,e=this.selectedProjectName)=>{var{thumbnailIndex:n}=t,i=o(t,["thumbnailIndex"]);this._imgLblApiService.getBase64Thumbnail(e,i.uuid).pipe(Object(a.a)()).subscribe(({message:t,img_src:e})=>{1===t&&(this.selectedMetaData=i,this.imgSrc=e,this.currentImageDisplayIndex=n,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{currentThumbnailIndex:n+1,thumbnailName:i.img_path}))},t=>console.error(t))},this.onProcessLabel=({selectedLabel:t,label_list:e,action:n})=>{const i=t&&!n?e.filter(e=>e!==t):e;this._imgLblApiService.updateLabelList(this.selectedProjectName,i.length>0?i:[]).pipe(Object(a.a)()).subscribe(({message:t})=>{1===t?this.tabStatus=this._imgLblLayoutService.displayLabelList(this.tabStatus,i):console.error("Error while updating label")}),this.updateProjectProgress()},this.onChangeAnnotationLabel=t=>{this.tabStatus=this._imgLblLayoutService.changeAnnotationLabel(this.tabStatus,t),this.updateStateToRenderChild(),this.updateProjectProgress()},this.onDeleteAnnotation=t=>{this.tabStatus=this._imgLblLayoutService.deleteAnnotation(this.tabStatus,t),this.updateStateToRenderChild(),this.updateProjectProgress()},this.onDisplayModal=(t="modal-image-labelling")=>{this.subLabelRegionVal="",this.subLabelValidateMsg="",this._modalService.open(t)},this.onCloseModal=(t="modal-image-labelling")=>{this._imgLblActionService.setState({isActiveModal:!1,draw:!0,scroll:!0}),this._modalService.close(t)},this.onChangeInput=(t,e)=>{const{value:n}=t.target;"main"===e?this.mainLabelRegionVal=n:this.subLabelRegionVal=n},this.onSubmitLabel=()=>{const{value:t}=this._subLabelSelect.nativeElement;let e=!1,n=!1;this.tabStatus.forEach(({annotation:i})=>null==i?void 0:i.forEach(({bnd_box:i,polygons:o})=>{const a=null!=i?i:o;if(a){const{subLabel:i}=a[this.currentAnnotationIndex];e=!!(i&&(null==i?void 0:i.length)>0),e&&(null==i||i.some(({label:e})=>n=e===t))}else console.log("missing prop bnd_box OR polygons")})),n?this.subLabelValidateMsg="Invalid of duplicate label: "+t:(this.tabStatus=this._imgLblLayoutService.submitLabel(this.tabStatus,t,this.currentAnnotationIndex,{mainLabelRegion:this.mainLabelRegionVal,subLabelRegion:this.subLabelRegionVal}),this.subLabelValidateMsg="",this.updateStateToRenderChild(),this.updateProjectProgress()),this.subLabelRegionVal=""},this.onRemoveSubLabel=(t,e)=>{this.tabStatus=this._imgLblLayoutService.removeSubLabel(this.tabStatus,{selectedAnnoIndex:t,selectedSubLabelIndex:e}),this.updateStateToRenderChild(),this.updateProjectProgress()},this.updateStateToRenderChild=()=>{this.tabStatus.forEach(({annotation:t})=>{t&&(this.thumbnailList=this.thumbnailList.map(e=>{var n;return null!==(n=t.find(({uuid:t})=>e.uuid===t))&&void 0!==n?n:e}),this.selectedMetaData=t[0])})},this.resetProjectStatus=(t=this.selectedProjectName)=>{t.trim()&&this._dataSetService.manualCloseProject(t).pipe(Object(s.a)(this.unsubscribe$)).subscribe(({})=>{this._router.navigate(["/"])})}}ngOnInit(){this.currentUrl=this._router.url;const{thumbnailList:t,labelList:e,projectName:n}=this._imgLblLayoutService.getRouteState(history);this.thumbnailList=t,this.selectedProjectName=n,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:t.length});const i=this._imgLblLayoutService.displayLabelList(this.tabStatus,e);this.tabStatus=i,this._annotateService.labelStaging$.pipe(Object(s.a)(this.unsubscribe$)).subscribe(({annotation:t,isDlbClick:e})=>{e?(this.currentAnnotationIndex=t,this.tabStatus.forEach(({annotation:e})=>null==e?void 0:e.forEach(({bnd_box:e,polygons:n})=>{const i=null!=e?e:n;if(i){const{label:e,region:n}=i[t];this.currentAnnotationLabel=e,this.mainLabelRegionVal=n||""}else console.log("missing prop bnd_box OR polygons")})),this._imgLblActionService.setState({isActiveModal:!0,draw:!1,drag:!1,scroll:!1}),this.onDisplayModal()):(this.currentAnnotationLabel="",this.currentAnnotationIndex=t)})}onWindowClose(t){this.resetProjectStatus(),t.preventDefault()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this._imgLblModeService.setState(null),this._imgLblActionService.setState(null),this.resetProjectStatus()}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(r.a),c.Hb(u),c.Hb(m.a),c.Hb(f.a),c.Hb(y),c.Hb(p),c.Hb(M),c.Hb(d.a))},t.\u0275cmp=c.Bb({type:t,selectors:[["image-labelling-layout"]],viewQuery:function(t,e){if(1&t&&c.pc(Ut,!0),2&t){let t;c.dc(t=c.Ub())&&(e._subLabelSelect=t.first)}},hostBindings:function(t,e){1&t&&c.Tb("beforeunload",function(t){return e.onWindowClose(t)},!1,c.fc)},decls:43,vars:17,consts:[[1,"layout-container"],[3,"_onChange"],[3,"_onChange","_onClick"],[1,"content-container"],[3,"_onChange","_currentUrl"],[4,"ngIf"],[3,"_thumbnailList","_tabStatus","_onClose","_onClickThumbNail","_onClickLabel","_onEnterLabel","_onChangeAnnotationLabel","_onDeleteAnnotation"],[3,"_thumbnailInfo","_imgSrc"],["id","modal-image-labelling"],[1,"modal-button","float-right",3,"click"],[1,"font-title"],[1,"main-label-container"],[1,"font-label"],[1,"static-select"],[4,"ngFor","ngForOf"],["type","text","placeholder","Input Main Region Info",1,"static-input",3,"value","change"],[1,"hr-line"],[1,"sub-label-container"],["subLabelSelect",""],["type","text","placeholder","Input Sub Region Info",1,"static-input",3,"value","change"],[1,"modal-button",3,"click"],[3,"_selectMetadata","_imgSrc","_onChangeMetadata"],[3,"value","selected"],[1,"validate-msg"],[1,"sub-label-flex-container","sub-label-padding"],[1,"font-label","flex-first"],[1,"font-label","flex-second"],[1,"flex-third"],[1,"modal-butto","flex-fourth",3,"click"]],template:function(t,e){1&t&&(c.Mb(0,"div",0),c.Mb(1,"div"),c.Ib(2,"page-header",1),c.Mb(3,"image-labelling-info",2),c.Tb("_onClick",function(t){return e.navigateByAction(t)}),c.Lb(),c.Lb(),c.Mb(4,"div",3),c.Ib(5,"image-labelling-left-sidebar",4),c.jc(6,Jt,2,2,"ng-container",5),c.jc(7,Kt,2,2,"ng-container",5),c.Mb(8,"image-labelling-project",6),c.Tb("_onClose",function(t){return e.onToggleTab(t)})("_onClickThumbNail",function(t){return e.displayImage(t)})("_onClickLabel",function(t){return e.onProcessLabel(t)})("_onEnterLabel",function(t){return e.onProcessLabel(t)})("_onChangeAnnotationLabel",function(t){return e.onChangeAnnotationLabel(t)})("_onDeleteAnnotation",function(t){return e.onDeleteAnnotation(t)}),c.Lb(),c.Mb(9,"image-labelling-right-sidebar",2),c.Tb("_onClick",function(t){return e.onToggleTab(t)}),c.Lb(),c.Lb(),c.Ib(10,"image-labelling-footer",7),c.Lb(),c.Mb(11,"modal",8),c.Mb(12,"button",9),c.Tb("click",function(){return e.onCloseModal()}),c.lc(13,"X"),c.Lb(),c.Mb(14,"div"),c.Mb(15,"h2",10),c.lc(16,"Main Label"),c.Lb(),c.Mb(17,"div",11),c.Mb(18,"label",12),c.lc(19,"Label: "),c.Lb(),c.Mb(20,"select",13),c.jc(21,Ht,2,1,"ng-container",14),c.Lb(),c.Mb(22,"label",12),c.lc(23,"Region Info: "),c.Lb(),c.Mb(24,"input",15),c.Tb("change",function(t){return e.onChangeInput(t,"main")}),c.Lb(),c.Lb(),c.Lb(),c.Ib(25,"hr",16),c.Mb(26,"div"),c.Mb(27,"h2",10),c.lc(28,"Sub Label"),c.Lb(),c.Mb(29,"div",17),c.Mb(30,"label",12),c.lc(31,"Label: "),c.Lb(),c.Mb(32,"select",13,18),c.jc(34,Zt,2,1,"ng-container",14),c.Lb(),c.Mb(35,"label",12),c.lc(36,"Region Info: "),c.Lb(),c.Mb(37,"input",19),c.Tb("change",function(t){return e.onChangeInput(t,"sub")}),c.Lb(),c.Mb(38,"button",20),c.Tb("click",function(){return e.onSubmitLabel()}),c.lc(39,"Add"),c.Lb(),c.Lb(),c.jc(40,qt,3,1,"ng-container",5),c.Lb(),c.Ib(41,"hr",16),c.jc(42,ie,2,1,"ng-container",14),c.Lb()),2&t&&(c.xb(2),c.ac("_onChange",e.onChangeSchema),c.xb(1),c.ac("_onChange",e.onChangeSchema),c.xb(2),c.ac("_onChange",e.onChangeSchema)("_currentUrl",e.currentUrl),c.xb(1),c.ac("ngIf",e._router.url.includes("imglabel/bndbox")),c.xb(1),c.ac("ngIf",e._router.url.includes("imglabel/seg")),c.xb(1),c.ac("_thumbnailList",e.thumbnailList)("_tabStatus",e.tabStatus),c.xb(1),c.ac("_onChange",e.onChangeSchema),c.xb(1),c.ac("_thumbnailInfo",e.selectedMetaData)("_imgSrc",e.imgSrc),c.xb(11),c.ac("ngForOf",e.tabStatus),c.xb(3),c.ac("value",e.mainLabelRegionVal),c.xb(10),c.ac("ngForOf",e.tabStatus),c.xb(3),c.ac("value",e.subLabelRegionVal),c.xb(3),c.ac("ngIf",e.subLabelValidateMsg),c.xb(2),c.ac("ngForOf",e.tabStatus))},directives:[w.a,A,z,i.k,pt,wt,Ct,Ot.a,i.j,zt,$t,Ft.h,Ft.k],styles:[".layout-container[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;min-width:97.8vw;max-width:97.8vw}.modal-button[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw}.float-right[_ngcontent-%COMP%]{float:right}.font-title[_ngcontent-%COMP%]{font-size:1.7vw}.font-label[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.main-label-container[_ngcontent-%COMP%]{min-width:35vw;max-width:35vw}.main-label-container[_ngcontent-%COMP%], .sub-label-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.sub-label-container[_ngcontent-%COMP%]{min-width:40vw;max-width:40vw}.sub-label-flex-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1 1 100%;min-width:0}.static-select[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:5vh;margin:0;-moz-text-align-last:center;text-align-last:center;background:#262a2e;color:#fff;box-shadow:inset -.5vw 6.25vw 1vw 0 rgba(0,0,0,.2),inset -.5vw -.5vw 1vw 0 hsla(0,0%,100%,.4)}.static-select[_ngcontent-%COMP%]:hover{box-shadow:inset -.375vw -.375vw .625vw 0 rgba(0,0,0,.2),inset .375vw .375vw .625vw 0 hsla(0,0%,100%,.5)}.static-select[_ngcontent-%COMP%]:active{box-shadow:inset .375vw .375vw .625vw 0 rgba(0,0,0,.2),inset -.375vw -.375vw .625vw 0 hsla(0,0%,100%,.5)}.static-input[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;border-radius:2vw;border:none;outline:none;background-color:#363636;color:#fff;padding:0 1vw}.hr-line[_ngcontent-%COMP%]{height:.5vh;color:#000;background:#8c8b8b;margin:5vh 0}.sub-label-padding[_ngcontent-%COMP%]{padding:0 0 2vh}.validate-msg[_ngcontent-%COMP%]{color:red;padding:5vh 0 0;font-size:1vw}.flex-first[_ngcontent-%COMP%]{flex:1 1 35%}.flex-second[_ngcontent-%COMP%]{flex:1 1 55%}.flex-third[_ngcontent-%COMP%]{flex:0 0 5%}.flex-fourth[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;flex:0 0 5%}"]}),t})()}];let ae=(()=>{class t{}return t.\u0275mod=c.Fb({type:t}),t.\u0275inj=c.Eb({factory:function(e){return new(e||t)},imports:[[r.d.forChild(oe)]]}),t})();var se=n("KZX/");let le=(()=>{class t{}return t.\u0275mod=c.Fb({type:t}),t.\u0275inj=c.Eb({factory:function(e){return new(e||t)},imports:[[i.b,se.a]]}),t})();var ce=n("RKnZ"),re=n("O+1G"),he=n("sYmb");let ge=(()=>{class t{}return t.\u0275mod=c.Fb({type:t}),t.\u0275inj=c.Eb({factory:function(e){return new(e||t)},imports:[[i.b,se.a,he.b,ae,ce.a,r.d,re.a,le]]}),t})()}}]);