(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{i5u5:function(t,e,n){"use strict";n.r(e),n.d(e,"ImageLabellingLayoutModule",function(){return Le});var i=n("ofXK");function o(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}var a=n("SxV6"),s=n("5+tZ"),l=n("1G5W"),c=n("XNiG"),r=n("l5mm"),h=n("z6cu"),b=n("fXoL"),g=n("tyNb"),d=n("/uUt"),u=n("cxbk"),m=n("tk/3"),f=n("14na");let v=(()=>{class t{constructor(t,e,n){this.http=t,this.mode=e,this.router=n,this.hostPort=u.a.baseURL,this.imageLabellingMode=null,this.getBase64Thumbnail=(t,e)=>this.http.get(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/uuid/${e}/imgsrc`),this.updateLabelList=(t,e)=>this.http.put(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/newlabels`,{label_list:e}),this.updateProjectProgress=(t,e,n)=>this.http.put(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/uuid/${e}/update`,Object.assign({},n)),this.exportProject=(t,e)=>this.http.put(`${this.hostPort}v2/${this.imageLabellingMode}/projects/${t}/export/${e}`,{newprojectid:t}),this.reloadProject=t=>this.http.put(`${this.hostPort}v2/${this.imageLabellingMode}/projects/${t}/reload`,{newprojectid:t}),this.reloadProjectStatus=t=>this.http.get(`${this.hostPort}v2/${this.imageLabellingMode}/projects/${t}/reloadstatus`),this.mode.imgLabelMode$.pipe(Object(d.a)()).subscribe(t=>t?this.imageLabellingMode=t:this.router.navigate(["/"]))}checkIfBboxMetaType(t){return Array.isArray(t)?void 0!==t[0].bnd_box:void 0!==t.bnd_box}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(m.b),b.Qb(f.a),b.Qb(g.a))},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var p=n("1F7/"),_=n("LY9J"),x=n("2Vo4");const y={annotation:-1,isDlbClick:!1};let w=(()=>{class t{constructor(){this.labelStateSubject=new x.a(y),this.labelStaging$=this.labelStateSubject.asObservable(),this.setState=t=>{this.labelStateSubject.next(t?Object.assign(Object.assign({},y),t):y)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const S={scroll:!1,drag:!1,draw:!1,fitCenter:!1,clear:!1,isActiveModal:!1};let M=(()=>{class t{constructor(){this.actionSubject=new x.a(S),this.action$=this.actionSubject.asObservable(),this.setState=t=>{this.actionSubject.next(t?Object.assign(Object.assign({},S),t):S)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),C=(()=>{class t{constructor(t){this._imgLblApiService=t,this.getRouteState=t=>{const{state:e}=t;return Object.assign({},e)},this.displayLabelList=(t,e)=>t.map(t=>t.label_list?Object.assign(Object.assign({},t),{label_list:e}):t),this.calculateIndex=(t,e,n)=>{let i=e;return 1===t?i>=n-1?n-1:i+=1:i<=0?0:e-=1},this.checkAnnotationMetadataProp=({bnd_box:t,polygons:e})=>null!=t?t:e,this.changeAnnotationLabel=(t,{label:e,index:n})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:i,polygons:a}=t,s=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},s),{bnd_box:null==i?void 0:i.map((t,i)=>i===n?Object.assign(Object.assign({},t),{label:e}):t),polygons:null==a?void 0:a.map((t,i)=>i===n?Object.assign(Object.assign({},t),{label:e}):t)})})}):t),this.deleteAnnotation=(t,e)=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:n,polygons:i}=t,a=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},a),{bnd_box:null==n?void 0:n.filter((t,n)=>n!==e),polygons:null==i?void 0:i.filter((t,n)=>n!==e)})})}):t),this.submitLabel=(t,e,n,{mainLabelRegion:i,subLabelRegion:a})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:s,polygons:l}=t,c=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},c),{bnd_box:null==s?void 0:s.map((t,o)=>o===n?Object.assign(Object.assign({},t),{region:i,subLabel:t.subLabel&&t.subLabel.length>0?[...t.subLabel,{label:e,region:a}]:[{label:e,region:a}]}):t),polygons:null==l?void 0:l.map((t,o)=>o===n?Object.assign(Object.assign({},t),{region:i,subLabel:t.subLabel&&t.subLabel.length>0?[...t.subLabel,{label:e,region:a}]:[{label:e,region:a}]}):t)})})}):t),this.removeSubLabel=(t,{selectedAnnoIndex:e,selectedSubLabelIndex:n})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:i,polygons:a}=t,s=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},s),{bnd_box:null==i?void 0:i.map((t,i)=>{var o;return i===e?Object.assign(Object.assign({},t),{subLabel:null===(o=t.subLabel)||void 0===o?void 0:o.filter((t,e)=>e!==n)}):t}),polygons:null==a?void 0:a.map((t,i)=>{var o;return i===e?Object.assign(Object.assign({},t),{subLabel:null===(o=t.subLabel)||void 0===o?void 0:o.filter((t,e)=>e!==n)}):t})})})}):t),this.setLocalStorageProjectProgress=(t,e)=>{localStorage.setItem(`${t}_${this._imgLblApiService.imageLabellingMode}`,JSON.stringify({cache:e}))},this.getLocalStorageProjectProgress=t=>{const e=localStorage.getItem(`${t}_${this._imgLblApiService.imageLabellingMode}`);return e?JSON.parse(e):null},this.updateProjectProgress=(t,e)=>{t.forEach(({annotation:t})=>{t&&(this.setLocalStorageProjectProgress(e,t),null==t||t.forEach(t=>{this._imgLblApiService.updateProjectProgress(e,t.uuid,t).pipe(Object(a.a)()).subscribe(({})=>{})}))})}}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(v))},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var P=n("I7yr"),L=n("F7l1"),O=n("x2Se");let k=(()=>{class t{transform(t){return t?window.navigator.platform.startsWith("Mac")?t.split("/").slice(-1)[0]:t.split("\\").slice(-1)[0]:""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=b.Gb({name:"fileNameSlice",type:t,pure:!0}),t})();var I=n("sYmb");function j(t,e){if(1&t&&(b.Kb(0),b.Ib(1,"div",7),b.Mb(2,"label",8),b.mc(3),b.Wb(4,"fileNameSlice"),b.Lb(),b.Jb()),2&t){const t=b.Vb();b.xb(1),b.ac("ngClass",t._onChange.hasAnnotation?"indicator":"no-indicator"),b.xb(2),b.nc(b.Xb(4,2,t._onChange.thumbnailName))}}function A(t,e){1&t&&b.Ib(0,"label",8)}function B(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"label"),b.mc(2),b.Lb(),b.Jb()),2&t){const t=b.Vb(3);b.xb(2),b.pc("",t._onChange.currentThumbnailIndex||0," / ",t._onChange.totalNumThumbnail,"")}}function D(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",10),b.Mb(2,"img",11),b.Tb("click",function(){return b.gc(t),b.Vb().$implicit.onClick()}),b.Wb(3,"translate"),b.Lb(),b.Lb(),b.Mb(4,"div",12),b.kc(5,B,3,2,"ng-container",13),b.Lb(),b.Jb()}if(2&t){const t=b.Vb(),e=t.$implicit,n=t.index,i=b.Vb();b.xb(2),b.ac("src",e.imgPath,b.hc)("alt",e.alt)("title",b.Xb(3,5,e.hoverLabel)),b.yb("data-index",n+e.alt),b.xb(3),b.ac("ngIf",i._onChange&&i._onChange.totalNumThumbnail)}}function X(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",10),b.Mb(1,"img",11),b.Tb("click",function(){return b.gc(t),b.Vb().$implicit.onClick()}),b.Wb(2,"translate"),b.Lb(),b.Lb()}if(2&t){const t=b.Vb(),e=t.$implicit,n=t.index;b.xb(1),b.ac("src",e.imgPath,b.hc)("alt",e.alt)("title",b.Xb(2,4,e.hoverLabel)),b.yb("data-index",n+e.alt)}}function E(t,e){if(1&t&&(b.Kb(0),b.kc(1,D,6,7,"ng-container",2),b.kc(2,X,3,6,"ng-template",null,9,b.lc),b.Jb()),2&t){const t=e.index,n=b.ec(3);b.xb(1),b.ac("ngIf",0===t)("ngIfElse",n)}}function T(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"div",10),b.Mb(2,"img",11),b.Tb("click",function(){return e.$implicit.onClick()}),b.Wb(3,"translate"),b.Lb(),b.Lb(),b.Jb()),2&t){const t=e.$implicit,n=e.index;b.xb(2),b.ac("src",t.imgPath,b.hc)("alt",t.alt)("title",b.Xb(3,4,t.hoverLabel)),b.yb("data-index",n+t.alt)}}let Y=(()=>{class t{constructor(){this._onClick=new b.n,this.bindImagePath=()=>{this.jsonSchema={logosCenter:[{imgPath:"../../../assets/icons/previous.svg",hoverLabel:"labellingInfo.previous",alt:"Previous",onClick:()=>this.emitParentEvent({thumbnailAction:-1})},{imgPath:"../../../assets/icons/next.svg",hoverLabel:"labellingInfo.next",alt:"Next",onClick:()=>this.emitParentEvent({thumbnailAction:1})}],logosEnd:[{imgPath:"../../../assets/icons/undo.svg",hoverLabel:"labellingInfo.undo",alt:"Undo",onClick:()=>null},{imgPath:"../../../assets/icons/redo.svg",hoverLabel:"labellingInfo.redo",alt:"Redo",onClick:()=>null}]}},this.emitParentEvent=({url:t,thumbnailAction:e})=>{this._onClick.emit({url:t,thumbnailAction:e})}}ngOnInit(){this.bindImagePath()}ngOnChanges(t){const{totalNumThumbnail:e}=t._onChange.currentValue;this._onChange.totalNumThumbnail=e,this.bindImagePath()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-info"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick"},features:[b.vb],decls:9,vars:4,consts:[[1,"header-container"],[1,"container-flex-start"],[4,"ngIf","ngIfElse"],["defaultName",""],[1,"container-flex-center"],[4,"ngFor","ngForOf"],[1,"container-flex-end"],[3,"ngClass"],[1,"imageTitle"],["renderOtherIcons",""],[1,"utility-icon-container"],[1,"utility-icon-light",3,"src","alt","title","click"],[1,"totalThumbnail"],[4,"ngIf"]],template:function(t,e){if(1&t&&(b.Mb(0,"div",0),b.Mb(1,"div",1),b.kc(2,j,5,4,"ng-container",2),b.kc(3,A,1,0,"ng-template",null,3,b.lc),b.Lb(),b.Mb(5,"div",4),b.kc(6,E,4,2,"ng-container",5),b.Lb(),b.Mb(7,"div",6),b.kc(8,T,4,6,"ng-container",5),b.Lb(),b.Lb()),2&t){const t=b.ec(4);b.xb(2),b.ac("ngIf",e._onChange.thumbnailName)("ngIfElse",t),b.xb(4),b.ac("ngForOf",e.jsonSchema.logosCenter),b.xb(2),b.ac("ngForOf",e.jsonSchema.logosEnd)}},directives:[i.k,i.j,i.i],pipes:[k,I.c],styles:[".header-container[_ngcontent-%COMP%]{min-width:100vw;max-width:100vw;min-height:4vh;max-height:4vh;background:#525353;border-bottom:.0625vw solid hsla(0,0%,100%,.25);display:flex;justify-content:space-between;z-index:1000;position:absolute}.container-flex-start[_ngcontent-%COMP%]{margin-left:3vw}.container-flex-center[_ngcontent-%COMP%], .container-flex-start[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:inherit;max-height:inherit}.container-flex-center[_ngcontent-%COMP%]{margin-left:8vw}.container-flex-end[_ngcontent-%COMP%]{display:flex;margin-right:19vw}.logo-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw}.logo[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:2.2vh;max-height:2.2vh;padding:.3vw;position:fixed;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.position-absolute[_ngcontent-%COMP%]{position:absolute}.utility-icon-container[_ngcontent-%COMP%]{display:flex;min-height:3.5vh;max-height:3.5vh;min-width:2vw;max-width:2vw}.totalThumbnail[_ngcontent-%COMP%]{font-size:1.7vh;padding:.4vw 1vw 0;display:inline-block;color:#fff;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.img-container[_ngcontent-%COMP%]:hover   .img-description[_ngcontent-%COMP%]{visibility:visible;opacity:1}.imageTitle[_ngcontent-%COMP%]{font-size:1.7vh;color:#fff;align-items:center;margin-left:1vw;max-width:20vw;min-width:20vw;position:absolute;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:aboslute}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.horizontal-line[_ngcontent-%COMP%]{padding:1vh 0;margin:0 1vw;border:.01rem solid #707070}"],changeDetection:0}),t})();var z=n("oSzE"),$=n("DlmY");function R(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new $.a;++e<n;)this.add(t[e])}R.prototype.add=R.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},R.prototype.has=function(t){return this.__data__.has(t)};var V=R,N=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},W=function(t,e,n,i,o,a){var s=1&n,l=t.length,c=e.length;if(l!=c&&!(s&&c>l))return!1;var r=a.get(t);if(r&&a.get(e))return r==e;var h=-1,b=!0,g=2&n?new V:void 0;for(a.set(t,e),a.set(e,t);++h<l;){var d=t[h],u=e[h];if(i)var m=s?i(u,d,h,e,t,a):i(d,u,h,t,e,a);if(void 0!==m){if(m)continue;b=!1;break}if(g){if(!N(e,function(t,e){if(!g.has(e)&&(d===t||o(d,t,n,i,a)))return g.push(e)})){b=!1;break}}else if(d!==u&&!o(d,u,n,i,a)){b=!1;break}}return a.delete(t),a.delete(e),b},F=n("ylTp"),K=n("Ce4a"),J=n("YHEm"),U=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n},H=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},G=F.a?F.a.prototype:void 0,Z=G?G.valueOf:void 0,q=n("TFwu"),Q=Object.prototype.hasOwnProperty,tt=n("YM6B"),et=n("/1FC"),nt=n("WOAq"),it=n("oYcn"),ot="[object Object]",at=Object.prototype.hasOwnProperty,st=n("EUcb"),lt=function t(e,n,i,o,a){return e===n||(null==e||null==n||!Object(st.a)(e)&&!Object(st.a)(n)?e!=e&&n!=n:function(t,e,n,i,o,a){var s=Object(et.a)(t),l=Object(et.a)(e),c=s?"[object Array]":Object(tt.a)(t),r=l?"[object Array]":Object(tt.a)(e),h=(c="[object Arguments]"==c?ot:c)==ot,b=(r="[object Arguments]"==r?ot:r)==ot,g=c==r;if(g&&Object(nt.a)(t)){if(!Object(nt.a)(e))return!1;s=!0,h=!1}if(g&&!h)return a||(a=new z.a),s||Object(it.a)(t)?W(t,e,n,i,o,a):function(t,e,n,i,o,a,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new K.a(t),new K.a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Object(J.a)(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=U;case"[object Set]":if(l||(l=H),t.size!=e.size&&!(1&i))return!1;var c=s.get(t);if(c)return c==e;i|=2,s.set(t,e);var r=W(l(t),l(e),i,o,a,s);return s.delete(t),r;case"[object Symbol]":if(Z)return Z.call(t)==Z.call(e)}return!1}(t,e,c,n,i,o,a);if(!(1&n)){var d=h&&at.call(t,"__wrapped__"),u=b&&at.call(e,"__wrapped__");if(d||u){var m=d?t.value():t,f=u?e.value():e;return a||(a=new z.a),o(m,f,n,i,a)}}return!!g&&(a||(a=new z.a),function(t,e,n,i,o,a){var s=1&n,l=Object(q.a)(t),c=l.length;if(c!=Object(q.a)(e).length&&!s)return!1;for(var r=c;r--;){var h=l[r];if(!(s?h in e:Q.call(e,h)))return!1}var b=a.get(t);if(b&&a.get(e))return b==e;var g=!0;a.set(t,e),a.set(e,t);for(var d=s;++r<c;){var u=t[h=l[r]],m=e[h];if(i)var f=s?i(m,u,h,e,t,a):i(u,m,h,t,e,a);if(!(void 0===f?u===m||o(u,m,n,i,a):f)){g=!1;break}d||(d="constructor"==h)}if(g&&!d){var v=t.constructor,p=e.constructor;v==p||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof p&&p instanceof p||(g=!1)}return a.delete(t),a.delete(e),g}(t,e,n,i,o,a))}(e,n,i,o,t,a))},ct=function(t,e){return lt(t,e)};function rt(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"img",4),b.Tb("click",function(){b.gc(t);const e=b.Vb(),n=e.index,i=e.$implicit;return b.Vb().getIndex(n),i.onClick()}),b.Wb(2,"translate"),b.Lb(),b.Jb()}if(2&t){const t=b.Vb(),e=t.$implicit,n=t.index,i=b.Vb();b.xb(1),b.ac("ngClass",i.conditionalIconTheme(!(null==e||!e.nonClickable)))("ngStyle",(null==e?null:e.toggleable)&&i.conditionalActiveIcon(n))("src",e.imgPath,b.hc)("alt",e.alt)("title",b.Xb(2,6,e.hoverLabel)),b.yb("data-index",n)}}function ht(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"div",2),b.kc(2,rt,3,8,"ng-container",3),b.Lb(),b.Jb()),2&t){const t=e.$implicit;b.xb(2),b.ac("ngIf",t)}}let bt=(()=>{class t{constructor(t,e){this._imgLabelState=t,this._annotateService=e,this._currentUrl="",this._tabStatus=[],this._navigate=new b.n,this.labelList=[],this.updateLabelList=()=>{this.labelList=this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]},this.resetSelectedAnnotate=()=>{this._annotateService.setState()},this.bindImagePath=()=>{this.jsonSchema={logos:[{imgPath:"../../../assets/icons/separator.svg",hoverLabel:"",alt:"",nonClickable:!0,toggleable:!1,onClick:()=>null},{imgPath:"../../../assets/icons/pointer.svg",hoverLabel:"leftSideBar.pointer",alt:"Pointer",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!0,scroll:!0})}},"/imglabel/bndbox"===this._currentUrl?{imgPath:"../../../assets/icons/rec_bounding_box.svg",hoverLabel:"leftSideBar.rectangularBB",alt:"RectangularBB",toggleable:0!==this.labelList.length,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})}}:{imgPath:"../../../assets/icons/polygon.svg",hoverLabel:"leftSideBar.polygon",alt:"Polygon",toggleable:0!==this.labelList.length,onClick:()=>{0!==this.labelList.length?(this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})):this.showAlertNoLabel()}},{imgPath:"../../../assets/icons/eraser.svg",hoverLabel:"leftSideBar.eraser",alt:"Eraser",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!0}),this._imgLabelState.setState(null)}},{imgPath:"../../../assets/icons/fit_center.svg",hoverLabel:"leftSideBar.fitCenter",alt:"Fit Center",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1}),this._imgLabelState.setState(null)}},{imgPath:"../../../assets/icons/save.svg",hoverLabel:"leftSideBar.save",alt:"Save",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1})}}]}},this.checkStateEqual=(t,e)=>!ct(t,e),this.getIndex=t=>{this.iconIndex=t},this.conditionalIconTheme=t=>t?"plain-icon":"utility-icon-light",this.conditionalActiveIcon=t=>t===this.iconIndex?{background:"rgb(59 59 59)"}:null}ngOnInit(){this.updateLabelList(),this.bindImagePath()}ngOnChanges(t){if(this.bindImagePath(),t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){const{currentValue:e}=t._tabStatus;this._tabStatus=[...e],this.updateLabelList()}}showAlertNoLabel(){alert("No label exist yet. Please add new label.")}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(M),b.Hb(w))},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-left-sidebar"]],inputs:{_onChange:"_onChange",_currentUrl:"_currentUrl",_tabStatus:"_tabStatus"},outputs:{_navigate:"_navigate"},features:[b.vb],decls:2,vars:1,consts:[[1,"utility-left-sidebar-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[4,"ngIf"],[3,"ngClass","ngStyle","src","alt","title","click"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.kc(1,ht,3,1,"ng-container",1),b.Lb()),2&t&&(b.xb(1),b.ac("ngForOf",e.jsonSchema.logos))},directives:[i.j,i.k,i.i,i.l],pipes:[I.c],styles:[".utility-left-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.14vw;max-width:2.14vw;min-height:95.4vh;max-height:95.4vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.plain-icon[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:auto}"],changeDetection:0}),t})(),gt=(()=>{class t{constructor(t){this.el=t,this.srcAttr=null,this.canLazyLoad=()=>window&&"IntersectionObserver"in window,this.lazyLoadImage=()=>{new IntersectionObserver(t=>{t.forEach(({isIntersecting:t})=>{t?this.loadImage():this.unloadImage()})}).observe(this.el.nativeElement)},this.loadImage=()=>{this.srcAttr=this.src},this.unloadImage=()=>{this.srcAttr=""}}ngAfterViewInit(){this.canLazyLoad()?this.lazyLoadImage():this.loadImage()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(b.l))},t.\u0275dir=b.Cb({type:t,selectors:[["img","imgLazyLoad",""]],hostVars:1,hostBindings:function(t,e){2&t&&b.yb("src",e.srcAttr,b.hc)},inputs:{src:"src"}}),t})();var dt=n("3Pt+");function ut(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",12),b.Tb("click",function(){b.gc(t);const n=e.$implicit,i=e.index;return b.Vb(3).onClick(n,i)}),b.Mb(2,"div",13),b.Ib(3,"img",14),b.Lb(),b.Mb(4,"div",15),b.Mb(5,"label",16),b.mc(6),b.Wb(7,"fileNameSlice"),b.Lb(),b.Lb(),b.Mb(8,"div"),b.Ib(9,"div",17),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=e.$implicit;b.xb(3),b.ac("src",t.img_thumbnail,b.hc),b.xb(3),b.nc(b.Xb(7,3,t.img_path)),b.xb(3),b.ac("ngClass",(null==t.bnd_box?null:t.bnd_box.length)>0||(null==t.polygons?null:t.polygons.length)>0?"indicator":"no-indicator")}}function mt(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",7),b.Mb(2,"label",8),b.mc(3),b.Wb(4,"translate"),b.Lb(),b.Mb(5,"span",9),b.Mb(6,"div",10),b.Tb("click",function(){b.gc(t);const e=b.Vb().$implicit;return b.Vb().onClose(e)}),b.mc(7,"x"),b.Lb(),b.Lb(),b.Mb(8,"section",11),b.kc(9,ut,10,5,"ng-container",4),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=b.Vb(),e=t.$implicit,n=t.index,i=b.Vb();b.xb(1),b.ac("ngClass",i.checkCloseToggle(e)),b.yb("data-index",n),b.xb(2),b.nc(b.Xb(4,4,e.name)),b.xb(6),b.ac("ngForOf",i._thumbnailList)}}function ft(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"span",29),b.Tb("click",function(){b.gc(t);const e=b.Vb().$implicit;return b.Vb(4).onDeleteLabel(e)}),b.mc(2),b.Wb(3,"translate"),b.Lb(),b.Jb()}if(2&t){const t=b.Vb(5);b.xb(1),b.ac("ngClass",t.clickAbilityToggle?"pointer":null),b.xb(1),b.nc(b.Xb(3,2,"labellingProject.delete"))}}function vt(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",27),b.Mb(2,"label",28),b.Mb(3,"div",29),b.Tb("click",function(){b.gc(t);const n=e.$implicit,i=b.Vb(4);return i.clickAbilityToggle?i.onClickLabel(n):null}),b.mc(4),b.Lb(),b.Lb(),b.Mb(5,"label",30),b.kc(6,ft,4,4,"ng-container",31),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=e.$implicit,n=e.index,i=b.Vb(4);b.xb(1),b.ac("ngClass",t===i.selectedLabel?"label-active":null),b.xb(2),b.ac("ngClass",i.clickAbilityToggle?"pointer":null),b.xb(1),b.oc(" ",t," "),b.xb(2),b.ac("ngIf",!i.action&&n>0)}}function pt(t,e){1&t&&(b.Mb(0,"label",32),b.mc(1),b.Wb(2,"translate"),b.Lb()),2&t&&(b.xb(1),b.oc(" ",b.Xb(2,1,"labellingProject.labelNotExist")," "))}function _t(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",7),b.Mb(2,"label",8),b.mc(3),b.Wb(4,"translate"),b.Lb(),b.Mb(5,"div",19),b.Mb(6,"span",20),b.Mb(7,"div",10),b.Tb("click",function(){b.gc(t);const e=b.Vb(2).$implicit;return b.Vb().onClose(e)}),b.mc(8,"x"),b.Lb(),b.Lb(),b.Ib(9,"span",21),b.Ib(10,"span",21),b.Lb(),b.Mb(11,"div",22),b.Mb(12,"input",23),b.Tb("ngModelChange",function(e){return b.gc(t),b.Vb(3).inputLabel=e})("ngModelChange",function(e){return b.gc(t),b.Vb(3).inputLabelChange(e)})("keydown.enter",function(e){return b.gc(t),b.Vb(3).validateInputLabel(e)}),b.Wb(13,"translate"),b.Lb(),b.Lb(),b.Mb(14,"div",24),b.Mb(15,"div",25),b.kc(16,vt,7,4,"ng-container",4),b.kc(17,pt,3,3,"label",26),b.Lb(),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=b.Vb(2),e=t.$implicit,n=t.index,i=b.Vb();b.xb(1),b.ac("ngClass",i.checkCloseToggle(e)),b.yb("data-index",n),b.xb(2),b.nc(b.Xb(4,8,e.name)),b.xb(9),b.ac("ngClass",i.invalidInput?"input-invalid":null)("ngModel",i.inputLabel)("placeholder",b.Xb(13,10,"labellingProject.enterLabel")),b.xb(4),b.ac("ngForOf",i.labelList),b.xb(1),b.ac("ngIf",0===i.labelList.length)}}function xt(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",38),b.Tb("click",function(){return b.gc(t),b.Vb(8).onDeleteAnnotation()}),b.mc(1," - "),b.Lb()}if(2&t){const t=b.Vb(8);b.ac("ngClass",t.clickAbilityToggle?"pointer":null)}}function yt(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"label",36),b.Tb("click",function(){b.gc(t);const n=e.index,i=e.$implicit,o=b.Vb(7);return o.clickAbilityToggle?o.onClickAnnotation(n,i):null}),b.Mb(2,"div",17),b.mc(3),b.Lb(),b.kc(4,xt,2,1,"div",37),b.Lb(),b.Jb()}if(2&t){const t=e.$implicit,n=e.index,i=b.Vb(7);b.xb(1),b.ac("ngClass",n===i.selectedIndexAnnotation?"annotation-active":null),b.yb("data-index",n),b.xb(1),b.ac("ngClass",i.clickAbilityToggle?"pointer":null),b.xb(1),b.pc(" ",t.label," : ",t.id," "),b.xb(1),b.ac("ngIf",n===i.selectedIndexAnnotation)}}function wt(t,e){if(1&t&&(b.Kb(0),b.kc(1,yt,5,6,"ng-container",4),b.Jb()),2&t){const t=b.Vb().$implicit;b.xb(1),b.ac("ngForOf",t.bnd_box)}}function St(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"label",36),b.Tb("click",function(){b.gc(t);const n=e.index,i=e.$implicit,o=b.Vb(7);return o.clickAbilityToggle?o.onClickAnnotation(n,i):null}),b.Mb(2,"div",17),b.mc(3),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=e.$implicit,n=e.index,i=b.Vb(7);b.xb(1),b.ac("ngClass",n===i.selectedIndexAnnotation?"annotation-active":null),b.yb("data-index",n),b.xb(1),b.ac("ngClass",i.clickAbilityToggle?"pointer":null),b.xb(1),b.pc(" ",t.label," : ",t.id," ")}}function Mt(t,e){if(1&t&&b.kc(0,St,4,5,"ng-container",4),2&t){const t=b.Vb().$implicit;b.ac("ngForOf",t.polygons)}}function Ct(t,e){if(1&t&&(b.Kb(0),b.kc(1,wt,2,1,"ng-container",5),b.kc(2,Mt,1,1,"ng-template",null,35,b.lc),b.Jb()),2&t){const t=e.$implicit,n=b.ec(3);b.xb(1),b.ac("ngIf",t.bnd_box)("ngIfElse",n)}}function Pt(t,e){if(1&t&&(b.Kb(0),b.kc(1,Ct,4,2,"ng-container",4),b.Jb()),2&t){const t=b.Vb(3).$implicit;b.xb(1),b.ac("ngForOf",t.annotation)}}function Lt(t,e){if(1&t){const t=b.Nb();b.Mb(0,"div",7),b.Mb(1,"label",8),b.mc(2),b.Wb(3,"translate"),b.Lb(),b.Mb(4,"div",19),b.Mb(5,"span",20),b.Mb(6,"div",10),b.Tb("click",function(){b.gc(t);const e=b.Vb(2).$implicit;return b.Vb().onClose(e)}),b.mc(7,"x"),b.Lb(),b.Lb(),b.Ib(8,"span",21),b.Ib(9,"span",21),b.Lb(),b.Mb(10,"div",33),b.Mb(11,"div",25),b.Mb(12,"div",34),b.kc(13,Pt,2,1,"ng-container",31),b.Lb(),b.Lb(),b.Lb(),b.Lb()}if(2&t){const t=b.Vb(2),e=t.$implicit,n=t.index,i=b.Vb();b.ac("ngClass",i.checkCloseToggle(e)),b.yb("data-index",n),b.xb(2),b.nc(b.Xb(3,4,e.name)),b.xb(11),b.ac("ngIf",null==e?null:e.annotation)}}function Ot(t,e){if(1&t&&(b.kc(0,_t,18,12,"ng-container",5),b.kc(1,Lt,14,6,"ng-template",null,18,b.lc)),2&t){const t=b.ec(2),e=b.Vb().index;b.ac("ngIf",1===e)("ngIfElse",t)}}function kt(t,e){if(1&t&&(b.Kb(0),b.kc(1,mt,10,6,"ng-container",5),b.kc(2,Ot,3,2,"ng-template",null,6,b.lc),b.Jb()),2&t){const t=e.index,n=b.ec(3);b.xb(1),b.ac("ngIf",0===t)("ngIfElse",n)}}let It=(()=>{class t{constructor(t,e){this._annotateService=t,this._imgLblState=e,this._thumbnailList=[],this._tabStatus=[],this._onClose=new b.n,this._onClickThumbnail=new b.n,this._onClickLabel=new b.n,this._onEnterLabel=new b.n,this._onChangeAnnotationLabel=new b.n,this._onDeleteAnnotation=new b.n,this.action=-1,this.displayInputLabel=!1,this.inputLabel="",this.selectedIndexAnnotation=-1,this.selectedLabel="",this.unsubscribe$=new c.a,this.clickAbilityToggle=!1,this.invalidInput=!1,this.labelList=[],this.updateLabelList=()=>{this.labelList=this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]},this.onClose=t=>{this._onClose.emit({name:t.name,closed:!0})},this.onClick=(t,e)=>{this._onClickThumbnail.emit(Object.assign(Object.assign({},t),{thumbnailIndex:e})),this.selectedIndexAnnotation=-1,this.selectedLabel=""},this.onDisplayInputModal=()=>{this.displayInputLabel=!this.displayInputLabel,this.inputLabel=""},this.validateInputLabel=({target:t})=>{const{value:e}=t,n=e.trim();if(n)if(n.match(/^[a-zA-Z0-9-]*$/))if(this._tabStatus.some(({label_list:t})=>t&&t.length?t.some(t=>t===n):null))this.invalidInput=!0,console.error("Invalid existing label input");else{this.invalidInput=!1;const t=this._tabStatus.map(({label_list:t})=>t||[]).filter(t=>t.length>0)[0];this._onEnterLabel.emit({action:1,label_list:t?[...t,e]:[e]}),this.displayInputLabel=!1,this.inputLabel=""}else this.invalidInput=!0,console.error("Invalid input value")},this.onDeleteLabel=t=>{const[{label_list:e}]=this._tabStatus.filter(t=>t.label_list);this._onClickLabel.emit({selectedLabel:t,label_list:e&&e.length>0?e:[],action:0})},this.onClickLabel=t=>{this.selectedLabel=t,this.selectedIndexAnnotation>-1&&this._onChangeAnnotationLabel.emit({label:t,index:this.selectedIndexAnnotation})},this.onClickAnnotation=(t,{label:e})=>{this.selectedLabel=e,this._annotateService.setState({annotation:t})},this.onDeleteAnnotation=()=>{this.selectedIndexAnnotation>-1&&this._onDeleteAnnotation.emit(this.selectedIndexAnnotation)},this.checkCloseToggle=t=>{let e="";return"labellingProject.label"===t.name&&this._tabStatus[2].closed||"labellingProject.project"===t.name&&this._tabStatus[1].closed&&this._tabStatus[2].closed||"labellingProject.annotation"===t.name||(e="flex-content"),t.closed&&(e+=" closed"),e},this.checkStateEqual=(t,e)=>!ct(t,e)}ngOnInit(){this.updateLabelList(),this._imgLblState.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({draw:t})=>this.clickAbilityToggle=t),this._thumbnailList.length>0&&this._annotateService.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({annotation:t})=>{var e;this.selectedIndexAnnotation=t;const[{annotation:n}]=this._tabStatus.filter(t=>t.annotation),i=null==n?void 0:n.map(({bnd_box:e,polygons:n})=>e?e.find((e,n)=>n===t):n?n.find((e,n)=>n===t):void 0)[0];this.selectedLabel=null!==(e=null==i?void 0:i.label)&&void 0!==e?e:""})}inputLabelChange(t){var e;this.labelList=this._tabStatus[1].label_list?null===(e=this._tabStatus[1].label_list)||void 0===e?void 0:e.filter(e=>e.includes(t)):[]}ngOnChanges(t){if(t._thumbnailList){const{currentValue:e}=t._thumbnailList;this._thumbnailList=Object.assign([],this._thumbnailList,[...e])}if(t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){const{currentValue:e}=t._tabStatus;this._tabStatus=[...e],this.updateLabelList()}}openAllTab(){this._tabStatus.forEach(t=>{t.closed=!1})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(w),b.Hb(M))},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-project"]],inputs:{_thumbnailList:"_thumbnailList",_tabStatus:"_tabStatus"},outputs:{_onClose:"_onClose",_onClickThumbnail:"_onClickThumbnail",_onClickLabel:"_onClickLabel",_onEnterLabel:"_onEnterLabel",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onDeleteAnnotation:"_onDeleteAnnotation"},features:[b.vb],decls:10,vars:1,consts:[[1,"tab-container"],[1,"tab-skeleton"],[1,"choose-tab"],[1,"open-all-tabs",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["nonThumbnailTab",""],[1,"utility-right-project-container","tab","flex-fill-remaining",3,"ngClass"],[1,"tab-name"],[1,"tab-close-thumbnail"],[1,"div-close",3,"click"],[1,"utility-inner-container","tab-height","scroll"],[1,"img-container",3,"click"],[1,"img-skeleton"],["imgLazyLoad","",1,"img",3,"src"],[1,"img-name"],[1,"img-path"],[3,"ngClass"],["annotationTab",""],[1,"flex-tab-icons"],[1,"tab-close-thumbnailless"],[1,"tab-extra-icons"],[1,"div-input"],["type","text",1,"input",3,"ngClass","ngModel","placeholder","ngModelChange","keydown.enter"],["id","inner-container",1,"utility-inner-container","tab-height","scroll"],[1,"flex-item"],["class","not-exist",4,"ngIf"],[1,"flex-center-width",3,"ngClass"],[1,"label"],[3,"ngClass","click"],[1,"action"],[4,"ngIf"],[1,"not-exist"],["id","inner-container",1,"utility-inner-container","scroll","tab-smaller-height"],[1,"flex-center-width"],["polygon",""],[1,"label",3,"ngClass","click"],["class","delete-annotation",3,"ngClass","click",4,"ngIf"],[1,"delete-annotation",3,"ngClass","click"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.Mb(1,"div",1),b.Mb(2,"p",2),b.mc(3,"Choose any tab to start"),b.Lb(),b.Mb(4,"p"),b.mc(5,"or"),b.Lb(),b.Mb(6,"p"),b.Mb(7,"span",3),b.Tb("click",function(){return e.openAllTab()}),b.mc(8,"Click here to open all tabs"),b.Lb(),b.Lb(),b.Lb(),b.kc(9,kt,4,2,"ng-container",4),b.Lb()),2&t&&(b.xb(9),b.ac("ngForOf",e._tabStatus))},directives:[i.j,i.k,i.i,gt,dt.a,dt.f,dt.i],pipes:[I.c,k],styles:['.tab-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;right:0;position:fixed;z-index:1000;min-width:18.5vw;max-width:18.5vw}.utility-right-project-container[_ngcontent-%COMP%]{height:100%;min-width:16.3vw;max-width:16.3vw;background:#696969;border:.0325vw solid hsla(0,0%,100%,.25);border-top:none;z-index:1000;align-items:stretch}.utility-right-project-container[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;min-width:8.5vw;max-width:8.5vw;min-height:4vh;max-height:4vh;background:#383535;z-index:-1;font-size:1.5vh;line-height:3vh;color:#fff;padding:.5vh 0 0 2vw}.tab[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;overflow:hidden}.tab[_ngcontent-%COMP%]:before{position:absolute;content:"";top:4vh;min-width:100vw;max-width:100vw;min-height:93vh;max-height:93vh;background:#383535;z-index:-1}.flex-fixed[_ngcontent-%COMP%]{flex:0 1 25vh}.flex-fill-remaining[_ngcontent-%COMP%]{flex:1 1 auto}.flex-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:33%;min-height:10%;flex-shrink:0;flex-grow:0;resize:vertical}.tab-name[_ngcontent-%COMP%]{font-size:1.7vh;padding:.5vw 2vw 0;display:inline-block;color:#fff;position:absolute}.tab-close-thumbnail[_ngcontent-%COMP%]{margin-left:3vw;justify-content:center}.tab-close-thumbnail[_ngcontent-%COMP%], .tab-close-thumbnailless[_ngcontent-%COMP%]{float:right;vertical-align:middle;min-height:4vh;max-height:4vh;color:#696969;font-size:2vh;line-height:4vh;text-align:center;display:inline-grid;padding-bottom:1vh}.tab-close-thumbnailless[_ngcontent-%COMP%]{flex:1 0 60%;justify-content:right}.div-close[_ngcontent-%COMP%]{min-width:1.6vw;max-width:1.6vw;min-height:4vh;max-height:4vh;color:#fff;cursor:pointer;text-align:center;float:right}.div-close[_ngcontent-%COMP%]:active{background:grey}.utility-inner-container[_ngcontent-%COMP%]{padding:2.5vh 0 0 .2vw;scroll-behavior:smooth;overflow:hidden auto;z-index:100;min-width:15.5vw;max-width:15.5vw}.tab-height[_ngcontent-%COMP%]{height:75%}.tab-smaller-height[_ngcontent-%COMP%]{height:60%}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.img-container[_ngcontent-%COMP%], .utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.img-container[_ngcontent-%COMP%]{font-size:1.5vh;color:#fff;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;cursor:pointer;margin:0 .3vw;padding:.1vh .4vw}.img-container[_ngcontent-%COMP%]:hover{background-color:#444;border-radius:2px}.img[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}.img[_ngcontent-%COMP%], .img-skeleton[_ngcontent-%COMP%]{max-height:4.3vh;min-height:4.3vh;max-width:3vw}.img-skeleton[_ngcontent-%COMP%]{min-width:3vw;border:.005vh dotted #525353}.img-name[_ngcontent-%COMP%]{margin-left:.5vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.closed[_ngcontent-%COMP%]{display:none}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute}.flex-item[_ngcontent-%COMP%]{align-items:center;flex-direction:column;font-size:1.5vh;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.flex-center-width[_ngcontent-%COMP%], .flex-item[_ngcontent-%COMP%]{display:flex;justify-content:center}.flex-center-width[_ngcontent-%COMP%]{width:90%;flex-wrap:wrap}.label[_ngcontent-%COMP%]{flex:1 1 80%;display:flex;justify-content:flex-start;margin:.25vh 0}.pointer[_ngcontent-%COMP%]{cursor:pointer}.annotation-active[_ngcontent-%COMP%], .label-active[_ngcontent-%COMP%]{border:.15vw solid #ff0}.utility-info-btn[_ngcontent-%COMP%]{font-size:1vw;min-width:0;max-width:0;min-height:2.5vh;max-height:2.5vh;line-height:0;right:21vh;position:absolute;background:#383535;border:none;color:#fff}.flex-tab-icons[_ngcontent-%COMP%]{display:flex;width:100%}.extra-icons[_ngcontent-%COMP%]{cursor:pointer}.extra-icons[_ngcontent-%COMP%]:active{background:grey}.tab-extra-icons[_ngcontent-%COMP%]{float:right;vertical-align:middle;font-size:1.7vh;line-height:4vh;text-align:center;color:#fff;flex:1 0 15%;justify-content:flex-start}.tab-text[_ngcontent-%COMP%]{font-size:1.7vh;min-width:6vw;max-width:6vw}.inner-content[_ngcontent-%COMP%]{max-height:25vh;min-height:25vh;min-width:3vw;max-width:3vw}.div-input[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin:.5vh .9vw}.input[_ngcontent-%COMP%]{border-radius:8vw;border:none;outline:none;padding:.3vw 0 .3vw 1vw;min-height:1.5vh;max-height:1.5vh;min-width:13vw;max-width:13vw;font-size:1.3vh;background:#525353;color:#fff}.input-invalid[_ngcontent-%COMP%]{border:.2vw solid red}.img-path[_ngcontent-%COMP%]{margin-top:4vh}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:relative}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.not-exist[_ngcontent-%COMP%]{font-size:1.5vh;color:#999}.delete-annotation[_ngcontent-%COMP%]{position:absolute;right:2vw}.open-all-tabs[_ngcontent-%COMP%]{cursor:pointer;padding:.2vh .2vw;border-radius:.7vw}.open-all-tabs[_ngcontent-%COMP%]:hover{background:#636363}.open-all-tabs[_ngcontent-%COMP%]:active, .open-all-tabs[_ngcontent-%COMP%]:focus{background:#737474}.tab-skeleton[_ngcontent-%COMP%]{position:absolute;height:100vh;width:16.5vw;background:#525353;border-left:.0625vw solid hsla(0,0%,100%,.25);text-align:center;color:#cac8c8;font-size:2vh}.choose-tab[_ngcontent-%COMP%]{margin-top:42vh}']}),t})();function jt(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"div",3),b.Mb(2,"label"),b.Mb(3,"img",4),b.Tb("click",function(){return e.$implicit.onClick()}),b.Wb(4,"translate"),b.Lb(),b.Lb(),b.Lb(),b.Jb()),2&t){const t=e.$implicit,n=e.index,i=b.Vb();b.xb(3),b.jc(t.style),b.ac("ngClass",i.conditionalIconTheme())("src",t.imgPath,b.hc)("alt",t.alt)("title",b.Xb(4,7,t.hoverLabel)),b.yb("data-index",n)}}let At=(()=>{class t{constructor(){this._onClick=new b.n,this._onExport=new b.n,this._onReload=new b.n,this.bindImagePath=()=>{this.jsonSchema={logos:[{imgPath:"../../../assets/icons/folder.svg",hoverLabel:"rightSideBar.folderOrFiles",alt:"Folder",onClick:()=>{this._onClick.emit({name:"labellingProject.project",closed:!1})}},{imgPath:"../../../assets/icons/tag.svg",hoverLabel:"rightSideBar.label",alt:"Label",onClick:()=>{this._onClick.emit({name:"labellingProject.label",closed:!1})}},{imgPath:"../../../assets/icons/bounding_box.svg",hoverLabel:"rightSideBar.annotation",alt:"Annotation",onClick:()=>{this._onClick.emit({name:"labellingProject.annotation",closed:!1})}},{imgPath:"../../../assets/icons/statistic.svg",hoverLabel:"rightSideBar.statistic",alt:"Statistic",onClick:()=>{}},{imgPath:"../../../assets/icons/export.svg",hoverLabel:"rightSideBar.export",alt:"Export",style:"padding: 1.5vh 0.5vw;",onClick:()=>{this._onExport.emit()}},{imgPath:"../../../assets/icons/reload.svg",hoverLabel:"rightSideBar.reload",alt:"Reload",style:"padding: 1.5vh 0.5vw;",onClick:()=>{this._onReload.emit()}}]}},this.conditionalIconTheme=()=>"utility-icon-light"}ngOnInit(){this.bindImagePath()}ngOnChanges(t){this.bindImagePath()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-right-sidebar"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick",_onExport:"_onExport",_onReload:"_onReload"},features:[b.vb],decls:3,vars:1,consts:[[1,"utility-right-sidebar-container"],[1,"utility-inner-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.Mb(1,"div",1),b.kc(2,jt,5,9,"ng-container",2),b.Lb(),b.Lb()),2&t&&(b.xb(2),b.ac("ngForOf",e.jsonSchema.logos))},directives:[i.j,i.i],pipes:[I.c],styles:[".utility-right-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.2vw;max-width:2.2vw;min-height:95.5vh;max-height:95.5vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-inner-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw;position:absolute}.utility-icon-container[_ngcontent-%COMP%], .utility-inner-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.input-none[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t})();function Bt(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"div",3),b.mc(2),b.Wb(3,"translate"),b.Lb(),b.Jb()),2&t){const t=b.Vb(2);b.xb(2),b.pc("",b.Xb(3,2,"footer.image"),": ",t.thumbnailType,"")}}function Dt(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",2),b.Mb(2,"div",3),b.mc(3),b.Wb(4,"translate"),b.Lb(),b.kc(5,Bt,4,4,"ng-container",1),b.Mb(6,"div",3),b.mc(7),b.Lb(),b.Mb(8,"div",4),b.Wb(9,"translate"),b.Mb(10,"label",5),b.Tb("click",function(){b.gc(t);const e=b.Vb();return e.copyMessage(e._thumbnailInfo.img_path)}),b.mc(11),b.Lb(),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=b.Vb();b.xb(3),b.pc("",b.Xb(4,7,"footer.size"),": ",t.thumbnailSize,""),b.xb(2),b.ac("ngIf",t.thumbnailType),b.xb(2),b.pc("",t._thumbnailInfo.img_ori_w," x ",t._thumbnailInfo.img_ori_h,""),b.xb(1),b.ac("title",b.Xb(9,9,"footer.copyToClipboard")),b.xb(3),b.nc(t._thumbnailInfo.img_path)}}let Xt=(()=>{class t{constructor(){this._imgSrc="",this.thumbnailSize="",this.thumbnailType="",this.formatBytes=(t,e=2)=>{if(0===t)return"0 Bytes";const n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}ngOnInit(){}copyMessage(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}ngOnChanges(t){if(t._thumbnailInfo&&t._imgSrc){const{currentValue:e}=t._thumbnailInfo,{currentValue:n}=t._imgSrc;this._thumbnailInfo=Object.assign(Object.assign({},this._thumbnailInfo),e),this.thumbnailSize=this.formatBytes(n.length);const i=n.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(i&&i.length){const t=i[1].split("/")[1];this.thumbnailType=t}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-footer"]],inputs:{_thumbnailInfo:"_thumbnailInfo",_imgSrc:"_imgSrc"},features:[b.vb],decls:3,vars:3,consts:[[1,"footer-container"],[4,"ngIf"],[1,"footer-label-container"],[1,"footer-label"],[1,"footer-image-path",3,"title"],[1,"footer-path-label",3,"click"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.kc(1,Dt,12,11,"ng-container",1),b.Wb(2,"json"),b.Lb()),2&t&&(b.xb(1),b.ac("ngIf","{}"!=b.Xb(2,1,e._thumbnailInfo)))},directives:[i.k],pipes:[i.e,I.c],styles:[".footer-container[_ngcontent-%COMP%]{position:absolute;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);min-height:2.3vh;max-height:2.3vh;min-width:100vw;max-width:100vw;bottom:0;padding-left:2.5vw}.footer-label-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:baseline;width:80%}.footer-label[_ngcontent-%COMP%]{flex:0 1 15%;text-align:center}.footer-image-path[_ngcontent-%COMP%], .footer-label[_ngcontent-%COMP%]{font-size:1.6vh;color:#fff;outline:none;border-right:.05vw solid #fff;padding:0 1vw}.footer-image-path[_ngcontent-%COMP%]{display:flex;flex:0 1 130%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border-right[_ngcontent-%COMP%]{border-right:1rem #fff}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:1.5vh;max-height:1.5vh;padding:0;position:absolute;cursor:context-menu}.footer-path-label[_ngcontent-%COMP%]{cursor:pointer;padding:0 .2vw;border-radius:.5vw}.footer-path-label[_ngcontent-%COMP%]:hover{background:#636363}.footer-path-label[_ngcontent-%COMP%]:active, .footer-path-label[_ngcontent-%COMP%]:focus{background:#737474}"],changeDetection:0}),t})();var Et=n("44N4"),Tt=n("TJKd"),Yt=n("XIp8"),zt=n("CfRg"),$t=function(t){return Object(zt.a)(t,4)};class Rt{constructor(){}stringifyObject(t){try{return JSON.stringify(t)}catch(e){return console.log("StringifyObject(content) ----\x3e ",e.name+": ",e.message),""}}deepCloneObject(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.log("DeepCloneObject(content) ----\x3e ",e.name+": ",e.message),null}}deepCloneVariable(t){try{const e=t?JSON.parse(JSON.stringify({item:t})):"",{item:n}=e;return n}catch(e){return console.log("DeepCloneVariable(variable) ----\x3e ",e.name+": ",e.message),""}}generateUniquesID(){try{let t="";const e=new Date;return t+=e.getDate().toString(),t+=(e.getMonth()+1).toString(),t+=e.getFullYear().toString(),t+=e.getHours().toString(),t+=e.getMinutes().toString(),t+=e.getSeconds().toString(),t+=e.getMilliseconds().toString(),parseInt(t,10)}catch(t){return console.log("GenerateUniquesID() ----\x3e ",t.name+": ",t.message),-1}}matchStringHead(t,e){try{return e.substr(0,t.length)===t}catch(n){return console.log("MatchStringHead(StrToMatch:string, oristr:string) ----\x3e ",n.name+": ",n.message),!1}}getFilename(t){try{const e=this.deepCloneVariable(t).split("\\").join("/").split("/");return e[e.length-1]}catch(e){return console.log("GetFilename(strs) ----\x3e ",e.name+": ",e.message),""}}GetFoldername(t){try{const e=JSON.parse(JSON.stringify({st:t})).st.split("\\").join("/").split("/");return e.pop(),e.join("/")}catch(e){return console.log("GetFoldername(strs) ----\x3e ",e.name+": ",e.message),""}}RemoveHTMLElement(t){var e;try{const n=document.getElementById(t);null!=n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}catch(n){console.log("RemoveHTMLElement(ids) ----\x3e ",n.name+": ",n.message)}}}let Vt=(()=>{class t{constructor(){this.globalXY={x:0,y:0},this.panXY={x:0,y:0},this.currentClickedBox={box:-1,pos:"o"},this.lineOffset=3,this.anchrSize=2.5,this.currentDrawing={x1:0,x2:0,y1:0,y2:0},this.currentSelectedBndBox=-1,this.util=new Rt}getDiffXY({offsetX:t,offsetY:e}){try{const n={diffX:0,diffY:0};return n.diffX=this.globalXY.x+(t-this.panXY.x),n.diffY=this.globalXY.y+(e-this.panXY.y),n}catch(n){return console.log("ObjectDetection getDiffXY(offsetX: number,offsetY: number): { diffX: number; diffY: number }",n.name+": ",n.message),{diffX:-1,diffY:-1}}}setCurrentX1Y1(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x1=t,this.currentDrawing.y1=e)}catch(n){console.log("ObjectDetection setCurrentX1Y1(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}setCurrentX2Y2(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x2=t,this.currentDrawing.y2=e)}catch(n){console.log("ObjectDetection setCurrentX2Y2(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}moveAllBbox(t,e,n,i){try{for(const i of t){const t=i.x2-i.x1,o=i.y2-i.y1;i.x1=$t(e+i.distancetoImg.x),i.y1=$t(n+i.distancetoImg.y),i.x2=$t(i.x1+t),i.y2=$t(i.y1+o)}i&&i(!0)}catch(o){}}calScaleTofitScreen(t,e,n,i){try{const o={factor:-1,newX:-1,newY:-1};return o.factor=Math.min(n/t,i/e),o.factor=o.factor-.05*o.factor,o.newX=n/2-t/2*o.factor,o.newY=i/2-e/2*o.factor,o}catch(o){return{factor:-1,newX:-1,newY:-1}}}deleteSingleBox(t,e,n){try{t.splice(e,1),this.currentSelectedBndBox=-1,this.currentClickedBox={box:-1,pos:"o"},n(!0)}catch(i){}}keyboardMoveBox(t,e,{img_w:n,img_h:i,img_x:o,img_y:a},s){try{switch(t){case"up":this.moveBoxWithinPointPath(o,a,n,i,0,-3,e)&&(e.y1-=3,e.y2-=3);break;case"down":this.moveBoxWithinPointPath(o,a,n,i,0,3,e)&&(e.y1+=3,e.y2+=3);break;case"left":this.moveBoxWithinPointPath(o,a,n,i,-3,0,e)&&(e.x1-=3,e.x2-=3);break;case"right":this.moveBoxWithinPointPath(o,a,n,i,3,0,e)&&(e.x1+=3,e.x2+=3)}s(!0)}catch(l){}}moveBoxWithinPointPath(t,e,n,i,o,a,s){try{return!(s.x1+o<t||s.x2+o>t+n||s.y1+a<e||s.y2+a>e+i)}catch(l){return console.log("ObjectDetection isWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, addx:number, addy:number, box:Boundingbox):Boolean",l.name+": ",l.message),!1}}mouseMoveBox(t,e,n){try{if(this.moveBoxWithinPointPath(n.img_x,n.img_y,n.img_w,n.img_h,t-this.currentDrawing.x1,e-this.currentDrawing.y1,n.bnd_box[this.currentSelectedBndBox])){this.setCurrentX2Y2(t,e);const i=this.currentDrawing.x2-this.currentDrawing.x1,o=this.currentDrawing.y2-this.currentDrawing.y1;this.setCurrentX1Y1(this.currentDrawing.x2,this.currentDrawing.y2),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"l"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x1+=i),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"t"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y1+=o),"i"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos&&"r"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x2+=i),"i"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos&&"b"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y2+=o)}}catch(i){console.log("ObjectDetection mouseMoveBox(MouseX:number, MouseY:number, CurrMeta:Metadata):void",i.name+": ",i.message)}}getCurrentSelectedBox(){try{return this.currentSelectedBndBox}catch(t){return-1}}setCurrentSelectedbBox(t){try{this.currentSelectedBndBox=t}catch(e){console.log("ObjectDetection setCurrentSelectedbBox(newNUM:number):void",e.name+": ",e.message)}}mouseUpDrawEnable(t,e,n){try{const i={selBox:-1,isNew:!1};if(-1===this.currentClickedBox.box&&null!==this.tmpbox)t.bnd_box.push(this.tmpbox),this.currentSelectedBndBox=t.bnd_box.length-1,t.bnd_box[this.currentSelectedBndBox].label=e.length>0?e[0].name:"",i.isNew=!0,i.selBox=$t(this.currentSelectedBndBox);else if(this.currentClickedBox.box>-1&&this.tmpbox){if(t.bnd_box[this.currentSelectedBndBox].x1>t.bnd_box[this.currentSelectedBndBox].x2){const e=$t(t.bnd_box[this.currentSelectedBndBox].x1);t.bnd_box[this.currentSelectedBndBox].x1=$t(t.bnd_box[this.currentSelectedBndBox].x2),t.bnd_box[this.currentSelectedBndBox].x2=e}if(t.bnd_box[this.currentSelectedBndBox].y1>t.bnd_box[this.currentSelectedBndBox].y2){const e=$t(t.bnd_box[this.currentSelectedBndBox].y1);t.bnd_box[this.currentSelectedBndBox].y1=$t(t.bnd_box[this.currentSelectedBndBox].y2),t.bnd_box[this.currentSelectedBndBox].y2=e}}return this.currentClickedBox={box:-1,pos:"o"},this.setCurrentX1Y1(0,0),this.setCurrentX2Y2(0,0),this.tmpbox=null,n(!0),i}catch(i){return console.log("ObjectDetection MouseUpDrawEnable(CurrMeta: Metadata): number",i.name+": ",i.message),{selBox:-1,isNew:!1}}}panRectangle(t,e,n,i){try{for(const i of t){const t=i.x2-i.x1,o=i.y2-i.y1;i.x1=e+i.distancetoImg.x,i.y1=n+i.distancetoImg.y,i.x2=i.x1+t,i.y2=i.y1+o}i(!0)}catch(o){console.log("ObjectDetection panRectangle(bbox:Boundingbox[], img_X:number, img_Y:number)",o.name+": ",o.message)}}scaleAllBoxes(t,e,n,i,o){try{for(const o of e){console.log(o);const e=o.distancetoImg.x*t+n,a=o.distancetoImg.y*t+i,s=e+(o.x2-o.x1)*t,l=a+(o.y2-o.y1)*t;o.x1=$t(e),o.y1=$t(a),o.x2=$t(s),o.y2=$t(l);const c=o.y1-i;o.distancetoImg.x=$t(o.x1-n),o.distancetoImg.y=$t(c)}o&&o(!0)}catch(a){console.log("ObjectDetection scaleAllBoxes(scalefactor: number,boxes:Boundingbox[],imgX:number,imgY:number)",a.name+": ",a.message)}}mouseMoveDrawEnable(t,e,n){try{-1===this.currentClickedBox.box?this.setCurrentX2Y2(t,e):this.mouseMoveBox(t,e,n)}catch(i){console.log("ObjectDetection MouseMoveDrawEnable(MouseX: number,MouseY: number,SelectedMeta: Metadata): void",i.name+": ",i.message)}}mouseDownDrawEnable(t,e,n){try{return this.getCurrentClickBox(t,e,n),this.setCurrentX1Y1(t,e),this.setCurrentX2Y2(t,e),this.currentSelectedBndBox=-1!==this.currentClickedBox.box?this.currentClickedBox.box:-1,this.currentClickedBox.box}catch(i){return console.log("ObjectDetection MouseDownDrawEnable(MouseX:number,MouseY:number,BBox:Boundingbox[]):number",i.name+": ",i.message),-1}}setPanXY(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}setGlobalXY(t,e){try{return!(!t||!e||(this.globalXY.x=t,this.globalXY.y=e,0))}catch(n){return console.log("ObjectDetection SetGlobalXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}changeLabel(t,e){t&&e&&(t.label=e)}mouseClickWithinPointPath({img_x:t,img_y:e,img_w:n,img_h:i},{offsetX:o,offsetY:a}){try{return o>t&&o<t+n&&a>e&&a<e+i}catch(s){return console.log(s),!1}}drawAllBoxOn(t,e,n){try{if(e.length>0)for(const[i,o]of e.entries())i===this.currentClickedBox.box||i===this.currentSelectedBndBox?(o.color="rgba(0,255,0,1.0)",o.lineWidth=2,this.drawEachBoxOn(t,o,n,!0)):(o.color="rgba(255,255,0,0.8)",o.lineWidth=1,this.drawEachBoxOn(t,o,n,!1));if(-1===this.currentClickedBox.box&&-1===this.currentSelectedBndBox){for(const l of e)l.color="rgba(255,255,0,0.8)",this.drawEachBoxOn(t,l,n,!1);const{x1:i,x2:o,y1:a,y2:s}=this.currentDrawing;this.tmpbox=this.generateNewBox(i,o,a,s),this.tmpbox&&this.drawEachBoxOn(t,this.tmpbox,n,!0)}}catch(i){console.log("redraw(boundbox) ----\x3e ",i.name+": ",i.message)}}drawEachBoxOn(t,e,n,i){try{if(n){const o=e.x1+(e.x2-e.x1)/2,a=e.y1+(e.y2-e.y1)/2;n.strokeStyle="white",n.fillStyle="black",n.font="bold 12px Arial",""==e.label?(n.strokeText("",e.x1+10,e.y1+15),n.fillText("",e.x1+10,e.y1+15)):t.find(t=>t.name===e.label)?(n.strokeText(e.label,e.x1+10,e.y1+15),n.fillText(e.label,e.x1+10,e.y1+15)):(n.strokeText("Text",e.x1+10,e.y1+15),n.fillText("Text",e.x1+10,e.y1+15)),n.strokeStyle=e.color,n.beginPath(),n.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),n.lineWidth=e.lineWidth,n.stroke(),n.fillStyle=e.color,i&&(n.beginPath(),n.fillRect(e.x1-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(o-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(o-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(o-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize))}}catch(o){console.log("ObjectDetection drawEachBoxOn(box:Boundingbox, context:CanvasRenderingContext2D, isSelected:boolean):void",o.name+": ",o.message)}}generateNewBox(t,e,n,i){try{const o=t<e?t:e,a=n<i?n:i,s=t>e?t:e,l=n>i?n:i;return s-o>this.lineOffset&&l-a>this.lineOffset?{x1:o,y1:a,x2:s,y2:l,lineWidth:2,color:"rgba(0,255,0,1.0)",distancetoImg:{x:0,y:0},label:"",id:this.util.generateUniquesID()}:null}catch(o){return console.log("ObjectDetection GenerateNewBox(x1:number,x2:number,y1:number,y2:number):Boundingbox",o.name+": ",o.message),null}}getBBoxDistfromImg(t,e,n){try{for(const{x1:i,y1:o,distancetoImg:a}of t){const t=o-n;a.x=$t(i-e),a.y=$t(t)}}catch(i){console.log("ObjectDetection GetBBoxDistfromImg(bbox:Boundingbox[],imgX:number,imgY:number)",i.name+": ",i.message)}}getCurrentClickBox(t,e,n){try{return this.currentClickedBox=this.mouseClickOnBoxes(t,e,n),this.currentClickedBox}catch(i){return console.log("ObjectDetection getCurrentClickBox(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}mouseClickOnBoxes(t,e,n){try{for(let i=0;i<n.length;++i){const o=n[i].x1+(n[i].x2-n[i].x1)/2,a=n[i].y1+(n[i].y2-n[i].y1)/2;if(n[i].x1-this.lineOffset<t&&t<n[i].x1+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tl"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"bl"};if(a-this.lineOffset<e&&e<a+this.lineOffset)return{box:i,pos:"l"}}else if(n[i].x2-this.lineOffset<t&&t<n[i].x2+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tr"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"br"};if(a-this.lineOffset<e&&e<a+this.lineOffset)return{box:i,pos:"r"}}else if(o-this.lineOffset<t&&t<o+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"t"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"b"};if(n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}else if(n[i].x1-this.lineOffset<t&&t<n[i].x2+this.lineOffset&&n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}return{box:-1,pos:"o"}}catch(i){return console.log("ObjectDetection mouseClickOnBoxes(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),Nt=(()=>{class t{constructor(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.maxStageSize=51,this.allowUndo=!1,this.allowRedo=!1,this.utility=new Rt,this.removeLastArray=t=>t.splice(-1,1)[0]}appendStages(t){t&&(this.redoArr=[],this.allowRedo=!1,0===this.currentArr.length?this.currentArr.push(this.utility.deepCloneVariable(t)):(this.undoArr.length===this.maxStageSize&&this.undoArr.splice(0,1),this.undoArr.push(this.removeLastArray(this.currentArr)),this.currentArr.push(this.utility.deepCloneVariable(t)),this.allowUndo=!0))}clearAllStages(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.allowUndo=!1,this.allowRedo=!1}undo(){if(this.allowRedo=!0,this.undoArr.length>0){this.redoArr.push(this.removeLastArray(this.currentArr));const t=this.removeLastArray(this.undoArr);return this.currentArr.push(t),this.allowUndo=0!==this.undoArr.length,t}return null}redo(){let t=null;return 0!==this.redoArr.length&&(this.undoArr.push(this.removeLastArray(this.currentArr)),t=this.removeLastArray(this.redoArr),this.currentArr.push(t),this.allowRedo=0!==this.redoArr.length),this.allowUndo=this.undoArr.length>0,t}clearRedundantStages(){var t,e;(null===(t=this.currentArr[0])||void 0===t?void 0:t.meta)&&"polygons"in this.currentArr[0].meta||this.undoArr.length>0&&(!this.isStateChange((null===(e=this.undoArr[this.undoArr.length-1])||void 0===e?void 0:e.meta).bnd_box)||(this.currentArr.pop(),this.currentArr.push(this.removeLastArray(this.undoArr))))}isAllowRedo(){return this.allowRedo}isAllowUndo(){return this.allowUndo}isMethodChange(t){var e;return(null===(e=this.currentArr[0])||void 0===e?void 0:e.method)!==t}replaceStages(t){t&&(this.currentArr[0]=this.utility.deepCloneVariable(t))}isStateChange(t){return!!t&&!!(t&&this.isAnnotationChange(t)||this.isLabelChange(t))}isLabelChange(t){var e,n,i,o;if((null===(e=this.currentArr[0])||void 0===e?void 0:e.meta)&&"polygons"in(null===(n=this.currentArr[0])||void 0===n?void 0:n.meta)){const e=t,n=(null===(i=this.currentArr[0])||void 0===i?void 0:i.meta).polygons;if(e.length!==n.length)return!0;for(const[t,{label:i}]of n.entries());}else{const e=t,n=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).bnd_box;if(e.length!==n.length)return!0;for(const[t,{label:i}]of n.entries())if(e[t].label!==i)return!0}return!1}isAnnotationChange(t){var e,n,i,o;if((null===(e=this.currentArr[0])||void 0===e?void 0:e.meta)&&"polygons"in(null===(n=this.currentArr[0])||void 0===n?void 0:n.meta)){if(this.currentArr.length<1)return!0;{const e=t,n=(null===(i=this.currentArr[0])||void 0===i?void 0:i.meta).polygons;return e.length!==n.length||!!n.some(({coorPt:t},n)=>e.some(({coorPt:e},i)=>t[n].x!==e[i].x||t[n].y!==e[i].y))||null}}if(this.currentArr.length<1)return!0;{const e=t,n=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).bnd_box;if(e.length!==n.length)return!0;for(const[t,{x1:i,x2:o,y1:a,y2:s}]of e.entries())return i!==n[t].x1||o!==n[t].x2||a!==n[t].y1||s!==n[t].y2||null}return!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),Wt=(()=>{class t{constructor(){this.MEMO=null,this.utility=new Rt}copy(t){this.MEMO=this.utility.deepCloneVariable(t)}paste(){return this.MEMO?"coorPt"in this.MEMO?this.polygonPaste():this.boundingBoxPaste():null}isAvailable(){return!!this.MEMO}clear(){this.MEMO=null}polygonPaste(){const t=this.utility.deepCloneObject(this.MEMO);let{coorPt:e,id:n}=t;for(const i of e)i.x+=8,i.y+=8,i.distancetoImg.x=0,i.distancetoImg.y=0;return n=this.utility.generateUniquesID(),t}boundingBoxPaste(){const t=this.utility.deepCloneObject(this.MEMO),e=t.x2-t.x1,n=t.y2-t.y1;return t.x1+=8,t.y1+=8,t.x2=t.x1+e,t.y2=t.y1+n,t.id=this.utility.generateUniquesID(),t.distancetoImg.x=0,t.distancetoImg.y=0,t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const Ft={scale:1,factor:.05,max_scale:4};let Kt=(()=>{class t{constructor(){this.zoomSubject=new x.a(Ft),this.zoom$=this.zoomSubject.asObservable(),this.setState=t=>{this.zoomSubject.next(t?Object.assign(Object.assign({},Ft),t):Ft)}}resetZoomScale(){this.zoomSubject.next(Ft)}calculateZoomScale(t,e,n){let{scale:i}=e;const{factor:o,max_scale:a}=e;let s=t.wheelDelta;void 0===s&&(s=t.detail),s=Math.max(-1,Math.min(1,s));const{scrollLeft:l,scrollTop:c}=n,r=(t.pageX+l)/i,h=(t.pageY+c)/i;return i+=s*o*i,i=Math.max(1,Math.min(a,i)),Object.assign(Object.assign({},{x:r*i-t.pageX,y:h*i-t.pageY}),{scale:i})}validateZoomScale({canvas:{style:{transform:t}}},e){return t!==`scale(${e}, ${e})`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const Jt={move:!1,pointer:!1,grab:!1,grabbing:!1,crosshair:!1,"zoom-in":!1,"zoom-out":!1,resize:!1};let Ut=(()=>{class t{constructor(){this.mouseCursorSubject=new x.a(Jt),this.mouseCursor$=this.mouseCursorSubject.asObservable(),this.setState=t=>{this.mouseCursorSubject.next(t?Object.assign(Object.assign({},Jt),t):Jt)}}changeCursor(t,e){if(e){const{wheelDelta:t,detail:n}=e;void 0!==t?150===t?this.setState({"zoom-in":!0}):-150===t&&this.setState({"zoom-out":!0}):3===n?this.setState({"zoom-in":!0}):-3===n&&this.setState({"zoom-out":!0})}else for(const[n,i]of Object.entries(t))if(!0===i)return n}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const Ht=["canvasdrawing"],Gt=["floatdiv"],Zt=["lbltypetxt"],qt=["availablelbl"];function Qt(t,e){if(1&t){const t=b.Nb();b.Mb(0,"li",12),b.Tb("click",function(){b.gc(t);const n=e.$implicit;return b.Vb().labelNameClicked(n.name)}),b.Mb(1,"span",13),b.mc(2),b.Lb(),b.Mb(3,"span",14),b.mc(4),b.Lb(),b.Lb()}if(2&t){const t=e.$implicit;b.xb(2),b.nc(t.name),b.xb(2),b.nc(t.count)}}function te(t,e){1&t&&(b.Mb(0,"li",15),b.Mb(1,"div",16),b.mc(2),b.Wb(3,"translate"),b.Lb(),b.Mb(4,"div",16),b.mc(5),b.Wb(6,"translate"),b.Lb(),b.Lb()),2&t&&(b.xb(2),b.nc(b.Xb(3,2,"searchLabel.labelNotExist")),b.xb(3),b.nc(b.Xb(6,4,"searchLabel.enterToAdd")))}const ee=function(){return{standalone:!0}},ne=function(t){return{cursor:t}};let ie=(()=>{class t{constructor(t,e,n,i,o,a,s){this._boundingBoxCanvas=t,this._imgLblStateService=e,this._undoRedoService=n,this._copyPasteService=i,this._annotateSelectState=o,this._zoomService=a,this._mouseCursorService=s,this.image=new Image,this.mousedown=!1,this.unsubscribe$=new c.a,this.labelSearch="",this.labelList=[],this.allLabelList=[],this.showDropdownLabelBox=!1,this.invalidInput=!1,this.closeEnough=5,this._imgSrc="",this._tabStatus=[],this._onChangeMetadata=new b.n,this._onChangeAnnotationLabel=new b.n,this._onEnterLabel=new b.n,this.validateInputLabel=({target:t})=>{const{value:e}=t,n=e.trim();n&&(this._tabStatus.some(({label_list:t})=>t&&t.length?t.some(t=>t===n):null)?(this.invalidInput=!0,console.error("Invalid existing label input")):(this.invalidInput=!1,this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:e,index:this.annotateState.annotation}),this.labelSearch=""))}}ngOnInit(){this.getLabelList(),this._imgLblStateService.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{var{clear:e,fitCenter:n}=t,i=o(t,["clear","fitCenter"]);this.boundingBoxState=Object.assign(Object.assign({},i),{clear:e,fitCenter:n}),n&&this.imgFitToCenter(),e&&(this._selectMetadata.bnd_box=[],this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this.redrawImage(this._selectMetadata),this.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{this.annotateState=t,this._boundingBoxCanvas.setCurrentSelectedbBox(t.annotation),this._selectMetadata&&this.redrawImage(this._selectMetadata)}),this._zoomService.zoom$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.zoom=t),this._mouseCursorService.mouseCursor$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.mouseCursor=t)}ngOnChanges(t){var e,n,i;(null===(e=t._selectMetadata)||void 0===e?void 0:e.previousValue)&&(null===(n=t._selectMetadata)||void 0===n?void 0:n.currentValue)&&this.redrawImage(this._selectMetadata),(null===(i=t._imgSrc)||void 0===i?void 0:i.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this.loadImage(t._imgSrc.currentValue),this._boundingBoxCanvas.setCurrentSelectedbBox(-1))}initializeCanvas(){this.canvas.nativeElement.style.width="80%",this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}emitMetadata(){this._onChangeMetadata.emit(this._selectMetadata)}annotateSelectChange(t){this._annotateSelectState.setState(t)}resetZoom(){this._zoomService.resetZoomScale()}imgFitToCenter(){try{const t=this._boundingBoxCanvas.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._boundingBoxCanvas.scaleAllBoxes(t.factor,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._boundingBoxCanvas.setGlobalXY(t.newX,t.newY),this._boundingBoxCanvas.moveAllBbox(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(t){console.log(t)}}keyStrokeEvent({ctrlKey:t,shiftKey:e,key:n}){try{const{isActiveModal:i}=this.boundingBoxState;if(!this.mousedown&&!i&&!this.showDropdownLabelBox&&this._selectMetadata)if(!t||"c"!==n&&"C"!==n)if(!t||"v"!==n&&"V"!==n){if(t&&e&&("z"===n||"Z"===n)){if(this._undoRedoService.isAllowRedo()){const t=this._undoRedoService.redo();this._selectMetadata=Object(Yt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}else if(!t||"z"!==n&&"Z"!==n)if(!i&&this.annotateState.annotation>-1&&("Delete"===n||"Backspace"===n))this._boundingBoxCanvas.deleteSingleBox(this._selectMetadata.bnd_box,this.annotateState.annotation,t=>{t&&(this.annotateSelectChange({annotation:-1,isDlbClick:!1}),this.redrawImage(this._selectMetadata),this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())});else{const t="ArrowLeft"===n?"left":"ArrowRight"===n?"right":"ArrowUp"===n?"up":"ArrowDown"===n&&"down";t&&this.keyMoveBox(t)}else if(this._undoRedoService.isAllowUndo()){const t=this._undoRedoService.undo();this._selectMetadata=Object(Yt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}else{if(this._copyPasteService.isAvailable()){this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation]);const t=this._copyPasteService.paste();t&&this._selectMetadata.bnd_box.push(t),this.annotateSelectChange({annotation:this._selectMetadata.bnd_box.length-1,isDlbClick:!1}),this.getBBoxDistanceFromImage(),this.redrawImage(this._selectMetadata)}this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata()}else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation])}catch(i){console.log(i)}}toggleEvent(t){try{this.annotateState.annotation>-1&&(this._undoRedoService.clearRedundantStages(),this.annotateSelectChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){console.log(e)}}mouseScroll(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){const{scale:e,x:n,y:i}=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement);this.boundingBoxState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,e)&&(this.canvasContext.canvas.style.transformOrigin=`${t.offsetX}px ${t.offsetY}px`,this.canvasContext.canvas.style.transform=`scale(${e}, ${e})`,this._zoomService.setState({scale:e}))),this.canvasContext.canvas.scrollTop=i,this.canvasContext.canvas.scrollLeft=n,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(e){console.log(e)}}mouseDown(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.mousedown=!0,this.boundingBoxState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._boundingBoxCanvas.setPanXY(t.offsetX,t.offsetY)),this.boundingBoxState.draw){const e=this._boundingBoxCanvas.mouseDownDrawEnable(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.annotateSelectChange({annotation:e,isDlbClick:!1}),this.redrawImage(this._selectMetadata)}}else this.mousedown=!1}catch(e){console.log(e)}}mouseUp(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.boundingBoxState.drag&&this.mousedown&&this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.boundingBoxState.draw&&this.mousedown){this.getLabelList(),this.sortingLabelList(this.labelList,this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box?this._tabStatus[2].annotation[0].bnd_box:[]);const e=this._boundingBoxCanvas.mouseUpDrawEnable(this._selectMetadata,this.labelList,t=>{t&&(this._undoRedoService.isStateChange(this._selectMetadata.bnd_box)&&this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this.getBBoxDistanceFromImage(),this.emitMetadata())});if(e.isNew){let e=t.offsetY*(100/document.documentElement.clientHeight)+8.5,n=t.offsetX*(100/document.documentElement.clientWidth)+2.5;e<9&&(e=9),e>76&&(e=76),n<2.5&&(n=2.5),n>66&&(n=66),this.floatdiv.nativeElement.style.top=e.toString()+"vh",this.floatdiv.nativeElement.style.left=n.toString()+"vw",this.showDropdownLabelBox=!0,this.labelSearch="",this.invalidInput=!1,setTimeout(()=>{this.lbltypetxt.nativeElement.focus()},100)}else this.showDropdownLabelBox=!1;e.isNew&&this.annotateSelectChange({annotation:e.selBox,isDlbClick:!1})}this.mousedown=!1}}catch(e){console.log(e)}}mouseMove(t){try{if(this._selectMetadata)if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)&&!this.showDropdownLabelBox){if(this.boundingBoxState.drag&&this.mousedown){const e=this._boundingBoxCanvas.getDiffXY(t);this._selectMetadata.img_x=e.diffX,this._selectMetadata.img_y=e.diffY,this._boundingBoxCanvas.panRectangle(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,t=>{if(t){const t=Object(Yt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:t,method:"pan"}):this._undoRedoService.replaceStages({meta:t,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.boundingBoxState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.boundingBoxState.draw&&this.mousedown&&(this._boundingBoxCanvas.mouseMoveDrawEnable(t.offsetX,t.offsetY,this._selectMetadata),this.redrawImage(this._selectMetadata)),this.boundingBoxState.draw&&!this.mousedown){const{box:e}=this._boundingBoxCanvas.getCurrentClickBox(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.changeMouseCursorState(-1!==e?{move:!0}:{crosshair:!0})}}else this.changeMouseCursorState()}catch(e){console.log(e)}}changeMouseCursorState(t){this._mouseCursorService.setState(t)}checkCloseEnough(t,e){const n=Math.abs(t-e)<this.closeEnough;return console.log(n),n}mouseOut(t){var e,n;try{"canvasstyle"!==t.target.className&&!t.target.className.includes("unclosedOut")||(null===(e=t.relatedTarget)||void 0===e?void 0:e.className.includes("unclosedOut"))||(null===(n=t.relatedTarget)||void 0===n?void 0:n.className.includes("canvasstyle"))||(this.showDropdownLabelBox=!1,0!=this._selectMetadata.bnd_box.filter(t=>""==t.label).length&&(this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.filter(t=>""!=t.label),this._onChangeMetadata.emit(this._selectMetadata),this.redrawImage(this._selectMetadata),alert("Some bounding boxes will be deleted because they were not labelled."))),this.boundingBoxState.drag&&this.mousedown&&(this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata)),this.mousedown=!1}catch(i){console.log(i)}}loadImage(t){try{this.image.src=t,this.image.onload=()=>{this._selectMetadata.img_w=this._selectMetadata.img_w<1?this._selectMetadata.img_ori_w:this._selectMetadata.img_w,this._selectMetadata.img_h=this._selectMetadata.img_h<1?this._selectMetadata.img_ori_h:this._selectMetadata.img_h,this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.imgFitToCenter(),this.emitMetadata(),this.changeMouseCursorState(),this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"})}}catch(e){console.log(e)}}keyMoveBox(t){try{const e=this._selectMetadata.bnd_box[this.annotateState.annotation];e&&this._boundingBoxCanvas.keyboardMoveBox(t,e,this._selectMetadata,t=>{t&&(this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this.getBBoxDistanceFromImage(),this.redrawImage(this._selectMetadata),this.emitMetadata())})}catch(e){console.log(e)}}redrawImage({img_x:t,img_y:e,img_w:n,img_h:i}){var o;this.clearCanvas(),this.canvasContext.drawImage(this.image,t,e,n,i),0!=(null===(o=this._tabStatus[2].annotation)||void 0===o?void 0:o.length)&&(this.getLabelList(),this.sortingLabelList(this.labelList,this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box?this._tabStatus[2].annotation[0].bnd_box:[])),this._boundingBoxCanvas.drawAllBoxOn(this.labelList,this._selectMetadata.bnd_box,this.canvasContext)}clearCanvas(){this.canvasContext.clearRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height)}getBBoxDistanceFromImage(){this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y)}getLabelList(){this.labelList=[],this.allLabelList=[],(this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]).forEach(t=>{this.labelList.push({name:t,count:0}),this.allLabelList.push({name:t,count:0})})}labelTypeTextChange(t){this.labelList=this.allLabelList.filter(e=>e.name.includes(t))}labelNameClicked(t){this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:t,index:this.annotateState.annotation})}sortingLabelList(t,e){t.forEach((t,n)=>{this.labelList[n].count=e.filter(e=>e.label===t.name).length,this.allLabelList[n].count=e.filter(e=>e.label===t.name).length}),this.labelList.sort((t,e)=>t.count<e.count?1:e.count<t.count?-1:0),this.allLabelList.sort((t,e)=>t.count<e.count?1:e.count<t.count?-1:0)}currentCursor(){return this._mouseCursorService.changeCursor(this.mouseCursor)}ngOnDestroy(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(Vt),b.Hb(M),b.Hb(Nt),b.Hb(Wt),b.Hb(w),b.Hb(Kt),b.Hb(Ut))},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-object-detection"]],viewQuery:function(t,e){if(1&t&&(b.qc(Ht,!0),b.qc(Gt,!0),b.qc(Zt,!0),b.qc(qt,!0)),2&t){let t;b.dc(t=b.Ub())&&(e.canvas=t.first),b.dc(t=b.Ub())&&(e.floatdiv=t.first),b.dc(t=b.Ub())&&(e.lbltypetxt=t.first),b.dc(t=b.Ub())&&(e.availablelbl=t.first)}},hostBindings:function(t,e){1&t&&b.Tb("keydown",function(t){return e.keyStrokeEvent(t)},!1,b.fc)("dblclick",function(t){return e.toggleEvent(t)})("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc",_tabStatus:"_tabStatus"},outputs:{_onChangeMetadata:"_onChangeMetadata",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onEnterLabel:"_onEnterLabel"},features:[b.vb],decls:13,vars:10,consts:[[1,"floatdiv","unclosedOut",3,"hidden"],["floatdiv",""],["autocomplete","off","spellcheck","false",1,"unclosedOut"],["type","text",1,"lbltypetxt","unclosedOut",3,"ngClass","ngModel","ngModelOptions","ngModelChange","keydown.enter"],["lbltypetxt",""],[1,"availablelbl","unclosedOut"],["availablelbl",""],[1,"lblList","unclosedOut"],["class","lblElement unclosedOut",3,"click",4,"ngFor","ngForOf"],["class","unclosedOut notExist",4,"ngIf"],[1,"canvasstyle",3,"ngStyle"],["canvasdrawing",""],[1,"lblElement","unclosedOut",3,"click"],[1,"lblName","unclosedOut"],[1,"lblCount","unclosedOut"],[1,"unclosedOut","notExist"],[1,"unclosedOut"]],template:function(t,e){1&t&&(b.Mb(0,"div"),b.Mb(1,"div",0,1),b.Mb(3,"form",2),b.Mb(4,"input",3,4),b.Tb("ngModelChange",function(t){return e.labelSearch=t})("ngModelChange",function(t){return e.labelTypeTextChange(t)})("keydown.enter",function(t){return e.validateInputLabel(t)}),b.Lb(),b.Lb(),b.Mb(6,"div",5,6),b.Mb(8,"ul",7),b.kc(9,Qt,5,2,"li",8),b.kc(10,te,7,6,"li",9),b.Lb(),b.Lb(),b.Lb(),b.Ib(11,"canvas",10,11),b.Lb()),2&t&&(b.xb(1),b.ac("hidden",!e.showDropdownLabelBox),b.xb(3),b.ac("ngClass",e.invalidInput?"invalidInput":"validInput")("ngModel",e.labelSearch)("ngModelOptions",b.bc(7,ee)),b.xb(5),b.ac("ngForOf",e.labelList),b.xb(1),b.ac("ngIf",0===e.labelList.length),b.xb(1),b.ac("ngStyle",b.cc(8,ne,e.currentCursor())))},directives:[dt.n,dt.g,dt.h,dt.a,i.i,dt.f,dt.i,i.j,i.k,i.l],pipes:[I.c],styles:[".canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}.floatdiv[_ngcontent-%COMP%]{position:absolute;z-index:10000}.lbltypetxt[_ngcontent-%COMP%]{height:4vh;border-radius:.2vh;border:.2vw solid grey;border-bottom:none;padding:0;text-indent:.4vw}.availablelbl[_ngcontent-%COMP%], .lbltypetxt[_ngcontent-%COMP%]{width:11vw;color:snow;font-size:2vh;background-color:#000;outline:none}.availablelbl[_ngcontent-%COMP%]{height:15vh;font-weight:700;border-radius:.2vh;border:.2vw solid grey;border-top:.1vh dotted snow;overflow:auto;scrollbar-width:none}.lblList[_ngcontent-%COMP%]{padding:0 .2vw}.lblElement[_ngcontent-%COMP%]{list-style-type:none;margin:.3vh 0;padding:0;justify-content:space-between;display:flex}.lblElement[_ngcontent-%COMP%]:hover{background-color:#111}.lblName[_ngcontent-%COMP%]{margin-left:.2vw;overflow:hidden;text-overflow:ellipsis}.lblCount[_ngcontent-%COMP%]{background-color:#222;margin-right:.2vw;padding:.1vh .2vw;border-radius:.2vw}.availablelbl[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.notExist[_ngcontent-%COMP%]{color:#999;font-size:1.5vh}.invalidInput[_ngcontent-%COMP%]{border:.2vw solid red}.validInput[_ngcontent-%COMP%]{border:.2vw solid grey}"],changeDetection:0}),t})(),oe=(()=>{class t{constructor(){this.globalXY={x:-1,y:-1},this.panXY={x:0,y:0},this.clickPoint={polygonIndex:-1,pointIndex:-1},this.clipPath=null,this.radius=3.5,this.distanceOffset=8,this.polygonAreaIndex=-1,this.selectedPolygonIndex=-1,this.util=new Rt,this.isNewPoly=!1}mouseDownDraw(t,e,n,i,o,a,s){const{offsetX:l,offsetY:c}=t;this.polygonAreaIndex=this.findPolygonArea(t,e),this.clickPoint=this.findClickPoint(l,c,e);const r=this.isNewPolygon();return r&&a?this.setPanXY(t):!this.returnTempPoly()&&this.polygonAreaIndex<0&&this.clickPoint.pointIndex<0?(this.setPolygonLineWidth(e,-1),this.selectedPolygonIndex=-1,this.pushTempPoint(t,e),this.setNewPolygon(!0)):r?(this.pushTempPoint(t,e),this.drawNewPolygon(e,i,o,n,!1),this.drawfromPreviousPoint(t,o)):(this.selectedPolygonIndex=this.findPolygonArea(t,e)>-1?this.findPolygonArea(t,e):this.findClickPoint(l,c,e).polygonIndex,this.setPolygonLineWidth(e,this.selectedPolygonIndex),this.setNewPolygon(!1)),this.selectedPolygonIndex}mouseMoveDraw(t,e,n,i,o,a,s,l){const c=this.findPolygonArea(o,t),r=this.isNewPolygon(),{pointIndex:h,polygonIndex:b}=this.clickPoint;if(r&&s&&a){const{diffX:e,diffY:n}=this.getDiffXY(o);t.img_x=e,t.img_y=n,this.panPolygons(t,!0),l("pan")}else r?(this.drawNewPolygon(t,e,n,i,!1),this.drawfromPreviousPoint(o,n)):s&&-1===h&&this.selectedPolygonIndex>-1?(this.mouseMovePolygon(o,t,n,this.selectedPolygonIndex,e,i),this.resetClipPath(t),l("pan")):s&&h>-1&&b>-1&&(this.setPolygonCoordinate(o,t,this.clickPoint),l("draw"));return c>-1}setPanXY({offsetX:t,offsetY:e}){try{this.panXY={x:t,y:e}}catch(n){console.log("setPanXY",n)}}getPanXY(){return this.panXY}getDiffXY({offsetX:t,offsetY:e}){try{const n={diffX:0,diffY:0},{x:i,y:o}=this.getGlobalXY();return n.diffX=i+(t-this.panXY.x),n.diffY=o+(e-this.panXY.y),n}catch(n){return console.log(n),{diffX:-1,diffY:-1}}}setSelectedPolygon(t,e){this.selectedPolygonIndex=t,e&&this.setPolygonLineWidth(e,this.selectedPolygonIndex)}getSelectedPolygonIndex(){return this.selectedPolygonIndex}mouseClickWithinPointPath({img_x:t,img_y:e,img_w:n,img_h:i},{offsetX:o,offsetY:a}){return o>t&&o<t+n&&a>e&&a<e+i}calScaleToFitScreen({img_w:t,img_h:e},{offsetWidth:n,offsetHeight:i}){try{const o={factor:-1,newX:-1,newY:-1},a=Math.min(n/t,i/e);return o.factor=a-.05*a,o.newX=n/2-t/2*o.factor,o.newY=i/2-e/2*o.factor,o}catch(o){return console.log("calScaleToFitScreen",o),{factor:-1,newX:-1,newY:-1}}}pushTempPoint({offsetX:t,offsetY:e},{img_x:n,img_y:i,polygons:o}){try{const a=t-n,s=e-i,l=o.length;!this.tmpPolygon&&this.generateNewTempPolygon(l),this.tmpPolygon.coorPt.push({x:t,y:e,distancetoImg:{x:a,y:s}})}catch(a){console.log("pushTempPoint",a)}}removeLastPoint(t,e,n,i){var o;try{return(null===(o=this.tmpPolygon)||void 0===o?void 0:o.coorPt)&&this.tmpPolygon.coorPt.length>1?(this.tmpPolygon.coorPt.pop(),!1):(this.resetDrawing(t,n,e,i),!0)}catch(a){return console.log("removeLastPoint",a),!1}}calculatePointDistance(t,e,n,i){try{const o=t-n,a=e-i;return Math.sqrt(o*o+a*a)}catch(o){return void console.log("calculatePointDistance",o)}}generateNewTempPolygon(t){try{const e=this.util.generateUniquesID(),n=(t+1).toString();this.tmpPolygon={coorPt:[],label:"default",id:e,lineWidth:2,color:"#FFFAFA",region:n,subLabel:[]}}catch(e){console.log("generateNewTempPolygon",e)}}getClickPoint(){return this.clickPoint}resetClickPoint(){this.clickPoint={pointIndex:-1,polygonIndex:-1}}resetDrawing(t,e,n,i){try{this.tmpPolygon=null,this.setNewPolygon(!1),this.redraw(t,e,n,i,-1)}catch(o){console.log("resetDrawing",o)}}setNewPolygon(t){this.isNewPoly=t}redraw(t,e,n,{width:i,height:o},a){try{const{img_w:s,img_h:l,img_x:c,img_y:r}=t;n.restore(),n.clearRect(0,0,i,o),n.save(),n.beginPath(),n.rect(c,r,s,l),n.clip(),n.beginPath(),n.drawImage(e,c,r,s,l),this.drawAllPolygon(t,n,a)}catch(s){console.log("redraw",s)}}drawAllPolygon(t,e,n){try{this.validatePolygonMetadata(t.polygons)&&(this.drawAllPolygonLine(t,e),this.drawAllPolygonsDots(t,e,n,this.radius),this.plotAllFloatLabel(t,e))}catch(i){console.log("drawAllPolygon",i)}}validatePolygonMetadata(t){return t.length>0}drawAllPolygonLine({polygons:t},e){try{for(const[n,{lineWidth:i,color:o,coorPt:a}]of t.entries()){e.lineWidth=i,e.strokeStyle=o||"white",e.fillStyle=o||"white",e.beginPath(),e.moveTo(a[0].x,a[0].y);for(const[t]of a.entries())t+1<a.length&&e.lineTo(a[t+1].x,a[t+1].y);e.closePath(),e.stroke()}}catch(n){console.log("drawAllPolygonLine",n)}}drawAllPolygonsDots({polygons:t},e,n,i){try{for(const[o,{coorPt:a}]of t.entries())if(n===o){e.strokeStyle="green",e.fillStyle="green";for(const[t]of a.entries())e.beginPath(),e.arc(a[t].x,a[t].y,i,0,2*Math.PI),e.fill(),e.closePath(),e.stroke()}}catch(o){console.log("drawAllPolygonsDots",o)}}plotAllFloatLabel({polygons:t},e){try{t.forEach(({label:t,coorPt:n})=>{const{x:i,y:o}=n[0];e.strokeStyle="white",e.fillStyle="black",e.font="bold 12px Arial",e.strokeText(t,i+10,o+15),e.fillText(t,i+10,o+15)})}catch(n){console.log("plotAllFloatLabel",n)}}setGlobalXY({offsetX:t,offsetY:e}){try{this.globalXY={x:t,y:e}}catch(n){console.log("setGlobalXY",n)}}getGlobalXY(){return this.globalXY}mouseMovePolygon({offsetX:t,offsetY:e},n,i,o,a,s){try{const{x:l,y:c}=this.getGlobalXY(),r=t-l,h=e-c;if(this.withinPointPath(n,o,{offsetX:r,offsetY:h})){this.setGlobalXY({offsetX:t,offsetY:e});for(const[t]of n.polygons[o].coorPt.entries())n.polygons[o].coorPt[t].x+=r,n.polygons[o].coorPt[t].y+=h;this.redraw(n,a,i,s,o)}}catch(l){console.log("mouseMovePolygon",l)}}keyboardMovePolygon(t,e,n,i,o,a,s){try{if(n>-1){const l=-3;switch(e){case"up":if(this.withinPointPath(t,n,{offsetX:0,offsetY:l}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].y+=l;break;case"down":if(this.withinPointPath(t,n,{offsetX:0,offsetY:l}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].y-=l;break;case"left":if(this.withinPointPath(t,n,{offsetX:l,offsetY:0}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].x+=l;break;case"right":if(this.withinPointPath(t,n,{offsetX:l,offsetY:0}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].x-=l}this.redraw(t,i,o,a,n),s(!0)}return!0}catch(l){return console.log("keyboardMovePolygon",l),!0}}withinPointPath({polygons:t,img_x:e,img_y:n,img_w:i,img_h:o},a,{offsetX:s,offsetY:l}){try{for(const[c]of t[a].coorPt.entries())return!(t[a].coorPt[c].x+s<e||t[a].coorPt[c].x+s>e+i||t[a].coorPt[c].y+l<n||t[a].coorPt[c].y+l>n+o)}catch(c){return!1}}validateXYDistance(t){try{for(const[e]of t.polygons.entries())for(const[n]of t.polygons[e].coorPt.entries()){const i=t.polygons[e].coorPt[n].y-t.img_y;t.polygons[e].coorPt[n].distancetoImg.x=t.polygons[e].coorPt[n].x-t.img_x,t.polygons[e].coorPt[n].distancetoImg.y=i}}catch(e){console.log("validateXYDistance",e)}}setPolygonLineWidth(t,e){try{t.polygons=t.polygons.map((t,n)=>Object.assign(Object.assign({},t),{lineWidth:t.lineWidth=n===e?2:1}))}catch(n){console.log("setPolygonLineWidth",n)}}drawNewPolygon(t,e,n,i,o){var a;try{if(this.redraw(t,e,n,i,-1),null===(a=this.tmpPolygon)||void 0===a?void 0:a.coorPt){for(const[t,{x:e,y:i}]of this.tmpPolygon.coorPt.entries())n.strokeStyle="green",n.fillStyle="green",n.beginPath(),n.arc(e,i,this.radius,0,2*Math.PI),n.fill(),n.closePath(),n.stroke();n.beginPath(),n.lineWidth=this.tmpPolygon.lineWidth,n.strokeStyle=this.tmpPolygon.color,n.fillStyle=this.tmpPolygon.color,n.moveTo(this.tmpPolygon.coorPt[0].x,this.tmpPolygon.coorPt[0].y);for(const[t]of this.tmpPolygon.coorPt.entries())t+1<this.tmpPolygon.coorPt.length&&n.lineTo(this.tmpPolygon.coorPt[t+1].x,this.tmpPolygon.coorPt[t+1].y);if(o){n.closePath(),n.stroke();const{length:e}=t.polygons;this.tmpPolygon&&(t.polygons.push(Object(Yt.a)(this.tmpPolygon)),this.setPolygonLineWidth(t,e-1),this.tmpPolygon=null),this.setNewPolygon(!1)}else n.stroke()}}catch(s){console.log("drawNewPolygon",s)}}drawfromPreviousPoint({offsetX:t,offsetY:e},n){var i;try{if(null===(i=this.tmpPolygon)||void 0===i?void 0:i.coorPt){const{length:i}=this.tmpPolygon.coorPt,o=i-1;n.beginPath(),n.moveTo(this.tmpPolygon.coorPt[o].x,this.tmpPolygon.coorPt[o].y),n.lineTo(t,e),n.stroke()}}catch(o){console.log("drawfromPreviousPoint",o)}}returnTempPoly(){try{return this.tmpPolygon}catch(t){return console.log("returnTempPoly",t),null}}setPolygonCoordinate({offsetX:t,offsetY:e},n,{polygonIndex:i,pointIndex:o}){try{i>-1&&o>-1&&(n.polygons[i].coorPt[o].x=t,n.polygons[i].coorPt[o].y=e)}catch(a){console.log("setPolygonCoordinate",a)}}insidePolygonArea(t,{offsetX:e,offsetY:n}){try{let i=!1;for(let o=0,a=t.length-1;o<t.length;a=o++)t[o].y>n!=t[a].y>n&&e<(t[a].x-t[o].x)*(n-t[o].y)/(t[a].y-t[o].y)+t[o].x&&(i=!i);return i}catch(i){return console.log("insidePolygonArea",i),!1}}calPolygonArea({coorPt:t}){try{let e=0,n=t.length-1;for(let i=0;i<t.length;++i)e+=(t[n].x+t[i].x)*(t[n].y-t[i].y),n=i;return Math.abs(e/2)}catch(e){return console.log("calPolygonArea",e),-1}}findPolygonArea(t,{polygons:e}){try{let n=-1,i=1e7;for(const[o,a]of e.entries())if(this.insidePolygonArea(a.coorPt,t)){const t=this.calPolygonArea(a);t<i&&(n=o,i=t)}return n}catch(n){return console.log("findPolygonArea",n),-1}}findClickPoint(t,e,n){try{let i;const o={polygonIndex:-1,pointIndex:-1};for(let a=0;a<n.polygons.length;++a)for(let s=0;s<n.polygons[a].coorPt.length;++s)if(i=Math.sqrt(Math.pow(t-n.polygons[a].coorPt[s].x,2)+Math.pow(e-n.polygons[a].coorPt[s].y,2)),i<=this.radius){o.polygonIndex=a,o.pointIndex=s;break}return o}catch(i){return console.log("findClickPoint",i),{polygonIndex:-1,pointIndex:-1}}}isNewPolygon(){try{return this.isNewPoly}catch(t){return console.log("isNewPolygon",t),!1}}deleteSinglePolygon(t,e,n){try{t.polygons.splice(e,1),this.selectedPolygonIndex=-1,n(!0)}catch(i){console.log("deleteSinglePolygon",i)}}scalePolygons(t,{factor:e,newX:n,newY:i},o){try{for(const[o]of t.polygons.entries())for(const[a]of t.polygons[o].coorPt.entries())t.polygons[o].coorPt[a].x=t.polygons[o].coorPt[a].distancetoImg.x*e+n,t.polygons[o].coorPt[a].y=t.polygons[o].coorPt[a].distancetoImg.y*e+i,t.polygons[o].coorPt[a].distancetoImg.x=t.polygons[o].coorPt[a].x-n,t.polygons[o].coorPt[a].distancetoImg.y=t.polygons[o].coorPt[a].y-i;this.setPolygonLineWidth(t,-1),o&&o(!0)}catch(a){console.log("scalePolygons",a)}}panPolygons(t,e,n){var i;try{if(e&&(null===(i=this.tmpPolygon)||void 0===i?void 0:i.coorPt))for(const[e]of this.tmpPolygon.coorPt.entries())this.tmpPolygon.coorPt[e].x=t.img_x+this.tmpPolygon.coorPt[e].distancetoImg.x,this.tmpPolygon.coorPt[e].y=t.img_y+this.tmpPolygon.coorPt[e].distancetoImg.y;for(const[e]of t.polygons.entries())for(const[n]of t.polygons[e].coorPt.entries())t.polygons[e].coorPt[n].x=t.img_x+t.polygons[e].coorPt[n].distancetoImg.x,t.polygons[e].coorPt[n].y=t.img_y+t.polygons[e].coorPt[n].distancetoImg.y;n&&n(!0)}catch(o){console.log("panPolygons",o)}}resetClipPath({img_x:t,img_y:e,img_w:n,img_h:i}){try{this.clipPath=null,this.clipPath=new Path2D,this.clipPath.rect(t,e,n,i)}catch(o){console.log(o)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const ae=["canvasdrawing"],se=function(t){return{cursor:t}};let le=(()=>{class t{constructor(t,e,n,i,o,a,s){this._segCanvasService=t,this._imgLblStateService=e,this._undoRedoService=n,this._copyPasteService=i,this._annotateSelectState=o,this._zoomService=a,this._mouseCursorService=s,this.image=new Image,this.isMouseWithinPoint=!1,this.altKey=!1,this.ctrlKey=!1,this.unsubscribe$=new c.a,this.mousedown=!1,this._imgSrc="",this._onChangeMetadata=new b.n}ngOnInit(){this._imgLblStateService.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{var{clear:e,fitCenter:n}=t,i=o(t,["clear","fitCenter"]);this.segState=Object.assign(Object.assign({},i),{clear:e,fitCenter:n}),n&&this.imgFitToCenter(),e&&(this._selectMetadata.polygons=[],this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this.redrawImage(this._selectMetadata),this.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{this.annotateState=t,this._selectMetadata&&(this._segCanvasService.setSelectedPolygon(t.annotation,this._selectMetadata),this.redrawImage(this._selectMetadata))}),this._zoomService.zoom$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.zoom=t),this._mouseCursorService.mouseCursor$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.mouseCursor=t)}ngOnChanges(t){var e;(null===(e=t._imgSrc)||void 0===e?void 0:e.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this._segCanvasService.setSelectedPolygon(-1),this.loadImage(t._imgSrc.currentValue))}initializeCanvas(){this.canvas.nativeElement.style.width="80%",this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}loadImage(t){this.image.src=t,this.image.onload=()=>{const{img_x:t,img_y:e}=this._selectMetadata;this._selectMetadata.img_w=this._selectMetadata.img_w<1?this._selectMetadata.img_ori_w:this._selectMetadata.img_w,this._selectMetadata.img_h=this._selectMetadata.img_h<1?this._selectMetadata.img_ori_h:this._selectMetadata.img_h,this._segCanvasService.setGlobalXY({offsetX:t,offsetY:e}),this.imgFitToCenter(),this.emitMetadata(),this.changeMouseCursorState(),this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"})}}emitMetadata(){this._onChangeMetadata.emit(this._selectMetadata)}annotateStateChange(t){t&&this._annotateSelectState.setState(t)}resetZoom(){this._zoomService.resetZoomScale()}imgFitToCenter(){try{const t=this._segCanvasService.calScaleToFitScreen(this._selectMetadata,this.canvas.nativeElement);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._segCanvasService.scalePolygons(this._selectMetadata,t),this._segCanvasService.setGlobalXY({offsetX:t.newX,offsetY:t.newY}),this._segCanvasService.panPolygons(this._selectMetadata,!1,t=>{if(t){const t=Object(Yt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:t,method:"zoom"}):this._undoRedoService.replaceStages({meta:t,method:"zoom"})}}),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(t){console.log("imgFitToCenter",t)}}redrawImage({img_x:t,img_y:e,img_w:n,img_h:i}){this.clearcanvas(),this.canvasContext.drawImage(this.image,t,e,n,i),this._segCanvasService.drawAllPolygon(this._selectMetadata,this.canvasContext,this.annotateState.annotation)}clearcanvas(){const{width:t,height:e}=this.canvas.nativeElement;this.canvasContext.clearRect(0,0,t,e)}mouseScroll(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){const{scale:e,x:n,y:i}=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement);this.segState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,e)&&(this.canvasContext.canvas.style.transformOrigin=`${t.offsetX}px ${t.offsetY}px`,this.canvasContext.canvas.style.transform=`scale(${e}, ${e})`,this._zoomService.setState({scale:e}))),this.canvasContext.canvas.scrollTop=i,this.canvasContext.canvas.scrollLeft=n,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(e){console.log("mouseScroll",e)}}validateEndDrawPolygon({isActiveModal:t,draw:e},n,i){return!t&&e&&n&&"none"!==i.canvas.style.pointerEvents}canvasDblClickEvent(t){this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)&&(this._segCanvasService.isNewPolygon()&&(this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()),this.annotateState.annotation>-1&&this.annotateStateChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}canvasKeyDownEvent({ctrlKey:t,shiftKey:e,key:n}){try{if(this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)){if(this._segCanvasService.isNewPolygon())switch(n){case"Enter":this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata();break;case"Escape":this._segCanvasService.resetDrawing(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement)}else switch(n){case"Delete":case"Backspace":this._segCanvasService.deleteSinglePolygon(this._selectMetadata,this.annotateState.annotation,t=>{t&&(this.annotateStateChange(),this.redrawImage(this._selectMetadata),this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())})}const t="ArrowLeft"===n?"left":"ArrowRight"===n?"right":"ArrowUp"===n?"up":"ArrowDown"===n&&"down";t&&this.keyMoveBox(t)}if(!this.isMouseWithinPoint)if(!t||"c"!==n&&"C"!==n)if(!t||"v"!==n&&"V"!==n){if(t&&e&&("z"===n||"Z"===n)){if(this._undoRedoService.isAllowRedo()){const t=this._undoRedoService.redo();this._selectMetadata=Object(Yt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else if(t&&("z"===n||"Z"===n)&&this._undoRedoService.isAllowUndo()){const t=this._undoRedoService.undo();this._selectMetadata=Object(Yt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else this._copyPasteService.isAvailable()&&(this._selectMetadata.polygons.push(this._copyPasteService.paste()),this.annotateStateChange({annotation:this._selectMetadata.polygons.length-1}),this._segCanvasService.validateXYDistance(this._selectMetadata)),this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata();else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.polygons[this.annotateState.annotation])}catch(i){console.log("canvasKeyDownEvent",i)}}keyMoveBox(t){try{this._selectMetadata.polygons[this.annotateState.annotation]&&this._segCanvasService.keyboardMovePolygon(this._selectMetadata,t,this.annotateState.annotation,this.image,this.canvasContext,this.canvas.nativeElement,t=>{t&&(this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())})}catch(e){console.log("keyMoveBox",e)}}mouseDown(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint)if(this.mousedown=!0,this.segState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._segCanvasService.setPanXY(t),this.initializeCanvas(),this.redrawImage(this._selectMetadata)),this.segState.draw){const e=this._segCanvasService.mouseDownDraw(t,this._selectMetadata,this.canvas.nativeElement,this.image,this.canvasContext,this.ctrlKey,this.altKey);if(e>-1)this._segCanvasService.setGlobalXY(t);else{const{img_x:t,img_y:e}=this._selectMetadata;this._segCanvasService.setGlobalXY({offsetX:t,offsetY:e})}this.annotateStateChange({annotation:e}),this.redrawImage(this._selectMetadata),this.mouseMoveDrawCanvas(t)}else this.segState.draw&&!this.mousedown&&this.redrawImage(this._selectMetadata);else this.mousedown=!1}catch(e){console.log("mouseDown",e)}}mouseUp(t){try{this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t);const e=this._segCanvasService.isNewPolygon();if(this._selectMetadata&&this.isMouseWithinPoint)if(this.mousedown){const{img_x:t,img_y:n}=this._selectMetadata;this.segState.drag&&this._segCanvasService.setGlobalXY({offsetX:t,offsetY:n}),this.segState.draw&&!e&&this.annotateState.annotation>-1&&this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.setGlobalXY({offsetX:t,offsetY:n}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}else{const{pointIndex:t,polygonIndex:e}=this._segCanvasService.getClickPoint();this.segState.draw&&e>-1&&t>-1?this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(Yt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.resetClickPoint(),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()):this.segState.draw&&(this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}this.mousedown=!1}catch(e){console.log("mouseUp",e)}}mouseMove(t){try{if(this.isMouseWithinPoint=this._selectMetadata&&this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){if(this.segState.drag&&this.mousedown){const{diffX:e,diffY:n}=this._segCanvasService.getDiffXY(t);this._selectMetadata.img_x=e,this._selectMetadata.img_y=n,this._segCanvasService.panPolygons(this._selectMetadata,!1,t=>{if(t){const t=Object(Yt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:t,method:"pan"}):this._undoRedoService.replaceStages({meta:t,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.segState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.segState.draw){const e=this.mouseMoveDrawCanvas(t);this.changeMouseCursorState(e?{move:!0}:{crosshair:!0})}}else this.changeMouseCursorState(),this.mousedown=!1}catch(e){console.log("mouseMove",e)}}mouseMoveDrawCanvas(t){return this._segCanvasService.mouseMoveDraw(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,t,this.ctrlKey,this.mousedown,t=>{this.redrawImage(this._selectMetadata)})}changeMouseCursorState(t){this._mouseCursorService.setState(t)}mouseOut(t){try{this.segState.drag&&this.isMouseWithinPoint&&this.mousedown&&(this._segCanvasService.setGlobalXY(t),this.redrawImage(this._selectMetadata)),this.isMouseWithinPoint=!1}catch(e){console.log("mouseOut",e)}}currentCursor(){return this._mouseCursorService.changeCursor(this.mouseCursor)}ngOnDestroy(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(oe),b.Hb(M),b.Hb(Nt),b.Hb(Wt),b.Hb(w),b.Hb(Kt),b.Hb(Ut))},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-segmentation"]],viewQuery:function(t,e){if(1&t&&b.qc(ae,!0),2&t){let t;b.dc(t=b.Ub())&&(e.canvas=t.first)}},hostBindings:function(t,e){1&t&&b.Tb("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("dblclick",function(t){return e.canvasDblClickEvent(t)})("keydown",function(t){return e.canvasKeyDownEvent(t)},!1,b.fc)("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[b.vb],decls:3,vars:3,consts:[[1,"canvasstyle",3,"ngStyle"],["canvasdrawing",""]],template:function(t,e){1&t&&(b.Mb(0,"div"),b.Ib(1,"canvas",0,1),b.Lb()),2&t&&(b.xb(1),b.ac("ngStyle",b.cc(1,se,e.currentCursor())))},directives:[i.l],styles:[".canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}"],changeDetection:0}),t})();const ce=["subLabelSelect"];function re(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"image-labelling-object-detection",31),b.Tb("_onChangeMetadata",function(e){return b.gc(t),b.Vb().onChangeMetadata(e)})("_onChangeAnnotationLabel",function(e){return b.gc(t),b.Vb().onChangeAnnotationLabel(e)})("_onEnterLabel",function(e){return b.gc(t),b.Vb().onProcessLabel(e)}),b.Lb(),b.Jb()}if(2&t){const t=b.Vb();b.xb(1),b.ac("_selectMetadata",t.selectedMetaData)("_imgSrc",t.imgSrc)("_tabStatus",t.tabStatus)}}function he(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"image-labelling-segmentation",32),b.Tb("_onChangeMetadata",function(e){return b.gc(t),b.Vb().onChangeMetadata(e)}),b.Lb(),b.Jb()}if(2&t){const t=b.Vb();b.xb(1),b.ac("_selectMetadata",t.selectedMetaData)("_imgSrc",t.imgSrc)}}function be(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"option",33),b.mc(2),b.Lb(),b.Jb()),2&t){const t=e.$implicit,n=b.Vb(2);b.xb(1),b.ac("value",t)("selected",t===n.currentAnnotationLabel),b.xb(1),b.oc(" ",t," ")}}function ge(t,e){if(1&t&&(b.Kb(0),b.kc(1,be,3,3,"ng-container",15),b.Jb()),2&t){const t=e.$implicit;b.xb(1),b.ac("ngForOf",t.label_list)}}function de(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"option",33),b.mc(2),b.Lb(),b.Jb()),2&t){const t=e.$implicit,n=b.Vb().$implicit;b.xb(1),b.ac("value",t)("selected",n.label_list[0].label),b.xb(1),b.oc(" ",t," ")}}function ue(t,e){if(1&t&&(b.Kb(0),b.kc(1,de,3,3,"ng-container",15),b.Jb()),2&t){const t=e.$implicit;b.xb(1),b.ac("ngForOf",t.label_list)}}function me(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"div",34),b.mc(2),b.Lb(),b.Jb()),2&t){const t=b.Vb();b.xb(2),b.oc(" ",t.subLabelValidateMsg," ")}}function fe(t,e){if(1&t){const t=b.Nb();b.Kb(0),b.Mb(1,"div",35),b.Mb(2,"label",36),b.mc(3),b.Wb(4,"translate"),b.Lb(),b.Mb(5,"label",37),b.mc(6),b.Wb(7,"translate"),b.Lb(),b.Ib(8,"span",38),b.Mb(9,"button",39),b.Tb("click",function(){b.gc(t);const n=e.index,i=b.Vb(2).index;return b.Vb(3).onRemoveSubLabel(i,n)}),b.mc(10," X "),b.Lb(),b.Lb(),b.Jb()}if(2&t){const t=e.$implicit;b.xb(3),b.pc("",b.Xb(4,4,"labellingArea.label"),": ",t.label,""),b.xb(3),b.pc("",b.Xb(7,6,"labellingArea.regionInfo"),": ",t.region,"")}}function ve(t,e){if(1&t&&(b.Kb(0),b.Mb(1,"h2",11),b.mc(2),b.Wb(3,"translate"),b.Lb(),b.kc(4,fe,11,8,"ng-container",15),b.Jb()),2&t){const t=b.Vb().$implicit;b.xb(2),b.nc(b.Xb(3,2,"labellingArea.addedSubLabel")),b.xb(2),b.ac("ngForOf",t.subLabel)}}function pe(t,e){if(1&t&&(b.Kb(0),b.kc(1,ve,5,4,"ng-container",5),b.Jb()),2&t){const t=e.$implicit,n=e.index,i=b.Vb(3);b.xb(1),b.ac("ngIf",(null==t||null==t.subLabel?null:t.subLabel.length)>0&&n===i.currentAnnotationIndex)}}function _e(t,e){if(1&t&&(b.Kb(0),b.kc(1,pe,2,1,"ng-container",15),b.Jb()),2&t){const t=e.$implicit;b.xb(1),b.ac("ngForOf",null==t?null:t.bnd_box)}}function xe(t,e){if(1&t&&(b.Kb(0),b.kc(1,_e,2,1,"ng-container",15),b.Jb()),2&t){const t=e.$implicit;b.xb(1),b.ac("ngForOf",t.annotation)}}const ye=[{path:"",component:(()=>{class t{constructor(t,e,n,i,b,g,d,u,m,f){this._router=t,this._imgLblApiService=e,this._modalService=n,this._dataSetService=i,this._annotateService=b,this._imgLblActionService=g,this._imgLblLayoutService=d,this._imgLblModeService=u,this._languageService=m,this._spinnerService=f,this.currentUrl="",this.selectedProjectName="",this.imgSrc="",this.loading=!1,this.thumbnailList=[],this.unsubscribe$=new c.a,this.subject$=new c.a,this.tabStatus=[{name:"labellingProject.project",closed:!1},{name:"labellingProject.label",closed:!1,label_list:[]},{name:"labellingProject.annotation",closed:!1,annotation:[]}],this.mainLabelRegionVal="",this.subLabelRegionVal="",this.subLabelValidateMsg="",this.currentAnnotationLabel="",this.currentAnnotationIndex=-1,this.currentImageDisplayIndex=-1,this.isLoading=!1,this.showLoading=!1,this.displayExportModal=!1,this.updateProjectProgress=()=>{this._imgLblLayoutService.updateProjectProgress(this.tabStatus,this.selectedProjectName)},this.onChangeMetadata=t=>{this.tabStatus=this.tabStatus.map(e=>e.annotation?Object.assign(Object.assign({},e),{annotation:[t]}):e),this.thumbnailList=this.thumbnailList.map((e,n)=>this.currentImageDisplayIndex===n?t:e);const e=t.bnd_box?t.bnd_box.length>0:t.polygons.length>0;this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{hasAnnotation:e}),this.updateProjectProgress()},this.onToggleTab=({name:t,closed:e})=>{!this.tabStatus.some(n=>n.name.toLowerCase()===t.toLowerCase()&&n.closed===e)&&(this.tabStatus=this.tabStatus.map(n=>n.name.toLowerCase()===t.toLowerCase()?Object.assign(Object.assign({},n),{closed:e}):Object.assign({},n)))},this.onExport=()=>{this.displayExportModal=!0},this.exportProject=t=>{const e=this.selectedProjectName;this._imgLblApiService.exportProject(e,t).pipe(Object(a.a)()).subscribe(({message:t})=>{1===t?this._languageService._translate.get("exportSuccess").subscribe(t=>{alert(e+t)}):this._languageService._translate.get("exportFailed").subscribe(t=>{alert(t+e)})}),this.displayExportModal=!1},this.onReload=()=>{const t=this.selectedProjectName,e=this._imgLblApiService.reloadProject(t),n=this._imgLblApiService.reloadProjectStatus(t),i=this._dataSetService.getThumbnailList,o=[],l=({message:e})=>5!==e&&1===e?Object(r.a)(500).pipe(Object(s.a)(()=>n),Object(a.a)(({message:t})=>4===t||1===t),Object(s.a)(({uuid_add_list:e,uuid_delete_list:n,message:o})=>{this.isLoading=!0;let a=[];this.thumbnailList.forEach(t=>{a.push(t.uuid)}),e.forEach(t=>{a.push(t)}),n.forEach(t=>{a=a.filter(e=>e!==t)});const s=4===o&&a.length>0?a.map(e=>i(t,e)):[];return this.thumbnailList=[],s}),Object(s.a)(t=>t)):Object(h.a)(t=>(console.error(t),this.isLoading=!1,t));this.subjectSubscription=this.subject$.pipe(Object(a.a)(),Object(s.a)(()=>e),Object(s.a)(t=>l(t))).subscribe(t=>{this.isLoading=!0,o.push(t)},t=>{},()=>{this.thumbnailList=o,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:this.thumbnailList.length}),this.isLoading=!1}),this.subject$.next()},this.navigateByUrl=({url:t})=>{t?this._router.navigate([t]):console.error("No url received from child component")},this.keyDownEvent=({key:t})=>{this._imgLblActionService.action$.pipe(Object(a.a)()).subscribe(({draw:e})=>{if(!e)switch(t){case"ArrowLeft":this.navigateByAction({thumbnailAction:-1});break;case"ArrowRight":this.navigateByAction({thumbnailAction:1});break;case"Escape":this.onCloseModal()}})},this.navigateByAction=({thumbnailAction:t})=>{if(t){this.showLoading=!0;const e=this._imgLblLayoutService.calculateIndex(t,this.currentImageDisplayIndex,this.thumbnailList.length);if(e!==this.currentImageDisplayIndex){this.currentImageDisplayIndex=e;const t=this.thumbnailList.find((t,n)=>n===e),n=this.thumbnailList.findIndex((t,n)=>n===e);t&&-1!==n&&this.displayImage(Object.assign(Object.assign({},t),{thumbnailIndex:n}))}}},this.displayImage=(t,e=this.selectedProjectName)=>{var n,{thumbnailIndex:i}=t,s=o(t,["thumbnailIndex"]);(null===(n=this.selectedMetaData)||void 0===n?void 0:n.uuid)!==s.uuid&&this._imgLblApiService.getBase64Thumbnail(e,s.uuid).pipe(Object(a.a)()).subscribe(({message:t,img_src:e})=>{if(1===t){this.selectedMetaData=s,this.imgSrc=e,this.currentImageDisplayIndex=i;const t=s.bnd_box?s.bnd_box.length>0:s.polygons&&s.polygons.length>0||!1;this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{currentThumbnailIndex:i+1,thumbnailName:s.img_path,hasAnnotation:t})}},t=>console.error(t),()=>this.showLoading=!1)},this.onProcessLabel=({selectedLabel:t,label_list:e,action:n})=>{const i=t&&!n?e.filter(e=>e!==t):e;this._imgLblApiService.updateLabelList(this.selectedProjectName,i.length>0?i:[]).pipe(Object(a.a)()).subscribe(({message:t})=>{1===t?this.tabStatus=this._imgLblLayoutService.displayLabelList(this.tabStatus,i):console.error("Error while updating label")}),this.updateProjectProgress()},this.onChangeAnnotationLabel=t=>{this.tabStatus=this._imgLblLayoutService.changeAnnotationLabel(this.tabStatus,t),this.updateStateToRenderChild(),this.updateProjectProgress()},this.onDeleteAnnotation=t=>{this.tabStatus=this._imgLblLayoutService.deleteAnnotation(this.tabStatus,t),this.updateStateToRenderChild(),this.updateProjectProgress()},this.onDisplayModal=(t="modal-image-labelling")=>{this.subLabelRegionVal="",this.subLabelValidateMsg="",this._modalService.open(t)},this.onCloseModal=(t="modal-image-labelling")=>{this._imgLblActionService.setState({isActiveModal:!1,draw:!0,scroll:!0}),this._modalService.close(t)},this.onChangeInput=(t,e)=>{const{value:n}=t.target;"main"===e?this.mainLabelRegionVal=n:this.subLabelRegionVal=n},this.onSubmitLabel=()=>{const{value:t}=this._subLabelSelect.nativeElement;let e=!1,n=!1;this.tabStatus.forEach(({annotation:i})=>null==i?void 0:i.forEach(({bnd_box:i,polygons:o})=>{const a=null!=i?i:o;if(a){const{subLabel:i}=a[this.currentAnnotationIndex];e=!!(i&&(null==i?void 0:i.length)>0),e&&(null==i||i.some(({label:e})=>n=e===t))}else console.log("missing prop bnd_box OR polygons")})),n?this.subLabelValidateMsg="Invalid of duplicate label: "+t:(this.tabStatus=this._imgLblLayoutService.submitLabel(this.tabStatus,t,this.currentAnnotationIndex,{mainLabelRegion:this.mainLabelRegionVal,subLabelRegion:this.subLabelRegionVal}),this.subLabelValidateMsg="",this.updateStateToRenderChild(),this.updateProjectProgress()),this.subLabelRegionVal=""},this.onRemoveSubLabel=(t,e)=>{this.tabStatus=this._imgLblLayoutService.removeSubLabel(this.tabStatus,{selectedAnnoIndex:t,selectedSubLabelIndex:e}),this.updateStateToRenderChild(),this.updateProjectProgress()},this.updateStateToRenderChild=()=>{this.tabStatus.forEach(({annotation:t})=>{t&&(this.thumbnailList=this.thumbnailList.map(e=>{var n;return null!==(n=t.find(({uuid:t})=>e.uuid===t))&&void 0!==n?n:e}),this.selectedMetaData=t[0])})},this.resetProjectStatus=(t=this.selectedProjectName)=>{t.trim()&&this._dataSetService.manualCloseProject(t).pipe(Object(l.a)(this.unsubscribe$)).subscribe(({})=>{this._router.navigate(["/"])})},this._languageService.initializeLanguage("image-labelling",["image-labelling-en","image-labelling-cn","image-labelling-ms"])}ngOnInit(){this.currentUrl=this._router.url;const{thumbnailList:t,labelList:e,projectName:n}=this._imgLblLayoutService.getRouteState(history);this.thumbnailList=t,this.selectedProjectName=n,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:t.length}),this.navigateByAction({thumbnailAction:1});const i=this._imgLblLayoutService.displayLabelList(this.tabStatus,e);this.tabStatus=i,this._annotateService.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({annotation:t,isDlbClick:e})=>{e?(this.currentAnnotationIndex=t,this.tabStatus.forEach(({annotation:e})=>null==e?void 0:e.forEach(({bnd_box:e,polygons:n})=>{const i=null!=e?e:n;if(i){const{label:e,region:n}=i[t];this.currentAnnotationLabel=e,this.mainLabelRegionVal=n||""}else console.log("missing prop bnd_box OR polygons")})),this._imgLblActionService.setState({isActiveModal:!0,draw:!1,drag:!1,scroll:!1}),this.onDisplayModal()):(this.currentAnnotationLabel="",this.currentAnnotationIndex=t)}),this._imgLblActionService.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({clear:t})=>{t&&(this.thumbnailList[0].bnd_box&&(this.thumbnailList[this.currentImageDisplayIndex].bnd_box=[]),this.thumbnailList[0].polygons&&(this.thumbnailList[this.currentImageDisplayIndex].polygons=[]),this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{hasAnnotation:!1}))}),this._spinnerService.returnAsObservable().pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.isLoading=this.showLoading&&t)}cancelExportProject(){this.displayExportModal=!1}onWindowClose(t){this.resetProjectStatus(),t.preventDefault()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this._imgLblModeService.setState(null),this._imgLblActionService.setState(null),this.resetProjectStatus()}}return t.\u0275fac=function(e){return new(e||t)(b.Hb(g.a),b.Hb(v),b.Hb(p.a),b.Hb(_.a),b.Hb(w),b.Hb(M),b.Hb(C),b.Hb(f.a),b.Hb(P.a),b.Hb(L.a))},t.\u0275cmp=b.Bb({type:t,selectors:[["image-labelling-layout"]],viewQuery:function(t,e){if(1&t&&b.qc(ce,!0),2&t){let t;b.dc(t=b.Ub())&&(e._subLabelSelect=t.first)}},hostBindings:function(t,e){1&t&&b.Tb("keydown",function(t){return e.keyDownEvent(t)},!1,b.fc)("beforeunload",function(t){return e.onWindowClose(t)},!1,b.fc)},decls:70,vars:59,consts:[[1,"layout-container"],[3,"_onChange"],[3,"_onChange","_onClick"],[1,"content-container"],[3,"_onChange","_currentUrl","_tabStatus"],[4,"ngIf"],[3,"_thumbnailList","_tabStatus","_onClose","_onClickThumbnail","_onClickLabel","_onEnterLabel","_onChangeAnnotationLabel","_onDeleteAnnotation"],[3,"_onChange","_onClick","_onExport","_onReload"],[3,"_thumbnailInfo","_imgSrc"],["id","modal-image-labelling"],[1,"modal-button","float-right",3,"click"],[1,"font-title"],[1,"main-label-container"],[1,"font-label"],[1,"static-select"],[4,"ngFor","ngForOf"],["type","text",1,"static-input",3,"value","placeholder","change"],[1,"hr-line"],[1,"sub-label-container"],["subLabelSelect",""],[1,"modal-button",3,"click"],[3,"hidden"],[1,"modal"],[1,"modal-content"],[1,"modal-content-container"],[1,"modal-content-header"],[1,"modal-button-container"],[1,"button-style","cancel-btn",3,"click"],[1,"button-style","confgdata-btn",3,"click"],[1,"button-style","confg-btn",3,"click"],[3,"_loading"],[3,"_selectMetadata","_imgSrc","_tabStatus","_onChangeMetadata","_onChangeAnnotationLabel","_onEnterLabel"],[3,"_selectMetadata","_imgSrc","_onChangeMetadata"],[3,"value","selected"],[1,"validate-msg"],[1,"sub-label-flex-container","sub-label-padding"],[1,"font-label","flex-first"],[1,"font-label","flex-second"],[1,"flex-third"],[1,"modal-butto","flex-fourth",3,"click"]],template:function(t,e){1&t&&(b.Mb(0,"div",0),b.Mb(1,"div"),b.Ib(2,"page-header",1),b.Mb(3,"image-labelling-info",2),b.Tb("_onClick",function(t){return e.navigateByAction(t)}),b.Lb(),b.Lb(),b.Mb(4,"div",3),b.Ib(5,"image-labelling-left-sidebar",4),b.kc(6,re,2,3,"ng-container",5),b.kc(7,he,2,2,"ng-container",5),b.Mb(8,"image-labelling-project",6),b.Tb("_onClose",function(t){return e.onToggleTab(t)})("_onClickThumbnail",function(t){return e.displayImage(t)})("_onClickLabel",function(t){return e.onProcessLabel(t)})("_onEnterLabel",function(t){return e.onProcessLabel(t)})("_onChangeAnnotationLabel",function(t){return e.onChangeAnnotationLabel(t)})("_onDeleteAnnotation",function(t){return e.onDeleteAnnotation(t)}),b.Lb(),b.Mb(9,"image-labelling-right-sidebar",7),b.Tb("_onClick",function(t){return e.onToggleTab(t)})("_onExport",function(){return e.onExport()})("_onReload",function(){return e.onReload()}),b.Lb(),b.Lb(),b.Ib(10,"image-labelling-footer",8),b.Lb(),b.Mb(11,"modal",9),b.Mb(12,"button",10),b.Tb("click",function(){return e.onCloseModal()}),b.mc(13,"X"),b.Lb(),b.Mb(14,"div"),b.Mb(15,"h2",11),b.mc(16),b.Wb(17,"translate"),b.Lb(),b.Mb(18,"div",12),b.Mb(19,"label",13),b.mc(20),b.Wb(21,"translate"),b.Lb(),b.Mb(22,"select",14),b.kc(23,ge,2,1,"ng-container",15),b.Lb(),b.Mb(24,"label",13),b.mc(25),b.Wb(26,"translate"),b.Lb(),b.Mb(27,"input",16),b.Tb("change",function(t){return e.onChangeInput(t,"main")}),b.Wb(28,"translate"),b.Lb(),b.Lb(),b.Lb(),b.Ib(29,"hr",17),b.Mb(30,"div"),b.Mb(31,"h2",11),b.mc(32),b.Wb(33,"translate"),b.Lb(),b.Mb(34,"div",18),b.Mb(35,"label",13),b.mc(36),b.Wb(37,"translate"),b.Lb(),b.Mb(38,"select",14,19),b.kc(40,ue,2,1,"ng-container",15),b.Lb(),b.Mb(41,"label",13),b.mc(42),b.Wb(43,"translate"),b.Lb(),b.Mb(44,"input",16),b.Tb("change",function(t){return e.onChangeInput(t,"sub")}),b.Wb(45,"translate"),b.Lb(),b.Mb(46,"button",20),b.Tb("click",function(){return e.onSubmitLabel()}),b.mc(47),b.Wb(48,"translate"),b.Lb(),b.Lb(),b.kc(49,me,3,1,"ng-container",5),b.Lb(),b.Ib(50,"hr",17),b.kc(51,xe,2,1,"ng-container",15),b.Lb(),b.Mb(52,"div",21),b.Mb(53,"div",22),b.Mb(54,"div",23),b.Mb(55,"div",24),b.Mb(56,"h1",25),b.mc(57),b.Wb(58,"translate"),b.Lb(),b.Mb(59,"div",26),b.Mb(60,"button",27),b.Tb("click",function(){return e.cancelExportProject()}),b.mc(61),b.Wb(62,"translate"),b.Lb(),b.Mb(63,"button",28),b.Tb("click",function(){return e.exportProject("cfg")}),b.mc(64),b.Wb(65,"translate"),b.Lb(),b.Mb(66,"button",29),b.Tb("click",function(){return e.exportProject("cfgdata")}),b.mc(67),b.Wb(68,"translate"),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Ib(69,"spinner",30)),2&t&&(b.xb(2),b.ac("_onChange",e.onChangeSchema),b.xb(1),b.ac("_onChange",e.onChangeSchema),b.xb(2),b.ac("_onChange",e.onChangeSchema)("_currentUrl",e.currentUrl)("_tabStatus",e.tabStatus),b.xb(1),b.ac("ngIf",e._router.url.includes("imglabel/bndbox")),b.xb(1),b.ac("ngIf",e._router.url.includes("imglabel/seg")),b.xb(1),b.ac("_thumbnailList",e.thumbnailList)("_tabStatus",e.tabStatus),b.xb(1),b.ac("_onChange",e.onChangeSchema),b.xb(1),b.ac("_thumbnailInfo",e.selectedMetaData)("_imgSrc",e.imgSrc),b.xb(6),b.nc(b.Xb(17,33,"labellingArea.mainLabel")),b.xb(4),b.oc("",b.Xb(21,35,"labellingArea.label"),": "),b.xb(3),b.ac("ngForOf",e.tabStatus),b.xb(2),b.oc("",b.Xb(26,37,"labellingArea.regionInfo"),": "),b.xb(2),b.ac("value",e.mainLabelRegionVal)("placeholder",b.Xb(28,39,"labellingArea.mainRegionInfo")),b.xb(5),b.nc(b.Xb(33,41,"labellingArea.subLabel")),b.xb(4),b.oc("",b.Xb(37,43,"labellingArea.label"),": "),b.xb(4),b.ac("ngForOf",e.tabStatus),b.xb(2),b.oc("",b.Xb(43,45,"labellingArea.regionInfo"),": "),b.xb(2),b.ac("value",e.subLabelRegionVal)("placeholder",b.Xb(45,47,"labellingArea.subRegionInfo")),b.xb(3),b.nc(b.Xb(48,49,"labellingArea.add")),b.xb(2),b.ac("ngIf",e.subLabelValidateMsg),b.xb(2),b.ac("ngForOf",e.tabStatus),b.xb(1),b.ac("hidden",!e.displayExportModal),b.xb(5),b.nc(b.Xb(58,51,"exportModal.exportOptions")),b.xb(4),b.oc(" ",b.Xb(62,53,"exportModal.cancel")," "),b.xb(3),b.oc(" ",b.Xb(65,55,"exportModal.configFile")," "),b.xb(3),b.oc(" ",b.Xb(68,57,"exportModal.configFileWithData")," "),b.xb(2),b.ac("_loading",e.isLoading))},directives:[O.a,Y,bt,i.k,It,At,Xt,Et.a,i.j,Tt.a,ie,le,dt.j,dt.m],pipes:[I.c],styles:[".layout-container[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;min-width:97.8vw;max-width:97.8vw}.modal-button[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw}.float-right[_ngcontent-%COMP%]{float:right}.font-title[_ngcontent-%COMP%]{font-size:1.7vw}.font-label[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.main-label-container[_ngcontent-%COMP%]{min-width:35vw;max-width:35vw}.main-label-container[_ngcontent-%COMP%], .sub-label-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.sub-label-container[_ngcontent-%COMP%]{min-width:40vw;max-width:40vw}.sub-label-flex-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1 1 100%;min-width:0}.static-select[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:5vh;margin:0;-moz-text-align-last:center;text-align-last:center;background:#262a2e;color:#fff;box-shadow:inset -.5vw 6.25vw 1vw 0 rgba(0,0,0,.2),inset -.5vw -.5vw 1vw 0 hsla(0,0%,100%,.4)}.static-select[_ngcontent-%COMP%]:hover{box-shadow:inset -.375vw -.375vw .625vw 0 rgba(0,0,0,.2),inset .375vw .375vw .625vw 0 hsla(0,0%,100%,.5)}.static-select[_ngcontent-%COMP%]:active{box-shadow:inset .375vw .375vw .625vw 0 rgba(0,0,0,.2),inset -.375vw -.375vw .625vw 0 hsla(0,0%,100%,.5)}.static-input[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;border-radius:2vw;border:none;outline:none;background-color:#363636;color:#fff;padding:0 1vw}.hr-line[_ngcontent-%COMP%]{height:.5vh;color:#000;background:#8c8b8b;margin:5vh 0}.sub-label-padding[_ngcontent-%COMP%]{padding:0 0 2vh}.validate-msg[_ngcontent-%COMP%]{color:red;padding:5vh 0 0;font-size:1vw}.flex-first[_ngcontent-%COMP%]{flex:1 1 35%}.flex-second[_ngcontent-%COMP%]{flex:1 1 55%}.flex-third[_ngcontent-%COMP%]{flex:0 0 5%}.flex-fourth[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;flex:0 0 5%}.modal[_ngcontent-%COMP%]{z-index:1000;padding-top:10vh;top:0;width:100%;height:100%;overflow:auto;background-color:transparent;scrollbar-width:none;position:fixed;background:rgba(0,0,0,.8)}.modal-content[_ngcontent-%COMP%]{background-color:#525353;padding:1vw;max-width:30vw;min-width:30vw;border-radius:1vw;margin:15vh auto auto}.model-content-container[_ngcontent-%COMP%]{margin-left:1.3vw}.modal-content-header[_ngcontent-%COMP%]{text-align:center;color:#fff;font-size:3vh}.modal-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:1vw}.button-style[_ngcontent-%COMP%]{padding:1vh 1.5vw;border-radius:1vh;border:none;outline:none;color:#fff;cursor:pointer;font-size:2vh}.confg-btn[_ngcontent-%COMP%], .confgdata-btn[_ngcontent-%COMP%]{background-color:#169887}.cancel-btn[_ngcontent-%COMP%], .confgdata-btn[_ngcontent-%COMP%]{margin-right:.7vw}.cancel-btn[_ngcontent-%COMP%]{background-color:#444}"]}),t})()}];let we=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)},imports:[[g.d.forChild(ye)]]}),t})();var Se=n("KZX/");let Me=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)},imports:[[i.b,Se.a,I.b]]}),t})();var Ce=n("RKnZ"),Pe=n("O+1G");let Le=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(e){return new(e||t)},imports:[[i.b,Se.a,I.b,we,Ce.a,g.d,Pe.a,Me]]}),t})()}}]);