(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{Iab2:function(t,e,n){var i,o;void 0===(o="function"==typeof(i=function(){"use strict";function e(t,e,n){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){s(i.response,e,n)},i.onerror=function(){console.error("could not download file")},i.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(t,a,s){var r=o.URL||o.webkitURL,l=document.createElement("a");l.download=a=a||t.name||"download",l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?i(l):n(l.href)?e(t,a,s):i(l,l.target="_blank")):(l.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(l.href)},4e4),setTimeout(function(){i(l)},0))}:"msSaveOrOpenBlob"in navigator?function(t,o,a){if(o=o||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,a),o);else if(n(t))e(t,o,a);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){i(s)})}}:function(t,n,i,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,i);var r="application/octet-stream"===t.type,l=/constructor/i.test(o.HTMLElement)||o.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||r&&l||a)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var t=h.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},h.readAsDataURL(t)}else{var d=o.URL||o.webkitURL,u=d.createObjectURL(t);s?s.location=u:location.href=u,s=null,setTimeout(function(){d.revokeObjectURL(u)},4e4)}});o.saveAs=s.saveAs=s,t.exports=s})?i.apply(e,[]):i)||(t.exports=o)},i5u5:function(t,e,n){"use strict";n.r(e),n.d(e,"ImageLabellingLayoutModule",function(){return Ve});var i=n("ofXK");function o(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}function a(t,e,n,i){return new(n||(n=Promise))(function(o,a){function s(t){try{l(i.next(t))}catch(e){a(e)}}function r(t){try{l(i.throw(t))}catch(e){a(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,r)}l((i=i.apply(t,e||[])).next())})}var s=n("5+tZ"),r=n("SxV6"),l=n("1G5W"),c=n("XNiG"),h=n("cp0P"),d=n("l5mm"),u=n("z6cu"),b=n("fXoL"),g=n("tyNb"),f=n("/uUt"),m=n("cxbk"),p=n("tk/3"),_=n("14na");let v=(()=>{class t{constructor(t,e,n){this.http=t,this.mode=e,this.router=n,this.hostPort=m.a.baseURL,this.imageLabellingMode=null,this.getBase64Thumbnail=(t,e)=>this.http.get(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/uuid/${e}/imgsrc`),this.updateLabelList=(t,e)=>this.http.put(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/newlabels`,{label_list:e}),this.updateProjectProgress=(t,e,n)=>this.http.put(`${this.hostPort}${this.imageLabellingMode}/projects/${t}/uuid/${e}/update`,Object.assign({},n)),this.exportProject=(t,e)=>this.http.put(`${this.hostPort}v2/${this.imageLabellingMode}/projects/${t}/export/${e}`,{newprojectid:t}),this.reloadProject=t=>this.http.put(`${this.hostPort}v2/${this.imageLabellingMode}/projects/${t}/reload`,{newprojectid:t}),this.reloadProjectStatus=t=>this.http.get(`${this.hostPort}v2/${this.imageLabellingMode}/projects/${t}/reloadstatus`),this.mode.imgLabelMode$.pipe(Object(f.a)()).subscribe(t=>t?this.imageLabellingMode=t:this.router.navigate(["/"]))}checkIfBboxMetaType(t){return Array.isArray(t)?void 0!==t[0].bnd_box:void 0!==t.bnd_box}}return t.\u0275fac=function(e){return new(e||t)(b.Pb(p.b),b.Pb(_.a),b.Pb(g.a))},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var w=n("1F7/"),y=n("LY9J"),x=n("2Vo4");const S={annotation:-1,isDlbClick:!1};let C=(()=>{class t{constructor(){this.labelStateSubject=new x.a(S),this.labelStaging$=this.labelStateSubject.asObservable(),this.setState=t=>{this.labelStateSubject.next(t?Object.assign(Object.assign({},S),t):S)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const k={scroll:!1,drag:!1,draw:!1,fitCenter:!1,clear:!1,isActiveModal:!1,save:!1};let P=(()=>{class t{constructor(){this.actionSubject=new x.a(k),this.action$=this.actionSubject.asObservable(),this.setState=t=>{this.actionSubject.next(t?Object.assign(Object.assign({},k),t):k)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),O=(()=>{class t{constructor(t){this._imgLblApiService=t,this.getRouteState=t=>{const{state:e}=t;return Object.assign({},e)},this.displayLabelList=(t,e)=>t.map(t=>t.label_list?Object.assign(Object.assign({},t),{label_list:e}):t),this.calculateIndex=(t,e,n)=>{let i=e;return 1===t?i>=n-1?n-1:i+=1:i<=0?0:e-=1},this.checkAnnotationMetadataProp=({bnd_box:t,polygons:e})=>null!=t?t:e,this.changeAnnotationLabel=(t,{label:e,index:n})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:i,polygons:a}=t,s=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},s),{bnd_box:null==i?void 0:i.map((t,i)=>i===n?Object.assign(Object.assign({},t),{label:e}):t),polygons:null==a?void 0:a.map((t,i)=>i===n?Object.assign(Object.assign({},t),{label:e}):t)})})}):t),this.deleteAnnotation=(t,e)=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:n,polygons:i}=t,a=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},a),{bnd_box:null==n?void 0:n.filter((t,n)=>n!==e),polygons:null==i?void 0:i.filter((t,n)=>n!==e)})})}):t),this.submitLabel=(t,e,n,{mainLabelRegion:i,subLabelRegion:a})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:s,polygons:r}=t,l=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},l),{bnd_box:null==s?void 0:s.map((t,o)=>o===n?Object.assign(Object.assign({},t),{region:i,subLabel:t.subLabel&&t.subLabel.length>0?[...t.subLabel,{label:e,region:a}]:[{label:e,region:a}]}):t),polygons:null==r?void 0:r.map((t,o)=>o===n?Object.assign(Object.assign({},t),{region:i,subLabel:t.subLabel&&t.subLabel.length>0?[...t.subLabel,{label:e,region:a}]:[{label:e,region:a}]}):t)})})}):t),this.removeSubLabel=(t,{selectedAnnoIndex:e,selectedSubLabelIndex:n})=>t.map(t=>t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(t=>{var{bnd_box:i,polygons:a}=t,s=o(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},s),{bnd_box:null==i?void 0:i.map((t,i)=>{var o;return i===e?Object.assign(Object.assign({},t),{subLabel:null===(o=t.subLabel)||void 0===o?void 0:o.filter((t,e)=>e!==n)}):t}),polygons:null==a?void 0:a.map((t,i)=>{var o;return i===e?Object.assign(Object.assign({},t),{subLabel:null===(o=t.subLabel)||void 0===o?void 0:o.filter((t,e)=>e!==n)}):t})})})}):t),this.setLocalStorageProjectProgress=(t,e)=>{localStorage.setItem(`${t}_${this._imgLblApiService.imageLabellingMode}`,JSON.stringify({cache:e}))},this.getLocalStorageProjectProgress=t=>{const e=localStorage.getItem(`${t}_${this._imgLblApiService.imageLabellingMode}`);return e?JSON.parse(e):null},this.updateProjectProgress=(t,e)=>{t.forEach(({annotation:t})=>{t&&(this.setLocalStorageProjectProgress(e,t),null==t||t.forEach(t=>{this._imgLblApiService.updateProjectProgress(e,t.uuid,t).pipe(Object(r.a)()).subscribe(({})=>{})}))})}}}return t.\u0275fac=function(e){return new(e||t)(b.Pb(v))},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var M=n("I7yr"),L=n("F7l1"),I=n("Iab2"),A=n("xOOu");let j=(()=>{class t{exportSaveFormat({saveCurrentImage:t,saveFormat:e,metadata:n,projectName:i,labelList:o,projectFullMetadata:s}){return a(this,void 0,void 0,function*(){switch(e){case"pascalVoc":if(!n)return alert("There are no metadata.");if(!(null==n?void 0:n.bnd_box))return alert("There are no bounding box.");if(!o)return alert("There are no label list.");if(t){const t=this.calBoxCoorOriginalImages(n),e=this.getFileName(n.img_path),{img_path:i,img_depth:a,img_ori_w:s,img_ori_h:r}=n,l=this.generatePascalVocFormat({img_path:i,img_depth:a,img_ori_w:s,img_ori_h:r,bnd_box:t},o),c=e.split(".");this.saveFile({content:l,filename:c[0]+".xml",type:"text/xml;charset=utf-8"})}else{if(!s)return alert("There are no image list.");const t=[];if(s.forEach(e=>{const n=(e.bnd_box?e.bnd_box.map(t=>t.label):[]).some(t=>o.indexOf(t)>=0);if(e.bnd_box&&e.bnd_box.length>0&&n){const n=this.calBoxCoorOriginalImages(e),i=this.getFileName(e.img_path),{img_path:a,img_depth:s,img_ori_w:r,img_ori_h:l}=e,c=this.generatePascalVocFormat({img_path:a,img_depth:s,img_ori_w:r,img_ori_h:l,bnd_box:n},o),h=i.split(".");t.push({filename:h[0]+".xml",content:c})}}),!t)return alert("There are no labelling progress.");yield this.saveAsZip(t,"pascal_voc",i)}break;case"yolo":if(!n)return alert("There are no metadata.");if(!(null==n?void 0:n.bnd_box))return alert("There are no bounding box.");if(!o)return alert("There are no label list.");if(t){const t=this.calBoxCoorOriginalImages(n),e=this.getFileName(n.img_path),{img_ori_w:i,img_ori_h:a}=n,s=this.generateYoloFormat(Object.assign({},{img_ori_w:i,img_ori_h:a,bnd_box:t}),o),r=e.split(".");this.saveFile({content:s,filename:r[0]+".txt",type:"text/plain;charset=utf-8"})}else{if(!s)return alert("There are no image list.");const t=[];if(s.forEach(e=>{const n=(e.bnd_box?e.bnd_box.map(t=>t.label):[]).some(t=>o.indexOf(t)>=0);if(e.bnd_box&&e.bnd_box.length>0&&n){const n=this.calBoxCoorOriginalImages(e),i=this.getFileName(e.img_path),{img_ori_w:a,img_ori_h:s}=e,r=this.generateYoloFormat(Object.assign({},{img_ori_w:a,img_ori_h:s,bnd_box:n}),o),l=i.split(".");t.push({filename:l[0]+".txt",content:r})}}),!t)return alert("There are no labelling progress.");yield this.saveAsZip(t,e,i)}break;case"ocr":if(!n)return alert("There are no metadata.");if(!(null==n?void 0:n.bnd_box))return alert("There are no bounding box.");if(!s)return alert("There are no image list.");if(!o)return alert("There are no image list.");let a="";if(s.forEach((t,e)=>{0===e&&(a+="filename,x1,y1,x2,y2,label\n");const n=this.calBoxCoorOriginalImages(t),i=this.getFileName(t.img_path),s=this.generateOCRFormat({bnd_box:n},i,o);a+=""+s}),!a)return alert("There are no labelling progress.");this.saveFile({content:a,filename:i+"_text_ocr_labels.csv",type:"text/csv;charset=utf-8"});break;case"label":if(!o)return alert("There are no label list.");const r=i+"_label.txt",l=this.generateLabelFormat(o);this.saveFile({content:l,filename:r,type:"text/plain;charset=utf-8"});break;case"coco":if(!s)return alert("There are no image list.");const c=this.calPolyCoorOriginalImages(s),h=this.getCocoContent(c,o),d=this.getCocoFileName(i);this.saveFile({content:h,filename:d,type:"text/json;charset=utf-8"});break;case"json":if(!n)return alert("There are no metadata.");if(!(null==n?void 0:n.polygons))return alert("There are no polygon.");if(!s)return alert("There are no image list.");const u=this.calPolyCoorOriginalImages(s),b=this.getJsonContent(u),g=this.getJsonFileName(i);this.saveFile({content:b,filename:g,type:"text/json;charset=utf-8"})}})}calBoxCoorOriginalImages({bnd_box:t,img_w:e,img_h:n,img_ori_w:i,img_ori_h:a}){const s=i/e,r=a/n;return t.map(t=>{const e=o(t,["subLabel","region"]),n=t.distancetoImg.x*s,i=n+(t.x2-t.x1)*s,a=t.distancetoImg.y*r,l=a+(t.y2-t.y1)*r;return Object.assign(Object.assign({},e),{x1:n,x2:i,y1:a,y2:l})})}calPolyCoorOriginalImages(t){return t.map(t=>{var{img_ori_w:e,img_ori_h:n,img_w:i,img_h:a,polygons:s}=t,r=o(t,["img_ori_w","img_ori_h","img_w","img_h","polygons"]);const l=e/i,c=n/a,h=s.filter(({coorPt:t})=>t.map(({distancetoImg:t})=>({distancetoImg:t,x:t.x*l,y:t.y*c})));return Object.assign(Object.assign({},r),{img_ori_w:e,img_ori_h:n,img_w:i,img_h:a,polygons:h})})}generatePascalVocFormat({bnd_box:t,img_path:e,img_depth:n,img_ori_w:i,img_ori_h:o},a){let s="<annotation>\n";const r=this.getItemName("file",e),l=this.getItemName("folder",e),c=this.createNode("folder");s+="\t"+c[0]+l+c[1];const h=this.createNode("filename");s+="\t"+h[0]+r+h[1];const d=this.createNode("path");s+="\t"+d[0]+e.split("\\").join("/")+d[1];const u=this.createNode("source"),b=this.createNode("database");s+="\t"+u[0]+"\n",s+="\t\t"+b[0]+"unknown"+b[1],s+="\t"+u[1];const g=this.createNode("size");s+="\t"+g[0]+"\n";const f=this.createNode("width"),m=this.createNode("height"),p=this.createNode("depth");s+="\t\t"+f[0]+i.toString()+f[1],s+="\t\t"+m[0]+o.toString()+m[1],s+="\t\t"+p[0]+(null==n?void 0:n.toString())+p[1],s+="\t"+g[1];const _=this.createNode("segmented");s+="\t"+_[0]+"0"+_[1];const v=this.createNode("object");for(const[w,{label:y,x1:x,x2:S,y1:C,y2:k}]of t.entries())if(-1!==a.indexOf(y)){s+="\t"+v[0]+"\n";const t=this.createNode("name"),e=this.createNode("pose"),n=this.createNode("truncated"),i=this.createNode("difficult"),o=this.createNode("bndbox"),a=this.createNode("xmin"),r=this.createNode("ymin"),l=this.createNode("xmax"),c=this.createNode("ymax");s+="\t\t"+t[0]+y+t[1],s+="\t\t"+e[0]+"Unspecified"+e[1],s+="\t\t"+n[0]+"0"+n[1],s+="\t\t"+i[0]+"0"+i[1],s+="\t\t"+o[0]+"\n",s+="\t\t\t"+a[0]+Math.floor(x).toString()+a[1],s+="\t\t\t"+r[0]+Math.floor(C).toString()+r[1],s+="\t\t\t"+l[0]+Math.floor(S).toString()+l[1],s+="\t\t\t"+c[0]+Math.floor(k).toString()+c[1],s+="\t\t"+o[1],s+="\t"+v[1]}return s+="</annotation>",s}generateYoloFormat({bnd_box:t,img_ori_w:e,img_ori_h:n},i){return t.reduce((o,{x1:a,x2:s,y1:r,y2:l,label:c},h)=>{if(-1===i.indexOf(c))return o;const d=(a+s)/2,u=(r+l)/2,b=s-a,g=l-r;return o+=i.indexOf(c).toString()+" ",o+=`${(d/e).toString()} ${(u/n).toString()} `,o+=`${(b/e).toString()} ${(g/n).toString()} `,h!==t.length&&(o+="\n"),o},"")}generateOCRFormat({bnd_box:t},e,n){return t.reduce((t,{x1:i,x2:o,y1:a,y2:s,label:r})=>-1===n.indexOf(r)?(t+=`${e},${i.toString()},${a.toString()}`,t+=`,${o.toString()},${s.toString()},${r.toString()}\n`):t,"")}getItemName(t,e){const n=e.split("\\").join("/").split("/");return"folder"===t?(n.pop(),n.join("/")):n[n.length-1]}createNode(t){return["<"+t+">","</"+t+">\n"]}generateLabelFormat(t){return t.reduce((t,e,n)=>n!==(t+=e).length?t+"\n":t,"")}saveFile({content:t,filename:e,type:n}){const i=new Blob([t],{type:n});I.saveAs(i,e)}saveAsZip(t,e,n){return a(this,void 0,void 0,function*(){const i=new A;for(const[e,{content:n,filename:a}]of t.entries())i.file(a,n);const o=yield i.generateAsync({type:"blob"});I.saveAs(o,`${n}_${e}_labels.zip`)})}getFileName(t){const e=t.split("\\").join("/").split("/");return e[e.length-1]}getCocoFileName(t){return t+"_segmentation_coco.json"}getJsonFileName(t){return t+"_segmentation_JSON.json"}getCocoContent(t,e){let n="{";return n+=this.generateCocoInfo(),n+=this.generateCocoImage(t),n+=this.generateCocoAnnotation(t,e),n+=this.generateCocoLicense(),n+=this.generateCocoCategory(e),n+="}",n=n.replace(/(}{)/gi,"},{"),n}generateCocoInfo(){const t=new Date;let e='"info":{';return e+=`year:"${t.getFullYear().toString()}",`,e+='version:"1.0",',e+='description:"VIA project exported to COCO format using classifai(https://classifai.ai/)",',e+='contributor:"",',e+='url:"https://classifai.ai/",',e+=`date_created:"${t.toUTCString()}"`,e+="},",e}generateCocoImage(t){let e="images:[";return e+=t.reduce((e,{img_ori_w:n,img_ori_h:i,img_path:o},a)=>(e+=`{id:${(a+1).toString()},`,e+=`width:${n.toString()},`,e+=`height:${i.toString()},`,e+=`file_name:"${this.getFileName(o)}",`,e+="license:0,",e+='date_captured:""}',a!==t.length&&(e+=","),e),""),e+="],",e}generateCocoAnnotation(t,e){let n="annotations:[",i=0;return n+=t.reduce((n,{polygons:a},s)=>(a.length>0&&(i+=1,n+=this.calPolyCoorOriginalImages(t).map(({polygons:t})=>t)[0].reduce((t,n,a)=>{var{coorPt:r,label:l}=n,c=o(n,["coorPt","label"]);t+="{segmentation:[",r.length>0&&(t+="[",t+=r.reduce((t,{x:e,y:n},i)=>(t+=e.toString()+",",t+=""+n.toString(),i!==r.length-1&&(t+=","),t),""),t+="]");const h=this.getPolyBBox(Object.assign({coorPt:r,label:l},c));return h&&(t+="],",t+=`area:${((h.x2-h.x1)*(h.y2-h.y1)).toString()},`,t+=`bbox:[${h.x1.toString()},${h.y1.toString()},${(h.x2-h.x1).toString()},${(h.y2-h.y1).toString()}],`,t+="iscrowd:0,",t+=`id:${i.toString()},`,t+=`image_id:${(s+1).toString()},`,t+=`category_id:${null==e?void 0:e.indexOf(l)}}`),t},"")),n),""),n+="]",n+=",",n}getPolyBBox({coorPt:t}){if(t.length>0){const e={x1:1e7,x2:-1e8,y1:1e7,y2:-1e8};for(const[n,{x:i,y:o}]of t.entries())i<e.x1&&(e.x1=i),i<e.x2&&(e.x2=i),o<e.y1&&(e.y1=o),o<e.y2&&(e.y2=o);return e}return null}generateCocoLicense(){let t="licenses:[{";return t+="id:1,",t+='name:"APACHE LICENSE, VERSION 2.0",',t+='url:"https://www.apache.org/licenses/LICENSE-2.0",',t+="}],",'licenses:[{id:1,name:"APACHE LICENSE, VERSION 2.0",url:"https://www.apache.org/licenses/LICENSE-2.0",}],'}generateCocoCategory(t){let e="categories:[";return t&&(e+=t.reduce((t,e,n)=>(t+='{supercategory:"type",',t+=`id:${n.toString()},`,(t+=`name:"${e}"`)+"},"),"")),e+="]",e}getJsonContent(t){let e="{";return e+=t.reduce((t,{polygons:e,file_size:n,img_path:i},o)=>{const a=this.getFileName(i),s=n>0?n.toString():"";return(t+=this.generateImageString(e,a,s))+"},"},""),e+="}",e}generateImageString(t,e,n){let i=`'${e}':{`;return i+='fileref:"",',i+=`size:"${n}",`,i+=`filename:"${e}",`,i+='base64_img_data:"",',i+="file_attributes:{},",i+=`regions:{${this.generateRegion(t)}}`,i}generateRegion(t){if(t.length>0)return t.reduce((e,{coorPt:n,label:i,region:o,subLabel:a},s)=>{let r="[",l="[";if(n.forEach(({x:t,y:e},i)=>{r+=t.toString(),l+=e.toString(),i===n.length-1?(r+="]",l+="]"):(r+=",",l+=",")},""),e+=s.toString()+":{",e+="shape_attributes:{name:polygon,",e+=`all_points_x:${r},`,e+=`all_points_y:${l}},`,e+=`region_attributes:{${i.trim()}:"${o.trim()}"}`,e+="}",0===a.length);else{e+=",";for(const[t,{label:n,region:i}]of a.entries())e+=`"${n.trim()}":"${i.trim()}"`,e+="},"}return s!==t.length-1&&(e+=","),e},"")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();var B=n("x2Se");let E=(()=>{class t{transform(t){return t?window.navigator.platform.startsWith("Mac")?t.split("/").slice(-1)[0]:t.split("\\").slice(-1)[0]:""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=b.Fb({name:"fileNameSlice",type:t,pure:!0}),t})();var z=n("sYmb");function T(t,e){if(1&t&&(b.Jb(0),b.Hb(1,"div",4),b.Lb(2,"label",6),b.nc(3),b.Vb(4,"fileNameSlice"),b.Kb(),b.Ib()),2&t){const t=b.Ub();b.wb(1),b.Zb("ngClass",t._onChange.hasAnnotation?"indicator":"no-indicator"),b.wb(2),b.oc(b.Wb(4,2,t._onChange.thumbnailName))}}function D(t,e){1&t&&b.Hb(0,"label",6)}function R(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"label"),b.nc(2),b.Kb(),b.Ib()),2&t){const t=b.Ub(3);b.wb(2),b.qc("",t._onChange.currentThumbnailIndex||0," / ",t._totalUuid,"")}}function N(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",8),b.Lb(2,"img",9),b.Sb("click",function(){return b.gc(t),b.Ub().$implicit.onClick()}),b.Vb(3,"translate"),b.Kb(),b.Kb(),b.Lb(4,"div",10),b.lc(5,R,3,2,"ng-container",11),b.Kb(),b.Ib()}if(2&t){const t=b.Ub(),e=t.$implicit,n=t.index,i=b.Ub();b.wb(2),b.Zb("src",e.imgPath,b.ic)("alt",e.alt)("title",b.Wb(3,5,e.hoverLabel)),b.xb("data-index",n+e.alt),b.wb(3),b.Zb("ngIf",i._onChange&&i._onChange.totalNumThumbnail)}}function U(t,e){if(1&t){const t=b.Mb();b.Lb(0,"div",8),b.Lb(1,"img",9),b.Sb("click",function(){return b.gc(t),b.Ub().$implicit.onClick()}),b.Vb(2,"translate"),b.Kb(),b.Kb()}if(2&t){const t=b.Ub(),e=t.$implicit,n=t.index;b.wb(1),b.Zb("src",e.imgPath,b.ic)("alt",e.alt)("title",b.Wb(2,4,e.hoverLabel)),b.xb("data-index",n+e.alt)}}function F(t,e){if(1&t&&(b.Jb(0),b.lc(1,N,6,7,"ng-container",2),b.lc(2,U,3,6,"ng-template",null,7,b.mc),b.Ib()),2&t){const t=e.index,n=b.ec(3);b.wb(1),b.Zb("ngIf",0===t)("ngIfElse",n)}}function K(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"div",8),b.Lb(2,"img",9),b.Sb("click",function(){return e.$implicit.onClick()}),b.Vb(3,"translate"),b.Kb(),b.Kb(),b.Ib()),2&t){const t=e.$implicit,n=e.index;b.wb(2),b.Zb("src",t.imgPath,b.ic)("alt",t.alt)("title",b.Wb(3,4,t.hoverLabel)),b.xb("data-index",n+t.alt)}}let Z=(()=>{class t{constructor(){this._totalUuid=0,this._tabStatus=[],this._onClick=new b.n,this.isTabStillOpen=!0,this.bindImagePath=()=>{this.jsonSchema={logosCenter:[{imgPath:"../../../assets/icons/previous.svg",hoverLabel:"labellingInfo.previous",alt:"Previous",onClick:()=>this.emitParentEvent({thumbnailAction:-1})},{imgPath:"../../../assets/icons/next.svg",hoverLabel:"labellingInfo.next",alt:"Next",onClick:()=>this.emitParentEvent({thumbnailAction:1})}],logosEnd:[{imgPath:"../../../assets/icons/undo.svg",hoverLabel:"labellingInfo.undo",alt:"Undo",onClick:()=>null},{imgPath:"../../../assets/icons/redo.svg",hoverLabel:"labellingInfo.redo",alt:"Redo",onClick:()=>null}]}},this.emitParentEvent=({url:t,thumbnailAction:e})=>{this._onClick.emit({url:t,thumbnailAction:e})}}ngOnInit(){this.bindImagePath()}ngOnChanges(t){if(t._onChange){const{totalNumThumbnail:e}=t._onChange.currentValue;this._onChange.totalNumThumbnail=e,this.bindImagePath()}if(t._tabStatus){this.isTabStillOpen=!1;for(const{closed:t}of this._tabStatus)if(!t){this.isTabStillOpen=!0;break}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-info"]],inputs:{_totalUuid:"_totalUuid",_onChange:"_onChange",_tabStatus:"_tabStatus"},outputs:{_onClick:"_onClick"},features:[b.ub],decls:9,vars:6,consts:[[1,"header-container"],[1,"container-flex-start"],[4,"ngIf","ngIfElse"],["defaultName",""],[3,"ngClass"],[4,"ngFor","ngForOf"],[1,"imageTitle"],["renderOtherIcons",""],[1,"utility-icon-container"],[1,"utility-icon-light",3,"src","alt","title","click"],[1,"totalThumbnail"],[4,"ngIf"]],template:function(t,e){if(1&t&&(b.Lb(0,"div",0),b.Lb(1,"div",1),b.lc(2,T,5,4,"ng-container",2),b.lc(3,D,1,0,"ng-template",null,3,b.mc),b.Kb(),b.Lb(5,"div",4),b.lc(6,F,4,2,"ng-container",5),b.Kb(),b.Lb(7,"div",4),b.lc(8,K,4,6,"ng-container",5),b.Kb(),b.Kb()),2&t){const t=b.ec(4);b.wb(2),b.Zb("ngIf",e._onChange.thumbnailName)("ngIfElse",t),b.wb(3),b.Zb("ngClass",e.isTabStillOpen?"container-flex-center":"container-flex-center-adjust"),b.wb(1),b.Zb("ngForOf",e.jsonSchema.logosCenter),b.wb(1),b.Zb("ngClass",e.isTabStillOpen?"container-flex-end":"container-flex-end-adjust"),b.wb(1),b.Zb("ngForOf",e.jsonSchema.logosEnd)}},directives:[i.k,i.i,i.j],pipes:[E,z.c],styles:[".header-container[_ngcontent-%COMP%]{min-width:100vw;max-width:100vw;min-height:4vh;max-height:4vh;background:#525353;border-bottom:.0625vw solid hsla(0,0%,100%,.25);display:flex;justify-content:space-between;z-index:1000;position:absolute}.container-flex-start[_ngcontent-%COMP%]{margin-left:3vw}.container-flex-center[_ngcontent-%COMP%], .container-flex-start[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:inherit;max-height:inherit}.container-flex-center[_ngcontent-%COMP%]{margin-left:8vw}.container-flex-end[_ngcontent-%COMP%]{display:flex;margin-right:19vw}.container-flex-center-adjust[_ngcontent-%COMP%]{display:flex;margin-left:2vw;align-items:center;min-height:inherit;max-height:inherit}.container-flex-end-adjust[_ngcontent-%COMP%]{display:flex;margin-right:3vw}.logo-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw}.logo[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:2.2vh;max-height:2.2vh;padding:.3vw;position:fixed;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.position-absolute[_ngcontent-%COMP%]{position:absolute}.utility-icon-container[_ngcontent-%COMP%]{display:flex;min-height:3.5vh;max-height:3.5vh;min-width:2vw;max-width:2vw}.totalThumbnail[_ngcontent-%COMP%]{font-size:1.7vh;padding:.4vw 1vw 0;display:inline-block;color:#fff;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.img-container[_ngcontent-%COMP%]:hover   .img-description[_ngcontent-%COMP%]{visibility:visible;opacity:1}.imageTitle[_ngcontent-%COMP%]{font-size:1.7vh;color:#fff;align-items:center;margin-left:1vw;max-width:20vw;min-width:20vw;position:absolute;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:aboslute}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.horizontal-line[_ngcontent-%COMP%]{padding:1vh 0;margin:0 1vw;border:.01rem solid #707070}"],changeDetection:0}),t})();var W=n("oSzE"),Y=n("DlmY");function $(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Y.a;++e<n;)this.add(t[e])}$.prototype.add=$.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},$.prototype.has=function(t){return this.__data__.has(t)};var X=$,V=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},H=function(t,e,n,i,o,a){var s=1&n,r=t.length,l=e.length;if(r!=l&&!(s&&l>r))return!1;var c=a.get(t),h=a.get(e);if(c&&h)return c==e&&h==t;var d=-1,u=!0,b=2&n?new X:void 0;for(a.set(t,e),a.set(e,t);++d<r;){var g=t[d],f=e[d];if(i)var m=s?i(f,g,d,e,t,a):i(g,f,d,t,e,a);if(void 0!==m){if(m)continue;u=!1;break}if(b){if(!V(e,function(t,e){if(!b.has(e)&&(g===t||o(g,t,n,i,a)))return b.push(e)})){u=!1;break}}else if(g!==f&&!o(g,f,n,i,a)){u=!1;break}}return a.delete(t),a.delete(e),u},G=n("ylTp"),J=n("Ce4a"),q=n("YHEm"),Q=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n},tt=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},et=G.a?G.a.prototype:void 0,nt=et?et.valueOf:void 0,it=n("TFwu"),ot=Object.prototype.hasOwnProperty,at=n("YM6B"),st=n("/1FC"),rt=n("WOAq"),lt=n("oYcn"),ct="[object Object]",ht=Object.prototype.hasOwnProperty,dt=n("EUcb"),ut=function t(e,n,i,o,a){return e===n||(null==e||null==n||!Object(dt.a)(e)&&!Object(dt.a)(n)?e!=e&&n!=n:function(t,e,n,i,o,a){var s=Object(st.a)(t),r=Object(st.a)(e),l=s?"[object Array]":Object(at.a)(t),c=r?"[object Array]":Object(at.a)(e),h=(l="[object Arguments]"==l?ct:l)==ct,d=(c="[object Arguments]"==c?ct:c)==ct,u=l==c;if(u&&Object(rt.a)(t)){if(!Object(rt.a)(e))return!1;s=!0,h=!1}if(u&&!h)return a||(a=new W.a),s||Object(lt.a)(t)?H(t,e,n,i,o,a):function(t,e,n,i,o,a,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new J.a(t),new J.a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Object(q.a)(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var r=Q;case"[object Set]":if(r||(r=tt),t.size!=e.size&&!(1&i))return!1;var l=s.get(t);if(l)return l==e;i|=2,s.set(t,e);var c=H(r(t),r(e),i,o,a,s);return s.delete(t),c;case"[object Symbol]":if(nt)return nt.call(t)==nt.call(e)}return!1}(t,e,l,n,i,o,a);if(!(1&n)){var b=h&&ht.call(t,"__wrapped__"),g=d&&ht.call(e,"__wrapped__");if(b||g){var f=b?t.value():t,m=g?e.value():e;return a||(a=new W.a),o(f,m,n,i,a)}}return!!u&&(a||(a=new W.a),function(t,e,n,i,o,a){var s=1&n,r=Object(it.a)(t),l=r.length;if(l!=Object(it.a)(e).length&&!s)return!1;for(var c=l;c--;){var h=r[c];if(!(s?h in e:ot.call(e,h)))return!1}var d=a.get(t),u=a.get(e);if(d&&u)return d==e&&u==t;var b=!0;a.set(t,e),a.set(e,t);for(var g=s;++c<l;){var f=t[h=r[c]],m=e[h];if(i)var p=s?i(m,f,h,e,t,a):i(f,m,h,t,e,a);if(!(void 0===p?f===m||o(f,m,n,i,a):p)){b=!1;break}g||(g="constructor"==h)}if(b&&!g){var _=t.constructor,v=e.constructor;_==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof v&&v instanceof v||(b=!1)}return a.delete(t),a.delete(e),b}(t,e,n,i,o,a))}(e,n,i,o,t,a))},bt=function(t,e){return ut(t,e)};function gt(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"img",4),b.Sb("click",function(){b.gc(t);const e=b.Ub(),n=e.index,i=e.$implicit;return b.Ub().getIndex(n),i.onClick()}),b.Vb(2,"translate"),b.Kb(),b.Ib()}if(2&t){const t=b.Ub(),e=t.$implicit,n=t.index,i=b.Ub();b.wb(1),b.Zb("ngClass",i.conditionalIconTheme(!(null==e||!e.nonClickable)))("ngStyle",(null==e?null:e.toggleable)&&i.conditionalActiveIcon(n))("src",e.imgPath,b.ic)("alt",e.alt)("title",b.Wb(2,6,e.hoverLabel)),b.xb("data-index",n)}}function ft(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"div",2),b.lc(2,gt,3,8,"ng-container",3),b.Kb(),b.Ib()),2&t){const t=e.$implicit;b.wb(2),b.Zb("ngIf",t)}}let mt=(()=>{class t{constructor(t,e){this._imgLabelState=t,this._annotateService=e,this._currentUrl="",this._tabStatus=[],this._navigate=new b.n,this._openInfo=new b.n,this.labelList=[],this.updateLabelList=()=>{this.labelList=this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]},this.resetSelectedAnnotate=()=>{this._annotateService.setState()},this.bindImagePath=()=>{this.jsonSchema={logos:[{imgPath:"../../../assets/icons/separator.svg",hoverLabel:"",alt:"",nonClickable:!0,toggleable:!1,onClick:()=>null},{imgPath:"../../../assets/icons/pointer.svg",hoverLabel:"leftSideBar.pointer",alt:"Pointer",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!0,scroll:!0})}},"/imglabel/bndbox"===this._currentUrl?{imgPath:"../../../assets/icons/rec_bounding_box.svg",hoverLabel:"leftSideBar.rectangularBB",alt:"RectangularBB",toggleable:!0,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})}}:{imgPath:"../../../assets/icons/polygon.svg",hoverLabel:"leftSideBar.polygon",alt:"Polygon",toggleable:!0,onClick:()=>{0!==this.labelList.length?(this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})):this.showAlertNoLabel()}},{imgPath:"../../../assets/icons/eraser.svg",hoverLabel:"leftSideBar.eraser",alt:"Eraser",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!0}),this._imgLabelState.setState(null)}},{imgPath:"../../../assets/icons/fit_center.svg",hoverLabel:"leftSideBar.fitCenter",alt:"Fit Center",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1}),this._imgLabelState.setState(null)}},{imgPath:"../../../assets/icons/save.svg",hoverLabel:"leftSideBar.save",alt:"Save",toggleable:!1,onClick:()=>{this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1,save:!0})}},{imgPath:"../../../assets/icons/info.svg",hoverLabel:"leftSideBar.info",alt:"KeyPoint",toggleable:!1,onClick:()=>{this._openInfo.emit()}}]}},this.checkStateEqual=(t,e)=>!bt(t,e),this.getIndex=t=>{this.iconIndex=t},this.conditionalIconTheme=t=>t?"plain-icon":"utility-icon-light",this.conditionalActiveIcon=t=>t===this.iconIndex?{background:"rgb(59 59 59)"}:null}ngOnInit(){this.updateLabelList(),this.bindImagePath()}ngOnChanges(t){if(this.bindImagePath(),t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){const{currentValue:e}=t._tabStatus;this._tabStatus=[...e],this.updateLabelList()}}showAlertNoLabel(){alert("No label exist yet. Please add new label.")}}return t.\u0275fac=function(e){return new(e||t)(b.Gb(P),b.Gb(C))},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-left-sidebar"]],inputs:{_onChange:"_onChange",_currentUrl:"_currentUrl",_tabStatus:"_tabStatus"},outputs:{_navigate:"_navigate",_openInfo:"_openInfo"},features:[b.ub],decls:2,vars:1,consts:[[1,"utility-left-sidebar-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[4,"ngIf"],[3,"ngClass","ngStyle","src","alt","title","click"]],template:function(t,e){1&t&&(b.Lb(0,"div",0),b.lc(1,ft,3,1,"ng-container",1),b.Kb()),2&t&&(b.wb(1),b.Zb("ngForOf",e.jsonSchema.logos))},directives:[i.j,i.k,i.i,i.l],pipes:[z.c],styles:[".utility-left-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.14vw;max-width:2.14vw;min-height:95.4vh;max-height:95.4vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.plain-icon[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:auto}"],changeDetection:0}),t})();var pt=n("XIp8");class _t{constructor(){}stringifyObject(t){try{return JSON.stringify(t)}catch(e){return console.log("StringifyObject(content) ----\x3e ",e.name+": ",e.message),""}}deepCloneObject(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.log("DeepCloneObject(content) ----\x3e ",e.name+": ",e.message),null}}deepCloneVariable(t){try{const e=t?JSON.parse(JSON.stringify({item:t})):"",{item:n}=e;return n}catch(e){return console.log("DeepCloneVariable(variable) ----\x3e ",e.name+": ",e.message),""}}generateUniquesID(){try{let t="";const e=new Date;return t+=e.getDate().toString(),t+=(e.getMonth()+1).toString(),t+=e.getFullYear().toString(),t+=e.getHours().toString(),t+=e.getMinutes().toString(),t+=e.getSeconds().toString(),t+=e.getMilliseconds().toString(),parseInt(t,10)}catch(t){return console.log("GenerateUniquesID() ----\x3e ",t.name+": ",t.message),-1}}matchStringHead(t,e){try{return e.substr(0,t.length)===t}catch(n){return console.log("MatchStringHead(StrToMatch:string, oristr:string) ----\x3e ",n.name+": ",n.message),!1}}getFilename(t){try{const e=this.deepCloneVariable(t).split("\\").join("/").split("/");return e[e.length-1]}catch(e){return console.log("GetFilename(strs) ----\x3e ",e.name+": ",e.message),""}}GetFoldername(t){try{const e=JSON.parse(JSON.stringify({st:t})).st.split("\\").join("/").split("/");return e.pop(),e.join("/")}catch(e){return console.log("GetFoldername(strs) ----\x3e ",e.name+": ",e.message),""}}RemoveHTMLElement(t){var e;try{const n=document.getElementById(t);null!=n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}catch(n){console.log("RemoveHTMLElement(ids) ----\x3e ",n.name+": ",n.message)}}}let vt=(()=>{class t{constructor(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.maxStageSize=51,this.allowUndo=!1,this.allowRedo=!1,this.utility=new _t,this.removeLastArray=t=>t.splice(-1,1)[0]}appendStages(t){t&&(this.redoArr=[],this.allowRedo=!1,0===this.currentArr.length?this.currentArr.push(this.utility.deepCloneVariable(t)):(this.undoArr.length===this.maxStageSize&&this.undoArr.splice(0,1),this.undoArr.push(this.removeLastArray(this.currentArr)),this.currentArr.push(this.utility.deepCloneVariable(t)),this.allowUndo=!0))}clearAllStages(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.allowUndo=!1,this.allowRedo=!1}undo(){if(this.allowRedo=!0,this.undoArr.length>0){this.redoArr.push(this.removeLastArray(this.currentArr));const t=this.removeLastArray(this.undoArr);return this.currentArr.push(t),this.allowUndo=0!==this.undoArr.length,t}return null}redo(){let t=null;return 0!==this.redoArr.length&&(this.undoArr.push(this.removeLastArray(this.currentArr)),t=this.removeLastArray(this.redoArr),this.currentArr.push(t),this.allowRedo=0!==this.redoArr.length),this.allowUndo=this.undoArr.length>0,t}clearRedundantStages(){var t,e;(null===(t=this.currentArr[0])||void 0===t?void 0:t.meta)&&"polygons"in this.currentArr[0].meta||this.undoArr.length>0&&(!this.isStateChange((null===(e=this.undoArr[this.undoArr.length-1])||void 0===e?void 0:e.meta).bnd_box)||(this.currentArr.pop(),this.currentArr.push(this.removeLastArray(this.undoArr))))}isAllowRedo(){return this.allowRedo}isAllowUndo(){return this.allowUndo}isMethodChange(t){var e;return(null===(e=this.currentArr[0])||void 0===e?void 0:e.method)!==t}replaceStages(t){t&&(this.currentArr[0]=this.utility.deepCloneVariable(t))}isStateChange(t){return!!t&&!!(t&&this.isAnnotationChange(t)||this.isLabelChange(t))}isLabelChange(t){var e,n,i,o;if((null===(e=this.currentArr[0])||void 0===e?void 0:e.meta)&&"polygons"in(null===(n=this.currentArr[0])||void 0===n?void 0:n.meta)){const e=t,n=(null===(i=this.currentArr[0])||void 0===i?void 0:i.meta).polygons;if(e.length!==n.length)return!0;for(const[t,{label:i}]of n.entries());}else{const e=t,n=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).bnd_box;if(e.length!==n.length)return!0;for(const[t,{label:i}]of n.entries())if(e[t].label!==i)return!0}return!1}isAnnotationChange(t){var e,n,i,o;if((null===(e=this.currentArr[0])||void 0===e?void 0:e.meta)&&"polygons"in(null===(n=this.currentArr[0])||void 0===n?void 0:n.meta)){if(this.currentArr.length<1)return!0;{const e=t,n=(null===(i=this.currentArr[0])||void 0===i?void 0:i.meta).polygons;return e.length!==n.length||!!n.some(({coorPt:t},n)=>e.some(({coorPt:e},i)=>t[n].x!==e[i].x||t[n].y!==e[i].y))||null}}if(this.currentArr.length<1)return!0;{const e=t,n=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).bnd_box;if(e.length!==n.length)return!0;for(const[t,{x1:i,x2:o,y1:a,y2:s,label:r}]of e.entries())if(i!==n[t].x1||o!==n[t].x2||a!==n[t].y1||s!==n[t].y2||r!==n[t].label)return!0}return!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),wt=(()=>{class t{constructor(t){this.el=t,this.srcAttr=null,this.canLazyLoad=()=>window&&"IntersectionObserver"in window,this.lazyLoadImage=()=>{new IntersectionObserver(t=>{t.forEach(({isIntersecting:t})=>{t?this.loadImage():this.unloadImage()})}).observe(this.el.nativeElement)},this.loadImage=()=>{this.srcAttr=this.src},this.unloadImage=()=>{this.srcAttr=""}}ngAfterViewInit(){this.canLazyLoad()?this.lazyLoadImage():this.loadImage()}}return t.\u0275fac=function(e){return new(e||t)(b.Gb(b.l))},t.\u0275dir=b.Bb({type:t,selectors:[["img","imgLazyLoad",""]],hostVars:1,hostBindings:function(t,e){2&t&&b.xb("src",e.srcAttr,b.ic)},inputs:{src:"src"}}),t})();var yt=n("3Pt+");const xt=["thumbnailList"];function St(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",12),b.Sb("click",function(){b.gc(t);const n=e.$implicit,i=e.index;return b.Ub(4).onClick(n,i)}),b.Lb(2,"div",13),b.Hb(3,"img",14),b.Kb(),b.Lb(4,"div",15),b.Lb(5,"label",16),b.nc(6),b.Vb(7,"fileNameSlice"),b.Kb(),b.Kb(),b.Lb(8,"div"),b.Hb(9,"div",17),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=e.$implicit;b.wb(3),b.Zb("src",t.img_thumbnail,b.ic),b.wb(3),b.oc(b.Wb(7,3,t.img_path)),b.wb(3),b.Zb("ngClass",(null==t.bnd_box?null:t.bnd_box.length)>0||(null==t.polygons?null:t.polygons.length)>0?"indicator":"no-indicator")}}function Ct(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",5),b.Lb(2,"label",6),b.nc(3),b.Vb(4,"translate"),b.Kb(),b.Lb(5,"div",7),b.Lb(6,"span",8),b.Lb(7,"div",9),b.Sb("click",function(){b.gc(t);const e=b.Ub().$implicit;return b.Ub(2).onClose(e)}),b.nc(8,"\u2716"),b.Kb(),b.Kb(),b.Kb(),b.Lb(9,"div",10,11),b.Sb("scroll",function(){return b.gc(t),b.Ub(3).mouseScroll()}),b.lc(11,St,10,5,"ng-container",2),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=b.Ub(),e=t.$implicit,n=t.index,i=b.Ub(2);b.wb(1),b.Zb("ngClass",i.checkCloseToggle(e)),b.xb("data-index",n),b.wb(2),b.rc("",b.Wb(4,6,e.name)," (",i._thumbnailList.length,"/",i._totalUuid,")"),b.wb(8),b.Zb("ngForOf",i._thumbnailList)}}function kt(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"span",29),b.Sb("click",function(){b.gc(t);const e=b.Ub().$implicit;return b.Ub(5).onDeleteLabel(e)}),b.nc(2,"-"),b.Kb(),b.Ib()}if(2&t){const t=b.Ub(6);b.wb(1),b.Zb("ngClass",t.clickAbilityToggle?"pointer":null)}}function Pt(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",24),b.Lb(2,"label",25),b.Lb(3,"div",26),b.Sb("click",function(){b.gc(t);const n=e.$implicit,i=b.Ub(5);return i.clickAbilityToggle?i.onClickLabel(n):null}),b.nc(4),b.Kb(),b.Kb(),b.Lb(5,"label",27),b.lc(6,kt,3,1,"ng-container",28),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=e.$implicit,n=b.Ub(5);b.wb(1),b.Zb("ngClass",t===n.selectedLabel?"label-active":null),b.wb(2),b.Zb("ngClass",n.clickAbilityToggle?"pointer":null),b.wb(1),b.pc(" ",t," "),b.wb(2),b.Zb("ngIf",t===n.selectedLabel)}}function Ot(t,e){1&t&&(b.Lb(0,"label",30),b.nc(1),b.Vb(2,"translate"),b.Kb()),2&t&&(b.wb(1),b.pc(" ",b.Wb(2,1,"labellingProject.labelNotExist")," "))}function Mt(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",5),b.Lb(2,"label",6),b.nc(3),b.Vb(4,"translate"),b.Kb(),b.Lb(5,"div",7),b.Lb(6,"span",8),b.Lb(7,"div",9),b.Sb("click",function(){b.gc(t);const e=b.Ub(2).$implicit;return b.Ub(2).onClose(e)}),b.nc(8,"\u2716"),b.Kb(),b.Kb(),b.Kb(),b.Lb(9,"div",19),b.Lb(10,"input",20),b.Sb("ngModelChange",function(e){return b.gc(t),b.Ub(4).inputLabel=e})("ngModelChange",function(e){return b.gc(t),b.Ub(4).inputLabelChange(e)})("keydown.enter",function(e){return b.gc(t),b.Ub(4).validateInputLabel(e)}),b.Vb(11,"translate"),b.Kb(),b.Kb(),b.Lb(12,"div",21),b.Lb(13,"div",22),b.lc(14,Pt,7,4,"ng-container",2),b.lc(15,Ot,3,3,"label",23),b.Kb(),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=b.Ub(2),e=t.$implicit,n=t.index,i=b.Ub(2);b.wb(1),b.Zb("ngClass",i.checkCloseToggle(e)),b.xb("data-index",n),b.wb(2),b.oc(b.Wb(4,8,e.name)),b.wb(7),b.Zb("ngClass",i.invalidInput?"input-invalid":null)("ngModel",i.inputLabel)("placeholder",b.Wb(11,10,"labellingProject.enterLabel")),b.wb(4),b.Zb("ngForOf",i.labelList),b.wb(1),b.Zb("ngIf",0===i.labelList.length)}}function Lt(t,e){if(1&t){const t=b.Mb();b.Lb(0,"div",36),b.Sb("click",function(){return b.gc(t),b.Ub(9).onDeleteAnnotation()}),b.nc(1," - "),b.Kb()}if(2&t){const t=b.Ub(9);b.Zb("ngClass",t.clickAbilityToggle?"pointer":null)}}function It(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"label",34),b.Sb("click",function(){b.gc(t);const n=e.index,i=e.$implicit,o=b.Ub(8);return o.clickAbilityToggle?o.onClickAnnotation(n,i):null}),b.Lb(2,"div",17),b.nc(3),b.Kb(),b.lc(4,Lt,2,1,"div",35),b.Kb(),b.Ib()}if(2&t){const t=e.$implicit,n=e.index,i=b.Ub(8);b.wb(1),b.Zb("ngClass",n===i.selectedIndexAnnotation?"annotation-active":null),b.xb("data-index",n),b.wb(1),b.Zb("ngClass",i.clickAbilityToggle?"pointer":null),b.wb(1),b.qc(" ",t.label," : ",t.id," "),b.wb(1),b.Zb("ngIf",n===i.selectedIndexAnnotation)}}function At(t,e){if(1&t&&(b.Jb(0),b.lc(1,It,5,6,"ng-container",2),b.Ib()),2&t){const t=b.Ub().$implicit;b.wb(1),b.Zb("ngForOf",t.bnd_box)}}function jt(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"label",34),b.Sb("click",function(){b.gc(t);const n=e.index,i=e.$implicit,o=b.Ub(8);return o.clickAbilityToggle?o.onClickAnnotation(n,i):null}),b.Lb(2,"div",17),b.nc(3),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=e.$implicit,n=e.index,i=b.Ub(8);b.wb(1),b.Zb("ngClass",n===i.selectedIndexAnnotation?"annotation-active":null),b.xb("data-index",n),b.wb(1),b.Zb("ngClass",i.clickAbilityToggle?"pointer":null),b.wb(1),b.qc(" ",t.label," : ",t.id," ")}}function Bt(t,e){if(1&t&&b.lc(0,jt,4,5,"ng-container",2),2&t){const t=b.Ub().$implicit;b.Zb("ngForOf",t.polygons)}}function Et(t,e){if(1&t&&(b.Jb(0),b.lc(1,At,2,1,"ng-container",3),b.lc(2,Bt,1,1,"ng-template",null,33,b.mc),b.Ib()),2&t){const t=e.$implicit,n=b.ec(3);b.wb(1),b.Zb("ngIf",t.bnd_box)("ngIfElse",n)}}function zt(t,e){if(1&t&&(b.Jb(0),b.lc(1,Et,4,2,"ng-container",2),b.Ib()),2&t){const t=b.Ub(3).$implicit;b.wb(1),b.Zb("ngForOf",t.annotation)}}function Tt(t,e){if(1&t){const t=b.Mb();b.Lb(0,"div",5),b.Lb(1,"label",6),b.nc(2),b.Vb(3,"translate"),b.Kb(),b.Lb(4,"div",7),b.Lb(5,"span",8),b.Lb(6,"div",9),b.Sb("click",function(){b.gc(t);const e=b.Ub(2).$implicit;return b.Ub(2).onClose(e)}),b.nc(7,"\u2716"),b.Kb(),b.Kb(),b.Kb(),b.Lb(8,"div",31),b.Lb(9,"div",22),b.Lb(10,"div",32),b.lc(11,zt,2,1,"ng-container",28),b.Kb(),b.Kb(),b.Kb(),b.Kb()}if(2&t){const t=b.Ub(2),e=t.$implicit,n=t.index,i=b.Ub(2);b.Zb("ngClass",i.checkCloseToggle(e)),b.xb("data-index",n),b.wb(2),b.oc(b.Wb(3,4,e.name)),b.wb(9),b.Zb("ngIf",null==e?null:e.annotation)}}function Dt(t,e){if(1&t&&(b.lc(0,Mt,16,12,"ng-container",3),b.lc(1,Tt,12,6,"ng-template",null,18,b.mc)),2&t){const t=b.ec(2),e=b.Ub().index;b.Zb("ngIf",1===e)("ngIfElse",t)}}function Rt(t,e){if(1&t&&(b.Jb(0),b.lc(1,Ct,12,8,"ng-container",3),b.lc(2,Dt,3,2,"ng-template",null,4,b.mc),b.Ib()),2&t){const t=e.index,n=b.ec(3);b.wb(1),b.Zb("ngIf",0===t)("ngIfElse",n)}}function Nt(t,e){if(1&t&&(b.Lb(0,"div",1),b.lc(1,Rt,4,2,"ng-container",2),b.Kb()),2&t){const t=b.Ub();b.wb(1),b.Zb("ngForOf",t._tabStatus)}}let Ut=(()=>{class t{constructor(t,e,n,i){this._annotateService=t,this._imgLblState=e,this._languageService=n,this._undoRedoService=i,this._totalUuid=0,this._thumbnailList=[],this._tabStatus=[],this._onClose=new b.n,this._onClickThumbnail=new b.n,this._onClickLabel=new b.n,this._onEnterLabel=new b.n,this._onChangeAnnotationLabel=new b.n,this._onDeleteAnnotation=new b.n,this._loadMoreThumbnails=new b.n,this.action=-1,this.displayInputLabel=!1,this.inputLabel="",this.selectedIndexAnnotation=-1,this.selectedLabel="",this.unsubscribe$=new c.a,this.clickAbilityToggle=!1,this.invalidInput=!1,this.labelList=[],this.isTabStillOpen=!0,this.tempMax=0,this.max=0,this.updateLabelList=()=>{this.labelList=this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]},this.onClose=t=>{this._onClose.emit({name:t.name,closed:!0})},this.onClick=(t,e)=>{this._onClickThumbnail.emit(Object.assign(Object.assign({},t),{thumbnailIndex:e})),this.selectedIndexAnnotation=-1,this.selectedLabel=""},this.onDisplayInputModal=()=>{this.displayInputLabel=!this.displayInputLabel,this.inputLabel=""},this.validateInputLabel=({target:t})=>{const{value:e}=t,n=e.trim();if(n)if(n.match(/^[a-zA-Z0-9-]*$/))if(this._tabStatus.some(({label_list:t})=>t&&t.length&&t.some(t=>t===n)))this.invalidInput=!0,console.error("Invalid existing label input");else{this.invalidInput=!1;const t=this._tabStatus.map(({label_list:t})=>t||[]).filter(t=>t.length>0)[0];this._onEnterLabel.emit({action:1,label_list:t?[...t,e]:[e]}),this.displayInputLabel=!1,this.inputLabel=""}else this.invalidInput=!0,console.error("Invalid input value")},this.onDeleteLabel=t=>{let e=!1;if(this._thumbnailList.forEach(n=>{n.bnd_box&&n.bnd_box.forEach(n=>{n.label===t&&(e=!0)}),n.polygons&&n.polygons.forEach(n=>{n.label===t&&(e=!0)})}),e)this._languageService._translate.get("labelExist").subscribe(t=>{alert(t)});else{const[{label_list:e}]=this._tabStatus.filter(t=>t.label_list);this._onClickLabel.emit({selectedLabel:t,label_list:e&&e.length>0?e:[],action:0})}},this.onClickLabel=t=>{this.selectedLabel=t,this.selectedIndexAnnotation>-1&&this._onChangeAnnotationLabel.emit({label:t,index:this.selectedIndexAnnotation}),this._selectMetadata.bnd_box[this.selectedIndexAnnotation].label=t,this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"})},this.onClickAnnotation=(t,{label:e})=>{this.selectedLabel=e,this._annotateService.setState({annotation:t})},this.onDeleteAnnotation=()=>{this.selectedIndexAnnotation>-1&&(this._onDeleteAnnotation.emit(this.selectedIndexAnnotation),this._selectMetadata.bnd_box.splice(this.selectedIndexAnnotation,1)&&this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}))},this.checkCloseToggle=t=>{let e="";return"labellingProject.label"===t.name&&this._tabStatus[2].closed||"labellingProject.project"===t.name&&this._tabStatus[1].closed&&this._tabStatus[2].closed||"labellingProject.annotation"===t.name||(e="flex-content"),t.closed&&(e+=" closed"),e},this.checkStateEqual=(t,e)=>!bt(t,e)}ngOnInit(){this.updateLabelList(),this._imgLblState.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({draw:t})=>this.clickAbilityToggle=t),this._thumbnailList.length>0&&this._annotateService.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({annotation:t})=>{var e;this.selectedIndexAnnotation=t;const[{annotation:n}]=this._tabStatus.filter(t=>t.annotation),i=null==n?void 0:n.map(({bnd_box:e,polygons:n})=>e?e.find((e,n)=>n===t):n?n.find((e,n)=>n===t):void 0)[0];this.selectedLabel=null!==(e=null==i?void 0:i.label)&&void 0!==e?e:""})}inputLabelChange(t){var e;this.labelList=this._tabStatus[1].label_list?null===(e=this._tabStatus[1].label_list)||void 0===e?void 0:e.filter(e=>e.includes(t)):[]}ngOnChanges(t){if(t._thumbnailList){const{currentValue:e}=t._thumbnailList;this._thumbnailList=Object.assign([],this._thumbnailList,[...e])}if(t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){const{currentValue:e}=t._tabStatus;this._tabStatus=[...e],this.updateLabelList(),this.isTabStillOpen=!1;for(const{closed:t}of this._tabStatus)if(!t){this.isTabStillOpen=!0;break}}}openAllTab(){this._tabStatus.forEach(t=>{t.closed=!1})}mouseScroll(){const t=this.thumbnailList.nativeElement.scrollTop+this.thumbnailList.nativeElement.clientHeight;this.max=this.thumbnailList.nativeElement.scrollHeight,t+1500>=this.max&&this.tempMax!==this.max&&(this.tempMax=this.max,this._loadMoreThumbnails.emit())}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Gb(C),b.Gb(P),b.Gb(M.a),b.Gb(vt))},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-project"]],viewQuery:function(t,e){if(1&t&&b.sc(xt,!0),2&t){let t;b.dc(t=b.Tb())&&(e.thumbnailList=t.first)}},hostBindings:function(t,e){1&t&&b.Sb("scroll",function(t){return e.mouseScroll(t)})},inputs:{_totalUuid:"_totalUuid",_selectMetadata:"_selectMetadata",_thumbnailList:"_thumbnailList",_tabStatus:"_tabStatus"},outputs:{_onClose:"_onClose",_onClickThumbnail:"_onClickThumbnail",_onClickLabel:"_onClickLabel",_onEnterLabel:"_onEnterLabel",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onDeleteAnnotation:"_onDeleteAnnotation",_loadMoreThumbnails:"_loadMoreThumbnails"},features:[b.ub],decls:1,vars:1,consts:[["class","tab-container",4,"ngIf"],[1,"tab-container"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["nonThumbnailTab",""],[1,"utility-right-project-container","tab","flex-fill-remaining",3,"ngClass"],[1,"tab-name"],[1,"flex-tab-icons"],[1,"tab-close-thumbnailless"],[1,"div-close",3,"click"],["id","thumbnailList",1,"utility-inner-container","tab-height","scroll",3,"scroll"],["thumbnailList",""],[1,"img-container",3,"click"],[1,"img-skeleton"],["imgLazyLoad","",1,"img",3,"src"],[1,"img-name"],[1,"img-path"],[3,"ngClass"],["annotationTab",""],[1,"div-input"],["type","text",1,"input",3,"ngClass","ngModel","placeholder","ngModelChange","keydown.enter"],["id","inner-container",1,"utility-inner-container","tab-height","scroll"],[1,"flex-item"],["class","not-exist",4,"ngIf"],[1,"flex-center-width",3,"ngClass"],[1,"label"],[3,"ngClass","click"],[1,"action"],[4,"ngIf"],[1,"delete-label",3,"ngClass","click"],[1,"not-exist"],["id","inner-container",1,"utility-inner-container","scroll","tab-smaller-height"],[1,"flex-center-width"],["polygon",""],[1,"label",3,"ngClass","click"],["class","delete-annotation",3,"ngClass","click",4,"ngIf"],[1,"delete-annotation",3,"ngClass","click"]],template:function(t,e){1&t&&b.lc(0,Nt,2,1,"div",0),2&t&&b.Zb("ngIf",e.isTabStillOpen)},directives:[i.k,i.j,i.i,wt,yt.a,yt.f,yt.i],pipes:[z.c,E],styles:['.tab-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;right:0;position:fixed;z-index:1000;min-width:18.5vw;max-width:18.5vw}.utility-right-project-container[_ngcontent-%COMP%]{height:100%;min-width:16.3vw;max-width:16.3vw;background:#383535;border:.0325vw solid hsla(0,0%,100%,.25);border-top:none;z-index:1000;align-items:stretch}.utility-right-project-container[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;min-width:8.5vw;max-width:8.5vw;min-height:4vh;max-height:4vh;background:#383535;z-index:-1;font-size:1.5vh;line-height:3vh;color:#fff;padding:.5vh 0 0 2vw}.tab[_ngcontent-%COMP%]{position:sticky;overflow:hidden}.tab[_ngcontent-%COMP%]:before{position:absolute;content:"";top:4vh;min-width:100vw;max-width:100vw;min-height:93vh;max-height:93vh;background:#383535;z-index:-1}.flex-fixed[_ngcontent-%COMP%]{flex:0 1 25vh}.flex-fill-remaining[_ngcontent-%COMP%]{flex:1 1 auto}.flex-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:33%;min-height:10%;flex-shrink:0;flex-grow:0;resize:vertical}.tab-name[_ngcontent-%COMP%]{font-size:1.7vh;padding:.5vw 2vw 0 1vw;display:inline-block;color:#fff;position:absolute}.tab-close-thumbnail[_ngcontent-%COMP%]{margin-left:3vw;justify-content:center}.tab-close-thumbnail[_ngcontent-%COMP%], .tab-close-thumbnailless[_ngcontent-%COMP%]{float:right;vertical-align:middle;min-height:4vh;max-height:4vh;color:#696969;font-size:1.8vh;line-height:4vh;text-align:center;display:inline-grid;padding-bottom:1vh}.tab-close-thumbnailless[_ngcontent-%COMP%]{flex:1 0 60%;justify-content:right}.div-close[_ngcontent-%COMP%]{margin-right:.5vw;min-width:1.6vw;max-width:1.6vw;min-height:4vh;max-height:4vh;color:#fff;cursor:pointer;text-align:center;float:right}.div-close[_ngcontent-%COMP%]:active{background:grey}.utility-inner-container[_ngcontent-%COMP%]{padding:2.5vh 0 0 .2vw;scroll-behavior:smooth;overflow:hidden auto;z-index:100;min-width:15.5vw;max-width:15.5vw}.tab-height[_ngcontent-%COMP%]{height:85%}.tab-smaller-height[_ngcontent-%COMP%]{height:60%}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.img-container[_ngcontent-%COMP%], .utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.img-container[_ngcontent-%COMP%]{font-size:1.5vh;color:#fff;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;cursor:pointer;margin:0 .3vw;padding:.1vh .4vw}.img-container[_ngcontent-%COMP%]:hover{background-color:#444;border-radius:2px}.img[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}.img[_ngcontent-%COMP%], .img-skeleton[_ngcontent-%COMP%]{max-height:4.3vh;min-height:4.3vh;max-width:3vw}.img-skeleton[_ngcontent-%COMP%]{min-width:3vw;border:.005vh dotted #525353}.img-name[_ngcontent-%COMP%]{margin-left:.5vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.closed[_ngcontent-%COMP%]{display:none}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute}.flex-item[_ngcontent-%COMP%]{align-items:center;flex-direction:column;font-size:1.5vh;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.flex-center-width[_ngcontent-%COMP%], .flex-item[_ngcontent-%COMP%]{display:flex;justify-content:center}.flex-center-width[_ngcontent-%COMP%]{width:90%;flex-wrap:wrap}.label[_ngcontent-%COMP%]{flex:1 1 80%;display:flex;justify-content:flex-start;margin:.25vh 0}.pointer[_ngcontent-%COMP%]{cursor:pointer}.annotation-active[_ngcontent-%COMP%], .label-active[_ngcontent-%COMP%]{border:.15vw solid #ff0}.utility-info-btn[_ngcontent-%COMP%]{font-size:1vw;min-width:0;max-width:0;min-height:2.5vh;max-height:2.5vh;line-height:0;right:21vh;position:absolute;background:#383535;border:none;color:#fff}.flex-tab-icons[_ngcontent-%COMP%]{display:flex;width:100%}.extra-icons[_ngcontent-%COMP%]{cursor:pointer}.extra-icons[_ngcontent-%COMP%]:active{background:grey}.tab-extra-icons[_ngcontent-%COMP%]{float:right;vertical-align:middle;font-size:1.7vh;line-height:4vh;text-align:center;color:#fff;flex:1 0 15%;justify-content:flex-start}.tab-text[_ngcontent-%COMP%]{font-size:1.7vh;min-width:6vw;max-width:6vw}.inner-content[_ngcontent-%COMP%]{max-height:25vh;min-height:25vh;min-width:3vw;max-width:3vw}.div-input[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin:.5vh .9vw}.input[_ngcontent-%COMP%]{border-radius:8vw;border:none;outline:none;padding:.3vw 0 .3vw 1vw;min-height:1.5vh;max-height:1.5vh;min-width:13vw;max-width:13vw;font-size:1.3vh;background:#525353;color:#fff}.input-invalid[_ngcontent-%COMP%]{border:.2vw solid red}.img-path[_ngcontent-%COMP%]{margin-top:4vh}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:relative}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.not-exist[_ngcontent-%COMP%]{font-size:1.5vh;color:#999}.delete-annotation[_ngcontent-%COMP%], .delete-label[_ngcontent-%COMP%]{position:absolute;right:2vw}.open-all-tabs[_ngcontent-%COMP%]{cursor:pointer;padding:.2vh .2vw;border-radius:.7vw}.open-all-tabs[_ngcontent-%COMP%]:hover{background:#636363}.open-all-tabs[_ngcontent-%COMP%]:active, .open-all-tabs[_ngcontent-%COMP%]:focus{background:#737474}.tab-skeleton[_ngcontent-%COMP%]{position:absolute;height:100vh;width:16.5vw;background:#525353;border-left:.0625vw solid hsla(0,0%,100%,.25);text-align:center;color:#cac8c8;font-size:2vh}.choose-tab[_ngcontent-%COMP%]{margin-top:42vh}']}),t})();function Ft(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"div",3),b.Lb(2,"label"),b.Lb(3,"img",4),b.Sb("click",function(){return e.$implicit.onClick()}),b.Vb(4,"translate"),b.Kb(),b.Kb(),b.Kb(),b.Ib()),2&t){const t=e.$implicit,n=e.index,i=b.Ub();b.wb(3),b.kc(t.style),b.Zb("ngClass",i.conditionalIconTheme())("src",t.imgPath,b.ic)("alt",t.alt)("title",b.Wb(4,7,t.hoverLabel)),b.xb("data-index",n)}}let Kt=(()=>{class t{constructor(){this._onClick=new b.n,this._onExport=new b.n,this._onReload=new b.n,this.bindImagePath=()=>{this.jsonSchema={logos:[{imgPath:"../../../assets/icons/folder.svg",hoverLabel:"rightSideBar.folderOrFiles",alt:"Folder",onClick:()=>{this._onClick.emit({name:"labellingProject.project",closed:!1})}},{imgPath:"../../../assets/icons/tag.svg",hoverLabel:"rightSideBar.label",alt:"Label",onClick:()=>{this._onClick.emit({name:"labellingProject.label",closed:!1})}},{imgPath:"../../../assets/icons/bounding_box.svg",hoverLabel:"rightSideBar.annotation",alt:"Annotation",onClick:()=>{this._onClick.emit({name:"labellingProject.annotation",closed:!1})}},{imgPath:"../../../assets/icons/statistic.svg",hoverLabel:"rightSideBar.statistic",alt:"Statistic",onClick:()=>{}},{imgPath:"../../../assets/icons/export.svg",hoverLabel:"rightSideBar.export",alt:"Export",style:"padding: 1.5vh 0.5vw;",onClick:()=>{this._onExport.emit()}},{imgPath:"../../../assets/icons/reload.svg",hoverLabel:"rightSideBar.reload",alt:"Reload",style:"padding: 1.5vh 0.5vw;",onClick:()=>{this._onReload.emit()}}]}},this.conditionalIconTheme=()=>"utility-icon-light"}ngOnInit(){this.bindImagePath()}ngOnChanges(t){this.bindImagePath()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-right-sidebar"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick",_onExport:"_onExport",_onReload:"_onReload"},features:[b.ub],decls:3,vars:1,consts:[[1,"utility-right-sidebar-container"],[1,"utility-inner-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"]],template:function(t,e){1&t&&(b.Lb(0,"div",0),b.Lb(1,"div",1),b.lc(2,Ft,5,9,"ng-container",2),b.Kb(),b.Kb()),2&t&&(b.wb(2),b.Zb("ngForOf",e.jsonSchema.logos))},directives:[i.j,i.i],pipes:[z.c],styles:[".utility-right-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.2vw;max-width:2.2vw;min-height:95.5vh;max-height:95.5vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-inner-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw;position:absolute}.utility-icon-container[_ngcontent-%COMP%], .utility-inner-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.input-none[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t})();function Zt(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"div",3),b.nc(2),b.Vb(3,"translate"),b.Kb(),b.Ib()),2&t){const t=b.Ub(2);b.wb(2),b.qc("",b.Wb(3,2,"footer.image"),": ",t.thumbnailType,"")}}function Wt(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",2),b.Lb(2,"div",3),b.nc(3),b.Vb(4,"translate"),b.Kb(),b.lc(5,Zt,4,4,"ng-container",1),b.Lb(6,"div",3),b.nc(7),b.Kb(),b.Lb(8,"div",4),b.Vb(9,"translate"),b.Lb(10,"label",5),b.Sb("click",function(){b.gc(t);const e=b.Ub();return e.copyMessage(e._thumbnailInfo.img_path)}),b.nc(11),b.Kb(),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=b.Ub();b.wb(3),b.qc("",b.Wb(4,7,"footer.size"),": ",t.thumbnailSize,""),b.wb(2),b.Zb("ngIf",t.thumbnailType),b.wb(2),b.qc("",t._thumbnailInfo.img_ori_w," x ",t._thumbnailInfo.img_ori_h,""),b.wb(1),b.Zb("title",b.Wb(9,9,"footer.copyToClipboard")),b.wb(3),b.oc(t._thumbnailInfo.img_path)}}let Yt=(()=>{class t{constructor(){this._imgSrc="",this.thumbnailSize="",this.thumbnailType="",this.formatBytes=(t,e=2)=>{if(0===t)return"0 Bytes";const n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}ngOnInit(){}copyMessage(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}ngOnChanges(t){if(t._thumbnailInfo&&t._imgSrc){const{currentValue:e}=t._thumbnailInfo,{currentValue:n}=t._imgSrc;this._thumbnailInfo=Object.assign(Object.assign({},this._thumbnailInfo),e),this.thumbnailSize=this.formatBytes(n.length);const i=n.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(i&&i.length){const t=i[1].split("/")[1];this.thumbnailType=t}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-footer"]],inputs:{_thumbnailInfo:"_thumbnailInfo",_imgSrc:"_imgSrc"},features:[b.ub],decls:3,vars:3,consts:[[1,"footer-container"],[4,"ngIf"],[1,"footer-label-container"],[1,"footer-label"],[1,"footer-image-path",3,"title"],[1,"footer-path-label",3,"click"]],template:function(t,e){1&t&&(b.Lb(0,"div",0),b.lc(1,Wt,12,11,"ng-container",1),b.Vb(2,"json"),b.Kb()),2&t&&(b.wb(1),b.Zb("ngIf","{}"!=b.Wb(2,1,e._thumbnailInfo)))},directives:[i.k],pipes:[i.e,z.c],styles:[".footer-container[_ngcontent-%COMP%]{position:absolute;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);min-height:2.3vh;max-height:2.3vh;min-width:100vw;max-width:100vw;bottom:0;padding-left:2.5vw}.footer-label-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:baseline;width:80%}.footer-label[_ngcontent-%COMP%]{flex:0 1 15%;text-align:center}.footer-image-path[_ngcontent-%COMP%], .footer-label[_ngcontent-%COMP%]{font-size:1.6vh;color:#fff;outline:none;border-right:.05vw solid #fff;padding:0 1vw}.footer-image-path[_ngcontent-%COMP%]{display:flex;flex:0 1 130%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border-right[_ngcontent-%COMP%]{border-right:1rem #fff}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:1.5vh;max-height:1.5vh;padding:0;position:absolute;cursor:context-menu}.footer-path-label[_ngcontent-%COMP%]{cursor:pointer;padding:0 .2vw;border-radius:.5vw}.footer-path-label[_ngcontent-%COMP%]:hover{background:#636363}.footer-path-label[_ngcontent-%COMP%]:active, .footer-path-label[_ngcontent-%COMP%]:focus{background:#737474}"],changeDetection:0}),t})();var $t=n("44N4"),Xt=n("TJKd");function Vt(t,e){if(1&t&&(b.Lb(0,"span"),b.nc(1),b.Kb()),2&t){const t=b.Ub(2);b.wb(1),b.pc("Zipping ",t._processingNum," file")}}function Ht(t,e){1&t&&(b.Lb(0,"span"),b.nc(1,"Done"),b.Kb())}function Gt(t,e){1&t&&b.Hb(0,"div",5)}function Jt(t,e){1&t&&(b.Lb(0,"div",6),b.nc(1,"\u2714"),b.Kb())}function qt(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"div",1),b.Lb(2,"div",2),b.lc(3,Vt,2,1,"span",0),b.lc(4,Ht,2,0,"span",0),b.Kb(),b.lc(5,Gt,1,0,"div",3),b.lc(6,Jt,2,0,"div",4),b.Kb(),b.Ib()),2&t){const t=b.Ub();b.wb(3),b.Zb("ngIf",t._processingNum>0),b.wb(1),b.Zb("ngIf",0===t._processingNum),b.wb(1),b.Zb("ngIf",t._processingNum>0),b.wb(1),b.Zb("ngIf",0===t._processingNum)}}let Qt=(()=>{class t{constructor(){this._processingNum=0,this.doneProcess=!1}ngOnInit(){}delay(t){return new Promise(e=>setTimeout(e,t))}ngOnChanges(t){return a(this,void 0,void 0,function*(){t._processingNum&&(console.log(t._processingNum),1===t._processingNum.previousValue&&0===t._processingNum.currentValue&&(this.doneProcess=!0,yield this.delay(1e3),this.doneProcess=!1))})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b.Ab({type:t,selectors:[["toastr"]],inputs:{_processingNum:"_processingNum"},features:[b.ub],decls:1,vars:1,consts:[[4,"ngIf"],[1,"toastr"],[1,"text"],["class","loader",4,"ngIf"],["class","done",4,"ngIf"],[1,"loader"],[1,"done"]],template:function(t,e){1&t&&b.lc(0,qt,7,4,"ng-container",0),2&t&&b.Zb("ngIf",e._processingNum>0||e.doneProcess)},directives:[i.k],styles:[".toastr[_ngcontent-%COMP%]{position:absolute;z-index:10000;background:#262a2e;border-radius:1vh;color:#fff;bottom:5vh;right:5vw;padding:2vh 2vw;display:flex;justify-content:center}.text[_ngcontent-%COMP%]{margin:auto 1vw auto auto;font-size:2vh}.loader[_ngcontent-%COMP%]{border-radius:50%;border:.5vh solid #f3f3f3;border-top-color:#de1c44;width:2vh;height:2vh;-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite}.done[_ngcontent-%COMP%]{color:#92c91b;font-size:2vh}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}"]}),t})();var te=n("CfRg"),ee=function(t){return Object(te.a)(t,4)};let ne=(()=>{class t{constructor(){this.globalXY={x:0,y:0},this.panXY={x:0,y:0},this.currentClickedBox={box:-1,pos:"o"},this.lineOffset=3,this.anchrSize=2.5,this.currentDrawing={x1:0,x2:0,y1:0,y2:0},this.currentSelectedBndBox=-1,this.util=new _t}getDiffXY({offsetX:t,offsetY:e}){try{const n={diffX:0,diffY:0};return n.diffX=this.globalXY.x+(t-this.panXY.x),n.diffY=this.globalXY.y+(e-this.panXY.y),n}catch(n){return console.log("ObjectDetection getDiffXY(offsetX: number,offsetY: number): { diffX: number; diffY: number }",n.name+": ",n.message),{diffX:-1,diffY:-1}}}setCurrentX1Y1(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x1=t,this.currentDrawing.y1=e)}catch(n){console.log("ObjectDetection setCurrentX1Y1(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}setCurrentX2Y2(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x2=t,this.currentDrawing.y2=e)}catch(n){console.log("ObjectDetection setCurrentX2Y2(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}moveAllBbox(t,e,n,i){try{for(const i of t){const t=i.x2-i.x1,o=i.y2-i.y1;i.x1=ee(e+i.distancetoImg.x),i.y1=ee(n+i.distancetoImg.y),i.x2=ee(i.x1+t),i.y2=ee(i.y1+o)}i&&i(!0)}catch(o){}}calScaleTofitScreen(t,e,n,i){try{const o={factor:-1,newX:-1,newY:-1};return o.factor=Math.min(n/t,i/e),o.factor=o.factor-.05*o.factor,o.newX=n/2-t/2*o.factor,o.newY=i/2-e/2*o.factor,o}catch(o){return{factor:-1,newX:-1,newY:-1}}}deleteSingleBox(t,e,n){try{t.splice(e,1),this.currentSelectedBndBox=-1,this.currentClickedBox={box:-1,pos:"o"},n(!0)}catch(i){}}keyboardMoveBox(t,e,{img_w:n,img_h:i,img_x:o,img_y:a},s){try{switch(t){case"up":this.moveBoxWithinPointPath(o,a,n,i,0,-3,e)&&(e.y1-=3,e.y2-=3);break;case"down":this.moveBoxWithinPointPath(o,a,n,i,0,3,e)&&(e.y1+=3,e.y2+=3);break;case"left":this.moveBoxWithinPointPath(o,a,n,i,-3,0,e)&&(e.x1-=3,e.x2-=3);break;case"right":this.moveBoxWithinPointPath(o,a,n,i,3,0,e)&&(e.x1+=3,e.x2+=3)}s(!0)}catch(r){}}moveBoxWithinPointPath(t,e,n,i,o,a,s){try{return!(s.x1+o<t||s.x2+o>t+n||s.y1+a<e||s.y2+a>e+i)}catch(r){return console.log("ObjectDetection isWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, addx:number, addy:number, box:Boundingbox):Boolean",r.name+": ",r.message),!1}}mouseMoveBox(t,e,n){try{if(this.moveBoxWithinPointPath(n.img_x,n.img_y,n.img_w,n.img_h,t-this.currentDrawing.x1,e-this.currentDrawing.y1,n.bnd_box[this.currentSelectedBndBox])){this.setCurrentX2Y2(t,e);const i=this.currentDrawing.x2-this.currentDrawing.x1,o=this.currentDrawing.y2-this.currentDrawing.y1;this.setCurrentX1Y1(this.currentDrawing.x2,this.currentDrawing.y2),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"l"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x1+=i),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"t"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y1+=o),"i"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos&&"r"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x2+=i),"i"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos&&"b"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y2+=o)}}catch(i){console.log("ObjectDetection mouseMoveBox(MouseX:number, MouseY:number, CurrMeta:Metadata):void",i.name+": ",i.message)}}getCurrentSelectedBox(){try{return this.currentSelectedBndBox}catch(t){return-1}}setCurrentSelectedbBox(t){try{this.currentSelectedBndBox=t}catch(e){console.log("ObjectDetection setCurrentSelectedbBox(newNUM:number):void",e.name+": ",e.message)}}mouseUpDrawEnable(t,e,n){try{const i={selBox:-1,isNew:!1};if(-1===this.currentClickedBox.box&&null!==this.tmpbox)t.bnd_box.push(this.tmpbox),this.currentSelectedBndBox=t.bnd_box.length-1,t.bnd_box[this.currentSelectedBndBox].label=e.length>0?e[0].name:"",i.isNew=!0,i.selBox=ee(this.currentSelectedBndBox);else if(this.currentClickedBox.box>-1&&this.tmpbox){if(t.bnd_box[this.currentSelectedBndBox].x1>t.bnd_box[this.currentSelectedBndBox].x2){const e=ee(t.bnd_box[this.currentSelectedBndBox].x1);t.bnd_box[this.currentSelectedBndBox].x1=ee(t.bnd_box[this.currentSelectedBndBox].x2),t.bnd_box[this.currentSelectedBndBox].x2=e}if(t.bnd_box[this.currentSelectedBndBox].y1>t.bnd_box[this.currentSelectedBndBox].y2){const e=ee(t.bnd_box[this.currentSelectedBndBox].y1);t.bnd_box[this.currentSelectedBndBox].y1=ee(t.bnd_box[this.currentSelectedBndBox].y2),t.bnd_box[this.currentSelectedBndBox].y2=e}}return this.currentClickedBox={box:-1,pos:"o"},this.setCurrentX1Y1(0,0),this.setCurrentX2Y2(0,0),this.tmpbox=null,n(!0),i}catch(i){return console.log("ObjectDetection MouseUpDrawEnable(CurrMeta: Metadata): number",i.name+": ",i.message),{selBox:-1,isNew:!1}}}panRectangle(t,e,n,i){try{for(const i of t){const t=i.x2-i.x1,o=i.y2-i.y1;i.x1=e+i.distancetoImg.x,i.y1=n+i.distancetoImg.y,i.x2=i.x1+t,i.y2=i.y1+o}i(!0)}catch(o){console.log("ObjectDetection panRectangle(bbox:Boundingbox[], img_X:number, img_Y:number)",o.name+": ",o.message)}}scaleAllBoxes(t,e,n,i,o){try{for(const o of e){console.log(o);const e=o.distancetoImg.x*t+n,a=o.distancetoImg.y*t+i,s=e+(o.x2-o.x1)*t,r=a+(o.y2-o.y1)*t;o.x1=ee(e),o.y1=ee(a),o.x2=ee(s),o.y2=ee(r);const l=o.y1-i;o.distancetoImg.x=ee(o.x1-n),o.distancetoImg.y=ee(l)}o&&o(!0)}catch(a){console.log("ObjectDetection scaleAllBoxes(scalefactor: number,boxes:Boundingbox[],imgX:number,imgY:number)",a.name+": ",a.message)}}mouseMoveDrawEnable(t,e,n){try{-1===this.currentClickedBox.box?this.setCurrentX2Y2(t,e):this.mouseMoveBox(t,e,n)}catch(i){console.log("ObjectDetection MouseMoveDrawEnable(MouseX: number,MouseY: number,SelectedMeta: Metadata): void",i.name+": ",i.message)}}mouseDownDrawEnable(t,e,n){try{return this.getCurrentClickBox(t,e,n),this.setCurrentX1Y1(t,e),this.setCurrentX2Y2(t,e),this.currentSelectedBndBox=-1!==this.currentClickedBox.box?this.currentClickedBox.box:-1,this.currentClickedBox.box}catch(i){return console.log("ObjectDetection MouseDownDrawEnable(MouseX:number,MouseY:number,BBox:Boundingbox[]):number",i.name+": ",i.message),-1}}setPanXY(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}setGlobalXY(t,e){try{return!(!t||!e||(this.globalXY.x=t,this.globalXY.y=e,0))}catch(n){return console.log("ObjectDetection SetGlobalXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}changeLabel(t,e){t&&e&&(t.label=e)}mouseClickWithinPointPath({img_x:t,img_y:e,img_w:n,img_h:i},{offsetX:o,offsetY:a}){try{return o>t&&o<t+n&&a>e&&a<e+i}catch(s){return console.log(s),!1}}drawAllBoxOn(t,e,n){try{if(e.length>0)for(const[i,o]of e.entries())i===this.currentClickedBox.box||i===this.currentSelectedBndBox?(o.color="rgba(0,255,0,1.0)",o.lineWidth=2,this.drawEachBoxOn(t,o,n,!0)):(o.color="rgba(255,255,0,0.8)",o.lineWidth=1,this.drawEachBoxOn(t,o,n,!1));if(-1===this.currentClickedBox.box&&-1===this.currentSelectedBndBox){for(const r of e)r.color="rgba(255,255,0,0.8)",this.drawEachBoxOn(t,r,n,!1);const{x1:i,x2:o,y1:a,y2:s}=this.currentDrawing;this.tmpbox=this.generateNewBox(i,o,a,s),this.tmpbox&&this.drawEachBoxOn(t,this.tmpbox,n,!0)}}catch(i){console.log("redraw(boundbox) ----\x3e ",i.name+": ",i.message)}}drawEachBoxOn(t,e,n,i){try{if(n){const o=e.x1+(e.x2-e.x1)/2,a=e.y1+(e.y2-e.y1)/2;n.strokeStyle="white",n.fillStyle="black",n.font="bold 12px Arial",""==e.label?(n.strokeText("",e.x1+10,e.y1+15),n.fillText("",e.x1+10,e.y1+15)):t.find(t=>t.name===e.label)?(n.strokeText(e.label,e.x1+10,e.y1+15),n.fillText(e.label,e.x1+10,e.y1+15)):(n.strokeText("Text",e.x1+10,e.y1+15),n.fillText("Text",e.x1+10,e.y1+15)),n.strokeStyle=e.color,n.beginPath(),n.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),n.lineWidth=e.lineWidth,n.stroke(),n.fillStyle=e.color,i&&(n.beginPath(),n.fillRect(e.x1-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(o-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(o-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(o-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize))}}catch(o){console.log("ObjectDetection drawEachBoxOn(box:Boundingbox, context:CanvasRenderingContext2D, isSelected:boolean):void",o.name+": ",o.message)}}generateNewBox(t,e,n,i){try{const o=t<e?t:e,a=n<i?n:i,s=t>e?t:e,r=n>i?n:i;return s-o>this.lineOffset&&r-a>this.lineOffset?{x1:o,y1:a,x2:s,y2:r,lineWidth:2,color:"rgba(0,255,0,1.0)",distancetoImg:{x:0,y:0},label:"",id:this.util.generateUniquesID()}:null}catch(o){return console.log("ObjectDetection GenerateNewBox(x1:number,x2:number,y1:number,y2:number):Boundingbox",o.name+": ",o.message),null}}getBBoxDistfromImg(t,e,n){try{for(const{x1:i,y1:o,distancetoImg:a}of t){const t=o-n;a.x=ee(i-e),a.y=ee(t)}}catch(i){console.log("ObjectDetection GetBBoxDistfromImg(bbox:Boundingbox[],imgX:number,imgY:number)",i.name+": ",i.message)}}getCurrentClickBox(t,e,n){try{return this.currentClickedBox=this.mouseClickOnBoxes(t,e,n),this.currentClickedBox}catch(i){return console.log("ObjectDetection getCurrentClickBox(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}mouseClickOnBoxes(t,e,n){try{for(let i=0;i<n.length;++i){const o=n[i].x1+(n[i].x2-n[i].x1)/2,a=n[i].y1+(n[i].y2-n[i].y1)/2;if(n[i].x1-this.lineOffset<t&&t<n[i].x1+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tl"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"bl"};if(a-this.lineOffset<e&&e<a+this.lineOffset)return{box:i,pos:"l"}}else if(n[i].x2-this.lineOffset<t&&t<n[i].x2+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tr"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"br"};if(a-this.lineOffset<e&&e<a+this.lineOffset)return{box:i,pos:"r"}}else if(o-this.lineOffset<t&&t<o+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"t"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"b"};if(n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}else if(n[i].x1-this.lineOffset<t&&t<n[i].x2+this.lineOffset&&n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}return{box:-1,pos:"o"}}catch(i){return console.log("ObjectDetection mouseClickOnBoxes(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),ie=(()=>{class t{constructor(){this.MEMO=null,this.utility=new _t}copy(t){this.MEMO=this.utility.deepCloneVariable(t)}paste(){return this.MEMO?"coorPt"in this.MEMO?this.polygonPaste():this.boundingBoxPaste():null}isAvailable(){return!!this.MEMO}clear(){this.MEMO=null}polygonPaste(){const t=this.utility.deepCloneObject(this.MEMO);let{coorPt:e,id:n}=t;for(const i of e)i.x+=8,i.y+=8,i.distancetoImg.x=0,i.distancetoImg.y=0;return n=this.utility.generateUniquesID(),t}boundingBoxPaste(){const t=this.utility.deepCloneObject(this.MEMO),e=t.x2-t.x1,n=t.y2-t.y1;return t.x1+=8,t.y1+=8,t.x2=t.x1+e,t.y2=t.y1+n,t.id=this.utility.generateUniquesID(),t.distancetoImg.x=0,t.distancetoImg.y=0,t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const oe={scale:1,factor:.05,max_scale:4};let ae=(()=>{class t{constructor(){this.zoomSubject=new x.a(oe),this.zoom$=this.zoomSubject.asObservable(),this.setState=t=>{this.zoomSubject.next(t?Object.assign(Object.assign({},oe),t):oe)}}resetZoomScale(){this.zoomSubject.next(oe)}calculateZoomScale(t,e,n){let{scale:i}=e;const{factor:o,max_scale:a}=e;let s=t.wheelDelta;void 0===s&&(s=t.detail),s=Math.max(-1,Math.min(1,s));const{scrollLeft:r,scrollTop:l}=n,c=(t.pageX+r)/i,h=(t.pageY+l)/i;return i+=s*o*i,i=Math.max(1,Math.min(a,i)),Object.assign(Object.assign({},{x:c*i-t.pageX,y:h*i-t.pageY}),{scale:i})}validateZoomScale({canvas:{style:{transform:t}}},e){return t!==`scale(${e}, ${e})`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const se={move:!1,pointer:!1,grab:!1,grabbing:!1,crosshair:!1,"zoom-in":!1,"zoom-out":!1,"n-resize":!1,"w-resize":!1,"ne-resize":!1,"nw-resize":!1,"se-resize":!1,"sw-resize":!1};let re=(()=>{class t{constructor(){this.mouseCursorSubject=new x.a(se),this.mouseCursor$=this.mouseCursorSubject.asObservable(),this.setState=t=>{this.mouseCursorSubject.next(t?Object.assign(Object.assign({},se),t):se)}}changeCursor(t,e){if(e){const{wheelDelta:t,detail:n}=e;void 0!==t?150===t?this.setState({"zoom-in":!0}):-150===t&&this.setState({"zoom-out":!0}):3===n?this.setState({"zoom-in":!0}):-3===n&&this.setState({"zoom-out":!0})}else for(const[n,i]of Object.entries(t))if(!0===i)return n}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const le=["canvasdrawing"],ce=["floatdiv"],he=["lbltypetxt"],de=["availablelbl"];function ue(t,e){if(1&t){const t=b.Mb();b.Lb(0,"li",12),b.Sb("click",function(){b.gc(t);const n=e.$implicit;return b.Ub().labelNameClicked(n.name)}),b.Lb(1,"span",13),b.nc(2),b.Kb(),b.Lb(3,"span",14),b.nc(4),b.Kb(),b.Kb()}if(2&t){const t=e.$implicit;b.wb(2),b.oc(t.name),b.wb(2),b.oc(t.count)}}function be(t,e){1&t&&(b.Lb(0,"li",15),b.Lb(1,"div",16),b.nc(2),b.Vb(3,"translate"),b.Kb(),b.Lb(4,"div",16),b.nc(5),b.Vb(6,"translate"),b.Kb(),b.Kb()),2&t&&(b.wb(2),b.oc(b.Wb(3,2,"searchLabel.labelNotExist")),b.wb(3),b.oc(b.Wb(6,4,"searchLabel.enterToAdd")))}const ge=function(){return{standalone:!0}},fe=function(t){return{cursor:t}};let me=(()=>{class t{constructor(t,e,n,i,o,a,s){this._boundingBoxCanvas=t,this._imgLblStateService=e,this._undoRedoService=n,this._copyPasteService=i,this._annotateSelectState=o,this._zoomService=a,this._mouseCursorService=s,this.image=new Image,this.mousedown=!1,this.unsubscribe$=new c.a,this.labelSearch="",this.labelList=[],this.allLabelList=[],this.showDropdownLabelBox=!1,this.invalidInput=!1,this.closeEnough=5,this._imgSrc="",this._tabStatus=[],this._onChangeMetadata=new b.n,this._onChangeAnnotationLabel=new b.n,this._onEnterLabel=new b.n,this.validateInputLabel=({target:t})=>{const{value:e}=t,n=e.trim();n&&(this._tabStatus.some(({label_list:t})=>t&&t.length&&t.some(t=>t===n))?(this.invalidInput=!0,console.error("Invalid existing label input")):(this.invalidInput=!1,this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:e,index:this.annotateState.annotation}),this._selectMetadata.bnd_box[this.annotateState.annotation].label=e,this._undoRedoService.isStateChange(this._selectMetadata.bnd_box)&&this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this.labelSearch=""))}}ngOnInit(){this.getLabelList(),this._imgLblStateService.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{var{clear:e,fitCenter:n}=t,i=o(t,["clear","fitCenter"]);this.boundingBoxState=Object.assign(Object.assign({},i),{clear:e,fitCenter:n}),n&&this.imgFitToCenter(),e&&(this._selectMetadata.bnd_box=[],this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this.redrawImage(this._selectMetadata),this.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{this.annotateState=t,this._boundingBoxCanvas.setCurrentSelectedbBox(t.annotation),this._selectMetadata&&this.redrawImage(this._selectMetadata)}),this._zoomService.zoom$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.zoom=t),this._mouseCursorService.mouseCursor$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.mouseCursor=t)}ngOnChanges(t){var e,n,i;if((null===(e=t._selectMetadata)||void 0===e?void 0:e.previousValue)&&(null===(n=t._selectMetadata)||void 0===n?void 0:n.currentValue)&&this.redrawImage(this._selectMetadata),(null===(i=t._imgSrc)||void 0===i?void 0:i.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this.loadImage(t._imgSrc.currentValue),this._boundingBoxCanvas.setCurrentSelectedbBox(-1)),t._tabStatus){let t=!0;for(const{closed:e}of this._tabStatus)if(!e){t=!1;break}this.canvas&&(!0===t?(this.initializeCanvas("96%"),this.imgFitToCenter()):(this.initializeCanvas(),this.imgFitToCenter()))}}initializeCanvas(t="80%"){this.canvas.nativeElement.style.width=t,this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}emitMetadata(){this._onChangeMetadata.emit(this._selectMetadata)}annotateSelectChange(t){this._annotateSelectState.setState(t)}resetZoom(){this._zoomService.resetZoomScale()}imgFitToCenter(){try{const t=this._boundingBoxCanvas.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._boundingBoxCanvas.scaleAllBoxes(t.factor,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._boundingBoxCanvas.setGlobalXY(t.newX,t.newY),this._boundingBoxCanvas.moveAllBbox(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(t){console.log(t)}}keyStrokeEvent({ctrlKey:t,shiftKey:e,key:n}){try{const{isActiveModal:i}=this.boundingBoxState;if(!this.mousedown&&!i&&!this.showDropdownLabelBox&&this._selectMetadata)if(!t||"c"!==n&&"C"!==n)if(!t||"v"!==n&&"V"!==n){if(t&&e&&("z"===n||"Z"===n)){if(this._undoRedoService.isAllowRedo()){const t=this._undoRedoService.redo();this._selectMetadata=Object(pt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}else if(!t||"z"!==n&&"Z"!==n)if(!i&&this.annotateState.annotation>-1&&("Delete"===n||"Backspace"===n))this._boundingBoxCanvas.deleteSingleBox(this._selectMetadata.bnd_box,this.annotateState.annotation,t=>{t&&(this.annotateSelectChange({annotation:-1,isDlbClick:!1}),this.redrawImage(this._selectMetadata),this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())});else{const t="ArrowLeft"===n?"left":"ArrowRight"===n?"right":"ArrowUp"===n?"up":"ArrowDown"===n&&"down";t&&this.keyMoveBox(t)}else if(this._undoRedoService.isAllowUndo()){const t=this._undoRedoService.undo();this._selectMetadata=Object(pt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}else{if(this._copyPasteService.isAvailable()){this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation]);const t=this._copyPasteService.paste();t&&this._selectMetadata.bnd_box.push(t),this.annotateSelectChange({annotation:this._selectMetadata.bnd_box.length-1,isDlbClick:!1}),this.getBBoxDistanceFromImage(),this.redrawImage(this._selectMetadata)}this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata()}else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation])}catch(i){console.log(i)}}toggleEvent(t){try{this.annotateState.annotation>-1&&(this._undoRedoService.clearRedundantStages(),this.annotateSelectChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){console.log(e)}}mouseScroll(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){const{scale:e,x:n,y:i}=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement);this.boundingBoxState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,e)&&(this.canvasContext.canvas.style.transformOrigin=`${t.offsetX}px ${t.offsetY}px`,this.canvasContext.canvas.style.transform=`scale(${e}, ${e})`,this._zoomService.setState({scale:e}))),this.canvasContext.canvas.scrollTop=i,this.canvasContext.canvas.scrollLeft=n,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(e){console.log(e)}}mouseDown(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.mousedown=!0,this.boundingBoxState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._boundingBoxCanvas.setPanXY(t.offsetX,t.offsetY)),this.boundingBoxState.draw){const e=this._boundingBoxCanvas.mouseDownDrawEnable(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.annotateSelectChange({annotation:e,isDlbClick:!1}),this.redrawImage(this._selectMetadata)}}else this.mousedown=!1}catch(e){console.log(e)}}mouseUp(t){try{this.boundingBoxState.draw&&this.mousedown&&this.finishDrawBoundingBox(t),this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)&&(this.boundingBoxState.drag&&this.mousedown&&this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.mousedown=!1)}catch(e){console.log(e)}}mouseMove(t){try{if(this._selectMetadata)if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)&&!this.showDropdownLabelBox){if(this.boundingBoxState.drag&&this.mousedown){const e=this._boundingBoxCanvas.getDiffXY(t);this._selectMetadata.img_x=e.diffX,this._selectMetadata.img_y=e.diffY,this._boundingBoxCanvas.panRectangle(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,t=>{if(t){const t=Object(pt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:t,method:"pan"}):this._undoRedoService.replaceStages({meta:t,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.boundingBoxState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.boundingBoxState.draw&&this.mousedown&&(this._boundingBoxCanvas.mouseMoveDrawEnable(t.offsetX,t.offsetY,this._selectMetadata),this.redrawImage(this._selectMetadata)),this.boundingBoxState.draw&&!this.mousedown){const{box:e,pos:n}=this._boundingBoxCanvas.getCurrentClickBox(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.changeMouseCursorState(-1!==e?"tl"===n?{"nw-resize":!0}:"tr"===n?{"ne-resize":!0}:"bl"===n?{"sw-resize":!0}:"br"===n?{"se-resize":!0}:"l"===n||"r"===n?{"w-resize":!0}:"t"===n||"b"===n?{"n-resize":!0}:{move:!0}:{crosshair:!0})}}else this.changeMouseCursorState()}catch(e){console.log(e)}}finishDrawBoundingBox(t){this.getLabelList(),this.sortingLabelList(this.labelList,this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box?this._tabStatus[2].annotation[0].bnd_box:[]);const e=this._boundingBoxCanvas.mouseUpDrawEnable(this._selectMetadata,this.labelList,t=>{t&&(this._undoRedoService.isStateChange(this._selectMetadata.bnd_box)&&this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this.getBBoxDistanceFromImage(),this.emitMetadata())});if(e.isNew||"mouseout"===t.type){let e=t.offsetY*(100/document.documentElement.clientHeight)+8.5,n=t.offsetX*(100/document.documentElement.clientWidth)+2.5;e<9&&(e=9),e>76&&(e=76),n<2.5&&(n=2.5),n>66&&(n=66),this.floatdiv.nativeElement.style.top=e.toString()+"vh",this.floatdiv.nativeElement.style.left=n.toString()+"vw",this.showDropdownLabelBox=!0,this.labelSearch="",this.invalidInput=!1,setTimeout(()=>{this.lbltypetxt.nativeElement.focus()},100)}else this.showDropdownLabelBox=!1;e.isNew&&this.annotateSelectChange({annotation:e.selBox,isDlbClick:!1})}changeMouseCursorState(t){this._mouseCursorService.setState(t)}mouseOut(t){var e,n;try{this.boundingBoxState.draw&&this.mousedown&&this.finishDrawBoundingBox(t),"canvasstyle"!==t.target.className&&!t.target.className.includes("unclosedOut")||(null===(e=t.relatedTarget)||void 0===e?void 0:e.className.includes("unclosedOut"))||(null===(n=t.relatedTarget)||void 0===n?void 0:n.className.includes("canvasstyle"))||(this.showDropdownLabelBox=!1,0!==this._selectMetadata.bnd_box.filter(t=>""===t.label).length&&(this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.filter(t=>""!==t.label),this._onChangeMetadata.emit(this._selectMetadata),this.redrawImage(this._selectMetadata),alert("Some bounding boxes will be deleted because they were not labelled."))),this.boundingBoxState.drag&&this.mousedown&&(this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata)),this.mousedown=!1}catch(i){console.log(i)}}loadImage(t){try{this.image.src=t,this.image.onload=()=>{this._selectMetadata.img_w=this._selectMetadata.img_w<1?this._selectMetadata.img_ori_w:this._selectMetadata.img_w,this._selectMetadata.img_h=this._selectMetadata.img_h<1?this._selectMetadata.img_ori_h:this._selectMetadata.img_h,this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.imgFitToCenter(),this.emitMetadata(),this.changeMouseCursorState(),this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"})}}catch(e){console.log(e)}}keyMoveBox(t){try{const e=this._selectMetadata.bnd_box[this.annotateState.annotation];e&&this._boundingBoxCanvas.keyboardMoveBox(t,e,this._selectMetadata,t=>{t&&(this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this.getBBoxDistanceFromImage(),this.redrawImage(this._selectMetadata),this.emitMetadata())})}catch(e){console.log(e)}}redrawImage({img_x:t,img_y:e,img_w:n,img_h:i}){var o;this.clearCanvas(),this.canvasContext.drawImage(this.image,t,e,n,i),0!==(null===(o=this._tabStatus[2].annotation)||void 0===o?void 0:o.length)&&(this.getLabelList(),this.sortingLabelList(this.labelList,this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box?this._tabStatus[2].annotation[0].bnd_box:[])),this._boundingBoxCanvas.drawAllBoxOn(this.labelList,this._selectMetadata.bnd_box,this.canvasContext)}clearCanvas(){this.canvasContext.clearRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height)}getBBoxDistanceFromImage(){this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y)}getLabelList(){this.labelList=[],this.allLabelList=[],(this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]).forEach(t=>{this.labelList.push({name:t,count:0}),this.allLabelList.push({name:t,count:0})})}labelTypeTextChange(t){this.labelList=this.allLabelList.filter(e=>e.name.includes(t))}labelNameClicked(t){this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:t,index:this.annotateState.annotation}),this._selectMetadata.bnd_box[this.annotateState.annotation].label=t,this._undoRedoService.isStateChange(this._selectMetadata.bnd_box)&&this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"})}sortingLabelList(t,e){t.forEach(({name:t},n)=>{this.labelList[n].count=e.filter(({label:e})=>e===t).length,this.allLabelList[n].count=e.filter(({label:e})=>e===t).length}),this.labelList.sort((t,e)=>t.count<e.count?1:e.count<t.count?-1:0),this.allLabelList.sort((t,e)=>t.count<e.count?1:e.count<t.count?-1:0)}currentCursor(){return this._mouseCursorService.changeCursor(this.mouseCursor)}ngOnDestroy(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Gb(ne),b.Gb(P),b.Gb(vt),b.Gb(ie),b.Gb(C),b.Gb(ae),b.Gb(re))},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-object-detection"]],viewQuery:function(t,e){if(1&t&&(b.sc(le,!0),b.sc(ce,!0),b.sc(he,!0),b.sc(de,!0)),2&t){let t;b.dc(t=b.Tb())&&(e.canvas=t.first),b.dc(t=b.Tb())&&(e.floatdiv=t.first),b.dc(t=b.Tb())&&(e.lbltypetxt=t.first),b.dc(t=b.Tb())&&(e.availablelbl=t.first)}},hostBindings:function(t,e){1&t&&b.Sb("keydown",function(t){return e.keyStrokeEvent(t)},!1,b.fc)("dblclick",function(t){return e.toggleEvent(t)})("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc",_tabStatus:"_tabStatus"},outputs:{_onChangeMetadata:"_onChangeMetadata",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onEnterLabel:"_onEnterLabel"},features:[b.ub],decls:13,vars:10,consts:[[1,"floatdiv","unclosedOut",3,"hidden"],["floatdiv",""],["autocomplete","off","spellcheck","false",1,"unclosedOut"],["type","text",1,"lbltypetxt","unclosedOut",3,"ngClass","ngModel","ngModelOptions","ngModelChange","keydown.enter"],["lbltypetxt",""],[1,"availablelbl","unclosedOut"],["availablelbl",""],[1,"lblList","unclosedOut"],["class","lblElement unclosedOut",3,"click",4,"ngFor","ngForOf"],["class","unclosedOut notExist",4,"ngIf"],[1,"canvasstyle",3,"ngStyle"],["canvasdrawing",""],[1,"lblElement","unclosedOut",3,"click"],[1,"lblName","unclosedOut"],[1,"lblCount","unclosedOut"],[1,"unclosedOut","notExist"],[1,"unclosedOut"]],template:function(t,e){1&t&&(b.Lb(0,"div"),b.Lb(1,"div",0,1),b.Lb(3,"form",2),b.Lb(4,"input",3,4),b.Sb("ngModelChange",function(t){return e.labelSearch=t})("ngModelChange",function(t){return e.labelTypeTextChange(t)})("keydown.enter",function(t){return e.validateInputLabel(t)}),b.Kb(),b.Kb(),b.Lb(6,"div",5,6),b.Lb(8,"ul",7),b.lc(9,ue,5,2,"li",8),b.lc(10,be,7,6,"li",9),b.Kb(),b.Kb(),b.Kb(),b.Hb(11,"canvas",10,11),b.Kb()),2&t&&(b.wb(1),b.Zb("hidden",!e.showDropdownLabelBox),b.wb(3),b.Zb("ngClass",e.invalidInput?"invalidInput":"validInput")("ngModel",e.labelSearch)("ngModelOptions",b.bc(7,ge)),b.wb(5),b.Zb("ngForOf",e.labelList),b.wb(1),b.Zb("ngIf",0===e.labelList.length),b.wb(1),b.Zb("ngStyle",b.cc(8,fe,e.currentCursor())))},directives:[yt.n,yt.g,yt.h,yt.a,i.i,yt.f,yt.i,i.j,i.k,i.l],pipes:[z.c],styles:[".canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}.floatdiv[_ngcontent-%COMP%]{position:absolute;z-index:10000}.lbltypetxt[_ngcontent-%COMP%]{height:4vh;border-radius:.2vh;border:.2vw solid grey;border-bottom:none;padding:0;text-indent:.4vw}.availablelbl[_ngcontent-%COMP%], .lbltypetxt[_ngcontent-%COMP%]{width:11vw;color:snow;font-size:2vh;background-color:#000;outline:none}.availablelbl[_ngcontent-%COMP%]{height:15vh;font-weight:700;border-radius:.2vh;border:.2vw solid grey;border-top:.1vh dotted snow;overflow:auto;scrollbar-width:none}.availablelbl[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.lblList[_ngcontent-%COMP%]{padding:0 .2vw}.lblElement[_ngcontent-%COMP%]{list-style-type:none;margin:.3vh 0;padding:0;justify-content:space-between;display:flex}.lblElement[_ngcontent-%COMP%]:hover{background-color:#111}.lblName[_ngcontent-%COMP%]{margin-left:.2vw;overflow:hidden;text-overflow:ellipsis}.lblCount[_ngcontent-%COMP%]{background-color:#222;margin-right:.2vw;padding:.1vh .2vw;border-radius:.2vw}.notExist[_ngcontent-%COMP%]{color:#999;font-size:1.5vh}.invalidInput[_ngcontent-%COMP%]{border:.2vw solid red}.validInput[_ngcontent-%COMP%]{border:.2vw solid grey}"],changeDetection:0}),t})(),pe=(()=>{class t{constructor(){this.globalXY={x:-1,y:-1},this.panXY={x:0,y:0},this.clickPoint={polygonIndex:-1,pointIndex:-1},this.clipPath=null,this.radius=3.5,this.distanceOffset=8,this.polygonAreaIndex=-1,this.selectedPolygonIndex=-1,this.util=new _t,this.isNewPoly=!1}mouseDownDraw(t,e,n,i,o,a,s){const{offsetX:r,offsetY:l}=t;this.polygonAreaIndex=this.findPolygonArea(t,e),this.clickPoint=this.findClickPoint(r,l,e);const c=this.isNewPolygon();return c&&a?this.setPanXY(t):!this.returnTempPoly()&&this.polygonAreaIndex<0&&this.clickPoint.pointIndex<0?(this.setPolygonLineWidth(e,-1),this.selectedPolygonIndex=-1,this.pushTempPoint(t,e),this.setNewPolygon(!0)):c?(this.pushTempPoint(t,e),this.drawNewPolygon(e,i,o,n,!1),this.drawfromPreviousPoint(t,o)):(this.selectedPolygonIndex=this.findPolygonArea(t,e)>-1?this.findPolygonArea(t,e):this.findClickPoint(r,l,e).polygonIndex,this.setPolygonLineWidth(e,this.selectedPolygonIndex),this.setNewPolygon(!1)),this.selectedPolygonIndex}mouseMoveDraw(t,e,n,i,o,a,s,r){const l=this.findPolygonArea(o,t),c=this.isNewPolygon(),{pointIndex:h,polygonIndex:d}=this.clickPoint;if(c&&s&&a){const{diffX:e,diffY:n}=this.getDiffXY(o);t.img_x=e,t.img_y=n,this.panPolygons(t,!0),r("pan")}else c?(this.drawNewPolygon(t,e,n,i,!1),this.drawfromPreviousPoint(o,n)):s&&-1===h&&this.selectedPolygonIndex>-1?(this.mouseMovePolygon(o,t,n,this.selectedPolygonIndex,e,i),this.resetClipPath(t),r("pan")):s&&h>-1&&d>-1&&(this.setPolygonCoordinate(o,t,this.clickPoint),r("draw"));return l>-1}setPanXY({offsetX:t,offsetY:e}){try{this.panXY={x:t,y:e}}catch(n){console.log("setPanXY",n)}}getPanXY(){return this.panXY}getDiffXY({offsetX:t,offsetY:e}){try{const n={diffX:0,diffY:0},{x:i,y:o}=this.getGlobalXY();return n.diffX=i+(t-this.panXY.x),n.diffY=o+(e-this.panXY.y),n}catch(n){return console.log(n),{diffX:-1,diffY:-1}}}setSelectedPolygon(t,e){this.selectedPolygonIndex=t,e&&this.setPolygonLineWidth(e,this.selectedPolygonIndex)}getSelectedPolygonIndex(){return this.selectedPolygonIndex}mouseClickWithinPointPath({img_x:t,img_y:e,img_w:n,img_h:i},{offsetX:o,offsetY:a}){return o>t&&o<t+n&&a>e&&a<e+i}calScaleToFitScreen({img_w:t,img_h:e},{offsetWidth:n,offsetHeight:i}){try{const o={factor:-1,newX:-1,newY:-1},a=Math.min(n/t,i/e);return o.factor=a-.05*a,o.newX=n/2-t/2*o.factor,o.newY=i/2-e/2*o.factor,o}catch(o){return console.log("calScaleToFitScreen",o),{factor:-1,newX:-1,newY:-1}}}pushTempPoint({offsetX:t,offsetY:e},{img_x:n,img_y:i,polygons:o}){try{const a=t-n,s=e-i,r=o.length;!this.tmpPolygon&&this.generateNewTempPolygon(r),this.tmpPolygon.coorPt.push({x:t,y:e,distancetoImg:{x:a,y:s}})}catch(a){console.log("pushTempPoint",a)}}removeLastPoint(t,e,n,i){var o;try{return(null===(o=this.tmpPolygon)||void 0===o?void 0:o.coorPt)&&this.tmpPolygon.coorPt.length>1?(this.tmpPolygon.coorPt.pop(),!1):(this.resetDrawing(t,n,e,i),!0)}catch(a){return console.log("removeLastPoint",a),!1}}calculatePointDistance(t,e,n,i){try{const o=t-n,a=e-i;return Math.sqrt(o*o+a*a)}catch(o){return void console.log("calculatePointDistance",o)}}generateNewTempPolygon(t){try{const e=this.util.generateUniquesID(),n=(t+1).toString();this.tmpPolygon={coorPt:[],label:"default",id:e,lineWidth:2,color:"#FFFAFA",region:n,subLabel:[]}}catch(e){console.log("generateNewTempPolygon",e)}}getClickPoint(){return this.clickPoint}resetClickPoint(){this.clickPoint={pointIndex:-1,polygonIndex:-1}}resetDrawing(t,e,n,i){try{this.tmpPolygon=null,this.setNewPolygon(!1),this.redraw(t,e,n,i,-1)}catch(o){console.log("resetDrawing",o)}}setNewPolygon(t){this.isNewPoly=t}redraw(t,e,n,{width:i,height:o},a){try{const{img_w:s,img_h:r,img_x:l,img_y:c}=t;n.restore(),n.clearRect(0,0,i,o),n.save(),n.beginPath(),n.rect(l,c,s,r),n.clip(),n.beginPath(),n.drawImage(e,l,c,s,r),this.drawAllPolygon(t,n,a)}catch(s){console.log("redraw",s)}}drawAllPolygon(t,e,n){try{this.validatePolygonMetadata(t.polygons)&&(this.drawAllPolygonLine(t,e),this.drawAllPolygonsDots(t,e,n,this.radius),this.plotAllFloatLabel(t,e))}catch(i){console.log("drawAllPolygon",i)}}validatePolygonMetadata(t){return t.length>0}drawAllPolygonLine({polygons:t},e){try{for(const[n,{lineWidth:i,color:o,coorPt:a}]of t.entries()){e.lineWidth=i,e.strokeStyle=o||"white",e.fillStyle=o||"white",e.beginPath(),e.moveTo(a[0].x,a[0].y);for(const[t]of a.entries())t+1<a.length&&e.lineTo(a[t+1].x,a[t+1].y);e.closePath(),e.stroke()}}catch(n){console.log("drawAllPolygonLine",n)}}drawAllPolygonsDots({polygons:t},e,n,i){try{for(const[o,{coorPt:a}]of t.entries())if(n===o){e.strokeStyle="green",e.fillStyle="green";for(const[t]of a.entries())e.beginPath(),e.arc(a[t].x,a[t].y,i,0,2*Math.PI),e.fill(),e.closePath(),e.stroke()}}catch(o){console.log("drawAllPolygonsDots",o)}}plotAllFloatLabel({polygons:t},e){try{t.forEach(({label:t,coorPt:n})=>{const{x:i,y:o}=n[0];e.strokeStyle="white",e.fillStyle="black",e.font="bold 12px Arial",e.strokeText(t,i+10,o+15),e.fillText(t,i+10,o+15)})}catch(n){console.log("plotAllFloatLabel",n)}}setGlobalXY({offsetX:t,offsetY:e}){try{this.globalXY={x:t,y:e}}catch(n){console.log("setGlobalXY",n)}}getGlobalXY(){return this.globalXY}mouseMovePolygon({offsetX:t,offsetY:e},n,i,o,a,s){try{const{x:r,y:l}=this.getGlobalXY(),c=t-r,h=e-l;if(this.withinPointPath(n,o,{offsetX:c,offsetY:h})){this.setGlobalXY({offsetX:t,offsetY:e});for(const[t]of n.polygons[o].coorPt.entries())n.polygons[o].coorPt[t].x+=c,n.polygons[o].coorPt[t].y+=h;this.redraw(n,a,i,s,o)}}catch(r){console.log("mouseMovePolygon",r)}}keyboardMovePolygon(t,e,n,i,o,a,s){try{if(n>-1){const r=-3;switch(e){case"up":if(this.withinPointPath(t,n,{offsetX:0,offsetY:r}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].y+=r;break;case"down":if(this.withinPointPath(t,n,{offsetX:0,offsetY:r}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].y-=r;break;case"left":if(this.withinPointPath(t,n,{offsetX:r,offsetY:0}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].x+=r;break;case"right":if(this.withinPointPath(t,n,{offsetX:r,offsetY:0}))for(const[e]of t.polygons[n].coorPt.entries())t.polygons[n].coorPt[e].x-=r}this.redraw(t,i,o,a,n),s(!0)}return!0}catch(r){return console.log("keyboardMovePolygon",r),!0}}withinPointPath({polygons:t,img_x:e,img_y:n,img_w:i,img_h:o},a,{offsetX:s,offsetY:r}){try{for(const[l]of t[a].coorPt.entries())return!(t[a].coorPt[l].x+s<e||t[a].coorPt[l].x+s>e+i||t[a].coorPt[l].y+r<n||t[a].coorPt[l].y+r>n+o)}catch(l){return!1}}validateXYDistance(t){try{for(const[e]of t.polygons.entries())for(const[n]of t.polygons[e].coorPt.entries()){const i=t.polygons[e].coorPt[n].y-t.img_y;t.polygons[e].coorPt[n].distancetoImg.x=t.polygons[e].coorPt[n].x-t.img_x,t.polygons[e].coorPt[n].distancetoImg.y=i}}catch(e){console.log("validateXYDistance",e)}}setPolygonLineWidth(t,e){try{t.polygons=t.polygons.map((t,n)=>Object.assign(Object.assign({},t),{lineWidth:t.lineWidth=n===e?2:1}))}catch(n){console.log("setPolygonLineWidth",n)}}drawNewPolygon(t,e,n,i,o){var a;try{if(this.redraw(t,e,n,i,-1),null===(a=this.tmpPolygon)||void 0===a?void 0:a.coorPt){for(const[t,{x:e,y:i}]of this.tmpPolygon.coorPt.entries())n.strokeStyle="green",n.fillStyle="green",n.beginPath(),n.arc(e,i,this.radius,0,2*Math.PI),n.fill(),n.closePath(),n.stroke();n.beginPath(),n.lineWidth=this.tmpPolygon.lineWidth,n.strokeStyle=this.tmpPolygon.color,n.fillStyle=this.tmpPolygon.color,n.moveTo(this.tmpPolygon.coorPt[0].x,this.tmpPolygon.coorPt[0].y);for(const[t]of this.tmpPolygon.coorPt.entries())t+1<this.tmpPolygon.coorPt.length&&n.lineTo(this.tmpPolygon.coorPt[t+1].x,this.tmpPolygon.coorPt[t+1].y);if(o){n.closePath(),n.stroke();const{length:e}=t.polygons;this.tmpPolygon&&(t.polygons.push(Object(pt.a)(this.tmpPolygon)),this.setPolygonLineWidth(t,e-1),this.tmpPolygon=null),this.setNewPolygon(!1)}else n.stroke()}}catch(s){console.log("drawNewPolygon",s)}}drawfromPreviousPoint({offsetX:t,offsetY:e},n){var i;try{if(null===(i=this.tmpPolygon)||void 0===i?void 0:i.coorPt){const{length:i}=this.tmpPolygon.coorPt,o=i-1;n.beginPath(),n.moveTo(this.tmpPolygon.coorPt[o].x,this.tmpPolygon.coorPt[o].y),n.lineTo(t,e),n.stroke()}}catch(o){console.log("drawfromPreviousPoint",o)}}returnTempPoly(){try{return this.tmpPolygon}catch(t){return console.log("returnTempPoly",t),null}}setPolygonCoordinate({offsetX:t,offsetY:e},n,{polygonIndex:i,pointIndex:o}){try{i>-1&&o>-1&&(n.polygons[i].coorPt[o].x=t,n.polygons[i].coorPt[o].y=e)}catch(a){console.log("setPolygonCoordinate",a)}}insidePolygonArea(t,{offsetX:e,offsetY:n}){try{let i=!1;for(let o=0,a=t.length-1;o<t.length;a=o++)t[o].y>n!=t[a].y>n&&e<(t[a].x-t[o].x)*(n-t[o].y)/(t[a].y-t[o].y)+t[o].x&&(i=!i);return i}catch(i){return console.log("insidePolygonArea",i),!1}}calPolygonArea({coorPt:t}){try{let e=0,n=t.length-1;for(let i=0;i<t.length;++i)e+=(t[n].x+t[i].x)*(t[n].y-t[i].y),n=i;return Math.abs(e/2)}catch(e){return console.log("calPolygonArea",e),-1}}findPolygonArea(t,{polygons:e}){try{let n=-1,i=1e7;for(const[o,a]of e.entries())if(this.insidePolygonArea(a.coorPt,t)){const t=this.calPolygonArea(a);t<i&&(n=o,i=t)}return n}catch(n){return console.log("findPolygonArea",n),-1}}findClickPoint(t,e,n){try{let i;const o={polygonIndex:-1,pointIndex:-1};for(let a=0;a<n.polygons.length;++a)for(let s=0;s<n.polygons[a].coorPt.length;++s)if(i=Math.sqrt(Math.pow(t-n.polygons[a].coorPt[s].x,2)+Math.pow(e-n.polygons[a].coorPt[s].y,2)),i<=this.radius){o.polygonIndex=a,o.pointIndex=s;break}return o}catch(i){return console.log("findClickPoint",i),{polygonIndex:-1,pointIndex:-1}}}isNewPolygon(){try{return this.isNewPoly}catch(t){return console.log("isNewPolygon",t),!1}}deleteSinglePolygon(t,e,n){try{t.polygons.splice(e,1),this.selectedPolygonIndex=-1,n(!0)}catch(i){console.log("deleteSinglePolygon",i)}}scalePolygons(t,{factor:e,newX:n,newY:i},o){try{for(const[o]of t.polygons.entries())for(const[a]of t.polygons[o].coorPt.entries())t.polygons[o].coorPt[a].x=t.polygons[o].coorPt[a].distancetoImg.x*e+n,t.polygons[o].coorPt[a].y=t.polygons[o].coorPt[a].distancetoImg.y*e+i,t.polygons[o].coorPt[a].distancetoImg.x=t.polygons[o].coorPt[a].x-n,t.polygons[o].coorPt[a].distancetoImg.y=t.polygons[o].coorPt[a].y-i;this.setPolygonLineWidth(t,-1),o&&o(!0)}catch(a){console.log("scalePolygons",a)}}panPolygons(t,e,n){var i;try{if(e&&(null===(i=this.tmpPolygon)||void 0===i?void 0:i.coorPt))for(const[e]of this.tmpPolygon.coorPt.entries())this.tmpPolygon.coorPt[e].x=t.img_x+this.tmpPolygon.coorPt[e].distancetoImg.x,this.tmpPolygon.coorPt[e].y=t.img_y+this.tmpPolygon.coorPt[e].distancetoImg.y;for(const[e]of t.polygons.entries())for(const[n]of t.polygons[e].coorPt.entries())t.polygons[e].coorPt[n].x=t.img_x+t.polygons[e].coorPt[n].distancetoImg.x,t.polygons[e].coorPt[n].y=t.img_y+t.polygons[e].coorPt[n].distancetoImg.y;n&&n(!0)}catch(o){console.log("panPolygons",o)}}resetClipPath({img_x:t,img_y:e,img_w:n,img_h:i}){try{this.clipPath=null,this.clipPath=new Path2D,this.clipPath.rect(t,e,n,i)}catch(o){console.log(o)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=b.Cb({token:t,factory:t.\u0275fac,providedIn:"any"}),t})();const _e=["canvasdrawing"],ve=function(t){return{cursor:t}};let we=(()=>{class t{constructor(t,e,n,i,o,a,s){this._segCanvasService=t,this._imgLblStateService=e,this._undoRedoService=n,this._copyPasteService=i,this._annotateSelectState=o,this._zoomService=a,this._mouseCursorService=s,this.image=new Image,this.isMouseWithinPoint=!1,this.altKey=!1,this.ctrlKey=!1,this.unsubscribe$=new c.a,this.mousedown=!1,this._imgSrc="",this._onChangeMetadata=new b.n}ngOnInit(){this._imgLblStateService.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{var{clear:e,fitCenter:n}=t,i=o(t,["clear","fitCenter"]);this.segState=Object.assign(Object.assign({},i),{clear:e,fitCenter:n}),n&&this.imgFitToCenter(),e&&(this._selectMetadata.polygons=[],this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this.redrawImage(this._selectMetadata),this.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>{this.annotateState=t,this._selectMetadata&&(this._segCanvasService.setSelectedPolygon(t.annotation,this._selectMetadata),this.redrawImage(this._selectMetadata))}),this._zoomService.zoom$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.zoom=t),this._mouseCursorService.mouseCursor$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(t=>this.mouseCursor=t)}ngOnChanges(t){var e;(null===(e=t._imgSrc)||void 0===e?void 0:e.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this._segCanvasService.setSelectedPolygon(-1),this.loadImage(t._imgSrc.currentValue))}initializeCanvas(){this.canvas.nativeElement.style.width="80%",this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}loadImage(t){this.image.src=t,this.image.onload=()=>{const{img_x:t,img_y:e}=this._selectMetadata;this._selectMetadata.img_w=this._selectMetadata.img_w<1?this._selectMetadata.img_ori_w:this._selectMetadata.img_w,this._selectMetadata.img_h=this._selectMetadata.img_h<1?this._selectMetadata.img_ori_h:this._selectMetadata.img_h,this._segCanvasService.setGlobalXY({offsetX:t,offsetY:e}),this.imgFitToCenter(),this.emitMetadata(),this.changeMouseCursorState(),this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"})}}emitMetadata(){this._onChangeMetadata.emit(this._selectMetadata)}annotateStateChange(t){t&&this._annotateSelectState.setState(t)}resetZoom(){this._zoomService.resetZoomScale()}imgFitToCenter(){try{const t=this._segCanvasService.calScaleToFitScreen(this._selectMetadata,this.canvas.nativeElement);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._segCanvasService.scalePolygons(this._selectMetadata,t),this._segCanvasService.setGlobalXY({offsetX:t.newX,offsetY:t.newY}),this._segCanvasService.panPolygons(this._selectMetadata,!1,t=>{if(t){const t=Object(pt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:t,method:"zoom"}):this._undoRedoService.replaceStages({meta:t,method:"zoom"})}}),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(t){console.log("imgFitToCenter",t)}}redrawImage({img_x:t,img_y:e,img_w:n,img_h:i}){this.clearcanvas(),this.canvasContext.drawImage(this.image,t,e,n,i),this._segCanvasService.drawAllPolygon(this._selectMetadata,this.canvasContext,this.annotateState.annotation)}clearcanvas(){const{width:t,height:e}=this.canvas.nativeElement;this.canvasContext.clearRect(0,0,t,e)}mouseScroll(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){const{scale:e,x:n,y:i}=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement);this.segState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,e)&&(this.canvasContext.canvas.style.transformOrigin=`${t.offsetX}px ${t.offsetY}px`,this.canvasContext.canvas.style.transform=`scale(${e}, ${e})`,this._zoomService.setState({scale:e}))),this.canvasContext.canvas.scrollTop=i,this.canvasContext.canvas.scrollLeft=n,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(e){console.log("mouseScroll",e)}}validateEndDrawPolygon({isActiveModal:t,draw:e},n,i){return!t&&e&&n&&"none"!==i.canvas.style.pointerEvents}canvasDblClickEvent(t){this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)&&(this._segCanvasService.isNewPolygon()&&(this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()),this.annotateState.annotation>-1&&this.annotateStateChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}canvasKeyDownEvent({ctrlKey:t,shiftKey:e,key:n}){try{if(this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)){if(this._segCanvasService.isNewPolygon())switch(n){case"Enter":this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata();break;case"Escape":this._segCanvasService.resetDrawing(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement)}else switch(n){case"Delete":case"Backspace":this._segCanvasService.deleteSinglePolygon(this._selectMetadata,this.annotateState.annotation,t=>{t&&(this.annotateStateChange(),this.redrawImage(this._selectMetadata),this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata())})}const t="ArrowLeft"===n?"left":"ArrowRight"===n?"right":"ArrowUp"===n?"up":"ArrowDown"===n&&"down";t&&this.keyMoveBox(t)}if(!this.isMouseWithinPoint)if(!t||"c"!==n&&"C"!==n)if(!t||"v"!==n&&"V"!==n){if(t&&e&&("z"===n||"Z"===n)){if(this._undoRedoService.isAllowRedo()){const t=this._undoRedoService.redo();this._selectMetadata=Object(pt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else if(t&&("z"===n||"Z"===n)&&this._undoRedoService.isAllowUndo()){const t=this._undoRedoService.undo();this._selectMetadata=Object(pt.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else this._copyPasteService.isAvailable()&&(this._selectMetadata.polygons.push(this._copyPasteService.paste()),this.annotateStateChange({annotation:this._selectMetadata.polygons.length-1}),this._segCanvasService.validateXYDistance(this._selectMetadata)),this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata();else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.polygons[this.annotateState.annotation])}catch(i){console.log("canvasKeyDownEvent",i)}}keyMoveBox(t){try{this._selectMetadata.polygons[this.annotateState.annotation]&&this._segCanvasService.keyboardMovePolygon(this._selectMetadata,t,this.annotateState.annotation,this.image,this.canvasContext,this.canvas.nativeElement,t=>{t&&(this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())})}catch(e){console.log("keyMoveBox",e)}}mouseDown(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint)if(this.mousedown=!0,this.segState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._segCanvasService.setPanXY(t),this.initializeCanvas(),this.redrawImage(this._selectMetadata)),this.segState.draw){const e=this._segCanvasService.mouseDownDraw(t,this._selectMetadata,this.canvas.nativeElement,this.image,this.canvasContext,this.ctrlKey,this.altKey);if(e>-1)this._segCanvasService.setGlobalXY(t);else{const{img_x:t,img_y:e}=this._selectMetadata;this._segCanvasService.setGlobalXY({offsetX:t,offsetY:e})}this.annotateStateChange({annotation:e}),this.redrawImage(this._selectMetadata),this.mouseMoveDrawCanvas(t)}else this.segState.draw&&!this.mousedown&&this.redrawImage(this._selectMetadata);else this.mousedown=!1}catch(e){console.log("mouseDown",e)}}mouseUp(t){try{this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t);const e=this._segCanvasService.isNewPolygon();if(this._selectMetadata&&this.isMouseWithinPoint)if(this.mousedown){const{img_x:t,img_y:n}=this._selectMetadata;this.segState.drag&&this._segCanvasService.setGlobalXY({offsetX:t,offsetY:n}),this.segState.draw&&!e&&this.annotateState.annotation>-1&&this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.setGlobalXY({offsetX:t,offsetY:n}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}else{const{pointIndex:t,polygonIndex:e}=this._segCanvasService.getClickPoint();this.segState.draw&&e>-1&&t>-1?this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(pt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.resetClickPoint(),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()):this.segState.draw&&(this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}this.mousedown=!1}catch(e){console.log("mouseUp",e)}}mouseMove(t){try{if(this.isMouseWithinPoint=this._selectMetadata&&this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){if(this.segState.drag&&this.mousedown){const{diffX:e,diffY:n}=this._segCanvasService.getDiffXY(t);this._selectMetadata.img_x=e,this._selectMetadata.img_y=n,this._segCanvasService.panPolygons(this._selectMetadata,!1,t=>{if(t){const t=Object(pt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:t,method:"pan"}):this._undoRedoService.replaceStages({meta:t,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.segState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.segState.draw){const e=this.mouseMoveDrawCanvas(t);this.changeMouseCursorState(e?{move:!0}:{crosshair:!0})}}else this.changeMouseCursorState(),this.mousedown=!1}catch(e){console.log("mouseMove",e)}}mouseMoveDrawCanvas(t){return this._segCanvasService.mouseMoveDraw(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,t,this.ctrlKey,this.mousedown,t=>{this.redrawImage(this._selectMetadata)})}changeMouseCursorState(t){this._mouseCursorService.setState(t)}mouseOut(t){try{this.segState.drag&&this.isMouseWithinPoint&&this.mousedown&&(this._segCanvasService.setGlobalXY(t),this.redrawImage(this._selectMetadata)),this.isMouseWithinPoint=!1}catch(e){console.log("mouseOut",e)}}currentCursor(){return this._mouseCursorService.changeCursor(this.mouseCursor)}ngOnDestroy(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}return t.\u0275fac=function(e){return new(e||t)(b.Gb(pe),b.Gb(P),b.Gb(vt),b.Gb(ie),b.Gb(C),b.Gb(ae),b.Gb(re))},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-segmentation"]],viewQuery:function(t,e){if(1&t&&b.sc(_e,!0),2&t){let t;b.dc(t=b.Tb())&&(e.canvas=t.first)}},hostBindings:function(t,e){1&t&&b.Sb("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("dblclick",function(t){return e.canvasDblClickEvent(t)})("keydown",function(t){return e.canvasKeyDownEvent(t)},!1,b.fc)("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[b.ub],decls:3,vars:3,consts:[[1,"canvasstyle",3,"ngStyle"],["canvasdrawing",""]],template:function(t,e){1&t&&(b.Lb(0,"div"),b.Hb(1,"canvas",0,1),b.Kb()),2&t&&(b.wb(1),b.Zb("ngStyle",b.cc(1,ve,e.currentCursor())))},directives:[i.l],styles:[".canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}"],changeDetection:0}),t})();const ye=["subLabelSelect"];function xe(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"image-labelling-object-detection",47),b.Sb("_onChangeMetadata",function(e){return b.gc(t),b.Ub().onChangeMetadata(e)})("_onChangeAnnotationLabel",function(e){return b.gc(t),b.Ub().onChangeAnnotationLabel(e)})("_onEnterLabel",function(e){return b.gc(t),b.Ub().onProcessLabel(e)}),b.Kb(),b.Ib()}if(2&t){const t=b.Ub();b.wb(1),b.Zb("_selectMetadata",t.selectedMetaData)("_imgSrc",t.imgSrc)("_tabStatus",t.tabStatus)}}function Se(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"image-labelling-segmentation",48),b.Sb("_onChangeMetadata",function(e){return b.gc(t),b.Ub().onChangeMetadata(e)}),b.Kb(),b.Ib()}if(2&t){const t=b.Ub();b.wb(1),b.Zb("_selectMetadata",t.selectedMetaData)("_imgSrc",t.imgSrc)}}function Ce(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",49),b.Lb(2,"label",50),b.Lb(3,"input",51),b.Sb("change",function(){return b.gc(t),b.Ub().onSwitchSaveType()}),b.Kb(),b.Hb(4,"span",52),b.Lb(5,"p"),b.nc(6),b.Vb(7,"translate"),b.Kb(),b.Kb(),b.Hb(8,"span",53),b.Lb(9,"label",50),b.Lb(10,"input",51),b.Sb("change",function(){return b.gc(t),b.Ub().onSwitchSaveType()}),b.Kb(),b.Hb(11,"span",52),b.Lb(12,"p"),b.nc(13),b.Vb(14,"translate"),b.Kb(),b.Kb(),b.Kb(),b.Lb(15,"div",54),b.Sb("click",function(){return b.gc(t),b.Ub().showAdvSettings()}),b.nc(16),b.Vb(17,"translate"),b.Kb(),b.Lb(18,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("pascalVoc")}),b.nc(19,"Pascal VOC"),b.Kb(),b.Hb(20,"br"),b.Lb(21,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("yolo")}),b.nc(22,"YOLO"),b.Kb(),b.Hb(23,"br"),b.Lb(24,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("ocr")}),b.nc(25,"Text OCR"),b.Kb(),b.Hb(26,"br"),b.Lb(27,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("label")}),b.nc(28,"Label"),b.Kb(),b.Hb(29,"br"),b.Ib()}if(2&t){const t=b.Ub();b.wb(3),b.Zb("checked",t.saveType.saveCurrentImage),b.wb(3),b.oc(b.Wb(7,5,"singleSave")),b.wb(4),b.Zb("checked",t.saveType.saveBulk),b.wb(3),b.oc(b.Wb(14,7,"bulkSave")),b.wb(3),b.oc(b.Wb(17,9,"advModal.title"))}}function ke(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("coco")}),b.nc(2,"COCO"),b.Kb(),b.Hb(3,"br"),b.Lb(4,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("json")}),b.nc(5,"JSON"),b.Kb(),b.Hb(6,"br"),b.Lb(7,"button",55),b.Sb("click",function(){return b.gc(t),b.Ub().onClickDownload("label")}),b.nc(8,"Label"),b.Kb(),b.Hb(9,"br"),b.Ib()}}function Pe(t,e){1&t&&(b.Lb(0,"p",56),b.nc(1),b.Vb(2,"translate"),b.Kb()),2&t&&(b.wb(1),b.pc(" ",b.Wb(2,1,"advModal.instructionText")," "))}function Oe(t,e){if(1&t&&(b.Lb(0,"div",57),b.Lb(1,"label",58),b.Lb(2,"input",51),b.Sb("change",function(){const t=e.$implicit;return t.isChoosen=!t.isChoosen}),b.Kb(),b.Hb(3,"span",52),b.Kb(),b.Lb(4,"label",59),b.nc(5),b.Kb(),b.Kb()),2&t){const t=e.$implicit;b.wb(2),b.Zb("checked",t.isChoosen),b.wb(3),b.oc(t.label)}}function Me(t,e){1&t&&(b.Lb(0,"div"),b.nc(1),b.Vb(2,"translate"),b.Kb()),2&t&&(b.wb(1),b.pc(" ",b.Wb(2,1,"advModal.noLabel")," "))}function Le(t,e){if(1&t){const t=b.Mb();b.Lb(0,"button",60),b.Sb("click",function(){return b.gc(t),b.Ub().saveAdvSettings()}),b.nc(1),b.Vb(2,"translate"),b.Kb()}2&t&&(b.wb(1),b.pc(" ",b.Wb(2,1,"advModal.btnSave")," "))}function Ie(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"option",61),b.nc(2),b.Kb(),b.Ib()),2&t){const t=e.$implicit,n=b.Ub(2);b.wb(1),b.Zb("value",t)("selected",t===n.currentAnnotationLabel),b.wb(1),b.pc(" ",t," ")}}function Ae(t,e){if(1&t&&(b.Jb(0),b.lc(1,Ie,3,3,"ng-container",23),b.Ib()),2&t){const t=e.$implicit;b.wb(1),b.Zb("ngForOf",t.label_list)}}function je(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"option",61),b.nc(2),b.Kb(),b.Ib()),2&t){const t=e.$implicit,n=b.Ub().$implicit;b.wb(1),b.Zb("value",t)("selected",n.label_list[0].label),b.wb(1),b.pc(" ",t," ")}}function Be(t,e){if(1&t&&(b.Jb(0),b.lc(1,je,3,3,"ng-container",23),b.Ib()),2&t){const t=e.$implicit;b.wb(1),b.Zb("ngForOf",t.label_list)}}function Ee(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"div",62),b.nc(2),b.Kb(),b.Ib()),2&t){const t=b.Ub();b.wb(2),b.pc(" ",t.subLabelValidateMsg," ")}}function ze(t,e){if(1&t){const t=b.Mb();b.Jb(0),b.Lb(1,"div",63),b.Lb(2,"label",64),b.nc(3),b.Vb(4,"translate"),b.Kb(),b.Lb(5,"label",65),b.nc(6),b.Vb(7,"translate"),b.Kb(),b.Hb(8,"span",66),b.Lb(9,"button",67),b.Sb("click",function(){b.gc(t);const n=e.index,i=b.Ub(2).index;return b.Ub(3).onRemoveSubLabel(i,n)}),b.nc(10," X "),b.Kb(),b.Kb(),b.Ib()}if(2&t){const t=e.$implicit;b.wb(3),b.qc("",b.Wb(4,4,"labellingArea.label"),": ",t.label,""),b.wb(3),b.qc("",b.Wb(7,6,"labellingArea.regionInfo"),": ",t.region,"")}}function Te(t,e){if(1&t&&(b.Jb(0),b.Lb(1,"h2",19),b.nc(2),b.Vb(3,"translate"),b.Kb(),b.lc(4,ze,11,8,"ng-container",23),b.Ib()),2&t){const t=b.Ub().$implicit;b.wb(2),b.oc(b.Wb(3,2,"labellingArea.addedSubLabel")),b.wb(2),b.Zb("ngForOf",t.subLabel)}}function De(t,e){if(1&t&&(b.Jb(0),b.lc(1,Te,5,4,"ng-container",5),b.Ib()),2&t){const t=e.$implicit,n=e.index,i=b.Ub(3);b.wb(1),b.Zb("ngIf",(null==t||null==t.subLabel?null:t.subLabel.length)>0&&n===i.currentAnnotationIndex)}}function Re(t,e){if(1&t&&(b.Jb(0),b.lc(1,De,2,1,"ng-container",23),b.Ib()),2&t){const t=e.$implicit;b.wb(1),b.Zb("ngForOf",null==t?null:t.bnd_box)}}function Ne(t,e){if(1&t&&(b.Jb(0),b.lc(1,Re,2,1,"ng-container",23),b.Ib()),2&t){const t=e.$implicit;b.wb(1),b.Zb("ngForOf",t.annotation)}}function Ue(t,e){if(1&t&&(b.Lb(0,"tr"),b.Hb(1,"td",68),b.Vb(2,"translate"),b.Hb(3,"td",68),b.Vb(4,"translate"),b.Kb()),2&t){const t=e.$implicit;b.wb(1),b.ac("innerHTML",b.Wb(2,2,t.shortcutKey),b.hc),b.wb(2),b.ac("innerHTML",b.Wb(4,4,t.functionality),b.hc)}}function Fe(t,e){if(1&t&&(b.Lb(0,"p"),b.nc(1),b.Vb(2,"translate"),b.Kb()),2&t){const t=b.Ub();b.wb(1),b.qc("",b.Wb(2,2,"location"),"",t.modalSpanLocationPath,"")}}const Ke=[{path:"",component:(()=>{class t{constructor(t,e,n,i,b,g,f,m,p,_,v){this._router=t,this._imgLblApiService=e,this._modalService=n,this._dataSetService=i,this._annotateService=b,this._imgLblActionService=g,this._imgLblLayoutService=f,this._imgLblModeService=m,this._languageService=p,this._spinnerService=_,this._exportSaveFormatService=v,this.currentUrl="",this.selectedProjectName="",this.imgSrc="",this.loading=!1,this.thumbnailList=[],this.unsubscribe$=new c.a,this.subject$=new c.a,this.tabStatus=[{name:"labellingProject.project",closed:!1},{name:"labellingProject.label",closed:!1,label_list:[]},{name:"labellingProject.annotation",closed:!1,annotation:[]}],this.mainLabelRegionVal="",this.subLabelRegionVal="",this.subLabelValidateMsg="",this.currentAnnotationLabel="",this.currentAnnotationIndex=-1,this.currentImageDisplayIndex=-1,this.isLoading=!1,this.showLoading=!1,this.processingNum=0,this.spanClass="",this.modalSpanMessage="",this.modalSpanLocationPath="",this.sliceNum=0,this.labelList=[],this.isOverlayOn=!1,this.blockLoadThumbnails=!1,this.totalUuid=0,this.labelChoosen=[],this.tempLabelChoosen=[],this.modalExportOptions="modal-export-options",this.modalExportProject="modal-export-project",this.modalShortcutKeyInfo="modal-shortcut-key-info",this.exportModalBodyStyle={minHeight:"19vh",maxHeight:"19vh",minWidth:"17vw",maxWidth:"17vw",margin:"15vw 71vh",overflow:"none"},this.saveModalBodyStyle={maxHeight:"80vh",minWidth:"28vw",maxWidth:"28vw",margin:"10vh 28vw",overflow:"none"},this.advModalBodyStyle={maxHeight:"80vh",minWidth:"18vw",maxWidth:"18vw",margin:"10vh 28vw",overflow:"none"},this.infoModalBodyStyle={maxHeight:"80vh",minWidth:"40vw",maxWidth:"40vw",margin:"20vh 23vw",padding:"0vh 0vw 3vh 0vw",overflow:"none"},this.exportProjectBodyStyle={minHeight:"10vh",maxHeight:"15vh",minWidth:"31vw",maxWidth:"31vw",margin:"15vw 71vh",overflow:"none"},this.saveType={saveCurrentImage:!0,saveBulk:!1},this.projectList={projects:[],isUploading:!1,isFetching:!1},this.startProject=t=>{this.isLoading=!0,this.selectedProjectName=t;const e=this._dataSetService.checkProjectStatus(t),n=this._dataSetService.updateProjectLoadStatus(t),i=this._dataSetService.checkExistProjectStatus(t),o=this._dataSetService.getThumbnailList;this.subjectSubscription=this.subject$.pipe(Object(s.a)(()=>Object(h.a)([e])),Object(r.a)(([{message:t,content:e}])=>{this.totalUuid=e[0].total_uuid,this.projectList={isUploading:this.projectList.isUploading,isFetching:this.projectList.isFetching,projects:this.projectList.projects.map(t=>t.project_name===e[0].project_name?Object.assign(Object.assign({},e[0]),{created_date:t.created_date}):t)};const{is_loaded:n}=e[0];return 1===t&&!n}),Object(s.a)(([{message:t}])=>t?Object(h.a)([n,i]):[]),Object(s.a)(([{},{message:e,uuid_list:n,label_list:a}])=>2===e?(this.labelList=[...a],this.tabStatus[1].label_list=this.labelList,n.length>0?n.map(e=>o(t,e)):[]):Object(d.a)(500).pipe(Object(s.a)(()=>i),Object(r.a)(({message:t})=>2===t),Object(s.a)(({uuid_list:e,label_list:n})=>(console.log(e.length),this.tabStatus[1].label_list=n,e.length>0?e.slice(this.sliceNum,this.sliceNum+=20).map(e=>o(t,e)):[])))),Object(s.a)(t=>t)).subscribe(t=>{this.thumbnailList=[...this.thumbnailList,t],this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:this.thumbnailList.length})},t=>{},()=>{this.isLoading=!1,this._annotateService.labelStaging$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({annotation:t,isDlbClick:e})=>{e?(this.currentAnnotationIndex=t,this.tabStatus.forEach(({annotation:e})=>null==e?void 0:e.forEach(({bnd_box:e,polygons:n})=>{const i=null!=e?e:n;if(i){const{label:e,region:n}=i[t];this.currentAnnotationLabel=e,this.mainLabelRegionVal=n||""}else console.log("missing prop bnd_box OR polygons")})),this._imgLblActionService.setState({isActiveModal:!0,draw:!1,drag:!1,scroll:!1}),this.onDisplayModal()):(this.currentAnnotationLabel="",this.currentAnnotationIndex=t)}),this._imgLblActionService.action$.pipe(Object(l.a)(this.unsubscribe$)).subscribe(({clear:t,save:e})=>{t&&(this.thumbnailList[0].bnd_box&&(this.thumbnailList[this.currentImageDisplayIndex].bnd_box=[]),this.thumbnailList[0].polygons&&(this.thumbnailList[this.currentImageDisplayIndex].polygons=[]),this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{hasAnnotation:!1})),e&&(this.labelChoosen=this.tabStatus[1].label_list?this.tabStatus[1].label_list.map(t=>({label:t,isChoosen:!0})):[],this.onDisplayModal("modal-save"))}),this.navigateByAction({thumbnailAction:1}),this._spinnerService.hideSpinner()}),this.subject$.next()},this.loadThumbnails=()=>{if(!this.blockLoadThumbnails&&this.sliceNum<this.totalUuid){this.blockLoadThumbnails=!0;const t=this._dataSetService.checkExistProjectStatus(this.selectedProjectName),e=this._dataSetService.getThumbnailList;this.subjectSubscription=this.subject$.pipe(Object(r.a)(),Object(s.a)(()=>Object(d.a)(500).pipe(Object(s.a)(()=>t),Object(r.a)(({message:t})=>2===t),Object(s.a)(({uuid_list:t})=>t.length>0?t.slice(this.sliceNum,this.sliceNum+=10).map(t=>e(this.selectedProjectName,t)):[]))),Object(s.a)(t=>t)).subscribe(t=>{this.thumbnailList=[...this.thumbnailList,t],this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:this.thumbnailList.length})},t=>{},()=>{this.blockLoadThumbnails=!1,this._spinnerService.hideSpinner()}),this.subject$.next()}},this.updateProjectProgress=()=>{this._imgLblLayoutService.updateProjectProgress(this.tabStatus,this.selectedProjectName)},this.onChangeMetadata=t=>{this.tabStatus=this.tabStatus.map(e=>e.annotation?Object.assign(Object.assign({},e),{annotation:[t]}):e),this.thumbnailList=this.thumbnailList.map((e,n)=>this.currentImageDisplayIndex===n?t:e);const e=t.bnd_box?t.bnd_box.length>0:t.polygons.length>0;this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{hasAnnotation:e}),this.updateProjectProgress()},this.onToggleTab=({name:t,closed:e})=>{!this.tabStatus.some(n=>n.name.toLowerCase()===t.toLowerCase()&&n.closed===e)&&(this.tabStatus=this.tabStatus.map(n=>n.name.toLowerCase()===t.toLowerCase()?Object.assign(Object.assign({},n),{closed:e}):Object.assign({},n)))},this.onExport=()=>{this.modalSpanMessage="",this.modalSpanLocationPath="",this._modalService.open(this.modalExportOptions)},this.exportProject=t=>{"cfgdata"===t&&this.processingNum++;const e=this.selectedProjectName;this._imgLblApiService.exportProject(e,t).pipe(Object(r.a)()).subscribe(({message:n,project_config_path:i})=>{"cfgdata"===t&&this.processingNum--,1===n?(console.log(this._languageService._translate.get("exportSuccess").subscribe()),this._languageService._translate.get("exportSuccess").subscribe(t=>{this.toggleExportProjectModalMessage(!0),this.modalSpanMessage=e+t,this.modalSpanLocationPath=i,this.processIsSuccess(!0)})):this._languageService._translate.get("exportFailed").subscribe(t=>{this.toggleExportProjectModalMessage(!0),this.modalSpanMessage=t+e,this.processIsSuccess(!1)})}),this.closeExportProjectModal()},this.toggleExportProjectModalMessage=t=>{this._modalService.open(this.modalExportProject)},this.processIsSuccess=t=>{this.spanClass=t?"validation-success":"validation-error"},this.onReload=()=>{const t=this.selectedProjectName,e=this._imgLblApiService.reloadProject(t),n=this._imgLblApiService.reloadProjectStatus(t),i=this._dataSetService.getThumbnailList,o=[],a=({message:e})=>5!==e&&1===e?Object(d.a)(500).pipe(Object(s.a)(()=>n),Object(r.a)(({message:t})=>4===t||1===t),Object(s.a)(({uuid_add_list:e,uuid_delete_list:n,message:o})=>{this.isLoading=!0;let a=[];this.thumbnailList.forEach(t=>{a.push(t.uuid)}),e.forEach(t=>{a.push(t),this.totalUuid++}),n.forEach(t=>{a=a.filter(e=>e!==t),this.totalUuid--}),this.sliceNum=0;const s=4===o&&a.length>0?a.slice(this.sliceNum,this.sliceNum+=20).map(e=>i(t,e)):[];return this.thumbnailList=[],s}),Object(s.a)(t=>t)):Object(u.a)(t=>(console.error(t),this.isLoading=!1,t));this.subjectSubscription=this.subject$.pipe(Object(r.a)(),Object(s.a)(()=>e),Object(s.a)(t=>a(t))).subscribe(t=>{this.isLoading=!0,o.push(t)},t=>{},()=>{this.thumbnailList=o,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:this.thumbnailList.length}),this.currentImageDisplayIndex=-1,this.navigateByAction({thumbnailAction:1}),this.isLoading=!1}),this.subject$.next()},this.navigateByUrl=({url:t})=>{t?this._router.navigate([t]):console.error("No url received from child component")},this.keyDownEvent=({key:t,repeat:e})=>{this._imgLblActionService.action$.pipe(Object(r.a)()).subscribe(({draw:n})=>{if(!n&&!e)switch(t){case"ArrowLeft":this.navigateByAction({thumbnailAction:-1});break;case"ArrowRight":this.navigateByAction({thumbnailAction:1});break;case"Escape":this.onCloseModal()}})},this.navigateByAction=({thumbnailAction:t})=>{if(t){const e=this._imgLblLayoutService.calculateIndex(t,this.currentImageDisplayIndex,this.thumbnailList.length);if(e!==this.currentImageDisplayIndex){this.currentImageDisplayIndex=e;const t=this.thumbnailList.find((t,n)=>n===e),n=this.thumbnailList.findIndex((t,n)=>n===e);n+3===this.thumbnailList.length&&this.loadThumbnails(),t&&-1!==n&&!this.showLoading&&this.displayImage(Object.assign(Object.assign({},t),{thumbnailIndex:n}))}}},this.displayImage=(t,e=this.selectedProjectName)=>{var n,{thumbnailIndex:i}=t,a=o(t,["thumbnailIndex"]);(null===(n=this.selectedMetaData)||void 0===n?void 0:n.uuid)!==a.uuid&&(this.showLoading=!0,this._imgLblApiService.getBase64Thumbnail(e,a.uuid).pipe(Object(r.a)()).subscribe(({message:t,img_src:e})=>{if(1===t){this.selectedMetaData=a,this.imgSrc=e,this.currentImageDisplayIndex=i;const t=a.bnd_box?a.bnd_box.length>0:a.polygons&&a.polygons.length>0||!1;this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{currentThumbnailIndex:i+1,thumbnailName:a.img_path,hasAnnotation:t})}},t=>console.error(t),()=>this.showLoading=!1))},this.onProcessLabel=({selectedLabel:t,label_list:e,action:n})=>{const i=t&&!n?e.filter(e=>e!==t):e;this._imgLblApiService.updateLabelList(this.selectedProjectName,i.length>0?i:[]).pipe(Object(r.a)()).subscribe(({message:t})=>{1===t?this.tabStatus=this._imgLblLayoutService.displayLabelList(this.tabStatus,i):console.error("Error while updating label")}),this.updateProjectProgress()},this.onChangeAnnotationLabel=t=>{this.tabStatus=this._imgLblLayoutService.changeAnnotationLabel(this.tabStatus,t),this.updateStateToRenderChild(),this.updateProjectProgress()},this.onDeleteAnnotation=t=>{this.tabStatus=this._imgLblLayoutService.deleteAnnotation(this.tabStatus,t),this.updateStateToRenderChild(),this.updateProjectProgress()},this.onDisplayModal=(t="modal-image-labelling")=>{this.subLabelRegionVal="",this.subLabelValidateMsg="",this._modalService.open(t)},this.onCloseModal=(t="modal-image-labelling")=>{this._imgLblActionService.setState({isActiveModal:!1,draw:!0,scroll:!0}),this._modalService.close(t)},this.onChangeInput=(t,e)=>{const{value:n}=t.target;"main"===e?this.mainLabelRegionVal=n:this.subLabelRegionVal=n},this.onSubmitLabel=()=>{const{value:t}=this._subLabelSelect.nativeElement;if(!t.trim())return;let e=!1,n=!1;this.tabStatus.forEach(({annotation:i})=>null==i?void 0:i.forEach(({bnd_box:i,polygons:o})=>{const a=null!=i?i:o;if(a){const{subLabel:i}=a[this.currentAnnotationIndex];e=!!(i&&(null==i?void 0:i.length)>0),e&&(null==i||i.some(({label:e})=>n=e===t))}else console.log("missing prop bnd_box OR polygons")})),n?this.subLabelValidateMsg="Invalid of duplicate label: "+t:(this.tabStatus=this._imgLblLayoutService.submitLabel(this.tabStatus,t,this.currentAnnotationIndex,{mainLabelRegion:this.mainLabelRegionVal,subLabelRegion:this.subLabelRegionVal}),this.subLabelValidateMsg="",this.updateStateToRenderChild(),this.updateProjectProgress()),this.subLabelRegionVal=""},this.onRemoveSubLabel=(t,e)=>{this.tabStatus=this._imgLblLayoutService.removeSubLabel(this.tabStatus,{selectedAnnoIndex:t,selectedSubLabelIndex:e}),this.updateStateToRenderChild(),this.updateProjectProgress()},this.updateStateToRenderChild=()=>{this.tabStatus.forEach(({annotation:t})=>{t&&(this.thumbnailList=this.thumbnailList.map(e=>{var n;return null!==(n=t.find(({uuid:t})=>e.uuid===t))&&void 0!==n?n:e}),this.selectedMetaData=t[0])})},this.resetProjectStatus=(t=this.selectedProjectName)=>{t.trim()&&this._dataSetService.manualCloseProject(t).pipe(Object(l.a)(this.unsubscribe$)).subscribe(({})=>{this._router.navigate(["/"])})},this.onSwitchSaveType=()=>{this.saveType={saveCurrentImage:!this.saveType.saveCurrentImage,saveBulk:!this.saveType.saveBulk}},this.onClickDownload=t=>a(this,void 0,void 0,function*(){const e=this.labelChoosen.filter(t=>!0===t.isChoosen).map(t=>t.label);this.saveType.saveBulk&&this.processingNum++,yield this._exportSaveFormatService.exportSaveFormat(Object.assign(Object.assign(Object.assign(Object.assign({},this.saveType),{saveFormat:t,metadata:this.selectedMetaData,index:this.currentAnnotationIndex,projectName:this.selectedProjectName}),(this.saveType.saveBulk||"ocr"===t||"json"===t||"coco"===t)&&{projectFullMetadata:this.thumbnailList}),"json"!==t&&{labelList:e})),this.saveType.saveBulk&&this.processingNum--}),this._languageService.initializeLanguage("image-labelling",["image-labelling-en","image-labelling-cn","image-labelling-ms"])}ngOnInit(){this.currentUrl=this._router.url;const{projectName:t}=this._imgLblLayoutService.getRouteState(history);this.selectedProjectName=t,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:this.thumbnailList.length}),this.startProject(this.selectedProjectName)}closeExportProjectModal(){this._modalService.close(this.modalExportOptions)}onWindowClose(t){this.resetProjectStatus(),t.preventDefault()}onChangeLabel(t){this.onChangeAnnotationLabel({index:this.currentAnnotationIndex,label:t})}onDisplayShortcutKeyInfo(){this._modalService.open(this.modalShortcutKeyInfo)}onLoadMoreThumbnails(){this.loadThumbnails()}showAdvSettings(){this.tempLabelChoosen=this.labelChoosen.map(t=>Object.assign({},t)),this.onDisplayModal("modal-adv")}saveAdvSettings(){this.labelChoosen=this.tempLabelChoosen.map(t=>Object.assign({},t)),this.onCloseModal("modal-adv")}shortcutKeyInfo(){return[{no:1,shortcutKey:"info.shortcut.1.key",functionality:"info.shortcut.1.functionality"},{no:2,shortcutKey:"info.shortcut.2.key",functionality:"info.shortcut.2.functionality"},{no:3,shortcutKey:"info.shortcut.3.key",functionality:"info.shortcut.3.functionality"},{no:4,shortcutKey:"info.shortcut.4.key",functionality:"info.shortcut.4.functionality"},{no:5,shortcutKey:"info.shortcut.5.key",functionality:"info.shortcut.5.functionality"}]}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this._imgLblModeService.setState(null),this._imgLblActionService.setState(null),this.resetProjectStatus()}}return t.\u0275fac=function(e){return new(e||t)(b.Gb(g.a),b.Gb(v),b.Gb(w.a),b.Gb(y.a),b.Gb(C),b.Gb(P),b.Gb(O),b.Gb(_.a),b.Gb(M.a),b.Gb(L.a),b.Gb(j))},t.\u0275cmp=b.Ab({type:t,selectors:[["image-labelling-layout"]],viewQuery:function(t,e){if(1&t&&b.sc(ye,!0),2&t){let t;b.dc(t=b.Tb())&&(e._subLabelSelect=t.first)}},hostBindings:function(t,e){1&t&&b.Sb("keydown",function(t){return e.keyDownEvent(t)},!1,b.fc)("beforeunload",function(t){return e.onWindowClose(t)},!1,b.fc)},decls:98,vars:101,consts:[[1,"layout-container"],[3,"_onChange"],[3,"_totalUuid","_onChange","_tabStatus","_onClick"],[1,"content-container"],[3,"_onChange","_currentUrl","_tabStatus","_openInfo"],[4,"ngIf"],[3,"_selectMetadata","_totalUuid","_thumbnailList","_tabStatus","_onClose","_onClickThumbnail","_onClickLabel","_onEnterLabel","_onChangeAnnotationLabel","_onDeleteAnnotation","_loadMoreThumbnails"],[3,"_onChange","_onClick","_onExport","_onReload"],[3,"_thumbnailInfo","_imgSrc"],["id","modal-save",3,"id","modalBodyStyle","scrollable"],[1,"save-format-list"],[1,"save-format-content"],["id","modal-adv",3,"id","modalBodyStyle","modalTitle","scrollable","zIndex"],[1,"modal-adv-container"],["class","modal-adv-instruction",4,"ngIf"],["class","margin-bottom",4,"ngFor","ngForOf"],["class","button-style modal-adv-btn",3,"click",4,"ngIf"],["id","modal-image-labelling",3,"id","scrollable","showHeader"],[1,"modal-button","close-button","float-right",3,"click"],[1,"font-title"],[1,"main-label-container"],[1,"font-label"],[1,"static-select",3,"change"],[4,"ngFor","ngForOf"],["type","text",1,"static-input",3,"value","placeholder","change"],[1,"hr-line"],[1,"sub-label-container"],[1,"static-select"],["subLabelSelect",""],[1,"modal-button",3,"click"],[3,"id","modalBodyStyle","showHeader"],[1,"modal-content-container"],[1,"modal-content-header"],[1,"modal-button-container"],[1,"button-style","confg-btn",3,"click"],[1,"button-style","confgdata-btn",3,"click"],[1,"with-data"],[3,"id","modalBodyStyle","scrollable"],[1,"shortcut-key-info-header"],[1,"table-box"],["cellpadding","20"],[3,"id","modalBodyStyle","modalTitle","scrollable"],[1,"model-content-container"],[3,"ngClass"],[1,"error-msg",3,"innerHTML"],[3,"_loading"],[3,"_processingNum"],[3,"_selectMetadata","_imgSrc","_tabStatus","_onChangeMetadata","_onChangeAnnotationLabel","_onEnterLabel"],[3,"_selectMetadata","_imgSrc","_onChangeMetadata"],[1,"switch-container"],[1,"switch"],["type","checkbox",1,"checkBox",3,"checked","change"],[1,"slider","round"],[1,"space-verticle"],[1,"adv-settings",3,"click"],[1,"save-format-btn",3,"click"],[1,"modal-adv-instruction"],[1,"margin-bottom"],[1,"switch-2","no-margin-left"],[1,"modal-adv-label"],[1,"button-style","modal-adv-btn",3,"click"],[3,"value","selected"],[1,"validate-msg"],[1,"sub-label-flex-container","sub-label-padding"],[1,"font-label","flex-first"],[1,"font-label","flex-second"],[1,"flex-third"],[1,"modal-butto","flex-fourth",3,"click"],[3,"innerHTML"]],template:function(t,e){1&t&&(b.Lb(0,"div",0),b.Lb(1,"div"),b.Hb(2,"page-header",1),b.Lb(3,"image-labelling-info",2),b.Sb("_onClick",function(t){return e.navigateByAction(t)}),b.Kb(),b.Kb(),b.Lb(4,"div",3),b.Lb(5,"image-labelling-left-sidebar",4),b.Sb("_openInfo",function(){return e.onDisplayShortcutKeyInfo()}),b.Kb(),b.lc(6,xe,2,3,"ng-container",5),b.lc(7,Se,2,2,"ng-container",5),b.Lb(8,"image-labelling-project",6),b.Sb("_onClose",function(t){return e.onToggleTab(t)})("_onClickThumbnail",function(t){return e.displayImage(t)})("_onClickLabel",function(t){return e.onProcessLabel(t)})("_onEnterLabel",function(t){return e.onProcessLabel(t)})("_onChangeAnnotationLabel",function(t){return e.onChangeAnnotationLabel(t)})("_onDeleteAnnotation",function(t){return e.onDeleteAnnotation(t)})("_loadMoreThumbnails",function(){return e.onLoadMoreThumbnails()}),b.Kb(),b.Lb(9,"image-labelling-right-sidebar",7),b.Sb("_onClick",function(t){return e.onToggleTab(t)})("_onExport",function(){return e.onExport()})("_onReload",function(){return e.onReload()}),b.Kb(),b.Kb(),b.Hb(10,"image-labelling-footer",8),b.Kb(),b.Lb(11,"modal",9),b.Lb(12,"div",10),b.Lb(13,"div",11),b.lc(14,Ce,30,11,"ng-container",5),b.lc(15,ke,10,0,"ng-container",5),b.Kb(),b.Kb(),b.Kb(),b.Lb(16,"modal",12),b.Vb(17,"translate"),b.Lb(18,"div",13),b.lc(19,Pe,3,3,"p",14),b.lc(20,Oe,6,2,"div",15),b.lc(21,Me,3,3,"div",5),b.lc(22,Le,3,3,"button",16),b.Kb(),b.Kb(),b.Lb(23,"modal",17),b.Lb(24,"button",18),b.Sb("click",function(){return e.onCloseModal()}),b.nc(25,"\u2716"),b.Kb(),b.Lb(26,"div"),b.Lb(27,"h2",19),b.nc(28),b.Vb(29,"translate"),b.Kb(),b.Lb(30,"div",20),b.Lb(31,"label",21),b.nc(32),b.Vb(33,"translate"),b.Kb(),b.Lb(34,"select",22),b.Sb("change",function(t){return e.onChangeLabel(t.target.value)}),b.lc(35,Ae,2,1,"ng-container",23),b.Kb(),b.Lb(36,"label",21),b.nc(37),b.Vb(38,"translate"),b.Kb(),b.Lb(39,"input",24),b.Sb("change",function(t){return e.onChangeInput(t,"main")}),b.Vb(40,"translate"),b.Kb(),b.Kb(),b.Kb(),b.Hb(41,"hr",25),b.Lb(42,"div"),b.Lb(43,"h2",19),b.nc(44),b.Vb(45,"translate"),b.Kb(),b.Lb(46,"div",26),b.Lb(47,"label",21),b.nc(48),b.Vb(49,"translate"),b.Kb(),b.Lb(50,"select",27,28),b.lc(52,Be,2,1,"ng-container",23),b.Kb(),b.Lb(53,"label",21),b.nc(54),b.Vb(55,"translate"),b.Kb(),b.Lb(56,"input",24),b.Sb("change",function(t){return e.onChangeInput(t,"sub")}),b.Vb(57,"translate"),b.Kb(),b.Lb(58,"button",29),b.Sb("click",function(){return e.onSubmitLabel()}),b.nc(59),b.Vb(60,"translate"),b.Kb(),b.Kb(),b.lc(61,Ee,3,1,"ng-container",5),b.Kb(),b.Hb(62,"hr",25),b.lc(63,Ne,2,1,"ng-container",23),b.Kb(),b.Lb(64,"modal",30),b.Lb(65,"button",18),b.Sb("click",function(){return e.closeExportProjectModal()}),b.nc(66,"\u2716"),b.Kb(),b.Lb(67,"div",31),b.Lb(68,"h1",32),b.nc(69),b.Vb(70,"translate"),b.Kb(),b.Lb(71,"div",33),b.Lb(72,"button",34),b.Sb("click",function(){return e.exportProject("cfg")}),b.nc(73),b.Vb(74,"translate"),b.Kb(),b.Lb(75,"button",35),b.Sb("click",function(){return e.exportProject("cfgdata")}),b.nc(76),b.Vb(77,"translate"),b.Hb(78,"br"),b.Lb(79,"span",36),b.nc(80),b.Vb(81,"translate"),b.Kb(),b.Kb(),b.Kb(),b.Kb(),b.Kb(),b.Lb(82,"modal",37),b.Lb(83,"div",38),b.nc(84),b.Vb(85,"translate"),b.Kb(),b.Lb(86,"div",39),b.Lb(87,"table",40),b.lc(88,Ue,5,6,"tr",23),b.Kb(),b.Kb(),b.Kb(),b.Lb(89,"modal",41),b.Vb(90,"translate"),b.Hb(91,"br"),b.Lb(92,"div",42),b.lc(93,Fe,3,4,"p",5),b.Lb(94,"div",43),b.Hb(95,"p",44),b.Kb(),b.Kb(),b.Kb(),b.Hb(96,"spinner",45),b.Hb(97,"toastr",46)),2&t&&(b.wb(2),b.Zb("_onChange",e.onChangeSchema),b.wb(1),b.Zb("_totalUuid",e.totalUuid)("_onChange",e.onChangeSchema)("_tabStatus",e.tabStatus),b.wb(2),b.Zb("_onChange",e.onChangeSchema)("_currentUrl",e.currentUrl)("_tabStatus",e.tabStatus),b.wb(1),b.Zb("ngIf",e._router.url.includes("imglabel/bndbox")),b.wb(1),b.Zb("ngIf",e._router.url.includes("imglabel/seg")),b.wb(1),b.Zb("_selectMetadata",e.selectedMetaData)("_totalUuid",e.totalUuid)("_thumbnailList",e.thumbnailList)("_tabStatus",e.tabStatus),b.wb(1),b.Zb("_onChange",e.onChangeSchema),b.wb(1),b.Zb("_thumbnailInfo",e.selectedMetaData)("_imgSrc",e.imgSrc),b.wb(1),b.Zb("id","modal-save")("modalBodyStyle",e.saveModalBodyStyle)("scrollable",!0),b.wb(3),b.Zb("ngIf",null==e.selectedMetaData?null:e.selectedMetaData.bnd_box),b.wb(1),b.Zb("ngIf",null==e.selectedMetaData?null:e.selectedMetaData.polygons),b.wb(1),b.Zb("id","modal-adv")("modalBodyStyle",e.advModalBodyStyle)("modalTitle",b.Wb(17,69,"advModal.title"))("scrollable",!0)("zIndex",2),b.wb(3),b.Zb("ngIf",0!==e.tempLabelChoosen.length),b.wb(1),b.Zb("ngForOf",e.tempLabelChoosen),b.wb(1),b.Zb("ngIf",0===e.tempLabelChoosen.length),b.wb(1),b.Zb("ngIf",0!==e.tempLabelChoosen.length),b.wb(1),b.Zb("id","modal-image-labelling")("scrollable",!0)("showHeader",!1),b.wb(5),b.oc(b.Wb(29,71,"labellingArea.mainLabel")),b.wb(4),b.pc("",b.Wb(33,73,"labellingArea.label"),": "),b.wb(3),b.Zb("ngForOf",e.tabStatus),b.wb(2),b.pc("",b.Wb(38,75,"labellingArea.regionInfo"),": "),b.wb(2),b.Zb("value",e.mainLabelRegionVal)("placeholder",b.Wb(40,77,"labellingArea.mainRegionInfo")),b.wb(5),b.oc(b.Wb(45,79,"labellingArea.subLabel")),b.wb(4),b.pc("",b.Wb(49,81,"labellingArea.label"),": "),b.wb(4),b.Zb("ngForOf",e.tabStatus),b.wb(2),b.pc("",b.Wb(55,83,"labellingArea.regionInfo"),": "),b.wb(2),b.Zb("value",e.subLabelRegionVal)("placeholder",b.Wb(57,85,"labellingArea.subRegionInfo")),b.wb(3),b.oc(b.Wb(60,87,"labellingArea.add")),b.wb(2),b.Zb("ngIf",e.subLabelValidateMsg),b.wb(2),b.Zb("ngForOf",e.tabStatus),b.wb(1),b.Zb("id",e.modalExportOptions)("modalBodyStyle",e.exportModalBodyStyle)("showHeader",!1),b.wb(5),b.pc(" ",b.Wb(70,89,"exportModal.exportOptions")," "),b.wb(4),b.pc(" ",b.Wb(74,91,"exportModal.configFile")," "),b.wb(3),b.pc(" ",b.Wb(77,93,"exportModal.zipFile")," "),b.wb(4),b.oc(b.Wb(81,95,"exportModal.withData")),b.wb(2),b.Zb("id",e.modalShortcutKeyInfo)("modalBodyStyle",e.infoModalBodyStyle)("scrollable",!0),b.wb(2),b.oc(b.Wb(85,97,"info.header")),b.wb(4),b.Zb("ngForOf",e.shortcutKeyInfo()),b.wb(1),b.Zb("id",e.modalExportProject)("modalBodyStyle",e.exportProjectBodyStyle)("modalTitle",b.Wb(90,99,"exportTitle"))("scrollable",!1),b.wb(4),b.Zb("ngIf",e.modalSpanLocationPath.trim()),b.wb(1),b.Zb("ngClass",e.spanClass),b.wb(1),b.Zb("innerHTML",e.modalSpanMessage,b.hc),b.wb(1),b.Zb("_loading",e.isLoading),b.wb(1),b.Zb("_processingNum",e.processingNum))},directives:[B.a,Z,mt,i.k,Ut,Kt,Yt,$t.a,i.j,i.i,Xt.a,Qt,me,we,yt.j,yt.m],pipes:[z.c],styles:['.layout-container[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;min-width:97.8vw;max-width:97.8vw}.modal-button[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;background:#262a2e;color:azure}.close-button[_ngcontent-%COMP%]{border:none;cursor:pointer}.float-right[_ngcontent-%COMP%]{float:right}.font-title[_ngcontent-%COMP%]{font-size:1.7vw}.font-label[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.main-label-container[_ngcontent-%COMP%]{min-width:35vw;max-width:35vw}.main-label-container[_ngcontent-%COMP%], .sub-label-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.sub-label-container[_ngcontent-%COMP%]{min-width:40vw;max-width:40vw}.sub-label-flex-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1 1 100%;min-width:0}.static-select[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:5vh;margin:0;-moz-text-align-last:center;text-align-last:center;background:#262a2e;color:#fff;box-shadow:inset -.5vw 6.25vw 1vw 0 rgba(0,0,0,.2),inset -.5vw -.5vw 1vw 0 hsla(0,0%,100%,.4)}.static-select[_ngcontent-%COMP%]:hover{box-shadow:inset -.375vw -.375vw .625vw 0 rgba(0,0,0,.2),inset .375vw .375vw .625vw 0 hsla(0,0%,100%,.5)}.static-select[_ngcontent-%COMP%]:active{box-shadow:inset .375vw .375vw .625vw 0 rgba(0,0,0,.2),inset -.375vw -.375vw .625vw 0 hsla(0,0%,100%,.5)}.static-input[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;border-radius:2vw;border:none;outline:none;background-color:#363636;color:#fff;padding:0 1vw}.hr-line[_ngcontent-%COMP%]{margin:5vh 0}.sub-label-padding[_ngcontent-%COMP%]{padding:0 0 2vh}.validate-msg[_ngcontent-%COMP%]{color:red;padding:5vh 0 0;font-size:1vw}.flex-first[_ngcontent-%COMP%]{flex:1 1 35%}.flex-second[_ngcontent-%COMP%]{flex:1 1 55%}.flex-third[_ngcontent-%COMP%]{flex:0 0 5%}.flex-fourth[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;background:#262a2e;color:azure;flex:0 0 5%}.modal[_ngcontent-%COMP%]{z-index:1000;padding-top:10vh;top:0;width:100%;height:100%;overflow:auto;background-color:transparent;scrollbar-width:none;position:fixed;background:rgba(0,0,0,.8)}.modal-content[_ngcontent-%COMP%]{background-color:#525353;padding:1vw;max-width:20vw;min-width:20vw;border-radius:1vw;margin:15vh auto auto}.model-content-container[_ngcontent-%COMP%]{margin-left:1.3vw}.modal-content-header[_ngcontent-%COMP%]{text-align:center;color:#fff;font-size:3vh}.modal-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:1vw}.modal-button-cancel[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.button-style[_ngcontent-%COMP%]{border-radius:1vh;border:none;outline:none;color:#fff;cursor:pointer}.confg-btn[_ngcontent-%COMP%]{margin-right:.7vw}.confg-btn[_ngcontent-%COMP%], .confgdata-btn[_ngcontent-%COMP%]{padding:1vh 1.5vw;background-color:#169887;font-size:2vh;min-width:8vw}.cancel-btn[_ngcontent-%COMP%], .with-data[_ngcontent-%COMP%]{font-size:1.5vh}.cancel-btn[_ngcontent-%COMP%]{padding:1vh 1vw;background-color:#444}.save-format-list[_ngcontent-%COMP%]{left:0;top:0;width:100%;height:100%;overflow:auto}.save-format-content[_ngcontent-%COMP%]{margin:auto;padding:10px}.switch-container[_ngcontent-%COMP%]{font-size:small;align-content:center;text-align:center}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:4em;height:1.8em;margin-left:auto;margin-right:auto}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.switch[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background:#000;background-size:100% 100%;background-position:50%}.switch[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translateX(2.2em)}.switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.8s}.switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:1.6em;width:1.6em;left:.14em;bottom:.15em;background-color:snow;transition:.8s}.switch[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]{border-radius:1.2em}.switch[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]:before{border-radius:50%}.switch[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:8px;margin-top:.5em;outline:none}.switch-2[_ngcontent-%COMP%]{position:relative;display:inline-block;width:2.5em;height:1.2em;margin-left:auto;margin-right:auto}.switch-2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.switch-2[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background:#000;background-size:100% 100%;background-position:50%}.switch-2[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translateX(1.5em)}.switch-2[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.5s}.switch-2[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:1.2em;width:1.2em;left:.14em;background-color:snow;transition:.5s}.switch-2[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]{border-radius:1.2em}.switch-2[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]:before{border-radius:50%}.switch-2[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:8px;margin-top:.5em;outline:none}.no-margin-left[_ngcontent-%COMP%]{margin-left:0}.space-verticle[_ngcontent-%COMP%]{background-color:transparent;outline:none;border:none;margin-left:1.5em;margin-right:1.5em}.save-format-btn[_ngcontent-%COMP%]{width:90%;height:6em;margin-top:2%;margin-bottom:2%;margin-left:4.5%;background:#000;background-size:100% 100%;background-position:50%;font-size:medium;outline:none;border:none;color:snow;overflow:hidden;border-radius:5px}.save-format-btn[_ngcontent-%COMP%]:hover{text-shadow:0 0 30px #888;box-shadow:5px 5px 10px #888,-5px -5px 10px #888;cursor:pointer}.save-format-btn[_ngcontent-%COMP%]:active:hover{border:3px dashed green}.adv-settings[_ngcontent-%COMP%]{padding:1vh;margin:1vh 1.2vw;color:#ccc;font-size:x-small;cursor:pointer;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;background:#30353a;border-radius:.5vh;float:right}.adv-settings[_ngcontent-%COMP%]:hover{background:#373d42}.modal-adv-container[_ngcontent-%COMP%]{margin:1vh 1vw}.modal-adv-instruction[_ngcontent-%COMP%]{color:#fff;opacity:.5}.modal-adv-label[_ngcontent-%COMP%]{font-size:1.5vh;margin-left:2vw;white-space:nowrap;width:9vw;overflow:hidden;text-overflow:ellipsis;display:inline-block}.modal-adv-btn[_ngcontent-%COMP%]{float:right;padding:.5vh 1vw;background-color:#169887;font-size:1.5vh;min-width:3vw}.shortcut-key-info-header[_ngcontent-%COMP%]{font-size:1.2vw;color:#fff;text-align:center;margin-bottom:2vh}.table-box[_ngcontent-%COMP%]{width:100%;height:90%;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%], td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border-collapse:collapse;text-align:center;color:#fff}th[_ngcontent-%COMP%]{top:0;background:#262a2e;color:#fff;border-top:none!important}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){color:#bebebe}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:60px;text-align:center;background:#262a2e}.validation-error[_ngcontent-%COMP%]{margin:1px;color:red}.validation-success[_ngcontent-%COMP%]{margin:1px;color:green}.label[_ngcontent-%COMP%]{color:#fff;font-size:2vh;margin-right:1vw}.label-file[_ngcontent-%COMP%]{padding-top:.5vh}.margin-bottom[_ngcontent-%COMP%]{margin-bottom:.5vh}']}),t})()}];let Ze=(()=>{class t{}return t.\u0275mod=b.Eb({type:t}),t.\u0275inj=b.Db({factory:function(e){return new(e||t)},imports:[[g.d.forChild(Ke)]]}),t})();var We=n("KZX/");let Ye=(()=>{class t{}return t.\u0275mod=b.Eb({type:t}),t.\u0275inj=b.Db({factory:function(e){return new(e||t)},imports:[[i.b,We.a,z.b]]}),t})();var $e=n("RKnZ"),Xe=n("O+1G");let Ve=(()=>{class t{}return t.\u0275mod=b.Eb({type:t}),t.\u0275inj=b.Db({factory:function(e){return new(e||t)},imports:[[i.b,We.a,z.b,Ze,$e.a,g.d,Xe.a,Ye]]}),t})()},xOOu:function(t,e,n){t.exports=function t(e,n,i){function o(s,r){if(!n[s]){if(!e[s]){if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){return o(e[s][1][t]||t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var a=!1,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){(function(i){!function(t){"object"==typeof n&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function e(n,i,o){function a(r,l){if(!i[r]){if(!n[r]){var c="function"==typeof t&&t;if(!l&&c)return c(r,!0);if(s)return s(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};n[r][0].call(d.exports,function(t){return a(n[r][1][t]||t)},d,d.exports,e,n,i,o)}return i[r].exports}for(var s="function"==typeof t&&t,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(t,e,n){(function(i){!function(t){"object"==typeof n&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function e(n,i,o){function a(r,l){if(!i[r]){if(!n[r]){var c="function"==typeof t&&t;if(!l&&c)return c(r,!0);if(s)return s(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};n[r][0].call(d.exports,function(t){return a(n[r][1][t]||t)},d,d.exports,e,n,i,o)}return i[r].exports}for(var s="function"==typeof t&&t,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(t,e,n){(function(i){!function(t){"object"==typeof n&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function e(n,i,o){function a(r,l){if(!i[r]){if(!n[r]){var c="function"==typeof t&&t;if(!l&&c)return c(r,!0);if(s)return s(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};n[r][0].call(d.exports,function(t){return a(n[r][1][t]||t)},d,d.exports,e,n,i,o)}return i[r].exports}for(var s="function"==typeof t&&t,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(t,e,n){(function(i){!function(t){"object"==typeof n&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function e(n,i,o){function a(r,l){if(!i[r]){if(!n[r]){var c="function"==typeof t&&t;if(!l&&c)return c(r,!0);if(s)return s(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};n[r][0].call(d.exports,function(t){return a(n[r][1][t]||t)},d,d.exports,e,n,i,o)}return i[r].exports}for(var s="function"==typeof t&&t,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(t,e,n){(function(i){!function(t){"object"==typeof n&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=t()}(function(){return function e(n,i,o){function a(r,l){if(!i[r]){if(!n[r]){var c="function"==typeof t&&t;if(!l&&c)return c(r,!0);if(s)return s(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};n[r][0].call(d.exports,function(t){return a(n[r][1][t]||t)},d,d.exports,e,n,i,o)}return i[r].exports}for(var s="function"==typeof t&&t,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(t,e,n){"use strict";var i=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,o,s,r,l,c=[],h=0,d=t.length,u=d,b="string"!==i.getTypeOf(t);h<t.length;)u=d-h,o=b?(e=t[h++],n=h<d?t[h++]:0,h<d?t[h++]:0):(e=t.charCodeAt(h++),n=h<d?t.charCodeAt(h++):0,h<d?t.charCodeAt(h++):0),s=(3&e)<<4|n>>4,r=1<u?(15&n)<<2|o>>6:64,l=2<u?63&o:64,c.push(a.charAt(e>>2)+a.charAt(s)+a.charAt(r)+a.charAt(l));return c.join("")},n.decode=function(t){var e,n,i,s,r,l,c=0,h=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var d,u=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===a.charAt(64)&&u--,t.charAt(t.length-2)===a.charAt(64)&&u--,u%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=o.uint8array?new Uint8Array(0|u):new Array(0|u);c<t.length;)e=a.indexOf(t.charAt(c++))<<2|(s=a.indexOf(t.charAt(c++)))>>4,n=(15&s)<<4|(r=a.indexOf(t.charAt(c++)))>>2,i=(3&r)<<6|(l=a.indexOf(t.charAt(c++))),d[h++]=e,64!==r&&(d[h++]=n),64!==l&&(d[h++]=i);return d}},{"./support":30,"./utils":32}],2:[function(t,e,n){"use strict";var i=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),s=t("./stream/DataLengthProbe");function r(t,e,n,i,o){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=i,this.compressedContent=o}r.prototype={getContentWorker:function(){var t=new o(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new o(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},r.createWorkerFrom=function(t,e,n){return t.pipe(new a).pipe(new s("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",e)},e.exports=r},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var i=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(t){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){"use strict";var i=t("./utils"),o=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==i.getTypeOf(t)?function(t,e,n){var i=o,a=0+n;t^=-1;for(var s=0;s<a;s++)t=t>>>8^i[255&(t^e[s])];return-1^t}(0|e,t,t.length):function(t,e,n){var i=o,a=0+n;t^=-1;for(var s=0;s<a;s++)t=t>>>8^i[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){"use strict";var i;i="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:i}},{lie:37}],7:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=t("pako"),a=t("./utils"),s=t("./stream/GenericWorker"),r=i?"uint8array":"array";function l(t,e){s.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}n.magic="\b\0",a.inherits(l,s),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(r,t.data),!1)},l.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(t){return new l("Deflate",t)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){"use strict";function i(t,e){var n,i="";for(n=0;n<e;n++)i+=String.fromCharCode(255&t),t>>>=8;return i}function o(t,e,n,o,s,h){var d,u,b=t.file,g=t.compression,f=h!==r.utf8encode,m=a.transformTo("string",h(b.name)),p=a.transformTo("string",r.utf8encode(b.name)),_=b.comment,v=a.transformTo("string",h(_)),w=a.transformTo("string",r.utf8encode(_)),y=p.length!==b.name.length,x=w.length!==_.length,S="",C="",k="",P=b.dir,O=b.date,M={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(M.crc32=t.crc32,M.compressedSize=t.compressedSize,M.uncompressedSize=t.uncompressedSize);var L=0;e&&(L|=8),f||!y&&!x||(L|=2048);var I,A=0,j=0;P&&(A|=16),"UNIX"===s?(j=798,A|=((I=b.unixPermissions)||(I=P?16893:33204),(65535&I)<<16)):(j=20,A|=63&(b.dosPermissions||0)),d=O.getUTCHours(),d<<=6,d|=O.getUTCMinutes(),d<<=5,d|=O.getUTCSeconds()/2,u=O.getUTCFullYear()-1980,u<<=4,u|=O.getUTCMonth()+1,u<<=5,u|=O.getUTCDate(),y&&(S+="up"+i((C=i(1,1)+i(l(m),4)+p).length,2)+C),x&&(S+="uc"+i((k=i(1,1)+i(l(v),4)+w).length,2)+k);var B="";return B+="\n\0",B+=i(L,2),B+=g.magic,B+=i(d,2),B+=i(u,2),B+=i(M.crc32,4),B+=i(M.compressedSize,4),B+=i(M.uncompressedSize,4),B+=i(m.length,2),B+=i(S.length,2),{fileRecord:c.LOCAL_FILE_HEADER+B+m+S,dirRecord:c.CENTRAL_FILE_HEADER+i(j,2)+B+i(v.length,2)+"\0\0\0\0"+i(A,4)+i(o,4)+m+S+v}}var a=t("../utils"),s=t("../stream/GenericWorker"),r=t("../utf8"),l=t("../crc32"),c=t("../signature");function h(t,e,n,i){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(h,s),h.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,s.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-i-1))/n:100}}))},h.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=o(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(t){this.accumulate=!1;var e,n=this.streamFiles&&!t.file.dir,a=o(t,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(a.dirRecord),n)this.push({data:(e=t,c.DATA_DESCRIPTOR+i(e.crc32,4)+i(e.compressedSize,4)+i(e.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:a.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n,o,s,r,l=(n=this.dirRecords.length,o=this.bytesWritten-t,s=t,r=a.transformTo("string",(0,this.encodeFileName)(this.zipComment)),c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(n,2)+i(n,2)+i(o,4)+i(s,4)+i(r.length,2)+r);this.push({data:l,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},h.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(t){var e=this._sources;if(!s.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},h.prototype.lock=function(){s.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var i=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(t,e,n){var a=new o(e.streamFiles,n,e.platform,e.encodeFileName),s=0;try{t.forEach(function(t,n){s++;var o=function(t,e){var n=t||e,o=i[n];if(!o)throw new Error(n+" is not a valid compression method !");return o}(n.options.compression,e.compression),r=n.dir,l=n.date;n._compressWorker(o,n.options.compressionOptions||e.compressionOptions||{}).withStreamInfo("file",{name:t,dir:r,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(a)}),a.entriesCount=s}catch(t){a.error(t)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new i;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.5.0",i.loadAsync=function(t,e){return(new i).loadAsync(t,e)},i.external=t("./external"),e.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){"use strict";var i=t("./utils"),o=t("./external"),a=t("./utf8"),s=t("./zipEntries"),r=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(t){return new o.Promise(function(e,n){var i=t.decompressed.getContentWorker().pipe(new r);i.on("error",function(t){n(t)}).on("end",function(){i.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var n=this;return e=i.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(t)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var n=new s(e);return n.load(t),n}).then(function(t){var n=[o.Promise.resolve(t)],i=t.files;if(e.checkCRC32)for(var a=0;a<i.length;a++)n.push(c(i[a]));return o.Promise.all(n)}).then(function(t){for(var i=t.shift(),o=i.files,a=0;a<o.length;a++){var s=o[a];n.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:e.createFolders})}return i.zipComment.length&&(n.comment=i.zipComment),n})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){"use strict";var i=t("../utils"),o=t("../stream/GenericWorker");function a(t,e){o.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}i.inherits(a,o),a.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){"use strict";var i=t("readable-stream").Readable;function o(t,e,n){i.call(this,e),this._helper=t;var o=this;t.on("data",function(t,e){o.push(t)||o._helper.pause(),n&&n(e)}).on("error",function(t){o.emit("error",t)}).on("end",function(){o.push(null)})}t("../utils").inherits(o,i),o.prototype._read=function(){this._helper.resume()},e.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,n){"use strict";function i(t,e,n){var i,a,l=s.getTypeOf(e),u=s.extend(n||{},c);u.date=u.date||new Date,null!==u.compression&&(u.compression=u.compression.toUpperCase()),"string"==typeof u.unixPermissions&&(u.unixPermissions=parseInt(u.unixPermissions,8)),u.unixPermissions&&16384&u.unixPermissions&&(u.dir=!0),u.dosPermissions&&16&u.dosPermissions&&(u.dir=!0),u.dir&&(t=o(t)),u.createFolders&&(i=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""}(t))&&f.call(this,i,!0),n&&void 0!==n.binary||(u.binary=!("string"===l&&!1===u.binary&&!1===u.base64)),(e instanceof h&&0===e.uncompressedSize||u.dir||!e||0===e.length)&&(u.base64=!1,u.binary=!0,e="",u.compression="STORE",l="string"),a=e instanceof h||e instanceof r?e:b.isNode&&b.isStream(e)?new g(t,e):s.prepareContent(t,e,u.binary,u.optimizedBinaryString,u.base64);var m=new d(t,a,u);this.files[t]=m}function o(t){return"/"!==t.slice(-1)&&(t+="/"),t}var a=t("./utf8"),s=t("./utils"),r=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),c=t("./defaults"),h=t("./compressedObject"),d=t("./zipObject"),u=t("./generate"),b=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),f=function(t,e){return e=void 0!==e?e:c.createFolders,t=o(t),this.files[t]||i.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function m(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var p={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,i;for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,i))},filter:function(t){var e=[];return this.forEach(function(n,i){t(n,i)&&e.push(i)}),e},file:function(t,e,n){if(1!==arguments.length)return i.call(this,t=this.root+t,e,n),this;if(m(t)){var o=t;return this.filter(function(t,e){return!e.dir&&o.test(t)})}var a=this.files[this.root+t];return a&&!a.dir?a:null},folder:function(t){if(!t)return this;if(m(t))return this.filter(function(e,n){return n.dir&&t.test(e)});var e=f.call(this,this.root+t),n=this.clone();return n.root=e.name,n},remove:function(t){var e=this.files[t=this.root+t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter(function(e,n){return n.name.slice(0,t.length)===t}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=s.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");s.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS"),e=u.generateWorker(this,n,n.comment||this.comment||"")}catch(t){(e=new r("error")).error(t)}return new l(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=p},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){"use strict";var i=t("./DataReader");function o(t){i.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(o,i),o.prototype.byteAt=function(t){return this.data[this.zero+t]},o.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),o=t.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===e&&this.data[a+1]===n&&this.data[a+2]===i&&this.data[a+3]===o)return a-this.zero;return-1},o.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),o=t.charCodeAt(3),a=this.readData(4);return e===a[0]&&n===a[1]&&i===a[2]&&o===a[3]},o.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){"use strict";var i=t("../utils");function o(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=o},{"../utils":32}],19:[function(t,e,n){"use strict";var i=t("./Uint8ArrayReader");function o(t){i.call(this,t)}t("../utils").inherits(o,i),o.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){"use strict";var i=t("./DataReader");function o(t){i.call(this,t)}t("../utils").inherits(o,i),o.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},o.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},o.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},o.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){"use strict";var i=t("./ArrayReader");function o(t){i.call(this,t)}t("../utils").inherits(o,i),o.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){"use strict";var i=t("../utils"),o=t("../support"),a=t("./ArrayReader"),s=t("./StringReader"),r=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=i.getTypeOf(t);return i.checkSupport(e),"string"!==e||o.uint8array?"nodebuffer"===e?new r(t):o.uint8array?new l(i.transformTo("uint8array",t)):new a(i.transformTo("array",t)):new s(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK\x03\x04",n.CENTRAL_FILE_HEADER="PK\x01\x02",n.CENTRAL_DIRECTORY_END="PK\x05\x06",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,e,n){"use strict";var i=t("./GenericWorker"),o=t("../utils");function a(t){i.call(this,"ConvertWorker to "+t),this.destType=t}o.inherits(a,i),a.prototype.processChunk=function(t){this.push({data:o.transformTo(this.destType,t.data),meta:t.meta})},e.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){"use strict";var i=t("./GenericWorker"),o=t("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,i),a.prototype.processChunk=function(t){this.streamInfo.crc32=o(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){"use strict";var i=t("../utils"),o=t("./GenericWorker");function a(t){o.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}i.inherits(a,o),a.prototype.processChunk=function(t){t&&(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+t.data.length),o.prototype.processChunk.call(this,t)},e.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){"use strict";var i=t("../utils"),o=t("./GenericWorker");function a(t){o.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=i.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}i.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){"use strict";function i(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=i},{}],29:[function(t,e,n){"use strict";var i=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),s=t("../base64"),r=t("../support"),l=t("../external"),c=null;if(r.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function h(t,e,n){var s=e;switch(e){case"blob":case"arraybuffer":s="uint8array";break;case"base64":s="string"}try{this._internalType=s,this._outputType=e,this._mimeType=n,i.checkSupport(s),this._worker=t.pipe(new o(s)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}h.prototype={accumulate:function(t){return e=this,n=t,new l.Promise(function(t,o){var a=[],r=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",function(t,e){a.push(t),n&&n(e)}).on("error",function(t){a=[],o(t)}).on("end",function(){try{var e=function(t,e,n){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),n);case"base64":return s.encode(e);default:return i.transformTo(t,e)}}(l,function(t,e){var n,i=0,o=null,a=0;for(n=0;n<e.length;n++)a+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(o=new Uint8Array(a),n=0;n<e.length;n++)o.set(e[n],i),i+=e[n].length;return o;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(r,a),c);t(e)}catch(e){o(e)}a=[]}).resume()});var e,n},on:function(t,e){var n=this;return this._worker.on(t,"data"===t?function(t){e.call(n,t.data,t.meta)}:function(){i.delay(e,arguments,n)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(t){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),n.blob=0===o.getBlob("application/zip").size}catch(t){n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch(t){n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";for(var i=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),s=t("./stream/GenericWorker"),r=new Array(256),l=0;l<256;l++)r[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){s.call(this,"utf-8 decode"),this.leftOver=null}function h(){s.call(this,"utf-8 encode")}r[254]=r[254]=1,n.utf8encode=function(t){return o.nodebuffer?a.newBufferFrom(t,"utf-8"):function(t){var e,n,i,a,s,r=t.length,l=0;for(a=0;a<r;a++)55296==(64512&(n=t.charCodeAt(a)))&&a+1<r&&56320==(64512&(i=t.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=o.uint8array?new Uint8Array(l):new Array(l),a=s=0;s<l;a++)55296==(64512&(n=t.charCodeAt(a)))&&a+1<r&&56320==(64512&(i=t.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?e[s++]=n:(n<2048?e[s++]=192|n>>>6:(n<65536?e[s++]=224|n>>>12:(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63),e[s++]=128|n>>>6&63),e[s++]=128|63&n);return e}(t)},n.utf8decode=function(t){return o.nodebuffer?i.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,n,o,a,s=t.length,l=new Array(2*s);for(e=n=0;e<s;)if((o=t[e++])<128)l[n++]=o;else if(4<(a=r[o]))l[n++]=65533,e+=a-1;else{for(o&=2===a?31:3===a?15:7;1<a&&e<s;)o=o<<6|63&t[e++],a--;1<a?l[n++]=65533:o<65536?l[n++]=o:(l[n++]=55296|(o-=65536)>>10&1023,l[n++]=56320|1023&o)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)}(t=i.transformTo(o.uint8array?"uint8array":"array",t))},i.inherits(c,s),c.prototype.processChunk=function(t){var e=i.transformTo(o.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var a=e;(e=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),e.set(a,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var s=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0||0===n?e:n+r[t[n]]>e?n:e}(e),l=e;s!==e.length&&(o.uint8array?(l=e.subarray(0,s),this.leftOver=e.subarray(s,e.length)):(l=e.slice(0,s),this.leftOver=e.slice(s,e.length))),this.push({data:n.utf8decode(l),meta:t.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,i.inherits(h,s),h.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";var i=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),s=t("set-immediate-shim"),r=t("./external");function l(t){return t}function c(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}n.newBlob=function(e,i){n.checkSupport("blob");try{return new Blob([e],{type:i})}catch(t){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return o.append(e),o.getBlob(i)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(t,e,n){var i=[],o=0,a=t.length;if(a<=n)return String.fromCharCode.apply(null,t);for(;o<a;)i.push(String.fromCharCode.apply(null,"array"===e||"nodebuffer"===e?t.slice(o,Math.min(o+n,a)):t.subarray(o,Math.min(o+n,a)))),o+=n;return i.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(t){return!1}}()}};function d(t){var e=65536,i=n.getTypeOf(t),o=!0;if("uint8array"===i?o=h.applyCanBeUsed.uint8array:"nodebuffer"===i&&(o=h.applyCanBeUsed.nodebuffer),o)for(;1<e;)try{return h.stringifyByChunk(t,i,e)}catch(t){e=Math.floor(e/2)}return h.stringifyByChar(t)}function u(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}n.applyFromCharCode=d;var b={};b.string={string:l,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return b.string.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:function(t){return c(t,a.allocBuffer(t.length))}},b.array={string:d,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(t)}},b.arraybuffer={string:function(t){return d(new Uint8Array(t))},array:function(t){return u(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(new Uint8Array(t))}},b.uint8array={string:d,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return a.newBufferFrom(t)}},b.nodebuffer={string:d,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return b.nodebuffer.uint8array(t).buffer},uint8array:function(t){return u(t,new Uint8Array(t.length))},nodebuffer:l},n.transformTo=function(t,e){if(e=e||"",!t)return e;n.checkSupport(t);var i=n.getTypeOf(e);return b[i][t](e)},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":i.nodebuffer&&a.isBuffer(t)?"nodebuffer":i.uint8array&&t instanceof Uint8Array?"uint8array":i.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!i[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,i="";for(n=0;n<(t||"").length;n++)i+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return i},n.delay=function(t,e,n){s(function(){t.apply(n||null,e||[])})},n.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},n.prepareContent=function(t,e,a,s,l){return r.Promise.resolve(e).then(function(t){return i.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new r.Promise(function(e,n){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(t){n(t.target.error)},i.readAsArrayBuffer(t)}):t}).then(function(e){var h,d=n.getTypeOf(e);return d?("arraybuffer"===d?e=n.transformTo("uint8array",e):"string"===d&&(l?e=o.decode(e):a&&!0!==s&&(e=c(h=e,i.uint8array?new Uint8Array(h.length):new Array(h.length)))),e):r.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,n){"use strict";var i=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),s=t("./zipEntry"),r=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(e)+", expected "+o.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var i=this.reader.readString(4)===e;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.transformTo(r.uint8array?"uint8array":"array",t);this.zipComment=this.loadOptions.decodeFileName(e)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)this.reader.setIndex((e=this.files[t]).localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(t=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=e-n;if(0<i)this.isSignature(e,a.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(t){this.reader=i(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){"use strict";var i=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),s=t("./crc32"),r=t("./utf8"),l=t("./compressions"),c=t("./support");function h(t,e){this.options=t,this.loadOptions=e}h.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,i,o=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<o;)e=t.readInt(2),n=t.readInt(2),i=t.readData(n),this.extraFields[e]={id:e,length:n,value:i};t.setIndex(o)},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=r.utf8decode(this.fileName),this.fileCommentStr=r.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=o.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var a=o.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=i(t.value);return 1!==e.readInt(1)||s(this.fileName)!==e.readInt(4)?null:r.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=i(t.value);return 1!==e.readInt(1)||s(this.fileComment)!==e.readInt(4)?null:r.utf8decode(e.readData(t.length-5))}return null}},e.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){"use strict";function i(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),s=t("./utf8"),r=t("./compressedObject"),l=t("./stream/GenericWorker");i.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(e=e.pipe(new s.Utf8EncodeWorker)),!a&&i&&(e=e.pipe(new s.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new o(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof r&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new s.Utf8EncodeWorker)),r.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof r?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<c.length;d++)i.prototype[c[d]]=h;e.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,n){(function(t){"use strict";var n,i,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var a=0,s=new o(h),r=t.document.createTextNode("");s.observe(r,{characterData:!0}),n=function(){r.data=a=++a%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){h(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(h,0)};else{var l=new t.MessageChannel;l.port1.onmessage=h,n=function(){l.port2.postMessage(0)}}var c=[];function h(){var t,e;i=!0;for(var n=c.length;n;){for(e=c,c=[],t=-1;++t<n;)e[t]();n=c.length}i=!1}e.exports=function(t){1!==c.push(t)||i||n()}}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){"use strict";var i=t("immediate");function o(){}var a={},s=["REJECTED"],r=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==o&&b(this,t)}function h(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(t,e,n){i(function(){var i;try{i=e(n)}catch(i){return a.reject(t,i)}i===t?a.reject(t,new TypeError("Cannot resolve promise with itself")):a.resolve(t,i)})}function u(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function b(t,e){var n=!1;function i(e){n||(n=!0,a.reject(t,e))}function o(e){n||(n=!0,a.resolve(t,e))}var s=g(function(){e(o,i)});"error"===s.status&&i(s.value)}function g(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}(e.exports=c).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===r||"function"!=typeof e&&this.state===s)return this;var n=new this.constructor(o);return this.state!==l?d(n,this.state===r?t:e,this.outcome):this.queue.push(new h(n,t,e)),n},h.prototype.callFulfilled=function(t){a.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){d(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){a.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){d(this.promise,this.onRejected,t)},a.resolve=function(t,e){var n=g(u,e);if("error"===n.status)return a.reject(t,n.value);var i=n.value;if(i)b(t,i);else{t.state=r,t.outcome=e;for(var o=-1,s=t.queue.length;++o<s;)t.queue[o].callFulfilled(e)}return t},a.reject=function(t,e){t.state=s,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:a.resolve(new this(o),t)},c.reject=function(t){var e=new this(o);return a.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);for(var s=new Array(n),r=0,l=-1,c=new this(o);++l<n;)h(t[l],l);return c;function h(t,o){e.resolve(t).then(function(t){s[o]=t,++r!==n||i||(i=!0,a.resolve(c,s))},function(t){i||(i=!0,a.reject(c,t))})}},c.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,n=!1;if(!e)return this.resolve([]);for(var i=-1,s=new this(o);++i<e;)this.resolve(t[i]).then(function(t){n||(n=!0,a.resolve(s,t))},function(t){n||(n=!0,a.reject(s,t))});return s}},{immediate:36}],38:[function(t,e,n){"use strict";var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){"use strict";var i=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),s=t("./zlib/messages"),r=t("./zlib/zstream"),l=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(s[n]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var h;if(h="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=i.deflateSetDictionary(this.strm,h)))throw new Error(s[n]);this._dict_set=!0}}function h(t,e){var n=new c(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}c.prototype.push=function(t,e){var n,s,r=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,r.input="string"==typeof t?a.string2buf(t):"[object ArrayBuffer]"===l.call(t)?new Uint8Array(t):t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new o.Buf8(c),r.next_out=0,r.avail_out=c),1!==(n=i.deflate(r,s))&&0!==n)return this.onEnd(n),!(this.ended=!0);0!==r.avail_out&&(0!==r.avail_in||4!==s&&2!==s)||this.onData("string"===this.options.to?a.buf2binstring(o.shrinkBuf(r.output,r.next_out)):o.shrinkBuf(r.output,r.next_out))}while((0<r.avail_in||0===r.avail_out)&&1!==n);return 4===s?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==s||(this.onEnd(0),!(r.avail_out=0))},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){0===t&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=c,n.deflate=h,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,h(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,h(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){"use strict";var i=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),s=t("./zlib/constants"),r=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),h=Object.prototype.toString;function d(t){if(!(this instanceof d))return new d(t);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,e.windowBits);if(n!==s.Z_OK)throw new Error(r[n]);this.header=new c,i.inflateGetHeader(this.strm,this.header)}function u(t,e){var n=new d(e);if(n.push(t,!0),n.err)throw n.msg||r[n.err];return n.result}d.prototype.push=function(t,e){var n,r,l,c,d,u,b=this.strm,g=this.options.chunkSize,f=this.options.dictionary,m=!1;if(this.ended)return!1;r=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,b.input="string"==typeof t?a.binstring2buf(t):"[object ArrayBuffer]"===h.call(t)?new Uint8Array(t):t,b.next_in=0,b.avail_in=b.input.length;do{if(0===b.avail_out&&(b.output=new o.Buf8(g),b.next_out=0,b.avail_out=g),(n=i.inflate(b,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&f&&(u="string"==typeof f?a.string2buf(f):"[object ArrayBuffer]"===h.call(f)?new Uint8Array(f):f,n=i.inflateSetDictionary(this.strm,u)),n===s.Z_BUF_ERROR&&!0===m&&(n=s.Z_OK,m=!1),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),!(this.ended=!0);b.next_out&&(0!==b.avail_out&&n!==s.Z_STREAM_END&&(0!==b.avail_in||r!==s.Z_FINISH&&r!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(b.output,b.next_out),c=b.next_out-l,d=a.buf2string(b.output,l),b.next_out=c,b.avail_out=g-c,c&&o.arraySet(b.output,b.output,l,c,0),this.onData(d)):this.onData(o.shrinkBuf(b.output,b.next_out)))),0===b.avail_in&&0===b.avail_out&&(m=!0)}while((0<b.avail_in||0===b.avail_out)&&n!==s.Z_STREAM_END);return n===s.Z_STREAM_END&&(r=s.Z_FINISH),r===s.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):r!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(b.avail_out=0))},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===s.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=d,n.inflate=u,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},n.ungzip=u},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,i,o){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+i),o);else for(var a=0;a<i;a++)t[o+a]=e[n+a]},flattenChunks:function(t){var e,n,i,o,a,s;for(e=i=0,n=t.length;e<n;e++)i+=t[e].length;for(s=new Uint8Array(i),e=o=0,n=t.length;e<n;e++)s.set(a=t[e],o),o+=a.length;return s}},a={arraySet:function(t,e,n,i,o){for(var a=0;a<i;a++)t[o+a]=e[n+a]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(i)},{}],42:[function(t,e,n){"use strict";var i=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new i.Buf8(256),r=0;r<256;r++)s[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function l(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var n="",s=0;s<e;s++)n+=String.fromCharCode(t[s]);return n}s[254]=s[254]=1,n.string2buf=function(t){var e,n,o,a,s,r=t.length,l=0;for(a=0;a<r;a++)55296==(64512&(n=t.charCodeAt(a)))&&a+1<r&&56320==(64512&(o=t.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(o-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new i.Buf8(l),a=s=0;s<l;a++)55296==(64512&(n=t.charCodeAt(a)))&&a+1<r&&56320==(64512&(o=t.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(o-56320),a++),n<128?e[s++]=n:(n<2048?e[s++]=192|n>>>6:(n<65536?e[s++]=224|n>>>12:(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63),e[s++]=128|n>>>6&63),e[s++]=128|63&n);return e},n.buf2binstring=function(t){return l(t,t.length)},n.binstring2buf=function(t){for(var e=new i.Buf8(t.length),n=0,o=e.length;n<o;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,i,o,a,r=e||t.length,c=new Array(2*r);for(n=i=0;n<r;)if((o=t[n++])<128)c[i++]=o;else if(4<(a=s[o]))c[i++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;1<a&&n<r;)o=o<<6|63&t[n++],a--;1<a?c[i++]=65533:o<65536?c[i++]=o:(c[i++]=55296|(o-=65536)>>10&1023,c[i++]=56320|1023&o)}return l(c,i)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0||0===n?e:n+s[t[n]]>e?n:e}},{"./common":41}],43:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){for(var o=65535&t|0,a=t>>>16&65535|0,s=0;0!==n;){for(n-=s=2e3<n?2e3:n;a=a+(o=o+e[i++]|0)|0,--s;);o%=65521,a%=65521}return o|a<<16|0}},{}],44:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){"use strict";var i=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,o){var a=i,s=o+n;t^=-1;for(var r=o;r<s;r++)t=t>>>8^a[255&(t^e[r])];return-1^t}},{}],46:[function(t,e,n){"use strict";var i,o=t("../utils/common"),a=t("./trees"),s=t("./adler32"),r=t("./crc32"),l=t("./messages"),c=-2,h=258,d=262,u=113;function b(t,e){return t.msg=l[e],e}function g(t){return(t<<1)-(4<t?9:0)}function f(t){for(var e=t.length;0<=--e;)t[e]=0}function m(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(o.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function p(t,e){a._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,m(t.strm)}function _(t,e){t.pending_buf[t.pending++]=e}function v(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function w(t,e){var n,i,o=t.max_chain_length,a=t.strstart,s=t.prev_length,r=t.nice_match,l=t.strstart>t.w_size-d?t.strstart-(t.w_size-d):0,c=t.window,u=t.w_mask,b=t.prev,g=t.strstart+h,f=c[a+s-1],m=c[a+s];t.prev_length>=t.good_match&&(o>>=2),r>t.lookahead&&(r=t.lookahead);do{if(c[(n=e)+s]===m&&c[n+s-1]===f&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<g);if(i=h-(g-a),a=g-h,s<i){if(t.match_start=e,r<=(s=i))break;f=c[a+s-1],m=c[a+s]}}}while((e=b[e&u])>l&&0!=--o);return s<=t.lookahead?s:t.lookahead}function y(t){var e,n,i,a,l,c,h,u,b,g,f=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-d)){for(o.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=n=t.hash_size;i=t.head[--e],t.head[e]=f<=i?i-f:0,--n;);for(e=n=f;i=t.prev[--e],t.prev[e]=f<=i?i-f:0,--n;);a+=f}if(0===t.strm.avail_in)break;if(h=t.window,u=t.strstart+t.lookahead,g=void 0,(b=a)<(g=(c=t.strm).avail_in)&&(g=b),n=0===g?0:(c.avail_in-=g,o.arraySet(h,c.input,c.next_in,g,u),1===c.state.wrap?c.adler=s(c.adler,h,g,u):2===c.state.wrap&&(c.adler=r(c.adler,h,g,u)),c.next_in+=g,c.total_in+=g,g),t.lookahead+=n,t.lookahead+t.insert>=3)for(t.ins_h=t.window[l=t.strstart-t.insert],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<d&&0!==t.strm.avail_in)}function x(t,e){for(var n,i;;){if(t.lookahead<d){if(y(t),t.lookahead<d&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-d&&(t.match_length=w(t,n)),t.match_length>=3)if(i=a._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(p(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(p(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(p(t,!1),0===t.strm.avail_out)?1:2}function S(t,e){for(var n,i,o;;){if(t.lookahead<d){if(y(t),t.lookahead<d&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-d&&(t.match_length=w(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){for(o=t.strstart+t.lookahead-3,i=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(p(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=a._tr_tally(t,0,t.window[t.strstart-1]))&&p(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(p(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(p(t,!1),0===t.strm.avail_out)?1:2}function C(t,e,n,i,o){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=o}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(1146),this.dyn_dtree=new o.Buf16(122),this.bl_tree=new o.Buf16(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(16),this.heap=new o.Buf16(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:u,t.adler=2===e.wrap?0:1,e.last_flush=0,a._tr_init(e),0):b(t,c)}function O(t){var e,n=P(t);return 0===n&&((e=t.state).window_size=2*e.w_size,f(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n}function M(t,e,n,i,a,s){if(!t)return c;var r=1;if(-1===e&&(e=6),i<0?(r=0,i=-i):15<i&&(r=2,i-=16),a<1||9<a||8!==n||i<8||15<i||e<0||9<e||s<0||4<s)return b(t,c);8===i&&(i=9);var l=new k;return(t.state=l).strm=t,l.wrap=r,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new o.Buf8(2*l.w_size),l.head=new o.Buf16(l.hash_size),l.prev=new o.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new o.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=n,O(t)}i=[new C(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(y(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,p(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-d&&(p(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(p(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&p(t,!1),1)}),new C(4,4,8,4,x),new C(4,5,16,8,x),new C(4,6,32,32,x),new C(4,4,16,16,S),new C(8,16,32,32,S),new C(8,16,128,128,S),new C(8,32,128,256,S),new C(32,128,258,1024,S),new C(32,258,258,4096,S)],n.deflateInit=function(t,e){return M(t,e,8,15,8,0)},n.deflateInit2=M,n.deflateReset=O,n.deflateResetKeep=P,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?c:(t.state.gzhead=e,0):c},n.deflate=function(t,e){var n,o,s,l;if(!t||!t.state||5<e||e<0)return t?b(t,c):c;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||666===o.status&&4!==e)return b(t,0===t.avail_out?-5:c);if(o.strm=t,n=o.last_flush,o.last_flush=e,42===o.status)if(2===o.wrap)t.adler=0,_(o,31),_(o,139),_(o,8),o.gzhead?(_(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),_(o,255&o.gzhead.time),_(o,o.gzhead.time>>8&255),_(o,o.gzhead.time>>16&255),_(o,o.gzhead.time>>24&255),_(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),_(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(_(o,255&o.gzhead.extra.length),_(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=r(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(_(o,0),_(o,0),_(o,0),_(o,0),_(o,0),_(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),_(o,3),o.status=u);else{var d=8+(o.w_bits-8<<4)<<8;d|=(2<=o.strategy||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(d|=32),d+=31-d%31,o.status=u,v(o,d),0!==o.strstart&&(v(o,t.adler>>>16),v(o,65535&t.adler)),t.adler=1}if(69===o.status)if(o.gzhead.extra){for(s=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>s&&(t.adler=r(t.adler,o.pending_buf,o.pending-s,s)),m(t),s=o.pending,o.pending!==o.pending_buf_size));)_(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>s&&(t.adler=r(t.adler,o.pending_buf,o.pending-s,s)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){s=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>s&&(t.adler=r(t.adler,o.pending_buf,o.pending-s,s)),m(t),s=o.pending,o.pending===o.pending_buf_size)){l=1;break}l=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,_(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>s&&(t.adler=r(t.adler,o.pending_buf,o.pending-s,s)),0===l&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){s=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>s&&(t.adler=r(t.adler,o.pending_buf,o.pending-s,s)),m(t),s=o.pending,o.pending===o.pending_buf_size)){l=1;break}l=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,_(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>s&&(t.adler=r(t.adler,o.pending_buf,o.pending-s,s)),0===l&&(o.status=103)}else o.status=103;if(103===o.status&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&m(t),o.pending+2<=o.pending_buf_size&&(_(o,255&t.adler),_(o,t.adler>>8&255),t.adler=0,o.status=u)):o.status=u),0!==o.pending){if(m(t),0===t.avail_out)return o.last_flush=-1,0}else if(0===t.avail_in&&g(e)<=g(n)&&4!==e)return b(t,-5);if(666===o.status&&0!==t.avail_in)return b(t,-5);if(0!==t.avail_in||0!==o.lookahead||0!==e&&666!==o.status){var w=2===o.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(y(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(p(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(p(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(p(t,!1),0===t.strm.avail_out)?1:2}(o,e):3===o.strategy?function(t,e){for(var n,i,o,s,r=t.window;;){if(t.lookahead<=h){if(y(t),t.lookahead<=h&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&0<t.strstart&&(i=r[o=t.strstart-1])===r[++o]&&i===r[++o]&&i===r[++o]){s=t.strstart+h;do{}while(i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&i===r[++o]&&o<s);t.match_length=h-(s-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=a._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(p(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(p(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(p(t,!1),0===t.strm.avail_out)?1:2}(o,e):i[o.level].func(o,e);if(3!==w&&4!==w||(o.status=666),1===w||3===w)return 0===t.avail_out&&(o.last_flush=-1),0;if(2===w&&(1===e?a._tr_align(o):5!==e&&(a._tr_stored_block(o,0,0,!1),3===e&&(f(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),m(t),0===t.avail_out))return o.last_flush=-1,0}return 4!==e?0:o.wrap<=0?1:(2===o.wrap?(_(o,255&t.adler),_(o,t.adler>>8&255),_(o,t.adler>>16&255),_(o,t.adler>>24&255),_(o,255&t.total_in),_(o,t.total_in>>8&255),_(o,t.total_in>>16&255),_(o,t.total_in>>24&255)):(v(o,t.adler>>>16),v(o,65535&t.adler)),m(t),0<o.wrap&&(o.wrap=-o.wrap),0!==o.pending?0:1)},n.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&e!==u&&666!==e?b(t,c):(t.state=null,e===u?b(t,-3):0):c},n.deflateSetDictionary=function(t,e){var n,i,a,r,l,h,d,u,b=e.length;if(!t||!t.state)return c;if(2===(r=(n=t.state).wrap)||1===r&&42!==n.status||n.lookahead)return c;for(1===r&&(t.adler=s(t.adler,e,b,0)),n.wrap=0,b>=n.w_size&&(0===r&&(f(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new o.Buf8(n.w_size),o.arraySet(u,e,b-n.w_size,n.w_size,0),e=u,b=n.w_size),l=t.avail_in,h=t.next_in,d=t.input,t.avail_in=b,t.next_in=0,t.input=e,y(n);n.lookahead>=3;){for(i=n.strstart,a=n.lookahead-2;n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--a;);n.strstart=i,n.lookahead=2,y(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=h,t.input=d,t.avail_in=l,n.wrap=r,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){"use strict";e.exports=function(t,e){var n,i,o,a,s,r,l,c,h,d,u,b,g,f,m,p,_,v,w,y,x,S,C,k,P;k=t.input,o=(i=t.next_in)+(t.avail_in-5),P=t.output,s=(a=t.next_out)-(e-t.avail_out),r=a+(t.avail_out-257),l=(n=t.state).dmax,c=n.wsize,h=n.whave,d=n.wnext,u=n.window,b=n.hold,g=n.bits,f=n.lencode,m=n.distcode,p=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;t:do{g<15&&(b+=k[i++]<<g,b+=k[i++]<<(g+=8),g+=8),v=f[b&p];e:for(;;){if(b>>>=w=v>>>24,g-=w,0==(w=v>>>16&255))P[a++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=f[(65535&v)+(b&(1<<w)-1)];continue e}if(32&w){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}y=65535&v,(w&=15)&&(g<w&&(b+=k[i++]<<g,g+=8),y+=b&(1<<w)-1,b>>>=w,g-=w),g<15&&(b+=k[i++]<<g,b+=k[i++]<<(g+=8),g+=8),v=m[b&_];n:for(;;){if(b>>>=w=v>>>24,g-=w,!(16&(w=v>>>16&255))){if(0==(64&w)){v=m[(65535&v)+(b&(1<<w)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(x=65535&v,g<(w&=15)&&(b+=k[i++]<<g,(g+=8)<w&&(b+=k[i++]<<g,g+=8)),l<(x+=b&(1<<w)-1)){t.msg="invalid distance too far back",n.mode=30;break t}if(b>>>=w,g-=w,(w=a-s)<x){if(h<(w=x-w)&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(C=u,(S=0)===d){if(S+=c-w,w<y){for(y-=w;P[a++]=u[S++],--w;);S=a-x,C=P}}else if(d<w){if(S+=c+d-w,(w-=d)<y){for(y-=w;P[a++]=u[S++],--w;);if(S=0,d<y){for(y-=w=d;P[a++]=u[S++],--w;);S=a-x,C=P}}}else if(S+=d-w,w<y){for(y-=w;P[a++]=u[S++],--w;);S=a-x,C=P}for(;2<y;)P[a++]=C[S++],P[a++]=C[S++],P[a++]=C[S++],y-=3;y&&(P[a++]=C[S++],1<y&&(P[a++]=C[S++]))}else{for(S=a-x;P[a++]=P[S++],P[a++]=P[S++],P[a++]=P[S++],2<(y-=3););y&&(P[a++]=P[S++],1<y&&(P[a++]=P[S++]))}break}}break}}while(i<o&&a<r);i-=y=g>>3,b&=(1<<(g-=y<<3))-1,t.next_in=i,t.next_out=a,t.avail_in=i<o?o-i+5:5-(i-o),t.avail_out=a<r?r-a+257:257-(a-r),n.hold=b,n.bits=g}},{}],49:[function(t,e,n){"use strict";var i=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),s=t("./inffast"),r=t("./inftrees"),l=-2;function c(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(t){var e;return t&&t.state?(t.total_in=t.total_out=(e=t.state).total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(852),e.distcode=e.distdyn=new i.Buf32(592),e.sane=1,e.back=-1,0):l}function u(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,d(t)):l}function b(t,e){var n,i;return t&&t.state?(i=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?l:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,u(t))):l}function g(t,e){var n,i;return t?(i=new h,(t.state=i).window=null,0!==(n=b(t,e))&&(t.state=null),n):l}var f,m,p=!0;function _(t){if(p){var e;for(f=new i.Buf32(512),m=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(r(1,t.lens,0,288,f,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;r(2,t.lens,0,32,m,0,t.work,{bits:5}),p=!1}t.lencode=f,t.lenbits=9,t.distcode=m,t.distbits=5}function v(t,e,n,o){var a,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new i.Buf8(s.wsize)),o>=s.wsize?(i.arraySet(s.window,e,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(o<(a=s.wsize-s.wnext)&&(a=o),i.arraySet(s.window,e,n-o,a,s.wnext),(o-=a)?(i.arraySet(s.window,e,n-o,o,0),s.wnext=o,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}n.inflateReset=u,n.inflateReset2=b,n.inflateResetKeep=d,n.inflateInit=function(t){return g(t,15)},n.inflateInit2=g,n.inflate=function(t,e){var n,h,d,u,b,g,f,m,p,w,y,x,S,C,k,P,O,M,L,I,A,j,B,E,z=0,T=new i.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return l;12===(n=t.state).mode&&(n.mode=13),b=t.next_out,d=t.output,u=t.next_in,h=t.input,m=n.hold,p=n.bits,w=g=t.avail_in,y=f=t.avail_out,j=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;p<16;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(2&n.wrap&&35615===m){T[n.check=0]=255&m,T[1]=m>>>8&255,n.check=a(n.check,T,2,0),p=m=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&m)){t.msg="unknown compression method",n.mode=30;break}if(p-=4,A=8+(15&(m>>>=4)),0===n.wbits)n.wbits=A;else if(A>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<A,t.adler=n.check=1,n.mode=512&m?10:12,p=m=0;break;case 2:for(;p<16;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(n.flags=m,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(T[0]=255&m,T[1]=m>>>8&255,n.check=a(n.check,T,2,0)),p=m=0,n.mode=3;case 3:for(;p<32;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}n.head&&(n.head.time=m),512&n.flags&&(T[0]=255&m,T[1]=m>>>8&255,T[2]=m>>>16&255,T[3]=m>>>24&255,n.check=a(n.check,T,4,0)),p=m=0,n.mode=4;case 4:for(;p<16;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(T[0]=255&m,T[1]=m>>>8&255,n.check=a(n.check,T,2,0)),p=m=0,n.mode=5;case 5:if(1024&n.flags){for(;p<16;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(T[0]=255&m,T[1]=m>>>8&255,n.check=a(n.check,T,2,0)),p=m=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(g<(x=n.length)&&(x=g),x&&(n.head&&(A=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,h,u,x,A)),512&n.flags&&(n.check=a(n.check,h,x,u)),g-=x,u+=x,n.length-=x),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break t;for(x=0;A=h[u+x++],n.head&&A&&n.length<65536&&(n.head.name+=String.fromCharCode(A)),A&&x<g;);if(512&n.flags&&(n.check=a(n.check,h,x,u)),g-=x,u+=x,A)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break t;for(x=0;A=h[u+x++],n.head&&A&&n.length<65536&&(n.head.comment+=String.fromCharCode(A)),A&&x<g;);if(512&n.flags&&(n.check=a(n.check,h,x,u)),g-=x,u+=x,A)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;p<16;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(m!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}p=m=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;p<32;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}t.adler=n.check=c(m),p=m=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=b,t.avail_out=f,t.next_in=u,t.avail_in=g,n.hold=m,n.bits=p,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){m>>>=7&p,p-=7&p,n.mode=27;break}for(;p<3;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}switch(n.last=1&m,p-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(_(n),n.mode=20,6!==e)break;m>>>=2,p-=2;break t;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}m>>>=2,p-=2;break;case 14:for(m>>>=7&p,p-=7&p;p<32;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if((65535&m)!=(m>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&m,p=m=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(x=n.length){if(g<x&&(x=g),f<x&&(x=f),0===x)break t;i.arraySet(d,h,u,x,b),g-=x,u+=x,f-=x,b+=x,n.length-=x;break}n.mode=12;break;case 17:for(;p<14;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(n.nlen=257+(31&m),p-=5,n.ndist=1+(31&(m>>>=5)),p-=5,n.ncode=4+(15&(m>>>=5)),m>>>=4,p-=4,286<n.nlen||30<n.ndist){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;p<3;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}n.lens[D[n.have++]]=7&m,m>>>=3,p-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j=r(0,n.lens,0,19,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,j){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;P=(z=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,O=65535&z,!((k=z>>>24)<=p);){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(O<16)m>>>=k,p-=k,n.lens[n.have++]=O;else{if(16===O){for(E=k+2;p<E;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(m>>>=k,p-=k,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}A=n.lens[n.have-1],x=3+(3&m),m>>>=2,p-=2}else if(17===O){for(E=k+3;p<E;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}p-=k,A=0,x=3+(7&(m>>>=k)),m>>>=3,p-=3}else{for(E=k+7;p<E;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}p-=k,A=0,x=11+(127&(m>>>=k)),m>>>=7,p-=7}if(n.have+x>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;x--;)n.lens[n.have++]=A}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,j=r(1,n.lens,0,n.nlen,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,j){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,j=r(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,B={bits:n.distbits}),n.distbits=B.bits,j){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(6<=g&&258<=f){t.next_out=b,t.avail_out=f,t.next_in=u,t.avail_in=g,n.hold=m,n.bits=p,s(t,y),b=t.next_out,d=t.output,f=t.avail_out,u=t.next_in,h=t.input,g=t.avail_in,m=n.hold,p=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;P=(z=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,O=65535&z,!((k=z>>>24)<=p);){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(P&&0==(240&P)){for(M=k,L=P,I=O;P=(z=n.lencode[I+((m&(1<<M+L)-1)>>M)])>>>16&255,O=65535&z,!(M+(k=z>>>24)<=p);){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}m>>>=M,p-=M,n.back+=M}if(m>>>=k,p-=k,n.back+=k,n.length=O,0===P){n.mode=26;break}if(32&P){n.back=-1,n.mode=12;break}if(64&P){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&P,n.mode=22;case 22:if(n.extra){for(E=n.extra;p<E;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;P=(z=n.distcode[m&(1<<n.distbits)-1])>>>16&255,O=65535&z,!((k=z>>>24)<=p);){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(0==(240&P)){for(M=k,L=P,I=O;P=(z=n.distcode[I+((m&(1<<M+L)-1)>>M)])>>>16&255,O=65535&z,!(M+(k=z>>>24)<=p);){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}m>>>=M,p-=M,n.back+=M}if(m>>>=k,p-=k,n.back+=k,64&P){t.msg="invalid distance code",n.mode=30;break}n.offset=O,n.extra=15&P,n.mode=24;case 24:if(n.extra){for(E=n.extra;p<E;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===f)break t;if(n.offset>(x=y-f)){if((x=n.offset-x)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}S=x>n.wnext?n.wsize-(x-=n.wnext):n.wnext-x,x>n.length&&(x=n.length),C=n.window}else C=d,S=b-n.offset,x=n.length;for(f<x&&(x=f),f-=x,n.length-=x;d[b++]=C[S++],--x;);0===n.length&&(n.mode=21);break;case 26:if(0===f)break t;d[b++]=n.length,f--,n.mode=21;break;case 27:if(n.wrap){for(;p<32;){if(0===g)break t;g--,m|=h[u++]<<p,p+=8}if(t.total_out+=y-=f,n.total+=y,y&&(t.adler=n.check=n.flags?a(n.check,d,y,b-y):o(n.check,d,y,b-y)),y=f,(n.flags?m:c(m))!==n.check){t.msg="incorrect data check",n.mode=30;break}p=m=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;p<32;){if(0===g)break t;g--,m+=h[u++]<<p,p+=8}if(m!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}p=m=0}n.mode=29;case 29:j=1;break t;case 30:j=-3;break t;case 31:return-4;case 32:default:return l}return t.next_out=b,t.avail_out=f,t.next_in=u,t.avail_in=g,n.hold=m,n.bits=p,(n.wsize||y!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&v(t,t.output,t.next_out,y-t.avail_out)?(n.mode=31,-4):(y-=t.avail_out,t.total_in+=w-=t.avail_in,t.total_out+=y,n.total+=y,n.wrap&&y&&(t.adler=n.check=n.flags?a(n.check,d,y,t.next_out-y):o(n.check,d,y,t.next_out-y)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==w&&0===y||4===e)&&0===j&&(j=-5),j)},n.inflateEnd=function(t){if(!t||!t.state)return l;var e=t.state;return e.window&&(e.window=null),t.state=null,0},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?l:((n.head=e).done=!1,0):l},n.inflateSetDictionary=function(t,e){var n,i=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?l:11===n.mode&&o(1,e,i,0)!==n.check?-3:v(t,e,i,i)?(n.mode=31,-4):(n.havedict=1,0):l},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){"use strict";var i=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],r=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,l,c,h,d,u){var b,g,f,m,p,_,v,w,y,x=u.bits,S=0,C=0,k=0,P=0,O=0,M=0,L=0,I=0,A=0,j=0,B=null,E=0,z=new i.Buf16(16),T=new i.Buf16(16),D=null,R=0;for(S=0;S<=15;S++)z[S]=0;for(C=0;C<l;C++)z[e[n+C]]++;for(O=x,P=15;1<=P&&0===z[P];P--);if(P<O&&(O=P),0===P)return c[h++]=20971520,c[h++]=20971520,u.bits=1,0;for(k=1;k<P&&0===z[k];k++);for(O<k&&(O=k),S=I=1;S<=15;S++)if(I<<=1,(I-=z[S])<0)return-1;if(0<I&&(0===t||1!==P))return-1;for(T[1]=0,S=1;S<15;S++)T[S+1]=T[S]+z[S];for(C=0;C<l;C++)0!==e[n+C]&&(d[T[e[n+C]]++]=C);if(_=0===t?(B=D=d,19):1===t?(B=o,E-=257,D=a,R-=257,256):(B=s,D=r,-1),S=k,p=h,L=C=j=0,f=-1,m=(A=1<<(M=O))-1,1===t&&852<A||2===t&&592<A)return 1;for(;;){for(v=S-L,y=d[C]<_?(w=0,d[C]):d[C]>_?(w=D[R+d[C]],B[E+d[C]]):(w=96,0),b=1<<S-L,k=g=1<<M;c[p+(j>>L)+(g-=b)]=v<<24|w<<16|y|0,0!==g;);for(b=1<<S-1;j&b;)b>>=1;if(0!==b?(j&=b-1,j+=b):j=0,C++,0==--z[S]){if(S===P)break;S=e[n+d[C]]}if(O<S&&(j&m)!==f){for(0===L&&(L=O),p+=k,I=1<<(M=S-L);M+L<P&&!((I-=z[M+L])<=0);)M++,I<<=1;if(A+=1<<M,1===t&&852<A||2===t&&592<A)return 1;c[f=j&m]=O<<24|M<<16|p-h|0}}return 0!==j&&(c[p+j]=S-L<<24|64<<16|0),u.bits=O,0}},{"../utils/common":41}],51:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){"use strict";var i=t("../utils/common");function o(t){for(var e=t.length;0<=--e;)t[e]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],s=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);o(c);var h=new Array(60);o(h);var d=new Array(512);o(d);var u=new Array(256);o(u);var b=new Array(29);o(b);var g,f,m,p=new Array(30);function _(t,e,n,i,o){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=o,this.has_stree=t&&t.length}function v(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function w(t){return t<256?d[t]:d[256+(t>>>7)]}function y(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function x(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,y(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function S(t,e,n){x(t,n[2*e],n[2*e+1])}function C(t,e){for(var n=0;n|=1&t,t>>>=1,n<<=1,0<--e;);return n>>>1}function k(t,e,n){var i,o,a=new Array(16),s=0;for(i=1;i<=15;i++)a[i]=s=s+n[i-1]<<1;for(o=0;o<=e;o++){var r=t[2*o+1];0!==r&&(t[2*o]=C(a[r]++,r))}}function P(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function O(t){8<t.bi_valid?y(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function M(t,e,n,i){var o=2*e,a=2*n;return t[o]<t[a]||t[o]===t[a]&&i[e]<=i[n]}function L(t,e,n){for(var i=t.heap[n],o=n<<1;o<=t.heap_len&&(o<t.heap_len&&M(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!M(e,i,t.heap[o],t.depth));)t.heap[n]=t.heap[o],n=o,o<<=1;t.heap[n]=i}function I(t,e,n){var i,o,r,l,c=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],o=t.pending_buf[t.l_buf+c],c++,0===i?S(t,o,e):(S(t,(r=u[o])+256+1,e),0!==(l=a[r])&&x(t,o-=b[r],l),S(t,r=w(--i),n),0!==(l=s[r])&&x(t,i-=p[r],l)),c<t.last_lit;);S(t,256,e)}function A(t,e){var n,i,o,a=e.dyn_tree,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):a[2*n+1]=0;for(;t.heap_len<2;)a[2*(o=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[o]=0,t.opt_len--,r&&(t.static_len-=s[2*o+1]);for(e.max_code=c,n=t.heap_len>>1;1<=n;n--)L(t,a,n);for(o=l;n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],L(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,a[2*o]=a[2*n]+a[2*i],t.depth[o]=(t.depth[n]>=t.depth[i]?t.depth[n]:t.depth[i])+1,a[2*n+1]=a[2*i+1]=o,t.heap[1]=o++,L(t,a,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,i,o,a,s,r,l=e.dyn_tree,c=e.max_code,h=e.stat_desc.static_tree,d=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,b=e.stat_desc.extra_base,g=e.stat_desc.max_length,f=0;for(a=0;a<=15;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)g<(a=l[2*l[2*(i=t.heap[n])+1]+1]+1)&&(a=g,f++),l[2*i+1]=a,c<i||(t.bl_count[a]++,s=0,b<=i&&(s=u[i-b]),t.opt_len+=(r=l[2*i])*(a+s),d&&(t.static_len+=r*(h[2*i+1]+s)));if(0!==f){do{for(a=g-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[g]--,f-=2}while(0<f);for(a=g;0!==a;a--)for(i=t.bl_count[a];0!==i;)c<(o=t.heap[--n])||(l[2*o+1]!==a&&(t.opt_len+=(a-l[2*o+1])*l[2*o],l[2*o+1]=a),i--)}}(t,e),k(a,c,t.bl_count)}function j(t,e,n){var i,o,a=-1,s=e[1],r=0,l=7,c=4;for(0===s&&(l=138,c=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)o=s,s=e[2*(i+1)+1],++r<l&&o===s||(r<c?t.bl_tree[2*o]+=r:0!==o?(o!==a&&t.bl_tree[2*o]++,t.bl_tree[32]++):r<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=o,c=(r=0)===s?(l=138,3):o===s?(l=6,3):(l=7,4))}function B(t,e,n){var i,o,a=-1,s=e[1],r=0,l=7,c=4;for(0===s&&(l=138,c=3),i=0;i<=n;i++)if(o=s,s=e[2*(i+1)+1],!(++r<l&&o===s)){if(r<c)for(;S(t,o,t.bl_tree),0!=--r;);else 0!==o?(o!==a&&(S(t,o,t.bl_tree),r--),S(t,16,t.bl_tree),x(t,r-3,2)):r<=10?(S(t,17,t.bl_tree),x(t,r-3,3)):(S(t,18,t.bl_tree),x(t,r-11,7));a=o,c=(r=0)===s?(l=138,3):o===s?(l=6,3):(l=7,4)}}o(p);var E=!1;function z(t,e,n,o){var a,s,r;x(t,0+(o?1:0),3),s=e,r=n,O(a=t),y(a,r),y(a,~r),i.arraySet(a.pending_buf,a.window,s,r,a.pending),a.pending+=r}n._tr_init=function(t){E||(function(){var t,e,n,i,o,l=new Array(16);for(i=n=0;i<28;i++)for(b[i]=n,t=0;t<1<<a[i];t++)u[n++]=i;for(u[n-1]=i,i=o=0;i<16;i++)for(p[i]=o,t=0;t<1<<s[i];t++)d[o++]=i;for(o>>=7;i<30;i++)for(p[i]=o<<7,t=0;t<1<<s[i]-7;t++)d[256+o++]=i;for(e=0;e<=15;e++)l[e]=0;for(t=0;t<=143;)c[2*t+1]=8,t++,l[8]++;for(;t<=255;)c[2*t+1]=9,t++,l[9]++;for(;t<=279;)c[2*t+1]=7,t++,l[7]++;for(;t<=287;)c[2*t+1]=8,t++,l[8]++;for(k(c,287,l),t=0;t<30;t++)h[2*t+1]=5,h[2*t]=C(t,5);g=new _(c,a,257,286,15),f=new _(h,s,0,30,15),m=new _(new Array(0),r,0,19,7)}(),E=!0),t.l_desc=new v(t.dyn_ltree,g),t.d_desc=new v(t.dyn_dtree,f),t.bl_desc=new v(t.bl_tree,m),t.bi_buf=0,t.bi_valid=0,P(t)},n._tr_stored_block=z,n._tr_flush_block=function(t,e,n,i){var o,a,s=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),A(t,t.l_desc),A(t,t.d_desc),s=function(t){var e;for(j(t,t.dyn_ltree,t.l_desc.max_code),j(t,t.dyn_dtree,t.d_desc.max_code),A(t,t.bl_desc),e=18;3<=e&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),(a=t.static_len+3+7>>>3)<=(o=t.opt_len+3+7>>>3)&&(o=a)):o=a=n+5,n+4<=o&&-1!==e?z(t,e,n,i):4===t.strategy||a===o?(x(t,2+(i?1:0),3),I(t,c,h)):(x(t,4+(i?1:0),3),function(t,e,n,i){var o;for(x(t,e-257,5),x(t,n-1,5),x(t,i-4,4),o=0;o<i;o++)x(t,t.bl_tree[2*l[o]+1],3);B(t,t.dyn_ltree,e-1),B(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),I(t,t.dyn_ltree,t.dyn_dtree)),P(t),i&&O(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(u[n]+256+1)]++,t.dyn_dtree[2*w(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){var e;x(t,2,3),S(t,256,c),16===(e=t).bi_valid?(y(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":41}],53:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)})}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}}]);