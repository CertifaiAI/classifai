!function(){function t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,l=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return l=t.done,t},e:function(t){c=!0,s=t},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw s}}}}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,a=!1,o=void 0;try{for(var s,l=t[Symbol.iterator]();!(i=(s=l.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(c){a=!0,o=c}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}return n}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){if(null==t)throw new TypeError("Cannot destructure undefined")}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{i5u5:function(a,o,l){"use strict";l.r(o),l.d(o,"ImageLabellingLayoutModule",function(){return Xe});var r=l("ofXK");function h(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]])}return n}var u,g,b,d,m,v=l("SxV6"),f=l("1G5W"),y=l("XNiG"),_=l("fXoL"),x=l("tyNb"),p=l("/uUt"),M=l("cxbk"),w=l("tk/3"),S=l("14na"),P=((u=function(){function t(e,n,i){var a=this;s(this,t),this.http=e,this.mode=n,this.router=i,this.hostPort=M.a.baseURL,this.imageLabellingMode=null,this.getBase64Thumbnail=function(t,e){return a.http.get("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/uuid/").concat(e,"/imgsrc"))},this.updateLabelList=function(t,e){return a.http.put("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/newlabels"),{label_list:e.length>0?e:["default"]})},this.updateProjectProgress=function(t,e,n){return a.http.put("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/uuid/").concat(e,"/update"),Object.assign({},n))},this.mode.imgLabelMode$.pipe(Object(p.a)()).subscribe(function(t){return t?a.imageLabellingMode=t:a.router.navigate(["/"])})}return c(t,[{key:"checkIfBboxMetaType",value:function(t){return Array.isArray(t)?void 0!==t[0].bnd_box:void 0!==t.bnd_box}}]),t}()).\u0275fac=function(t){return new(t||u)(_.Qb(w.b),_.Qb(S.a),_.Qb(x.a))},u.\u0275prov=_.Db({token:u,factory:u.\u0275fac,providedIn:"any"}),u),C=l("1F7/"),k=l("LY9J"),O=l("2Vo4"),L={annotation:-1,isDlbClick:!1},I=((g=function t(){var e=this;s(this,t),this.labelStateSubject=new O.a(L),this.labelStaging$=this.labelStateSubject.asObservable(),this.setState=function(t){e.labelStateSubject.next(t?Object.assign(Object.assign({},L),t):L)}}).\u0275fac=function(t){return new(t||g)},g.\u0275prov=_.Db({token:g,factory:g.\u0275fac,providedIn:"any"}),g),j={scroll:!0,drag:!1,draw:!1,fitCenter:!1,clear:!1,isActiveModal:!1},B=((d=function t(){var e=this;s(this,t),this.actionSubject=new O.a(j),this.action$=this.actionSubject.asObservable(),this.setState=function(t){e.actionSubject.next(t?Object.assign(Object.assign({},j),t):j)}}).\u0275fac=function(t){return new(t||d)},d.\u0275prov=_.Db({token:d,factory:d.\u0275fac,providedIn:"any"}),d),A=((b=function t(e){var a=this;s(this,t),this._imgLblApiService=e,this.getRouteState=function(t){var e=t.state;return Object.assign({},e)},this.displayLabelList=function(t,e){return t.map(function(t){return t.label_list?Object.assign(Object.assign({},t),{label_list:e}):t})},this.calculateIndex=function(t,e,n){var i=e;return 1===t?i>=n-1?n-1:i+=1:i<=0?0:e-=1},this.checkAnnotationMetadataProp=function(t){var e=t.bnd_box,n=t.polygons;return null!=e?e:n},this.changeAnnotationLabel=function(t,e){var n=e.label,i=e.index;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var e=t.bnd_box,a=t.polygons,o=h(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},o),{bnd_box:null==e?void 0:e.map(function(t,e){return e===i?Object.assign(Object.assign({},t),{label:n}):t}),polygons:null==a?void 0:a.map(function(t,e){return e===i?Object.assign(Object.assign({},t),{label:n}):t})})})}):t})},this.deleteAnnotation=function(t,e){return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var n=t.bnd_box,i=t.polygons,a=h(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},a),{bnd_box:null==n?void 0:n.filter(function(t,n){return n!==e}),polygons:null==i?void 0:i.filter(function(t,n){return n!==e})})})}):t})},this.submitLabel=function(t,e,n,a){var o=a.mainLabelRegion,s=a.subLabelRegion;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var a=t.bnd_box,l=t.polygons,c=h(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},c),{bnd_box:null==a?void 0:a.map(function(t,a){return a===n?Object.assign(Object.assign({},t),{region:o,subLabel:t.subLabel&&t.subLabel.length>0?[].concat(i(t.subLabel),[{label:e,region:s}]):[{label:e,region:s}]}):t}),polygons:null==l?void 0:l.map(function(t,a){return a===n?Object.assign(Object.assign({},t),{region:o,subLabel:t.subLabel&&t.subLabel.length>0?[].concat(i(t.subLabel),[{label:e,region:s}]):[{label:e,region:s}]}):t})})})}):t})},this.removeSubLabel=function(t,e){var n=e.selectedAnnoIndex,i=e.selectedSubLabelIndex;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var e=t.bnd_box,a=t.polygons,o=h(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},o),{bnd_box:null==e?void 0:e.map(function(t,e){var a;return e===n?Object.assign(Object.assign({},t),{subLabel:null===(a=t.subLabel)||void 0===a?void 0:a.filter(function(t,e){return e!==i})}):t}),polygons:null==a?void 0:a.map(function(t,e){var a;return e===n?Object.assign(Object.assign({},t),{subLabel:null===(a=t.subLabel)||void 0===a?void 0:a.filter(function(t,e){return e!==i})}):t})})})}):t})},this.setLocalStorageProjectProgress=function(t,e){localStorage.setItem("".concat(t,"_").concat(a._imgLblApiService.imageLabellingMode),JSON.stringify({cache:e}))},this.getLocalStorageProjectProgress=function(t){var e=localStorage.getItem("".concat(t,"_").concat(a._imgLblApiService.imageLabellingMode));return e?JSON.parse(e):null},this.updateProjectProgress=function(t,e){t.forEach(function(t){var i=t.annotation;i&&(a.setLocalStorageProjectProgress(e,i),null==i||i.forEach(function(t){a._imgLblApiService.updateProjectProgress(e,t.uuid,t).pipe(Object(v.a)()).subscribe(function(t){n(t)})}))})}}).\u0275fac=function(t){return new(t||b)(_.Qb(P))},b.\u0275prov=_.Db({token:b,factory:b.\u0275fac,providedIn:"any"}),b),D=l("x2Se"),E=((m=function(){function t(){s(this,t)}return c(t,[{key:"transform",value:function(t){return t?t.split("\\").slice(-1)[0]:""}}]),t}()).\u0275fac=function(t){return new(t||m)},m.\u0275pipe=_.Gb({name:"fileNameSlice",type:m,pure:!0}),m);function X(t,e){if(1&t&&(_.Kb(0),_.Ib(1,"div",7),_.Mb(2,"label",8),_.lc(3),_.Wb(4,"fileNameSlice"),_.Lb(),_.Jb()),2&t){var n=_.Vb();_.xb(3),_.mc(_.Xb(4,1,n._onChange.thumbnailName))}}function Y(t,e){1&t&&_.Ib(0,"label",8)}function R(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"label"),_.lc(2),_.Lb(),_.Jb()),2&t){var n=_.Vb(3);_.xb(2),_.oc("",n._onChange.currentThumbnailIndex||0," / ",n._onChange.totalNumThumbnail,"")}}function T(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",10),_.Mb(2,"img",11),_.Tb("click",function(){return _.gc(n),_.Vb().$implicit.onClick()}),_.Lb(),_.Lb(),_.Mb(3,"div",12),_.jc(4,R,3,2,"ng-container",13),_.Lb(),_.Jb()}if(2&t){var i=_.Vb(),a=i.$implicit,o=i.index,s=_.Vb();_.xb(2),_.ac("ngClass",s.conditionalIconTheme())("src",a.imgPath,_.hc)("alt",a.alt)("title",a.hoverLabel),_.yb("data-index",o+a.alt),_.xb(2),_.ac("ngIf",s._onChange&&s._onChange.totalNumThumbnail)}}function z(t,e){if(1&t){var n=_.Nb();_.Mb(0,"div",10),_.Mb(1,"img",11),_.Tb("click",function(){return _.gc(n),_.Vb().$implicit.onClick()}),_.Lb(),_.Lb()}if(2&t){var i=_.Vb(),a=i.$implicit,o=i.index,s=_.Vb();_.xb(1),_.ac("ngClass",s.conditionalIconTheme())("src",a.imgPath,_.hc)("alt",a.alt)("title",a.hoverLabel),_.yb("data-index",o+a.alt)}}function V(t,e){if(1&t&&(_.Kb(0),_.jc(1,T,5,6,"ng-container",2),_.jc(2,z,2,5,"ng-template",null,9,_.kc),_.Jb()),2&t){var n=e.index,i=_.ec(3);_.xb(1),_.ac("ngIf",0===n)("ngIfElse",i)}}function N(t,e){1&t&&(_.Kb(0),_.Ib(1,"hr",14),_.Jb())}function F(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"div",10),_.Mb(2,"img",11),_.Tb("click",function(){return e.$implicit.onClick()}),_.Lb(),_.Lb(),_.jc(3,N,2,0,"ng-container",13),_.Jb()),2&t){var n=e.$implicit,i=e.index,a=_.Vb();_.xb(2),_.ac("ngClass",a.conditionalIconTheme())("src",n.imgPath,_.hc)("alt",n.alt)("title",n.hoverLabel),_.yb("data-index",i+n.alt),_.xb(1),_.ac("ngIf",1===i)}}var W,$=((W=function(){function t(){var e=this;s(this,t),this._onClick=new _.n,this.bindImagePath=function(){e.jsonSchema={logosCenter:[{imgPath:"../../../assets/icons/previous.svg",hoverLabel:"Pervious",alt:"Previous",onClick:function(){return e.emitParentEvent({thumbnailAction:-1})}},{imgPath:"../../../assets/icons/next.svg",hoverLabel:"Next",alt:"Next",onClick:function(){return e.emitParentEvent({thumbnailAction:1})}}],logosEnd:[{imgPath:"../../../assets/icons/undo.svg",hoverLabel:"Undo",alt:"Undo",onClick:function(){return null}},{imgPath:"../../../assets/icons/redo.svg",hoverLabel:"Redo",alt:"Redo",onClick:function(){return null}},{imgPath:"../../../assets/icons/zoom_in.svg",hoverLabel:"Zoom In",alt:"Zoom In",onClick:function(){return null}},{imgPath:"../../../assets/icons/zoom_out.svg",hoverLabel:"Zoom Out",alt:"Zoom Out",onClick:function(){return null}}]}},this.emitParentEvent=function(t){var n=t.url,i=t.thumbnailAction;e._onClick.emit({url:n,thumbnailAction:i})},this.conditionalIconTheme=function(){return"utility-icon-light"}}return c(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"ngOnChanges",value:function(t){var e=t._onChange.currentValue.totalNumThumbnail;this._onChange.totalNumThumbnail=e,this.bindImagePath()}}]),t}()).\u0275fac=function(t){return new(t||W)},W.\u0275cmp=_.Bb({type:W,selectors:[["image-labelling-info"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick"},features:[_.vb],decls:9,vars:4,consts:[[1,"header-container"],[1,"container-flex-start"],[4,"ngIf","ngIfElse"],["defaultName",""],[1,"container-flex-center"],[4,"ngFor","ngForOf"],[1,"container-flex-end"],[1,"indicator"],[1,"imageTitle"],["renderOtherIcons",""],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"],[1,"totalThumbnail"],[4,"ngIf"],[1,"horizontal-line"]],template:function(t,e){if(1&t&&(_.Mb(0,"div",0),_.Mb(1,"div",1),_.jc(2,X,5,3,"ng-container",2),_.jc(3,Y,1,0,"ng-template",null,3,_.kc),_.Lb(),_.Mb(5,"div",4),_.jc(6,V,4,2,"ng-container",5),_.Lb(),_.Mb(7,"div",6),_.jc(8,F,4,6,"ng-container",5),_.Lb(),_.Lb()),2&t){var n=_.ec(4);_.xb(2),_.ac("ngIf",e._onChange.thumbnailName)("ngIfElse",n),_.xb(4),_.ac("ngForOf",e.jsonSchema.logosCenter),_.xb(2),_.ac("ngForOf",e.jsonSchema.logosEnd)}},directives:[r.k,r.j,r.i],pipes:[E],styles:[".header-container[_ngcontent-%COMP%]{min-width:100vw;max-width:100vw;min-height:3.5vh;max-height:3.5vh;background:#525353;outline:.0625vw inset #fff;display:flex;justify-content:space-between;z-index:1000;position:absolute}.container-flex-start[_ngcontent-%COMP%]{display:flex;align-items:baseline;margin-left:3vw;min-height:inherit;max-height:inherit}.container-flex-center[_ngcontent-%COMP%]{display:flex;margin-left:8vw}.container-flex-end[_ngcontent-%COMP%]{display:flex;margin-right:19vw}.logo-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw}.logo[_ngcontent-%COMP%], .utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.1vw;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active{background:#696969}.utility-icon-dark[_ngcontent-%COMP%]:active{background:#a9a9a9}.position-absolute[_ngcontent-%COMP%]{position:absolute}.utility-icon-container[_ngcontent-%COMP%]{display:flex;min-height:3.5vh;max-height:3.5vh}.totalThumbnail[_ngcontent-%COMP%]{font-size:1.7vh;padding:.4vw 1vw 0;display:inline-block;color:#fff;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.img-container[_ngcontent-%COMP%]:hover   .img-description[_ngcontent-%COMP%]{visibility:visible;opacity:1}.imageTitle[_ngcontent-%COMP%]{font-size:2vh;color:#fff;align-items:center;margin-left:1vw;max-width:20vw;min-width:20vw;min-height:inherit;max-height:inherit;position:absolute;margin-top:.5vh;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.indicator[_ngcontent-%COMP%]{height:.8vh;width:.4vw;background-color:#bbb;border-radius:50%;position:absolute;top:1.2vh}.horizontal-line[_ngcontent-%COMP%]{padding:1vh 0;margin:0 1vw;border:.01rem solid #707070}"],changeDetection:0}),W);function H(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"img",4),_.Tb("click",function(){_.gc(n);var t=_.Vb(),e=t.index,i=t.$implicit;return _.Vb().getIndex(e),i.onClick()}),_.Lb(),_.Jb()}if(2&t){var i=_.Vb(),a=i.$implicit,o=i.index,s=_.Vb();_.xb(1),_.ac("ngClass",s.conditionalIconTheme())("ngStyle",(null==a?null:a.toggleable)&&s.conditionalActiveIcon(o))("src",a.imgPath,_.hc)("alt",a.alt)("title",a.hoverLabel),_.yb("data-index",o)}}function K(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"div",2),_.jc(2,H,2,6,"ng-container",3),_.Lb(),_.Jb()),2&t){var n=e.$implicit;_.xb(2),_.ac("ngIf",n)}}var J,U=((J=function(){function t(e,n){var i=this;s(this,t),this._imgLabelState=e,this._annotateService=n,this._navigate=new _.n,this.bindImagePath=function(){i.jsonSchema={logos:[{imgPath:"../../../assets/icons/pointer.svg",hoverLabel:"Pointer",alt:"Pointer",toggleable:!0,onClick:function(){i._imgLabelState.setState({draw:!1,drag:!0})}},{imgPath:"../../../assets/icons/move.svg",hoverLabel:"Move Image",alt:"Move Image",toggleable:!0,onClick:function(){i._imgLabelState.setState({draw:!1,drag:!0})}},{imgPath:"../../../assets/icons/rec_bounding_box.svg",hoverLabel:"Rectangular Bounding Box",alt:"RectangularBB",toggleable:!0,onClick:function(){i._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})}},{imgPath:"../../../assets/icons/eraser.svg",hoverLabel:"Eraser",alt:"Eraser",toggleable:!0,onClick:function(){i._annotateService.setState({annotation:-1})}},{imgPath:"../../../assets/icons/fit_center.svg",hoverLabel:"Fit Center",alt:"Fit Center",toggleable:!1,onClick:function(){i._annotateService.setState({annotation:-1}),i._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1})}},{imgPath:"../../../assets/icons/save.svg",hoverLabel:"Save",alt:"Save",toggleable:!1,onClick:function(){i._annotateService.setState({annotation:-1}),i._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1})}}]}},this.getIndex=function(t){i.iconIndex=t},this.conditionalIconTheme=function(){return"utility-icon-light-theme"},this.conditionalActiveIcon=function(t){return t===i.iconIndex?{background:"rgb(59 59 59)",outline:"darkgrey inset 0.1vw"}:null}}return c(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"ngOnChanges",value:function(t){this.bindImagePath()}}]),t}()).\u0275fac=function(t){return new(t||J)(_.Hb(B),_.Hb(I))},J.\u0275cmp=_.Bb({type:J,selectors:[["image-labelling-left-sidebar"]],inputs:{_onChange:"_onChange"},outputs:{_navigate:"_navigate"},features:[_.vb],decls:2,vars:1,consts:[[1,"utility-left-sidebar-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[4,"ngIf"],[3,"ngClass","ngStyle","src","alt","title","click"]],template:function(t,e){1&t&&(_.Mb(0,"div",0),_.jc(1,K,3,1,"ng-container",1),_.Lb()),2&t&&(_.xb(1),_.ac("ngForOf",e.jsonSchema.logos))},directives:[r.j,r.k,r.i,r.l],styles:[".utility-left-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.6vh;min-width:2.14vw;max-width:2.14vw;min-height:95.4vh;max-height:95.4vh;background:#525353;outline:.0625vw inset #fff;border:none;z-index:1000}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-dark-theme[_ngcontent-%COMP%], .utility-icon-light-theme[_ngcontent-%COMP%]{min-width:1.52vw;max-width:1.52vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light-theme-active[_ngcontent-%COMP%], .utility-icon-light-theme[_ngcontent-%COMP%]:active, .utility-icon-light-theme[_ngcontent-%COMP%]:focus{background:#a9a9a9}.utility-icon-dark-theme-active[_ngcontent-%COMP%], .utility-icon-dark-theme[_ngcontent-%COMP%]:active, .utility-icon-dark-theme[_ngcontent-%COMP%]:focus{background:#3b3b3b}"],changeDetection:0}),J),G=l("oSzE"),Z=l("DlmY");function q(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Z.a;++e<n;)this.add(t[e])}q.prototype.add=q.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},q.prototype.has=function(t){return this.__data__.has(t)};var Q,tt=q,et=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},nt=function(t,e,n,i,a,o){var s=1&n,l=t.length,c=e.length;if(l!=c&&!(s&&c>l))return!1;var r=o.get(t);if(r&&o.get(e))return r==e;var h=-1,u=!0,g=2&n?new tt:void 0;for(o.set(t,e),o.set(e,t);++h<l;){var b=t[h],d=e[h];if(i)var m=s?i(d,b,h,e,t,o):i(b,d,h,t,e,o);if(void 0!==m){if(m)continue;u=!1;break}if(g){if(!et(e,function(t,e){if(!g.has(e)&&(b===t||a(b,t,n,i,o)))return g.push(e)})){u=!1;break}}else if(b!==d&&!a(b,d,n,i,o)){u=!1;break}}return o.delete(t),o.delete(e),u},it=l("ylTp"),at=l("Ce4a"),ot=l("YHEm"),st=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n},lt=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},ct=it.a?it.a.prototype:void 0,rt=ct?ct.valueOf:void 0,ht=l("TFwu"),ut=Object.prototype.hasOwnProperty,gt=l("YM6B"),bt=l("/1FC"),dt=l("WOAq"),mt=l("oYcn"),vt="[object Object]",ft=Object.prototype.hasOwnProperty,yt=l("EUcb"),_t=function t(e,n,i,a,o){return e===n||(null==e||null==n||!Object(yt.a)(e)&&!Object(yt.a)(n)?e!=e&&n!=n:function(t,e,n,i,a,o){var s=Object(bt.a)(t),l=Object(bt.a)(e),c=s?"[object Array]":Object(gt.a)(t),r=l?"[object Array]":Object(gt.a)(e),h=(c="[object Arguments]"==c?vt:c)==vt,u=(r="[object Arguments]"==r?vt:r)==vt,g=c==r;if(g&&Object(dt.a)(t)){if(!Object(dt.a)(e))return!1;s=!0,h=!1}if(g&&!h)return o||(o=new G.a),s||Object(mt.a)(t)?nt(t,e,n,i,a,o):function(t,e,n,i,a,o,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new at.a(t),new at.a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Object(ot.a)(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=st;case"[object Set]":if(l||(l=lt),t.size!=e.size&&!(1&i))return!1;var c=s.get(t);if(c)return c==e;i|=2,s.set(t,e);var r=nt(l(t),l(e),i,a,o,s);return s.delete(t),r;case"[object Symbol]":if(rt)return rt.call(t)==rt.call(e)}return!1}(t,e,c,n,i,a,o);if(!(1&n)){var b=h&&ft.call(t,"__wrapped__"),d=u&&ft.call(e,"__wrapped__");if(b||d){var m=b?t.value():t,v=d?e.value():e;return o||(o=new G.a),a(m,v,n,i,o)}}return!!g&&(o||(o=new G.a),function(t,e,n,i,a,o){var s=1&n,l=Object(ht.a)(t),c=l.length;if(c!=Object(ht.a)(e).length&&!s)return!1;for(var r=c;r--;){var h=l[r];if(!(s?h in e:ut.call(e,h)))return!1}var u=o.get(t);if(u&&o.get(e))return u==e;var g=!0;o.set(t,e),o.set(e,t);for(var b=s;++r<c;){var d=t[h=l[r]],m=e[h];if(i)var v=s?i(m,d,h,e,t,o):i(d,m,h,t,e,o);if(!(void 0===v?d===m||a(d,m,n,i,o):v)){g=!1;break}b||(b="constructor"==h)}if(g&&!b){var f=t.constructor,y=e.constructor;f==y||!("constructor"in t)||!("constructor"in e)||"function"==typeof f&&f instanceof f&&"function"==typeof y&&y instanceof y||(g=!1)}return o.delete(t),o.delete(e),g}(t,e,n,i,a,o))}(e,n,i,a,t,o))},xt=((Q=function(){function t(e){var n=this;s(this,t),this.el=e,this.srcAttr=null,this.canLazyLoad=function(){return window&&"IntersectionObserver"in window},this.lazyLoadImage=function(){new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting?n.loadImage():n.unloadImage()})}).observe(n.el.nativeElement)},this.loadImage=function(){n.srcAttr=n.src},this.unloadImage=function(){n.srcAttr=""}}return c(t,[{key:"ngAfterViewInit",value:function(){this.canLazyLoad()?this.lazyLoadImage():this.loadImage()}}]),t}()).\u0275fac=function(t){return new(t||Q)(_.Hb(_.l))},Q.\u0275dir=_.Cb({type:Q,selectors:[["img","imgLazyLoad",""]],hostVars:1,hostBindings:function(t,e){2&t&&_.yb("src",e.srcAttr,_.hc)},inputs:{src:"src"}}),Q);function pt(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",9),_.Tb("click",function(){_.gc(n);var t=e.$implicit,i=e.index;return _.Vb(3).onClick(t,i)}),_.Mb(2,"div"),_.Ib(3,"img",10),_.Lb(),_.Mb(4,"div",11),_.Mb(5,"label"),_.lc(6),_.Wb(7,"fileNameSlice"),_.Lb(),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=e.$implicit;_.xb(3),_.ac("src",i.img_thumbnail,_.hc),_.xb(3),_.nc("",_.Xb(7,2,i.img_path)," ")}}function Mt(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",4),_.Mb(2,"label",5),_.lc(3),_.Lb(),_.Mb(4,"span",6),_.Mb(5,"div",7),_.Tb("click",function(){_.gc(n);var t=_.Vb().$implicit;return _.Vb().onClose(t)}),_.lc(6,"x"),_.Lb(),_.Lb(),_.Mb(7,"section",8),_.jc(8,pt,8,4,"ng-container",1),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=_.Vb(),a=i.$implicit,o=i.index,s=_.Vb();_.xb(1),_.ac("ngClass",s.checkCloseToggle(a)),_.yb("data-index",o),_.xb(2),_.mc(a.name),_.xb(5),_.ac("ngForOf",s._thumbnailList)}}function wt(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",19),_.Tb("click",function(){_.gc(n);var t=_.Vb(4);return t.onDisplayInputModal(),t.onIconClick({tabType:"label",action:1})}),_.lc(2," + "),_.Lb(),_.Jb()}}function St(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",20),_.Mb(2,"input",21),_.Tb("change",function(t){return _.gc(n),_.Vb(4).onChangeInputLabel(t)})("keydown.enter",function(t){return _.gc(n),_.Vb(4).validateInputLabel(t)}),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=_.Vb(4);_.xb(2),_.ac("ngClass",i.invalidInput?"input-invalid":null)("value",i.inputLabel)}}function Pt(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"span",24),_.Tb("click",function(){_.gc(n);var t=_.Vb().$implicit;return _.Vb(4).onDeleteLabel(t)}),_.lc(2,"Delete"),_.Lb(),_.Jb()}if(2&t){var i=_.Vb(5);_.xb(1),_.ac("ngClass",i.clickAbilityToggle?"pointer":null)}}function Ct(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",22),_.Mb(2,"label",23),_.Mb(3,"div",24),_.Tb("click",function(){_.gc(n);var t=e.$implicit,i=_.Vb(4);return i.clickAbilityToggle?i.onClickLabel(t):null}),_.lc(4),_.Lb(),_.Lb(),_.Mb(5,"label",25),_.jc(6,Pt,3,1,"ng-container",16),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=e.$implicit,a=e.index,o=_.Vb(4);_.xb(1),_.ac("ngClass",i===o.selectedLabel?"label-active":null),_.xb(2),_.ac("ngClass",o.clickAbilityToggle?"pointer":null),_.xb(1),_.nc(" ",i," "),_.xb(2),_.ac("ngIf",!o.action&&a>0)}}function kt(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",4),_.Mb(2,"label",5),_.lc(3),_.Lb(),_.Mb(4,"div",13),_.Mb(5,"span",14),_.Mb(6,"div",7),_.Tb("click",function(){_.gc(n);var t=_.Vb(2).$implicit;return _.Vb().onClose(t)}),_.lc(7,"x"),_.Lb(),_.Lb(),_.Ib(8,"span",15),_.Mb(9,"span",15),_.jc(10,wt,3,0,"ng-container",16),_.jc(11,St,3,2,"ng-container",16),_.Lb(),_.Lb(),_.Mb(12,"div",17),_.Mb(13,"div",18),_.jc(14,Ct,7,4,"ng-container",1),_.Lb(),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=_.Vb(2),a=i.$implicit,o=i.index,s=_.Vb();_.xb(1),_.ac("ngClass",s.checkCloseToggle(a)),_.yb("data-index",o),_.xb(2),_.mc(a.name),_.xb(7),_.ac("ngIf",s._thumbnailList.length>0),_.xb(1),_.ac("ngIf",s.displayInputLabel),_.xb(3),_.ac("ngForOf",a.label_list)}}function Ot(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",19),_.Tb("click",function(){return _.gc(n),_.Vb(4).onDeleteAnnotation()}),_.lc(2,"-"),_.Lb(),_.Jb()}}function Lt(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"label",28),_.Tb("click",function(){_.gc(n);var t=e.index,i=e.$implicit,a=_.Vb(6);return a.clickAbilityToggle?a.onClickAnnotation(t,i):null}),_.Mb(2,"div",29),_.lc(3),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=e.$implicit,a=e.index,o=_.Vb(6);_.xb(1),_.ac("ngClass",a===o.selectedIndexAnnotation?"annotation-active":null),_.yb("data-index",a),_.xb(1),_.ac("ngClass",o.clickAbilityToggle?"pointer":null),_.xb(1),_.oc(" ",i.label," : ",i.id," ")}}function It(t,e){if(1&t&&(_.Kb(0),_.jc(1,Lt,4,5,"ng-container",1),_.Jb()),2&t){var n=e.$implicit;_.xb(1),_.ac("ngForOf",n.bnd_box)}}function jt(t,e){if(1&t&&(_.Kb(0),_.jc(1,It,2,1,"ng-container",1),_.Jb()),2&t){var n=_.Vb(3).$implicit;_.xb(1),_.ac("ngForOf",n.annotation)}}function Bt(t,e){if(1&t){var n=_.Nb();_.Mb(0,"div",26),_.Mb(1,"label",5),_.lc(2),_.Lb(),_.Mb(3,"div",13),_.Mb(4,"span",14),_.Mb(5,"div",7),_.Tb("click",function(){_.gc(n);var t=_.Vb(2).$implicit;return _.Vb().onClose(t)}),_.lc(6,"x"),_.Lb(),_.Lb(),_.Ib(7,"span",15),_.Mb(8,"span",15),_.jc(9,Ot,3,0,"ng-container",16),_.Lb(),_.Lb(),_.Mb(10,"div",17),_.Mb(11,"div",18),_.Mb(12,"div",27),_.jc(13,jt,2,1,"ng-container",16),_.Lb(),_.Lb(),_.Lb(),_.Lb()}if(2&t){var i=_.Vb(2),a=i.$implicit,o=i.index,s=_.Vb();_.ac("ngClass",s.checkCloseToggle(a)),_.yb("data-index",o),_.xb(2),_.mc(a.name),_.xb(7),_.ac("ngIf",s._thumbnailList.length>0),_.xb(4),_.ac("ngIf",null==a?null:a.annotation)}}function At(t,e){if(1&t&&(_.jc(0,kt,15,6,"ng-container",2),_.jc(1,Bt,14,5,"ng-template",null,12,_.kc)),2&t){var n=_.ec(2),i=_.Vb().index;_.ac("ngIf",1===i)("ngIfElse",n)}}function Dt(t,e){if(1&t&&(_.Kb(0),_.jc(1,Mt,9,4,"ng-container",2),_.jc(2,At,3,2,"ng-template",null,3,_.kc),_.Jb()),2&t){var n=e.index,i=_.ec(3);_.xb(1),_.ac("ngIf",0===n)("ngIfElse",i)}}var Et,Xt=((Et=function(){function t(n,a){var o=this;s(this,t),this._annotateService=n,this._imgLblState=a,this._thumbnailList=[],this._tabStatus=[],this._onClose=new _.n,this._onClickThumbNail=new _.n,this._onClickLabel=new _.n,this._onEnterLabel=new _.n,this._onChangeAnnotationLabel=new _.n,this._onDeleteAnnotation=new _.n,this.action=-1,this.displayInputLabel=!1,this.inputLabel="",this.selectedIndexAnnotation=-1,this.selectedLabel="",this.unsubscribe$=new y.a,this.clickAbilityToggle=!1,this.invalidInput=!1,this.onClose=function(t){o._onClose.emit({name:t.name,closed:!0})},this.onClick=function(t,e){o._onClickThumbNail.emit(Object.assign(Object.assign({},t),{thumbnailIndex:e}))},this.onDisplayInputModal=function(){o.displayInputLabel=!o.displayInputLabel,o.inputLabel=""},this.validateInputLabel=function(t){var e=t.target.value,n=e.trim();if(n)if(n.match(/^[a-zA-Z0-9-]*$/))if(o._tabStatus.some(function(t){var e=t.label_list;return e&&e.length?e.some(function(t){return t===n}):null}))o.invalidInput=!0,console.error("Invalid existing label input");else{o.invalidInput=!1;var a=o._tabStatus.map(function(t){return t.label_list||[]}).filter(function(t){return t.length>0})[0];o._onEnterLabel.emit({action:1,label_list:a?[].concat(i(a),[e]):[e]}),o.displayInputLabel=!1}else o.invalidInput=!0,console.error("Invalid input value")},this.onIconClick=function(t){var e=t.action;o.action=e},this.onChangeInputLabel=function(t){var e=t.target.value;o.inputLabel=e},this.onDeleteLabel=function(t){var n=e(o._tabStatus.filter(function(t){return t.label_list}),1)[0].label_list;o._onClickLabel.emit({selectedLabel:t,label_list:n&&n.length>0?n:[],action:0})},this.onClickLabel=function(t){o.selectedLabel=t,o.selectedIndexAnnotation>-1&&o._onChangeAnnotationLabel.emit({label:t,index:o.selectedIndexAnnotation})},this.onClickAnnotation=function(t,e){var n=e.label;o.selectedLabel=n,o._annotateService.setState({annotation:t})},this.onDeleteAnnotation=function(){o.selectedIndexAnnotation>-1&&o._onDeleteAnnotation.emit(o.selectedIndexAnnotation)},this.checkCloseToggle=function(t){return t.closed?"closed":null},this.checkStateEqual=function(t,e){return!_t(t,e)}}return c(t,[{key:"ngOnInit",value:function(){var t=this;this._imgLblState.action$.pipe(Object(f.a)(this.unsubscribe$)).subscribe(function(e){var n=e.draw;return t.clickAbilityToggle=n}),this._thumbnailList.length>0&&this._annotateService.labelStaging$.pipe(Object(f.a)(this.unsubscribe$)).subscribe(function(n){var i,a=n.annotation;t.selectedIndexAnnotation=a;var o=e(t._tabStatus.filter(function(t){return t.annotation}),1)[0].annotation,s=null==o?void 0:o.map(function(t){return t.bnd_box.find(function(t,e){return e===a})})[0];t.selectedLabel=null!==(i=null==s?void 0:s.label)&&void 0!==i?i:""})}},{key:"ngOnChanges",value:function(t){if(t._thumbnailList){var e=t._thumbnailList.currentValue;this._thumbnailList=Object.assign([],this._thumbnailList,i(e))}if(t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){var n=t._tabStatus.currentValue;this._tabStatus=i(n)}}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),t}()).\u0275fac=function(t){return new(t||Et)(_.Hb(I),_.Hb(B))},Et.\u0275cmp=_.Bb({type:Et,selectors:[["image-labelling-project"]],inputs:{_thumbnailList:"_thumbnailList",_tabStatus:"_tabStatus"},outputs:{_onClose:"_onClose",_onClickThumbNail:"_onClickThumbNail",_onClickLabel:"_onClickLabel",_onEnterLabel:"_onEnterLabel",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onDeleteAnnotation:"_onDeleteAnnotation"},features:[_.vb],decls:2,vars:1,consts:[[1,"tab-container"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["nonThumbnailTab",""],[1,"utility-right-project-container","tab","flex-fill-remaining","flex-content",3,"ngClass"],[1,"tab-name"],[1,"tab-close-thumbnail"],[1,"div-close",3,"click"],[1,"utility-inner-container","scroll"],[1,"img-container",3,"click"],["imgLazyLoad","",1,"img",3,"src"],[1,"img-name"],["annotationTab",""],[1,"flex-tab-icons"],[1,"tab-close-thumbnailless"],[1,"tab-extra-icons"],[4,"ngIf"],["id","inner-container",1,"utility-inner-container"],[1,"flex-item"],[1,"extra-icons",3,"click"],[1,"label-input"],["type","text","placeholder","Enter Label",1,"input",3,"ngClass","value","change","keydown.enter"],[1,"flex-center-width",3,"ngClass"],[1,"label"],[3,"ngClass","click"],[1,"action"],[1,"utility-right-project-container","tab","flex-fill-remaining",3,"ngClass"],[1,"flex-center-width"],[1,"label",3,"ngClass","click"],[3,"ngClass"]],template:function(t,e){1&t&&(_.Mb(0,"div",0),_.jc(1,Dt,4,2,"ng-container",1),_.Lb()),2&t&&(_.xb(1),_.ac("ngForOf",e._tabStatus))},directives:[r.j,r.k,r.i,xt],pipes:[E],styles:['.tab-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;right:0;position:fixed;z-index:1000;min-width:18.5vw;max-width:18.5vw}.utility-right-project-container[_ngcontent-%COMP%]{height:100%;min-width:16.3vw;max-width:16.3vw;background:#696969;outline:.0625vw inset #fff;border:none;z-index:1000;align-items:stretch}.utility-right-project-container[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;min-width:8.5vw;max-width:8.5vw;min-height:4vh;max-height:4vh;background:#383535;z-index:-1;font-size:1.5vh;line-height:3vh;color:#fff;padding:.5vh 0 0 2vw}.tab[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;overflow:hidden}.tab[_ngcontent-%COMP%]:before{position:absolute;content:"";top:4vh;min-width:100vw;max-width:100vw;min-height:93vh;max-height:93vh;background:#383535;z-index:-1}.flex-fixed[_ngcontent-%COMP%]{flex:0 1 25vh}.flex-fill-remaining[_ngcontent-%COMP%]{flex:1 1 auto}.flex-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%}.tab-name[_ngcontent-%COMP%]{font-size:1.7vh;padding:.5vw 2vw 0;display:inline-block;color:#fff;position:absolute}.tab-close-thumbnail[_ngcontent-%COMP%]{vertical-align:middle;color:#696969;font-size:2vh;line-height:4vh;margin-left:3vw;justify-content:center;display:inline-grid}.div-close[_ngcontent-%COMP%], .tab-close-thumbnail[_ngcontent-%COMP%]{float:right;min-height:4vh;max-height:4vh;text-align:center}.div-close[_ngcontent-%COMP%]{min-width:1.6vw;max-width:1.6vw;color:#fff;cursor:pointer}.div-close[_ngcontent-%COMP%]:active{background:grey}.utility-inner-container[_ngcontent-%COMP%]{padding:2.5vh 0 0 .2vw;scroll-behavior:smooth;overflow:hidden auto;z-index:100;min-width:16vw;max-width:16vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.img-container[_ngcontent-%COMP%], .utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.img-container[_ngcontent-%COMP%]{font-size:1.5vh;color:#fff;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;cursor:pointer}.img[_ngcontent-%COMP%]{max-height:4.3vh;min-height:4.3vh;min-width:3vw;max-width:3vw;outline:.0625vw inset #fff}.img-name[_ngcontent-%COMP%]{margin-left:.5vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.closed[_ngcontent-%COMP%]{display:none}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute}.flex-item[_ngcontent-%COMP%]{align-items:center;flex-direction:column;font-size:1.5vh;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.flex-center-width[_ngcontent-%COMP%], .flex-item[_ngcontent-%COMP%]{display:flex;justify-content:center}.flex-center-width[_ngcontent-%COMP%]{width:90%;flex-wrap:wrap}.label[_ngcontent-%COMP%]{flex:1 1 80%;display:flex;justify-content:center;margin:.25vh 0}.pointer[_ngcontent-%COMP%]{cursor:pointer}.annotation-active[_ngcontent-%COMP%], .label-active[_ngcontent-%COMP%]{border:.15vw solid #ff0}.action[_ngcontent-%COMP%]{flex:1 1 20%}.utility-info-btn[_ngcontent-%COMP%]{font-size:1vw;min-width:0;max-width:0;min-height:2.5vh;max-height:2.5vh;line-height:0;right:21vh;position:absolute;background:#383535;border:none;color:#fff}.flex-tab-icons[_ngcontent-%COMP%]{display:flex;width:100%}.tab-close-thumbnailless[_ngcontent-%COMP%]{float:right;vertical-align:middle;min-height:4vh;max-height:4vh;color:#696969;font-size:2vh;line-height:4vh;text-align:center;flex:1 0 60%;justify-content:right;display:inline-grid}.extra-icons[_ngcontent-%COMP%]{cursor:pointer}.extra-icons[_ngcontent-%COMP%]:active{background:grey}.tab-extra-icons[_ngcontent-%COMP%]{float:right;vertical-align:middle;font-size:1.7vh;line-height:4vh;text-align:center;color:#fff;flex:1 0 15%}.tab-text[_ngcontent-%COMP%]{font-size:1.7vh;min-width:6vw;max-width:6vw}.inner-content[_ngcontent-%COMP%]{max-height:25vh;min-height:25vh;min-width:3vw;max-width:3vw}.label-input[_ngcontent-%COMP%]{position:absolute;z-index:1000;margin-left:-4vw}.input[_ngcontent-%COMP%]{border-radius:10vw;border:none;outline:none;padding:.3vw 0 .3vw 1vw;box-shadow:0 0 .3vw;min-height:2vh;max-height:2vh;min-width:6vw;max-width:6vw;font-size:1.7vh}.input-invalid[_ngcontent-%COMP%]{border:.2vw solid red}']}),Et);function Yt(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"div",3),_.Mb(2,"label"),_.Mb(3,"img",4),_.Tb("click",function(){return e.$implicit.onClick()}),_.Lb(),_.Lb(),_.Lb(),_.Jb()),2&t){var n=e.$implicit,i=e.index,a=_.Vb();_.xb(3),_.ac("ngClass",a.conditionalIconTheme())("src",n.imgPath,_.hc)("alt",n.alt)("title",n.hoverLabel),_.yb("data-index",i)}}var Rt,Tt=((Rt=function(){function t(){var e=this;s(this,t),this._onClick=new _.n,this.bindImagePath=function(){e.jsonSchema={logos:[{imgPath:"../../../assets/icons/folder.svg",hoverLabel:"Folder / Files",alt:"Folder",onClick:function(){return e._onClick.emit({name:"project",closed:!1})}},{imgPath:"../../../assets/icons/tag.svg",hoverLabel:"Label",alt:"Label",onClick:function(){return e._onClick.emit({name:"label",closed:!1})}},{imgPath:"../../../assets/icons/bounding_box.svg",hoverLabel:"Annotation",alt:"Annotation",onClick:function(){return e._onClick.emit({name:"annotation",closed:!1})}},{imgPath:"../../../assets/icons/statistic.svg",hoverLabel:"Statistic",alt:"Statistic",onClick:function(){return null}}]}},this.conditionalIconTheme=function(){return"utility-icon-light"}}return c(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"ngOnChanges",value:function(t){this.bindImagePath()}}]),t}()).\u0275fac=function(t){return new(t||Rt)},Rt.\u0275cmp=_.Bb({type:Rt,selectors:[["image-labelling-right-sidebar"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick"},features:[_.vb],decls:3,vars:1,consts:[[1,"utility-right-sidebar-container"],[1,"utility-inner-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"]],template:function(t,e){1&t&&(_.Mb(0,"div",0),_.Mb(1,"div",1),_.jc(2,Yt,4,5,"ng-container",2),_.Lb(),_.Lb()),2&t&&(_.xb(2),_.ac("ngForOf",e.jsonSchema.logos))},directives:[r.j,r.i],styles:[".utility-right-sidebar-container[_ngcontent-%COMP%]{position:absolute;min-width:2.2vw;max-width:2.2vw;min-height:95.5vh;max-height:95.5vh;background:#525353;outline:.0625vw inset #fff;z-index:1000}.utility-inner-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw;position:absolute}.utility-icon-container[_ngcontent-%COMP%], .utility-inner-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active{background:#696969}.utility-icon-dark[_ngcontent-%COMP%]:active{background:#a9a9a9}.input-none[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),Rt);function zt(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"div",3),_.lc(2),_.Lb(),_.Jb()),2&t){var n=_.Vb(2);_.xb(2),_.nc("Image: ",n.thumbnailType,"")}}function Vt(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"div",2),_.Mb(2,"div",3),_.lc(3),_.Lb(),_.jc(4,zt,3,1,"ng-container",1),_.Mb(5,"div",3),_.lc(6),_.Lb(),_.Lb(),_.Jb()),2&t){var n=_.Vb();_.xb(3),_.nc("Size: ",n.thumbnailSize,""),_.xb(1),_.ac("ngIf",n.thumbnailType),_.xb(2),_.oc("Dimension: ",n._thumbnailInfo.img_ori_w," x ",n._thumbnailInfo.img_ori_h,"")}}var Nt,Ft,Wt,$t,Ht,Kt,Jt,Ut=((Nt=function(){function t(){s(this,t),this._imgSrc="",this.thumbnailSize="",this.thumbnailType="",this.formatBytes=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 Bytes";var n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}return c(t,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(t){if(t._thumbnailInfo&&t._imgSrc){var e=t._thumbnailInfo.currentValue,n=t._imgSrc.currentValue;this._thumbnailInfo=Object.assign(Object.assign({},this._thumbnailInfo),e),this.thumbnailSize=this.formatBytes(n.length);var i=n.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(i&&i.length){var a=i[1].split("/")[1];this.thumbnailType=a}}}}]),t}()).\u0275fac=function(t){return new(t||Nt)},Nt.\u0275cmp=_.Bb({type:Nt,selectors:[["image-labelling-footer"]],inputs:{_thumbnailInfo:"_thumbnailInfo",_imgSrc:"_imgSrc"},features:[_.vb],decls:3,vars:3,consts:[[1,"footer-container"],[4,"ngIf"],[1,"footer-label-container"],[1,"footer-label"]],template:function(t,e){1&t&&(_.Mb(0,"div",0),_.jc(1,Vt,7,4,"ng-container",1),_.Wb(2,"json"),_.Lb()),2&t&&(_.xb(1),_.ac("ngIf","{}"!=_.Xb(2,1,e._thumbnailInfo)))},directives:[r.k],pipes:[r.e],styles:[".footer-container[_ngcontent-%COMP%]{position:absolute;background:#525353;outline:.0625vw inset #fff;border:none;min-height:2.3vh;max-height:2.3vh;min-width:100vw;max-width:100vw;bottom:0}.footer-label-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:baseline;width:40%}.footer-label[_ngcontent-%COMP%]{font-size:1.6vh;color:#fff;flex:0 1 30%;outline:none;border-right:1px solid #fff;text-align:center}.border-right[_ngcontent-%COMP%]{border-right:1rem #fff}"],changeDetection:0}),Nt),Gt=l("44N4"),Zt=l("XIp8"),qt=function(){function t(){s(this,t)}return c(t,[{key:"stringifyObject",value:function(t){try{return JSON.stringify(t)}catch(e){return console.log("StringifyObject(content) ----\x3e ",e.name+": ",e.message),""}}},{key:"deepCloneObject",value:function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.log("DeepCloneObject(content) ----\x3e ",e.name+": ",e.message),null}}},{key:"deepCloneVariable",value:function(t){try{return(t?JSON.parse(JSON.stringify({item:t})):"").item}catch(e){return console.log("DeepCloneVariable(variable) ----\x3e ",e.name+": ",e.message),""}}},{key:"generateUniquesID",value:function(){try{var t="",e=new Date;return t+=e.getDate().toString(),t+=(e.getMonth()+1).toString(),t+=e.getFullYear().toString(),t+=e.getHours().toString(),t+=e.getMinutes().toString(),t+=e.getSeconds().toString(),t+=e.getMilliseconds().toString(),parseInt(t,10)}catch(n){return console.log("GenerateUniquesID() ----\x3e ",n.name+": ",n.message),-1}}},{key:"matchStringHead",value:function(t,e){try{return e.substr(0,t.length)===t}catch(n){return console.log("MatchStringHead(StrToMatch:string, oristr:string) ----\x3e ",n.name+": ",n.message),!1}}},{key:"getFilename",value:function(t){try{var e=this.deepCloneVariable(t).split("\\").join("/").split("/");return e[e.length-1]}catch(n){return console.log("GetFilename(strs) ----\x3e ",n.name+": ",n.message),""}}},{key:"GetFoldername",value:function(t){try{var e=JSON.parse(JSON.stringify({st:t})).st.split("\\").join("/").split("/");return e.pop(),e.join("/")}catch(n){return console.log("GetFoldername(strs) ----\x3e ",n.name+": ",n.message),""}}},{key:"RemoveHTMLElement",value:function(t){var e;try{var n=document.getElementById(t);null!=n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}catch(i){console.log("RemoveHTMLElement(ids) ----\x3e ",i.name+": ",i.message)}}}]),t}(),Qt=(($t=function(){function n(){s(this,n),this.globalXY={x:0,y:0},this.panXY={x:0,y:0},this.currentClickedBox={box:-1,pos:"o"},this.lineOffset=3,this.anchrSize=2.5,this.currentDrawing={x1:0,x2:0,y1:0,y2:0},this.currentSelectedBndBox=-1,this.utility=new qt}return c(n,[{key:"getdiffXY",value:function(t,e){try{var n={diffX:0,diffY:0};return null!=t&&null!=e&&(n.diffX=this.globalXY.x+(t-this.panXY.x),n.diffY=this.globalXY.y+(e-this.panXY.y)),n}catch(i){return console.log("ObjectDetection GetdiffXY(offsetX: number,offsetY: number): { diffX: number; diffY: number }",i.name+": ",i.message),{diffX:-1,diffY:-1}}}},{key:"setCurrentX1Y1",value:function(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x1=t,this.currentDrawing.y1=e)}catch(n){console.log("ObjectDetection setCurrentX1Y1(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}},{key:"setCurrentX2Y2",value:function(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x2=t,this.currentDrawing.y2=e)}catch(n){console.log("ObjectDetection setCurrentX2Y2(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}},{key:"moveAllBbox",value:function(e,n,i,a){try{var o,s=t(e);try{for(s.s();!(o=s.n()).done;){var l=o.value,c=l.x2-l.x1,r=l.y2-l.y1;l.x1=Object(Zt.a)(n+l.distancetoImg.x),l.y1=Object(Zt.a)(i+l.distancetoImg.y),l.x2=Object(Zt.a)(l.x1+c),l.y2=Object(Zt.a)(l.y1+r)}}catch(h){s.e(h)}finally{s.f()}a(!0)}catch(h){}}},{key:"calScaleTofitScreen",value:function(t,e,n,i){try{var a={factor:-1,newX:-1,newY:-1};return a.factor=Math.min(n/t,i/e),a.factor=a.factor-.05*a.factor,a.newX=n/2-t/2*a.factor,a.newY=i/2-e/2*a.factor,a}catch(o){return{factor:-1,newX:-1,newY:-1}}}},{key:"deleteSingleBox",value:function(t,e,n){try{t.splice(e,1),this.currentSelectedBndBox=-1,this.currentClickedBox={box:-1,pos:"o"},n(!0)}catch(i){}}},{key:"keyboardMoveBox",value:function(t,e,n,i,a,o,s){try{var l=e.x2-e.x1,c=e.y2-e.y1;"up"===t?this.moveBoxWithinPointPath(n,i,a,o,0,-3,e)&&(e.y1-=3,e.y2=Object(Zt.a)(e.y1+l)):"down"===t?this.moveBoxWithinPointPath(n,i,a,o,0,3,e)&&(e.y1+=3,e.y2=Object(Zt.a)(e.y1+l)):"left"===t?this.moveBoxWithinPointPath(n,i,a,o,-3,0,e)&&(e.x1-=3,e.x2=Object(Zt.a)(e.x1+c)):"right"===t&&this.moveBoxWithinPointPath(n,i,a,o,3,0,e)&&(e.x1+=3,e.x2=Object(Zt.a)(e.x1+c)),s(!0)}catch(r){}}},{key:"mouseMoveBox",value:function(t,e,n){try{if(this.moveBoxWithinPointPath(n.img_x,n.img_y,n.img_w,n.img_h,t-this.currentDrawing.x1,e-this.currentDrawing.y1,n.bnd_box[this.currentSelectedBndBox])){this.setCurrentX2Y2(t,e);var i=this.currentDrawing.x2-this.currentDrawing.x1,a=this.currentDrawing.y2-this.currentDrawing.y1;this.setCurrentX1Y1(this.currentDrawing.x2,this.currentDrawing.y2),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"l"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x1+=i),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"t"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y1+=a),"i"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos&&"r"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x2+=i),"i"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos&&"b"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y2+=a)}}catch(o){console.log("ObjectDetection mouseMoveBox(MouseX:number, MouseY:number, CurrMeta:Metadata):void",o.name+": ",o.message)}}},{key:"getCurrentSelectedBox",value:function(){try{return this.currentSelectedBndBox}catch(t){return-1}}},{key:"setCurrentSelectedbBox",value:function(t){try{!t||(this.currentSelectedBndBox=t)}catch(e){console.log("ObjectDetection setCurrentSelectedbBox(newNUM:number):void",e.name+": ",e.message)}}},{key:"mouseUpDrawEnable",value:function(t,e){try{var n={selBox:-1,isNew:!1};if(-1===this.currentClickedBox.box&&null!==this.tmpbox)t.bnd_box.push(this.tmpbox),this.currentSelectedBndBox=t.bnd_box.length-1,t.bnd_box[this.currentSelectedBndBox].label="default",n.isNew=!0,n.selBox=Object(Zt.a)(this.currentSelectedBndBox);else{if(t.bnd_box[this.currentSelectedBndBox].x1>t.bnd_box[this.currentSelectedBndBox].x2){var i=Object(Zt.a)(t.bnd_box[this.currentSelectedBndBox].x1);t.bnd_box[this.currentSelectedBndBox].x1=Object(Zt.a)(t.bnd_box[this.currentSelectedBndBox].x2),t.bnd_box[this.currentSelectedBndBox].x2=i}if(t.bnd_box[this.currentSelectedBndBox].y1>t.bnd_box[this.currentSelectedBndBox].y2){var a=Object(Zt.a)(t.bnd_box[this.currentSelectedBndBox].y1);t.bnd_box[this.currentSelectedBndBox].y1=Object(Zt.a)(t.bnd_box[this.currentSelectedBndBox].y2),t.bnd_box[this.currentSelectedBndBox].y2=a}}return this.currentClickedBox={box:-1,pos:"o"},this.setCurrentX1Y1(0,0),this.setCurrentX2Y2(0,0),this.tmpbox=null,e(!0),n}catch(o){return console.log("ObjectDetection MouseUpDrawEnable(CurrMeta: Metadata): number",o.name+": ",o.message),{selBox:-1,isNew:!1}}}},{key:"panRectangle",value:function(e,n,i,a){try{var o,s=t(e);try{for(s.s();!(o=s.n()).done;){var l=o.value,c=l.x2-l.x1,r=l.y2-l.y1;l.x1=n+l.distancetoImg.x,l.y1=i+l.distancetoImg.y,l.x2=l.x1+c,l.y2=l.y1+r}}catch(h){s.e(h)}finally{s.f()}a(!0)}catch(h){console.log("ObjectDetection panRectangle(bbox:Boundingbox[], img_X:number, img_Y:number)",h.name+": ",h.message)}}},{key:"scaleAllBoxes",value:function(e,n,i,a,o){try{var s,l=t(n);try{for(l.s();!(s=l.n()).done;){var c=s.value;console.log(c);var r=c.distancetoImg.x*e+i,h=c.distancetoImg.y*e+a,u=r+(c.x2-c.x1)*e,g=h+(c.y2-c.y1)*e;c.x1=Object(Zt.a)(r),c.y1=Object(Zt.a)(h),c.x2=Object(Zt.a)(u),c.y2=Object(Zt.a)(g);var b=c.x1-i,d=c.y1-a;c.distancetoImg.x=Object(Zt.a)(b),c.distancetoImg.y=Object(Zt.a)(d)}}catch(m){l.e(m)}finally{l.f()}o(!0)}catch(m){console.log("ObjectDetection scaleAllBoxes(scalefactor: number,boxes:Boundingbox[],imgX:number,imgY:number)",m.name+": ",m.message)}}},{key:"mouseMoveDrawEnable",value:function(t,e,n){try{-1===this.currentClickedBox.box?this.setCurrentX2Y2(t,e):this.mouseMoveBox(t,e,n)}catch(i){console.log("ObjectDetection MouseMoveDrawEnable(MouseX: number,MouseY: number,SelectedMeta: Metadata): void",i.name+": ",i.message)}}},{key:"mouseDownDrawEnable",value:function(t,e,n){try{return this.getCurrentClickBox(t,e,n),this.setCurrentX1Y1(t,e),this.setCurrentX2Y2(t,e),this.currentSelectedBndBox=-1!==this.currentClickedBox.box?this.currentClickedBox.box:-1,this.currentClickedBox.box}catch(i){return console.log("ObjectDetection MouseDownDrawEnable(MouseX:number,MouseY:number,BBox:Boundingbox[]):number",i.name+": ",i.message),-1}}},{key:"setPanXY",value:function(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"setGlobalXY",value:function(t,e){try{return!(!t||!e||(this.globalXY.x=t,this.globalXY.y=e,0))}catch(n){return console.log("ObjectDetection SetGlobalXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"changeLabel",value:function(t,e){!t||!e||(t.label=Object(Zt.a)(e))}},{key:"moveBoxWithinPointPath",value:function(t,e,n,i,a,o,s){try{return!(s.x1+a<t||s.x2+a>t+n||s.y1+o<e||s.y2+o>e+i)}catch(l){return console.log("ObjectDetection isWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, addx:number, addy:number, box:Boundingbox):Boolean",l.name+": ",l.message),!1}}},{key:"mouseClickWithinPointPath",value:function(t,e,n,i,a,o){try{return a>t&&a<t+n&&o>e&&o<e+i}catch(s){return console.log("ObjectDetection mouseClickWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, coorX:number,):boolean",s.name+": ",s.message),!1}}},{key:"drawAllBoxOn",value:function(n,i){try{if(n.length>0){var a,o=t(n.entries());try{for(o.s();!(a=o.n()).done;){var s=e(a.value,2),l=s[0],c=s[1];l===this.currentClickedBox.box||l===this.currentSelectedBndBox?(c.color="rgba(0,255,0,1.0)",c.lineWidth=2,this.drawEachBoxOn(c,i,!0)):(c.color="rgba(255,255,0,0.8)",c.lineWidth=1,this.drawEachBoxOn(c,i,!1))}}catch(f){o.e(f)}finally{o.f()}}if(-1===this.currentClickedBox.box&&-1===this.currentSelectedBndBox){var r,h=t(n);try{for(h.s();!(r=h.n()).done;){var u=r.value;u.color="rgba(255,255,0,0.8)",this.drawEachBoxOn(u,i,!1)}}catch(f){h.e(f)}finally{h.f()}var g=this.currentDrawing,b=g.x1,d=g.x2,m=g.y1,v=g.y2;this.tmpbox=this.generateNewBox(b,d,m,v),this.tmpbox&&this.drawEachBoxOn(this.tmpbox,i,!0)}}catch(f){console.log("redraw(boundbox) ----\x3e ",f.name+": ",f.message)}}},{key:"drawEachBoxOn",value:function(t,e,n){try{if(e){var i=t.x1+(t.x2-t.x1)/2,a=t.y1+(t.y2-t.y1)/2;e.strokeStyle=t.color,e.fillStyle=t.color,e.beginPath(),e.rect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),e.lineWidth=t.lineWidth,e.stroke(),n&&(e.beginPath(),e.fillRect(t.x1-this.anchrSize,t.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x1-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x1-this.anchrSize,t.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(i-this.anchrSize,t.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(i-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(i-this.anchrSize,t.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x2-this.anchrSize,t.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x2-this.anchrSize,a-this.anchrSize,2*this.anchrSize,2*this.anchrSize),e.fillRect(t.x2-this.anchrSize,t.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize))}}catch(o){console.log("ObjectDetection drawEachBoxOn(box:Boundingbox, context:CanvasRenderingContext2D, isSelected:boolean):void",o.name+": ",o.message)}}},{key:"generateNewBox",value:function(t,e,n,i){try{var a=t<e?t:e,o=n<i?n:i,s=t>e?t:e,l=n>i?n:i;return s-a>this.lineOffset&&l-o>this.lineOffset?{x1:a,y1:o,x2:s,y2:l,lineWidth:2,color:"rgba(0,255,0,1.0)",distancetoImg:{x:0,y:0},label:"default",id:this.utility.generateUniquesID()}:null}catch(c){return console.log("ObjectDetection GenerateNewBox(x1:number,x2:number,y1:number,y2:number):Boundingbox",c.name+": ",c.message),null}}},{key:"getBBoxDistfromImg",value:function(e,n,i){try{var a,o=t(e);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=s.x1,c=s.y1,r=s.distancetoImg,h=l-n,u=c-i;r.x=Object(Zt.a)(h),r.y=Object(Zt.a)(u)}}catch(g){o.e(g)}finally{o.f()}}catch(g){console.log("ObjectDetection GetBBoxDistfromImg(bbox:Boundingbox[],imgX:number,imgY:number)",g.name+": ",g.message)}}},{key:"getCurrentClickBox",value:function(t,e,n){try{return this.currentClickedBox=this.mouseClickOnBoxeses(t,e,n),this.currentClickedBox}catch(i){return console.log("ObjectDetection getCurrentClickBox(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}},{key:"mouseClickOnBoxeses",value:function(t,e,n){try{for(var i=0;i<n.length;++i){var a=n[i].x1+(n[i].x2-n[i].x1)/2,o=n[i].y1+(n[i].y2-n[i].y1)/2;if(n[i].x1-this.lineOffset<t&&t<n[i].x1+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tl"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"bl"};if(o-this.lineOffset<e&&e<o+this.lineOffset)return{box:i,pos:"l"}}else if(n[i].x2-this.lineOffset<t&&t<n[i].x2+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tr"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"br"};if(o-this.lineOffset<e&&e<o+this.lineOffset)return{box:i,pos:"r"}}else if(a-this.lineOffset<t&&t<a+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"t"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"b"};if(n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}else if(n[i].x1-this.lineOffset<t&&t<n[i].x2+this.lineOffset&&n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}return{box:-1,pos:"o"}}catch(s){return console.log("ObjectDetection mouseClickonBoxeses(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",s.name+": ",s.message),{box:-1,pos:"o"}}}}]),n}()).\u0275fac=function(t){return new(t||$t)},$t.\u0275prov=_.Db({token:$t,factory:$t.\u0275fac,providedIn:"any"}),$t),te=((Wt=function(){function n(){s(this,n),this.currentArr=[],this.undoArr=[],this.redoArr=[],this.maxStageSize=51,this.allowUndo=!1,this.allowRedo=!1,this.utility=new qt,this.removeLastArray=function(t){return t.splice(-1,1)[0]}}return c(n,[{key:"appendStages",value:function(t){t&&(this.redoArr=[],this.allowRedo=!1,0===this.currentArr.length?this.currentArr.push(this.utility.deepCloneVariable(t)):(this.undoArr.length===this.maxStageSize&&this.undoArr.splice(0,1),this.undoArr.push(this.removeLastArray(this.currentArr)),this.currentArr.push(this.utility.deepCloneVariable(t)),this.allowUndo=!0))}},{key:"clearAllStages",value:function(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.allowUndo=!1,this.allowRedo=!1}},{key:"undo",value:function(){if(this.allowRedo=!0,this.undoArr.length>0){this.redoArr.push(this.removeLastArray(this.currentArr));var t=this.removeLastArray(this.undoArr);return this.currentArr.push(t),this.allowUndo=0!==this.undoArr.length,t}return null}},{key:"redo",value:function(){var t=null;return 0!==this.redoArr.length&&(this.undoArr.push(this.removeLastArray(this.currentArr)),t=this.removeLastArray(this.redoArr),this.currentArr.push(t),this.allowRedo=0!==this.redoArr.length),this.allowUndo=this.undoArr.length>0,t}},{key:"clearRedundantStages",value:function(){var t,e;(null===(t=this.currentArr[0])||void 0===t?void 0:t.meta)&&"Polygons"in this.currentArr[0].meta||this.undoArr.length>0&&(!this.isStatgeChange((null===(e=this.undoArr[this.undoArr.length-1])||void 0===e?void 0:e.meta).bnd_box)||(this.currentArr.pop(),this.currentArr.push(this.removeLastArray(this.undoArr))))}},{key:"isAllowRedo",value:function(){return this.allowRedo}},{key:"isAllowUndo",value:function(){return this.allowUndo}},{key:"isMethodChange",value:function(t){var e;return(null===(e=this.currentArr[0])||void 0===e?void 0:e.method)!==t}},{key:"replaceStages",value:function(t){!t||(this.currentArr[0]=this.utility.deepCloneVariable(t))}},{key:"isStatgeChange",value:function(t){return null!=t&&!(!this.isAnnotationChange(t)&&!this.isLabelChange(t))}},{key:"isLabelChange",value:function(n){var i,a,o,s;if((null===(i=this.currentArr[0])||void 0===i?void 0:i.meta)&&"Polygons"in(null===(a=this.currentArr[0])||void 0===a?void 0:a.meta)){var l=n,c=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).polygons;if(l.length!==c.length)return!0;var r,h=t(c.entries());try{for(h.s();!(r=h.n()).done;){var u=e(r.value,2);u[0],u[1].label}}catch(_){h.e(_)}finally{h.f()}}else{var g=n,b=(null===(s=this.currentArr[0])||void 0===s?void 0:s.meta).bnd_box;if(g.length!==b.length)return!0;var d,m=t(b.entries());try{for(m.s();!(d=m.n()).done;){var v=e(d.value,2),f=v[0],y=v[1].label;if(g[f].label!==y)return!0}}catch(_){m.e(_)}finally{m.f()}}return!1}},{key:"isAnnotationChange",value:function(n){var i,a,o,s;if((null===(i=this.currentArr[0])||void 0===i?void 0:i.meta)&&"Polygons"in(null===(a=this.currentArr[0])||void 0===a?void 0:a.meta)){if(this.currentArr.length<1)return!0;var l=n,c=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).polygons;return l.length!==c.length||!!c.some(function(t,e){var n=t.coorPt;return l.some(function(t,i){var a=t.coorPt;return n[e].x!==a[i].x||n[e].y!==a[i].y})})||null}if(this.currentArr.length<1)return!0;var r=n,h=(null===(s=this.currentArr[0])||void 0===s?void 0:s.meta).bnd_box;if(r.length!==h.length)return!0;var u,g=t(r.entries());try{for(g.s();!(u=g.n()).done;){var b=e(u.value,2),d=b[0],m=b[1],v=m.x1,f=m.x2,y=m.y1,_=m.y2;return v!==h[d].x1||f!==h[d].x2||y!==h[d].y1||_!==h[d].y2||null}}catch(x){g.e(x)}finally{g.f()}return!1}}]),n}()).\u0275fac=function(t){return new(t||Wt)},Wt.\u0275prov=_.Db({token:Wt,factory:Wt.\u0275fac,providedIn:"any"}),Wt),ee=((Ft=function(){function e(){s(this,e),this.MEMO=null,this.utility=new qt}return c(e,[{key:"copy",value:function(t){!t||(this.MEMO=this.utility.deepCloneVariable(t))}},{key:"paste",value:function(){return this.MEMO?"coorPt"in this.MEMO?this.polygonPaste():this.boundingBoxPaste():null}},{key:"isAvailable",value:function(){return!!this.MEMO}},{key:"clear",value:function(){this.MEMO=null}},{key:"polygonPaste",value:function(){var e,n=this.utility.deepCloneObject(this.MEMO),i=n.coorPt,a=(n.id,t(i));try{for(a.s();!(e=a.n()).done;){var o=e.value;o.x+=8,o.y+=8,o.distancetoImg.x=0,o.distancetoImg.y=0}}catch(s){a.e(s)}finally{a.f()}return this.utility.generateUniquesID(),n}},{key:"boundingBoxPaste",value:function(){var t=this.utility.deepCloneObject(this.MEMO),e=t.x1,n=t.x2,i=t.y1,a=t.y2,o=(t.id,t.distancetoImg),s=n-e,l=a-i;return n=(e+=8)+s,a=(i+=8)+l,this.utility.generateUniquesID(),o.x=0,o.y=0,t}}]),e}()).\u0275fac=function(t){return new(t||Ft)},Ft.\u0275prov=_.Db({token:Ft,factory:Ft.\u0275fac,providedIn:"any"}),Ft),ne=["canvasdrawing"],ie=["crossh"],ae=["crossv"],oe=((Kt=function(){function t(e,n,i,a,o){s(this,t),this._boundingBoxCanvas=e,this._imgLblStateService=n,this._undoRedoService=i,this._copyPasteService=a,this._annotateSelectState=o,this.img=new Image,this.mousedown=!1,this._imgSrc="",this._onChangeMetadata=new _.n}return c(t,[{key:"ngOnInit",value:function(){var t=this;this._imgLblStateService.action$.subscribe(function(e){return t.boundingBoxState=e,t.isFitCenter(),t.isClearCanvas()}),this._annotateSelectState.labelStaging$.subscribe(function(e){return t.annotateState=e,t.annotateStateOnChange()})}},{key:"ngOnChanges",value:function(t){var e,n;try{console.log(t),!t._imgSrc.currentValue||(this.initCanvas(),this.context=(null===(n=null===(e=this.mycanvas)||void 0===e?void 0:e.nativeElement)||void 0===n?void 0:n.getContext("2d"))?this.mycanvas.nativeElement.getContext("2d"):null,this._undoRedoService.clearAllStages(),this.loadImages(t._imgSrc.currentValue))}catch(i){}}},{key:"emitMetadata",value:function(){this._onChangeMetadata.emit(this._selectMetadata)}},{key:"annotateStateMakeChange",value:function(t){null===t||this._annotateSelectState.setState(t)}},{key:"rulesMakeChange",value:function(t,e,n){try{var i=Object(Zt.a)(this.boundingBoxState);null===t||(i.scroll=t),null===e||(i.fitCenter=e),null===n||(i.clear=n),this._imgLblStateService.setState(i)}catch(a){}}},{key:"isClearCanvas",value:function(){try{this.boundingBoxState.clear&&(this._selectMetadata.bnd_box=[],this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.rulesMakeChange(null,null,!1),this.emitMetadata())}catch(t){}}},{key:"isFitCenter",value:function(){try{!this.boundingBoxState.fitCenter||this.imgFitToCenter()}catch(t){}}},{key:"annotateStateOnChange",value:function(){this.annotateState&&this._boundingBoxCanvas.setCurrentSelectedbBox(Object(Zt.a)(this.annotateState.annotation))}},{key:"imgFitToCenter",value:function(){var t=this;try{var e=this._boundingBoxCanvas.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=e.factor,this._selectMetadata.img_h*=e.factor,this._boundingBoxCanvas.scaleAllBoxes(e.factor,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(){}),this._selectMetadata.img_x=e.newX,this._selectMetadata.img_y=e.newY,this._boundingBoxCanvas.setGlobalXY(e.newX,e.newY),this._boundingBoxCanvas.moveAllBbox(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(e){if(e){var n=Object(Zt.a)(t._selectMetadata);return t._undoRedoService.isMethodChange("zoom")?t._undoRedoService.appendStages({meta:n,method:"zoom"}):t._undoRedoService.replaceStages({meta:n,method:"zoom"})}return{}}),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata(),this.rulesMakeChange(null,!1,null)}catch(n){}}},{key:"keyStrokeEvent",value:function(t){var e=this;try{if(!this.mousedown){var n=this.boundingBoxState.isActiveModal;if(!t.ctrlKey||"c"!==t.key&&"C"!==t.key||n)if(!t.ctrlKey||"v"!==t.key&&"V"!==t.key||n){if(!t.ctrlKey||!t.shiftKey||"z"!==t.key&&"Z"!==t.key||n){if(!t.ctrlKey||"z"!==t.key&&"Z"!==t.key||n)n||"Delete"!==t.key&&"Backspace"!==t.key?"ArrowLeft"!==t.key||n?"ArrowRight"!==t.key||n?"ArrowUp"!==t.key||n?"ArrowDown"===t.key&&!n&&this.keyMoveBox("down"):this.keyMoveBox("up"):this.keyMoveBox("right"):this.keyMoveBox("left"):this._boundingBoxCanvas.deleteSingleBox(this._selectMetadata.bnd_box,this.annotateState.annotation,function(t){!t||(e.annotateStateMakeChange({annotation:-1,isDlbClick:!1}),e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"}),e.emitMetadata())});else if(this._undoRedoService.isAllowUndo()){var i=this._undoRedoService.undo();this._selectMetadata=Object(Zt.a)(null==i?void 0:i.meta),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}}else if(this._undoRedoService.isAllowRedo()){var a=this._undoRedoService.redo();this._selectMetadata=Object(Zt.a)(null==a?void 0:a.meta),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}}else this._copyPasteService.isAvailable()&&(this._selectMetadata.bnd_box.push(this._copyPasteService.paste()),this.annotateStateMakeChange({annotation:this._selectMetadata.bnd_box.length-1,isDlbClick:!1}),this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y)),this._undoRedoService.appendStages({meta:Object(Zt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata(),this.mycanvas.nativeElement.focus();else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation])}}catch(o){}}},{key:"toggleEvent",value:function(t){try{this.annotateState.annotation>-1&&(this._undoRedoService.clearRedundantStages(),this.annotateStateMakeChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){}}},{key:"mouseScroll",value:function(t){try{var e=Math.max(-1,Math.min(1,-t.deltaY||-t.detail));e&&this.boundingBoxState.scroll&&this.zoomImage(e)}catch(n){console.log("MouseScroll(event: WheelEvent)",n.name+": ",n.message)}}},{key:"mouseDown",value:function(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)&&(this.mousedown=!0,this.rulesMakeChange(!1,null,null),this.boundingBoxState.drag&&this._boundingBoxCanvas.setPanXY(t.offsetX,t.offsetY),this.boundingBoxState.draw)){var e=this._boundingBoxCanvas.mouseDownDrawEnable(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.annotateStateMakeChange(Object(Zt.a)({annotation:e,isDlbClick:!1})),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}}catch(n){console.log("MouseDown(event: MouseEvent)",n.name+": ",n.message)}}},{key:"mouseUp",value:function(t){var e=this;try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)){if(this.boundingBoxState.drag&&this.mousedown&&this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.boundingBoxState.draw&&this.mousedown){var n=this._boundingBoxCanvas.mouseUpDrawEnable(this._selectMetadata,function(t){!t||!e._undoRedoService.isStatgeChange(e._selectMetadata.bnd_box)||e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"})});!n.isNew||this.annotateStateMakeChange({annotation:n.selBox,isDlbClick:!1})}this.mousedown=!1,this.rulesMakeChange(!0,null,null),this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this.emitMetadata()}}catch(i){console.log("MouseUp(event: MouseEvent)",i.name+": ",i.message)}}},{key:"mouseMove",value:function(t){var e=this;try{if(this._selectMetadata)if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)){if(this.boundingBoxState.drag&&this.mousedown){var n=this._boundingBoxCanvas.getdiffXY(t.offsetX,t.offsetY);this._selectMetadata.img_x=n.diffX,this._selectMetadata.img_y=n.diffY,this._boundingBoxCanvas.panRectangle(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){if(t){var n=Object(Zt.a)(e._selectMetadata);return e._undoRedoService.isMethodChange("pan")?e._undoRedoService.appendStages({meta:n,method:"pan"}):e._undoRedoService.replaceStages({meta:n,method:"pan"})}return{}}),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}this.boundingBoxState.draw&&this.mousedown&&(this._boundingBoxCanvas.mouseMoveDrawEnable(t.offsetX,t.offsetY,this._selectMetadata),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h))}else"-1"===this.crossh.nativeElement.style.zIndex&&"hidden"===this.crossh.nativeElement.style.visibility&&"-1"===this.crossv.nativeElement.style.zIndex&&"hidden"===this.crossv.nativeElement.style.visibility||(this.crossh.nativeElement.style.zIndex="-1",this.crossh.nativeElement.style.visibility="hidden",this.crossv.nativeElement.style.zIndex="-1",this.crossv.nativeElement.style.visibility="hidden")}catch(i){console.log("MouseMove(event: MouseEvent)",i.name+": ",i.message)}}},{key:"mouseOut",value:function(t){try{this.boundingBoxState.drag&&this.mousedown&&(this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)),this.mousedown=!1}catch(e){console.log("MouseOut(event: MouseEvent)",e.name+": ",e.message)}}},{key:"initCanvas",value:function(){try{this.mycanvas.nativeElement.style.width="80%",this.mycanvas.nativeElement.style.height="90%",this.mycanvas.nativeElement.width=this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.height=this.mycanvas.nativeElement.offsetHeight}catch(t){}}},{key:"loadImages",value:function(t){var e=this;try{this.img.src=t,this.img.onload=function(){e._selectMetadata.img_w=e._selectMetadata.img_w<1?e._selectMetadata.img_ori_w:e._selectMetadata.img_w,e._selectMetadata.img_h=e._selectMetadata.img_h<1?e._selectMetadata.img_ori_h:e._selectMetadata.img_h,e._boundingBoxCanvas.setGlobalXY(e._selectMetadata.img_x,e._selectMetadata.img_y),e.imgFitToCenter(),e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"})}}catch(n){}}},{key:"keyMoveBox",value:function(t){var e=this;try{this._boundingBoxCanvas.keyboardMoveBox(t,this._selectMetadata.bnd_box[this.annotateState.annotation],this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,function(t){!t||(e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"}),e.emitMetadata())})}catch(n){}}},{key:"redrawImages",value:function(t,e,n,i){var a;try{this.clearcanvas(),null===(a=this.context)||void 0===a||a.drawImage(this.img,t,e,n,i),this._boundingBoxCanvas.drawAllBoxOn(this._selectMetadata.bnd_box,this.context),this.mycanvas.nativeElement.focus()}catch(o){}}},{key:"clearcanvas",value:function(){var t;try{null===(t=this.context)||void 0===t||t.clearRect(0,0,this.mycanvas.nativeElement.width,this.mycanvas.nativeElement.height)}catch(e){}}},{key:"zoomImage",value:function(t){var e=this;try{t>0?(this._selectMetadata.img_w*=1.1,this._selectMetadata.img_h*=1.1,this._boundingBoxCanvas.scaleAllBoxes(1.1,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){!t||(e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"zoom"}),e.emitMetadata())})):.9*this._selectMetadata.img_w>100&&.9*this._selectMetadata.img_h>100&&(this._selectMetadata.img_w*=.9,this._selectMetadata.img_h*=.9,this._boundingBoxCanvas.scaleAllBoxes(.9,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){if(t){var n=Object(Zt.a)(e._selectMetadata);e.emitMetadata(),e._undoRedoService.isMethodChange("zoom")?e._undoRedoService.appendStages({meta:n,method:"zoom"}):e._undoRedoService.replaceStages({meta:n,method:"zoom"})}})),this._copyPasteService.isAvailable()&&this._copyPasteService.clear(),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}catch(n){}}}]),t}()).\u0275fac=function(t){return new(t||Kt)(_.Hb(Qt),_.Hb(B),_.Hb(te),_.Hb(ee),_.Hb(I))},Kt.\u0275cmp=_.Bb({type:Kt,selectors:[["image-labelling-object-detection"]],viewQuery:function(t,e){var n;1&t&&(_.pc(ne,!0),_.pc(ie,!0),_.pc(ae,!0)),2&t&&(_.dc(n=_.Ub())&&(e.mycanvas=n.first),_.dc(n=_.Ub())&&(e.crossh=n.first),_.dc(n=_.Ub())&&(e.crossv=n.first))},hostBindings:function(t,e){1&t&&_.Tb("keydown",function(t){return e.keyStrokeEvent(t)},!1,_.fc)("dblclick",function(t){return e.toggleEvent(t)})("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[_.vb],decls:7,vars:0,consts:[[1,"canvasstyle"],["canvasdrawing",""],[1,"crosses","cross-h"],["crossh",""],[1,"crosses","cross-v"],["crossv",""]],template:function(t,e){1&t&&(_.Mb(0,"div"),_.Ib(1,"canvas",0,1),_.Ib(3,"div",2,3),_.Ib(5,"div",4,5),_.Lb())},styles:[".cross-h[_ngcontent-%COMP%]{width:100%;height:1px;margin-top:-1px;opacity:.8}.cross-v[_ngcontent-%COMP%]{height:100%;width:1px;margin-left:-1px;opacity:.8}.crosses[_ngcontent-%COMP%]{position:fixed;background-color:#ff0;box-shadow:0 0 5px #646464;pointer-events:none;visibility:hidden}.canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}"],changeDetection:0}),Kt),se=((Ht=function(){function i(){s(this,i),this.tmpPolygon={color:"",coorPt:[],id:0,label:"",lineWidth:0,region:"",subLabel:[]},this.radius=3.5,this.util=new qt,this.globalXY={x:-1,y:-1},this.panXY={x:0,y:0},this.isNewPoly=!1,this.distanceOffset=8,this.selectedPolygon=-1,this.clickPoint={polygonIndex:-1,PointIndex:-1}}return c(i,[{key:"whenMouseDownEvent",value:function(t,e,n,i,a,o,s,l,c,r,h){return this.setGlobalXY(t,e),this.findPolygonArea(t,e,s),this.clickPoint=this.findClickPoint(t,e,s),this.isNewPolygon()&&r?this.setPanXY(t,e):null===this.tmpPolygon&&this.selectedPolygon<0||h?(this.setpolygonslineWidth(s,-1),this.selectedPolygon=-1,this.setNewpolygon(!0),this.pushTmpPoint(t,e,n,i,s.polygons.length)):this.isNewPolygon()?(this.pushTmpPoint(t,e,n,i,s.polygons.length),this.drawNewPolygon(s,l,c,a,o,!1),this.drawfromPreviousPoint(t,e,c)):(this.setNewpolygon(!1),this.selectedPolygon=this.findPolygonArea(t,e,s)>-1?this.findPolygonArea(t,e,s):this.findClickPoint(t,e,s).polygonIndex,this.setpolygonslineWidth(s,this.selectedPolygon)),this.selectedPolygon}},{key:"whenMouseMoveEvent",value:function(t,e,n,i,a,o,s,l,c,r){if(this.isNewPolygon()&&l&&c){var h=o-this.getPanX(),u=s-this.getPanY();t&&(t.img_x=this.getGlobalX()+h,t.img_y=this.getGlobalY()+u,this.panPolygons(t,t.img_x,t.img_y,!0),r("pan"))}else this.isNewPolygon()?(this.drawNewPolygon(t,e,n,i,a,!1),this.drawfromPreviousPoint(o,s,n)):this.selectedPolygon>-1&&c?this.mouseMovePolygon(o,s,t,n,this.selectedPolygon,e,i,a):(this.setPolygonCoordinate(o,s,t,this.clickPoint.polygonIndex,this.clickPoint.PointIndex),r("draw"))}},{key:"setPanXY",value:function(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"getPanX",value:function(){return this.panXY.x}},{key:"getPanY",value:function(){return this.panXY.y}},{key:"setSelectedPolygon",value:function(t){!t||(this.selectedPolygon=t)}},{key:"getSelectedPolygon",value:function(){return this.selectedPolygon}},{key:"mouseClickWithinPointPath",value:function(t,e,n,i,a,o){return a>t&&a<t+n&&o>e&&o<e+i}},{key:"calScaleTofitScreen",value:function(t,e,n,i){try{var a={factor:-1,newX:-1,newY:-1};return a.factor=Math.min(n/t,i/e),a.factor=a.factor-.05*a.factor,a.newX=n/2-t/2*a.factor,a.newY=i/2-e/2*a.factor,a}catch(o){return{factor:-1,newX:-1,newY:-1}}}},{key:"pushTmpPoint",value:function(t,e,n,i,a){try{var o=t-n,s=e-i;if(null!=this.tmpPolygon){var l=this.calculatePointDistance(this.tmpPolygon.coorPt[this.tmpPolygon.coorPt.length-1].x,this.tmpPolygon.coorPt[this.tmpPolygon.coorPt.length-1].y,t,e);l&&l>this.distanceOffset&&this.tmpPolygon.coorPt.push({x:t,y:e,distancetoImg:{x:o,y:s}})}else this.generateNewtmpPolygon(a),this.tmpPolygon.coorPt.push({x:t,y:e,distancetoImg:{x:o,y:s}})}catch(c){console.log("segmentation pushTmpPoint(mouseX:number, mouseY:number) ----\x3e ",c.name+": ",c.message)}}},{key:"removeLastPoint",value:function(t,e,n,i,a){try{return this.tmpPolygon&&this.tmpPolygon.coorPt.length>1?(this.tmpPolygon.coorPt.pop(),!1):(this.resetDrawing(t,e,n,i,a),!0)}catch(o){return console.log("segmentation removeLastPoint() ----\x3e ",o.name+": ",o.message),!1}}},{key:"calculatePointDistance",value:function(t,e,n,i){try{var a=t-n,o=e-i;return Math.sqrt(a*a+o*o)}catch(s){return void console.log("segmentation calculatePointDistance(p1x:number,p1y:number,p2x:number,p2y:number):number ----\x3e ",s.name+": ",s.message)}}},{key:"generateNewtmpPolygon",value:function(t){try{var e=this.util.generateUniquesID(),n=(t+1).toString();this.tmpPolygon={coorPt:[],label:"default",id:e,lineWidth:2,color:"#FFFAFA",region:n,subLabel:[]}}catch(i){console.log("segmentation generateNewtmpPolygon() ----\x3e ",i.name+": ",i.message)}}},{key:"resetDrawing",value:function(t,e,n,i,a){try{this.tmpPolygon=null,this.setNewpolygon(!1),this.redraw(t,n,e,i,a,t.img_w,t.img_h,t.img_x,t.img_y,-1)}catch(o){console.log("segmentation resetDrawing(context:CanvasRenderingContext2D, img:HTMLImageElement, canvasW:number, canvasH:number) ----\x3e ",o.name+": ",o.message)}}},{key:"setNewpolygon",value:function(t){try{this.isNewPoly=t}catch(e){console.log("segmentation setNewpolygon(state:Boolean) ----\x3e ",e.name+": ",e.message)}}},{key:"redraw",value:function(t,e,n,i,a,o,s,l,c,r){try{n.restore(),n.clearRect(0,0,i,a),n.save(),n.beginPath(),n.rect(l,c,o,s),n.clip(),n.beginPath(),n.drawImage(e,l,c,o,s),this.drawAllPolygons(t,n,r)}catch(h){console.log("segmentation redraw(img:HTMLImageElement,context:CanvasRenderingContext2D, canvasW:number, canvasH:number, imgW:number, imgH:number, imgX:number, imgY:number) ----\x3e ",h.name+": ",h.message)}}},{key:"drawAllPolygons",value:function(t,e,n){try{this.drawAllPolygonsLine(t,e,1),this.drawAllPolygonsDots(t,e,n,this.radius,1),this.plotAllFloatLabel(t,1)}catch(i){console.log("segmentation drawAllPolygons(context:CanvasRenderingContext2D) ----\x3e ",i.name+": ",i.message)}}},{key:"drawAllPolygonsLine",value:function(t,e,n){try{for(var i=0;i<n;++i){e.lineWidth=t.polygons[i].lineWidth,e.strokeStyle=t.polygons[i].color,e.fillStyle=t.polygons[i].color,e.beginPath(),e.moveTo(t.polygons[i].coorPt[0].x,t.polygons[i].coorPt[0].y);for(var a=0;a<t.polygons[i].coorPt.length;++a)a+1<t.polygons[i].coorPt.length&&e.lineTo(t.polygons[i].coorPt[a+1].x,t.polygons[i].coorPt[a+1].y);e.closePath(),e.stroke()}}catch(o){console.log("segmentation drawAllPolygonsLine(context:CanvasRenderingContext2D) ----\x3e ",o.name+": ",o.message)}}},{key:"drawAllPolygonsDots",value:function(i,a,o,s,l){try{for(var c=0;c<l;++c)if(c===o){a.strokeStyle="green",a.fillStyle="green";var r,h=t(i.polygons[c].coorPt.entries());try{for(h.s();!(r=h.n()).done;){var u=e(r.value,2),g=u[0];n(u[1]),a.beginPath(),a.arc(i.polygons[c].coorPt[g].x,i.polygons[c].coorPt[g].y,s,0,2*Math.PI),a.fill(),a.closePath(),a.stroke()}}catch(b){h.e(b)}finally{h.f()}}}catch(b){console.log("segmentation drawAllPolygonsDots(context:CanvasRenderingContext2D) ----\x3e ",b.name+": ",b.message)}}},{key:"plotAllFloatLabel",value:function(t,e){try{this.clearAllDIV(t,1);for(var n=0;n<e;++n){var i=t.polygons[n].region.toString(),a=this.createDIV(i,t.polygons[n].id,t.polygons[n].coorPt[0].x,t.polygons[n].coorPt[0].y),o=document.getElementById("");o&&a&&o.appendChild(a)}}catch(s){console.log("segmentation plotAllFloatLabel() ----\x3e ",s.name+": ",s.message)}}},{key:"clearAllDIV",value:function(t,e){try{for(var n=0;n<e;++n)this.util.RemoveHTMLElement("float_"+t.polygons[n].id.toString())}catch(i){console.log("segmentation clearAllDIV() ----\x3e ",i.name+": ",i.message)}}},{key:"createDIV",value:function(t,e,n,i){try{var a=document.createElement("div");return a.id="float_"+e.toString(),a.style.position="absolute",a.style.top=(i+this.radius+.5).toString()+"px",a.style.left=(n+this.radius+.5).toString()+"px",a.style.backgroundColor="rgba(255,255,255,0.5)",a.style.pointerEvents="none",a.style.color="black",a.innerText=t,a}catch(o){console.log("segmentation setCurrentSelectedimguid(uid:number) ----\x3e ",o.name+": ",o.message)}}},{key:"setGlobalXY",value:function(t,e){try{this.globalXY.x=t,this.globalXY.y=e}catch(n){console.log("segmentation setGlobalXY(offsetX:number, offsetY:number) ----\x3e ",n.name+": ",n.message)}}},{key:"getGlobalX",value:function(){return this.globalXY.x}},{key:"getGlobalY",value:function(){return this.globalXY.y}},{key:"mouseMovePolygon",value:function(i,a,o,s,l,c,r,h){try{var u=i-this.globalXY.x,g=a-this.globalXY.y;if(this.WithinPointPath(o,o.img_x,o.img_y,o.img_w,o.img_h,l,u,g)){this.globalXY.x=i,this.globalXY.y=a;var b,d=t(o.polygons[l].coorPt.entries());try{for(d.s();!(b=d.n()).done;){var m=e(b.value,2),v=m[0];n(m[1]),o.polygons[l].coorPt[v].x+=u,o.polygons[l].coorPt[v].y+=g}}catch(f){d.e(f)}finally{d.f()}this.redraw(o,c,s,r,h,o.img_w,o.img_h,o.img_x,o.img_y,l)}}catch(f){console.log("segmentation MovePolygon(e:MouseEvent, context:CanvasRenderingContext2D, PolyIndex:number, img:HTMLImageElement, canvasW:number, canvasH:number, imgW:number, imgH:number, imgx:number, imgy:number) ----\x3e ",f.name+": ",f.message)}}},{key:"keyboardMovePolygon",value:function(n,i,a,o,s,l,c,r){try{if(void 0!==a&&-1!==a&&n){var h=n.img_x,u=n.img_y,g=n.img_w,b=n.img_h,d=-3;switch(i){case"up":if(this.WithinPointPath(n,h,u,g,b,a,0,d)){var m,v=t(n.polygons[a].coorPt.entries());try{for(v.s();!(m=v.n()).done;){var f=e(m.value,1)[0];n.polygons[a].coorPt[f].y+=d}}catch(k){v.e(k)}finally{v.f()}}break;case"left":if(this.WithinPointPath(n,h,u,g,b,a,d,0)){var y,_=t(n.polygons[a].coorPt.entries());try{for(_.s();!(y=_.n()).done;){var x=e(y.value,1)[0];n.polygons[a].coorPt[x].x+=d}}catch(k){_.e(k)}finally{_.f()}}break;case"down":if(this.WithinPointPath(n,h,u,g,b,a,0,d)){var p,M=t(n.polygons[a].coorPt.entries());try{for(M.s();!(p=M.n()).done;){var w=e(p.value,1)[0];n.polygons[a].coorPt[w].y+=d}}catch(k){M.e(k)}finally{M.f()}}break;case"right":if(this.WithinPointPath(n,h,u,g,b,a,d,0)){var S,P=t(n.polygons[a].coorPt.entries());try{for(P.s();!(S=P.n()).done;){var C=e(S.value,1)[0];n.polygons[a].coorPt[C].x+=d}}catch(k){P.e(k)}finally{P.f()}}}this.redraw(n,s,o,l,c,n.img_w,n.img_h,n.img_x,n.img_y,a),this.validateXYDistance(n,n.img_x,n.img_y),r(!0)}return!0}catch(k){return console.log("segmentation MoveSinglePolygon(direction:string, PolyIndex:number, context:CanvasRenderingContext2D, img:HTMLImageElement, canvasW:number, canvasH:number, selectedpolygon:number) ----\x3e ",k.name+": ",k.message),!0}}},{key:"WithinPointPath",value:function(n,i,a,o,s,l,c,r){try{var h,u=t(n.polygons[l].coorPt.entries());try{for(u.s();!(h=u.n()).done;){var g=e(h.value,1)[0];if(n.polygons[l].coorPt[g].x+c<i||n.polygons[l].coorPt[g].x+c>i+o||n.polygons[l].coorPt[g].y+r<a||n.polygons[l].coorPt[g].y+r>a+s)return!1}}catch(b){u.e(b)}finally{u.f()}return!0}catch(b){return!1}}},{key:"validateXYDistance",value:function(n,i,a){try{var o,s=t(n.polygons.entries());try{for(s.s();!(o=s.n()).done;){var l,c=e(o.value,1)[0],r=t(n.polygons[c].coorPt.entries());try{for(r.s();!(l=r.n()).done;){var h=e(l.value,1)[0],u=n.polygons[c].coorPt[h].y-a;n.polygons[c].coorPt[h].distancetoImg.x=n.polygons[c].coorPt[h].x-i,n.polygons[c].coorPt[h].distancetoImg.y=u}}catch(g){r.e(g)}finally{r.f()}}}catch(g){s.e(g)}finally{s.f()}}catch(g){console.log("segmentation validateXYDistance(imgX:number, imgY:number) ----\x3e ",g.name+": ",g.message)}}},{key:"setpolygonslineWidth",value:function(t,e){try{for(var n=0;n<t.polygons.length;++n)t.polygons[n].lineWidth=n===e?2:1}catch(i){}}},{key:"drawNewPolygon",value:function(n,i,a,o,s,l){try{if(this.redraw(n,i,a,o,s,n.img_w,n.img_h,n.img_x,n.img_y,-1),this.tmpPolygon){var c,r=t(this.tmpPolygon.coorPt.entries());try{for(r.s();!(c=r.n()).done;){var h=e(c.value,1)[0];a.strokeStyle="green",a.fillStyle="green",a.beginPath(),a.arc(this.tmpPolygon.coorPt[h].x,this.tmpPolygon.coorPt[h].y,this.radius,0,2*Math.PI),a.fill(),a.closePath(),a.stroke()}}catch(g){r.e(g)}finally{r.f()}a.beginPath(),a.lineWidth=this.tmpPolygon.lineWidth,a.strokeStyle=this.tmpPolygon.color,a.fillStyle=this.tmpPolygon.color,a.moveTo(this.tmpPolygon.coorPt[0].x,this.tmpPolygon.coorPt[0].y);for(var u=0;u<this.tmpPolygon.coorPt.length;++u)u+1<this.tmpPolygon.coorPt.length&&a.lineTo(this.tmpPolygon.coorPt[u+1].x,this.tmpPolygon.coorPt[u+1].y)}l?(a.closePath(),a.stroke(),null!=this.tmpPolygon&&(n.polygons.push(Object(Zt.a)(this.tmpPolygon)),this.setpolygonslineWidth(n,n.polygons.length-1),this.tmpPolygon=null),this.setNewpolygon(!1),this.redraw(n,i,a,o,s,n.img_w,n.img_h,n.img_x,n.img_y,n.polygons.length-1)):a.stroke()}catch(g){console.log("segmentation drawNewPolygon(img:HTMLImageElement, context:CanvasRenderingContext2D, canvasW:number, canvasH:number, imgWidth:number, imgHeight:number, closepath:Boolean, imgx:number, imgy:number) ----\x3e ",g.name+": ",g.message)}}},{key:"drawfromPreviousPoint",value:function(t,e,n){try{this.tmpPolygon&&this.tmpPolygon.coorPt.length>0&&(n.beginPath(),n.moveTo(this.tmpPolygon.coorPt[this.tmpPolygon.coorPt.length-1].x,this.tmpPolygon.coorPt[this.tmpPolygon.coorPt.length-1].y),n.lineTo(t,e),n.stroke())}catch(i){console.log("segmentation drawfromPreviousPoint(e:MouseEvent, context:CanvasRenderingContext2D) ----\x3e ",i.name+": ",i.message)}}},{key:"returnTempPoly",value:function(){try{return null!=this.tmpPolygon?this.tmpPolygon:null}catch(t){return console.log("segmentation returnTempPoly() ----\x3e ",t.name+": ",t.message),null}}},{key:"setPolygonCoordinate",value:function(t,e,n,i,a){try{-1!==i&&-1!==a&&(n.polygons[i].coorPt[a].x=t,n.polygons[i].coorPt[a].y=e)}catch(o){console.log("segmentation setPolygonCoordinate(e:MouseEvent, selectedPoly:number, PointIndex:number) ----\x3e ",o.name+": ",o.message)}}},{key:"insidePolygonArea",value:function(t,e,n){try{for(var i=!1,a=0,o=t.length-1;a<t.length;o=a++)t[a].y>n!=t[o].y>n&&e<(t[o].x-t[a].x)*(n-t[a].y)/(t[o].y-t[a].y)+t[a].x&&(i=!i);return i}catch(s){return console.log("segmentation insidePolygonArea(vert:coordinate[], mouseX:number, mouseY:number):boolean ----\x3e ",s.name+": ",s.message),!1}}},{key:"CalculatePolygonArea",value:function(t){try{for(var e=0,n=t.coorPt.length-1,i=0;i<t.coorPt.length;++i)e+=(t.coorPt[n].x+t.coorPt[i].x)*(t.coorPt[n].y-t.coorPt[i].y),n=i;return Math.abs(e/2)}catch(a){return-1}}},{key:"findPolygonArea",value:function(t,e,n){try{for(var i=-1,a=1e7,o=0;o<n.polygons.length;++o)if(this.insidePolygonArea(n.polygons[o].coorPt,t,e)){var s=this.CalculatePolygonArea(n.polygons[o]);s<a&&(i=o,a=Object(Zt.a)(s))}return i}catch(l){return console.log("segmentation findPolygonArea(e:MouseEvent):number ----\x3e ",l.name+": ",l.message),-1}}},{key:"findClickPoint",value:function(t,e,n){try{for(var i={polygonIndex:-1,PointIndex:-1},a=0;a<n.polygons.length;++a)for(var o=0;o<n.polygons[a].coorPt.length;++o)if(Math.sqrt(Math.pow(t-n.polygons[a].coorPt[o].x,2)+Math.pow(e-n.polygons[a].coorPt[o].y,2))<=this.radius){i.polygonIndex=a,i.PointIndex=o;break}return i}catch(s){return console.log("segmentation findClickPoint(e:MouseEvent, radius:number):{polygonIndex:number, PointIndex:number} ----\x3e ",s.name+": ",s.message),{polygonIndex:-1,PointIndex:-1}}}},{key:"isNewPolygon",value:function(){try{return this.isNewPoly}catch(t){return console.log("segmentation isNewPolygon():Boolean ----\x3e ",t.name+": ",t.message),!1}}},{key:"deleteSinglePolygon",value:function(t,e,n){}},{key:"scalePolygons",value:function(n,i,a,o,s){try{console.log(n);var l,c=t(n.polygons.entries());try{for(c.s();!(l=c.n()).done;){var r,h=e(l.value,1)[0],u=t(n.polygons[h].coorPt.entries());try{for(u.s();!(r=u.n()).done;){var g=e(r.value,1)[0];n.polygons[h].coorPt[g].x=n.polygons[h].coorPt[g].distancetoImg.x*i+a,n.polygons[h].coorPt[g].y=n.polygons[h].coorPt[g].distancetoImg.y*i+o,n.polygons[h].coorPt[g].distancetoImg.x=n.polygons[h].coorPt[g].x-a,n.polygons[h].coorPt[g].distancetoImg.y=n.polygons[h].coorPt[g].y-o}}catch(b){u.e(b)}finally{u.f()}}}catch(b){c.e(b)}finally{c.f()}this.setpolygonslineWidth(n,-1),s&&s(!0)}catch(b){console.log("segmentation scalePolygons(scaleFactor:number, imgX:number, imgY:number) ----\x3e ",b.name+": ",b.message)}}},{key:"panPolygons",value:function(n,i,a,o){try{if(o&&this.tmpPolygon){var s,l=t(this.tmpPolygon.coorPt.entries());try{for(l.s();!(s=l.n()).done;){var c=e(s.value,1)[0];this.tmpPolygon.coorPt[c].x=Object(Zt.a)(i)+Object(Zt.a)(this.tmpPolygon.coorPt[c].distancetoImg.x),this.tmpPolygon.coorPt[c].y=Object(Zt.a)(a)+Object(Zt.a)(this.tmpPolygon.coorPt[c].distancetoImg.y)}}catch(m){l.e(m)}finally{l.f()}}var r,h=t(n.polygons.entries());try{for(h.s();!(r=h.n()).done;){var u,g=e(r.value,1)[0],b=t(n.polygons[g].coorPt.entries());try{for(b.s();!(u=b.n()).done;){var d=e(u.value,1)[0];n.polygons[g].coorPt[d].x=Object(Zt.a)(i)+Object(Zt.a)(n.polygons[g].coorPt[d].distancetoImg.x),n.polygons[g].coorPt[d].y=Object(Zt.a)(a)+Object(Zt.a)(n.polygons[g].coorPt[d].distancetoImg.y)}}catch(m){b.e(m)}finally{b.f()}}}catch(m){h.e(m)}finally{h.f()}}catch(m){console.log("segmentation panPolygons(imgX:number, imgY:number) ----\x3e ",m.name+": ",m.message)}}}]),i}()).\u0275fac=function(t){return new(t||Ht)},Ht.\u0275prov=_.Db({token:Ht,factory:Ht.\u0275fac,providedIn:"any"}),Ht),le=["canvasdrawing"],ce=["crossh"],re=["crossv"],he=((Jt=function(){function t(e,n,i,a,o){s(this,t),this._segCanvasService=e,this._imgLblStateService=n,this._undoRedoService=i,this._copyPasteService=a,this._annotateSelectState=o,this.img=new Image,this.mousedown=!1,this.altdown=!1,this.isctrlHold=!1,this._imgSrc="",this._onChangeMetadata=new _.n}return c(t,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(t){var e,n;try{console.log(t),!t._imgSrc.currentValue||(this.initCanvas(),this.context=(null===(n=null===(e=this.mycanvas)||void 0===e?void 0:e.nativeElement)||void 0===n?void 0:n.getContext("2d"))?this.mycanvas.nativeElement.getContext("2d"):null,this.loadImages(t._imgSrc.currentValue))}catch(i){}}},{key:"initCanvas",value:function(){try{this.mycanvas.nativeElement.style.width="80%",this.mycanvas.nativeElement.style.height="90%",this.mycanvas.nativeElement.width=this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.height=this.mycanvas.nativeElement.offsetHeight}catch(t){}}},{key:"loadImages",value:function(t){var e=this;try{this.img.src=t,this.img.onload=function(){e._selectMetadata.img_w=e._selectMetadata.img_w<1?e._selectMetadata.img_ori_w:e._selectMetadata.img_w,e._selectMetadata.img_h=e._selectMetadata.img_h<1?e._selectMetadata.img_ori_h:e._selectMetadata.img_h,e._segCanvasService.setGlobalXY(e._selectMetadata.img_x,e._selectMetadata.img_y),e.imgFitToCenter(),e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"})}}catch(n){}}},{key:"emitMetadata",value:function(){this._onChangeMetadata.emit(this._selectMetadata)}},{key:"annotateStateMakeChange",value:function(t){t&&this._annotateSelectState.setState(t)}},{key:"annotateStateOnChange",value:function(){this.annotateState&&this._segCanvasService.setSelectedPolygon(Object(Zt.a)(this.annotateState.annotation))}},{key:"rulesMakeChange",value:function(t,e,n){try{var i=Object(Zt.a)(this.segState);t&&(i.scroll=t),e&&(i.fitCenter=e),n&&(i.clear=n),this._imgLblStateService.setState(i)}catch(a){}}},{key:"imgFitToCenter",value:function(){try{var t=this._segCanvasService.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.mycanvas.nativeElement.offsetWidth,this.mycanvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._segCanvasService.scalePolygons(this._selectMetadata,t.factor,this._selectMetadata.img_x,this._selectMetadata.img_y),this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._segCanvasService.setGlobalXY(t.newX,t.newY),this._segCanvasService.panPolygons(this._selectMetadata,this._selectMetadata.img_x,this._selectMetadata.img_y,!1);var e=Object(Zt.a)(this._selectMetadata);this._undoRedoService.isMethodChange("zoom")?this._undoRedoService.appendStages({meta:e,method:"zoom"}):this._undoRedoService.replaceStages({meta:e,method:"zoom"}),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}catch(n){}}},{key:"isClearCanvas",value:function(){try{this.segState.clear&&(this._selectMetadata.polygons=[],this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.rulesMakeChange(void 0,void 0,!1),this.emitMetadata())}catch(t){}}},{key:"isFitCenter",value:function(){try{this.segState.fitCenter&&this.imgFitToCenter()}catch(t){}}},{key:"redrawImages",value:function(t,e,n,i){var a;try{this.clearcanvas(),this.context&&(null===(a=this.context)||void 0===a||a.drawImage(this.img,t,e,n,i),this._segCanvasService.drawAllPolygons(this._selectMetadata,this.context,this.annotateState.annotation),this.mycanvas.nativeElement.focus())}catch(o){}}},{key:"clearcanvas",value:function(){var t;try{null===(t=this.context)||void 0===t||t.clearRect(0,0,this.mycanvas.nativeElement.width,this.mycanvas.nativeElement.height)}catch(e){}}},{key:"keyMoveBox",value:function(t){var e=this;try{this.context&&this._segCanvasService.keyboardMovePolygon(this._selectMetadata,t,this.annotateState.annotation,this.context,this.img,this._selectMetadata.img_w,this._selectMetadata.img_h,function(t){!t||(e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"}),e.emitMetadata())})}catch(n){}}},{key:"zoomImage",value:function(t){var e=this;try{t>0?(this._selectMetadata.img_w*=1.1,this._selectMetadata.img_h*=1.1,this._segCanvasService.scalePolygons(this._selectMetadata,1.1,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){!t||(e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"zoom"}),e.emitMetadata())})):.9*this._selectMetadata.img_w>100&&.9*this._selectMetadata.img_h>100&&(this._selectMetadata.img_w*=.9,this._selectMetadata.img_h*=.9,this._segCanvasService.scalePolygons(this._selectMetadata,.9,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){if(t){var n=Object(Zt.a)(e._selectMetadata);e.emitMetadata(),e._undoRedoService.isMethodChange("zoom")?e._undoRedoService.appendStages({meta:n,method:"zoom"}):e._undoRedoService.replaceStages({meta:n,method:"zoom"})}})),!this._copyPasteService.isAvailable()||this._copyPasteService.clear(),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}catch(n){}}},{key:"mouseScroll",value:function(t){try{var e=Math.max(-1,Math.min(1,-t.deltaY||-t.detail));e&&this.segState.scroll&&this.zoomImage(e)}catch(n){console.log("MouseScroll(event: WheelEvent)",n.name+": ",n.message)}}},{key:"toggleEvent",value:function(t){try{!(this.annotateState.annotation>-1)||(this._undoRedoService.clearRedundantStages(),this.annotateStateMakeChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){}}},{key:"keyStrokeEvent",value:function(t){var e=this;try{if(!this.mousedown){var n=this.segState.isActiveModal;if(!t.ctrlKey||"c"!==t.key&&"C"!==t.key||n)if(!t.ctrlKey||"v"!==t.key&&"V"!==t.key||n){if(!t.ctrlKey||!t.shiftKey||"z"!==t.key&&"Z"!==t.key||n){if(!t.ctrlKey||"z"!==t.key&&"Z"!==t.key||n)n||"Delete"!==t.key&&"Backspace"!==t.key?"ArrowLeft"!==t.key||n?"ArrowRight"!==t.key||n?"ArrowUp"!==t.key||n?"ArrowDown"===t.key&&!n&&this.keyMoveBox("down"):this.keyMoveBox("up"):this.keyMoveBox("right"):this.keyMoveBox("left"):this._segCanvasService.deleteSinglePolygon(this._selectMetadata,this.annotateState.annotation,function(t){t&&(e.annotateStateMakeChange({annotation:-1,isDlbClick:!1}),e._undoRedoService.appendStages({meta:Object(Zt.a)(e._selectMetadata),method:"draw"}),e.emitMetadata())});else if(this._undoRedoService.isAllowUndo()){var i=this._undoRedoService.undo();this._selectMetadata=Object(Zt.a)(null==i?void 0:i.meta),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}}else if(this._undoRedoService.isAllowRedo()){var a=this._undoRedoService.redo();this._selectMetadata=Object(Zt.a)(null==a?void 0:a.meta),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this.emitMetadata()}}else!this._copyPasteService.isAvailable()||(this._selectMetadata.polygons.push(this._copyPasteService.paste()),this.annotateStateMakeChange({annotation:this._selectMetadata.polygons.length-1,isDlbClick:!1}),this._segCanvasService.validateXYDistance(this._selectMetadata,this._selectMetadata.img_x,this._selectMetadata.img_y)),this._undoRedoService.appendStages({meta:Object(Zt.a)(this._selectMetadata),method:"draw"}),this.emitMetadata(),this.mycanvas.nativeElement.focus();else!(this.annotateState.annotation>-1)||this._copyPasteService.copy(this._selectMetadata.polygons[this.annotateState.annotation])}}catch(o){}}},{key:"mouseDown",value:function(t){if(this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)&&(this.mousedown=!0,this.segState.drag&&this._segCanvasService.setPanXY(t.offsetX,t.offsetY),this.segState.draw&&this.context)){var e=this._segCanvasService.whenMouseDownEvent(t.offsetX,t.offsetY,this._selectMetadata.img_x,this._selectMetadata.img_y,this.mycanvas.nativeElement.width,this.mycanvas.nativeElement.height,this._selectMetadata,this.img,this.context,this.isctrlHold,this.altdown);this.annotateStateMakeChange(Object(Zt.a)({annotation:e,isDlbClick:!1})),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)}}},{key:"mouseUp",value:function(t){this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)&&(this.mousedown=!0,(this.segState.drag&&this.mousedown||this._segCanvasService.isNewPolygon()&&this.isctrlHold&&this.mousedown)&&this._segCanvasService.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.segState.draw&&!this._segCanvasService.isNewPolygon()&&this.annotateState.annotation>-1&&this._undoRedoService.isStatgeChange(this._selectMetadata.polygons)&&this._undoRedoService.appendStages({meta:Object(Zt.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.setGlobalXY(-1,-1),this._segCanvasService.validateXYDistance(this._selectMetadata,this._selectMetadata.img_x,this._selectMetadata.img_y),this.emitMetadata())}},{key:"mouseMove",value:function(t){var e=this;if(this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h,t.offsetX,t.offsetY)){if(this.mousedown=!0,this.segState.drag&&this.mousedown){var n=t.offsetX-this._segCanvasService.getPanX(),i=t.offsetY-this._segCanvasService.getPanY();this._selectMetadata.img_x=this._segCanvasService.getGlobalX()+n,this._selectMetadata.img_y=this._segCanvasService.getGlobalY()+i,this._segCanvasService.panPolygons(this._selectMetadata,this._selectMetadata.img_x,this._selectMetadata.img_y,!1),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h),this._undoRedoService.isMethodChange("pan")?this._undoRedoService.appendStages({meta:this._selectMetadata,method:"pan"}):this._undoRedoService.replaceStages({meta:this._selectMetadata,method:"pan"})}this.segState.draw&&this.mousedown&&this.context&&this._segCanvasService.whenMouseMoveEvent(this._selectMetadata,this.img,this.context,this.mycanvas.nativeElement.width,this.mycanvas.nativeElement.height,t.offsetX,t.offsetY,this.isctrlHold,this.mousedown,function(t){e.redrawImages(e._selectMetadata.img_x,e._selectMetadata.img_y,e._selectMetadata.img_w,e._selectMetadata.img_h),"pan"===t&&(e._undoRedoService.isMethodChange("pan")?e._undoRedoService.appendStages({meta:e._selectMetadata,method:"pan"}):e._undoRedoService.replaceStages({meta:e._selectMetadata,method:"pan"}))})}else console.log(this.crossh),"-1"===this.crossh.nativeElement.style.zIndex&&"hidden"===this.crossh.nativeElement.style.visibility&&"-1"===this.crossv.nativeElement.style.zIndex&&"hidden"===this.crossv.nativeElement.style.visibility||(this.crossh.nativeElement.style.zIndex="-1",this.crossh.nativeElement.style.visibility="hidden",this.crossv.nativeElement.style.zIndex="-1",this.crossv.nativeElement.style.visibility="hidden")}},{key:"mouseOut",value:function(t){this.segState.drag&&this.mousedown&&(this._segCanvasService.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImages(this._selectMetadata.img_x,this._selectMetadata.img_y,this._selectMetadata.img_w,this._selectMetadata.img_h)),this.mousedown=!1}}]),t}()).\u0275fac=function(t){return new(t||Jt)(_.Hb(se),_.Hb(B),_.Hb(te),_.Hb(ee),_.Hb(I))},Jt.\u0275cmp=_.Bb({type:Jt,selectors:[["image-labelling-segmentation"]],viewQuery:function(t,e){var n;1&t&&(_.pc(le,!0),_.pc(ce,!0),_.pc(re,!0)),2&t&&(_.dc(n=_.Ub())&&(e.mycanvas=n.first),_.dc(n=_.Ub())&&(e.crossh=n.first),_.dc(n=_.Ub())&&(e.crossv=n.first))},hostBindings:function(t,e){1&t&&_.Tb("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("dblclick",function(t){return e.toggleEvent(t)})("keydown",function(t){return e.keyStrokeEvent(t)},!1,_.fc)("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[_.vb],decls:7,vars:0,consts:[[1,"canvasstyle"],["canvasdrawing",""],[1,"crosses","cross-h"],["crossh",""],[1,"crosses","cross-v"],["crossv",""]],template:function(t,e){1&t&&(_.Mb(0,"div"),_.Ib(1,"canvas",0,1),_.Ib(3,"div",2,3),_.Ib(5,"div",4,5),_.Lb())},styles:[""],changeDetection:0}),Jt),ue=l("3Pt+"),ge=["subLabelSelect"];function be(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"image-labelling-object-detection",20),_.Tb("_onChangeMetadata",function(t){return _.gc(n),_.Vb().onChangeMetadata(t)}),_.Lb(),_.Jb()}if(2&t){var i=_.Vb();_.xb(1),_.ac("_selectMetadata",i.selectedMetaData)("_imgSrc",i.imgSrc)}}function de(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"image-labelling-segmentation",20),_.Tb("_onChangeMetadata",function(t){return _.gc(n),_.Vb().onChangeMetadata(t)}),_.Lb(),_.Jb()}if(2&t){var i=_.Vb();_.xb(1),_.ac("_selectMetadata",i.selectedMetaData)("_imgSrc",i.imgSrc)}}function me(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"option",21),_.lc(2),_.Lb(),_.Jb()),2&t){var n=e.$implicit,i=_.Vb(2);_.xb(1),_.ac("value",n)("selected",n===i.currentAnnotationLabel),_.xb(1),_.nc(" ",n," ")}}function ve(t,e){if(1&t&&(_.Kb(0),_.jc(1,me,3,3,"ng-container",13),_.Jb()),2&t){var n=e.$implicit;_.xb(1),_.ac("ngForOf",n.label_list)}}function fe(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"option",21),_.lc(2),_.Lb(),_.Jb()),2&t){var n=e.$implicit,i=_.Vb().$implicit;_.xb(1),_.ac("value",n)("selected",i.label_list[0].label),_.xb(1),_.nc(" ",n," ")}}function ye(t,e){if(1&t&&(_.Kb(0),_.jc(1,fe,3,3,"ng-container",13),_.Jb()),2&t){var n=e.$implicit;_.xb(1),_.ac("ngForOf",n.label_list)}}function _e(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"div",22),_.lc(2),_.Lb(),_.Jb()),2&t){var n=_.Vb();_.xb(2),_.nc(" ",n.subLabelValidateMsg," ")}}function xe(t,e){if(1&t){var n=_.Nb();_.Kb(0),_.Mb(1,"div",23),_.Mb(2,"label",24),_.lc(3),_.Lb(),_.Mb(4,"label",25),_.lc(5),_.Lb(),_.Ib(6,"span",26),_.Mb(7,"button",27),_.Tb("click",function(){_.gc(n);var t=e.index,i=_.Vb(2).index;return _.Vb(3).onRemoveSubLabel(i,t)}),_.lc(8," X "),_.Lb(),_.Lb(),_.Jb()}if(2&t){var i=e.$implicit;_.xb(3),_.nc("Label: ",i.label,""),_.xb(2),_.nc("Region Info: ",i.region,"")}}function pe(t,e){if(1&t&&(_.Kb(0),_.Mb(1,"h2",9),_.lc(2,"Added Sub Label"),_.Lb(),_.jc(3,xe,9,2,"ng-container",13),_.Jb()),2&t){var n=_.Vb().$implicit;_.xb(3),_.ac("ngForOf",n.subLabel)}}function Me(t,e){if(1&t&&(_.Kb(0),_.jc(1,pe,4,1,"ng-container",4),_.Jb()),2&t){var n=e.$implicit,i=e.index,a=_.Vb(3);_.xb(1),_.ac("ngIf",(null==n||null==n.subLabel?null:n.subLabel.length)>0&&i===a.currentAnnotationIndex)}}function we(t,e){if(1&t&&(_.Kb(0),_.jc(1,Me,2,1,"ng-container",13),_.Jb()),2&t){var n=e.$implicit;_.xb(1),_.ac("ngForOf",null==n?null:n.bnd_box)}}function Se(t,e){if(1&t&&(_.Kb(0),_.jc(1,we,2,1,"ng-container",13),_.Jb()),2&t){var n=e.$implicit;_.xb(1),_.ac("ngForOf",n.annotation)}}var Pe,Ce,ke,Oe,Le=[{path:"",component:(Pe=function(){function t(e,i,a,o,l,c,r,u){var g=this;s(this,t),this._router=e,this._imgLblApiService=i,this._modalService=a,this._dataSetService=o,this._annotateService=l,this._imgLblActionService=c,this._imgLblLayoutService=r,this._imgLblModeService=u,this.inputProjectName="",this.selectedProjectName="",this.imgSrc="",this.loading=!1,this.thumbnailList=[],this.unsubscribe$=new y.a,this.tabStatus=[{name:"Project",closed:!1},{name:"Label",closed:!1,label_list:[]},{name:"Annotation",closed:!1,annotation:[]}],this.mainLabelRegionVal="",this.subLabelRegionVal="",this.subLabelValidateMsg="",this.currentAnnotationLabel="",this.currentAnnotationIndex=-1,this.currentImageDisplayIndex=-1,this.updateProjectProgress=function(){g._imgLblLayoutService.updateProjectProgress(g.tabStatus,g.inputProjectName||g.selectedProjectName)},this.onChangeMetadata=function(t){g.tabStatus=g.tabStatus.map(function(e){return e.annotation?Object.assign(Object.assign({},e),{annotation:[t]}):e}),g.updateProjectProgress()},this.onToggleTab=function(t){var e=t.name,n=t.closed;!g.tabStatus.some(function(t){return t.name.toLowerCase()===e.toLowerCase()&&t.closed===n})&&(g.tabStatus=g.tabStatus.map(function(t){return t.name.toLowerCase()===e.toLowerCase()?Object.assign(Object.assign({},t),{closed:n}):Object.assign({},t)}))},this.navigateByUrl=function(t){var e=t.url;e?g._router.navigate([e]):console.error("No url received from child component")},this.navigateByAction=function(t){var e=t.thumbnailAction;if(e){var n=g._imgLblLayoutService.calculateIndex(e,g.currentImageDisplayIndex,g.thumbnailList.length);if(n!==g.currentImageDisplayIndex){g.currentImageDisplayIndex=n;var i=g.thumbnailList.find(function(t,e){return e===n}),a=g.thumbnailList.findIndex(function(t,e){return e===n});i&&-1!==a&&g.displayImage(Object.assign(Object.assign({},i),{thumbnailIndex:a}))}}},this.displayImage=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.selectedProjectName,n=t.thumbnailIndex,i=h(t,["thumbnailIndex"]);g._imgLblApiService.getBase64Thumbnail(e,i.uuid).pipe(Object(v.a)()).subscribe(function(t){var e=t.message,a=t.img_src;1===e&&(g.selectedMetaData=i,g.imgSrc=a,g.onChangeSchema=Object.assign(Object.assign({},g.onChangeSchema),{currentThumbnailIndex:n+1,thumbnailName:i.img_path}))},function(t){return console.error(t)})},this.onProcessLabel=function(t){var e=t.selectedLabel,n=t.label_list,i=t.action,a=e&&!i?n.filter(function(t){return t!==e}):n;g._imgLblApiService.updateLabelList(g.selectedProjectName,a.length>0?a:[]).pipe(Object(v.a)()).subscribe(function(t){1===t.message&&(g.tabStatus=g._imgLblLayoutService.displayLabelList(g.tabStatus,a),console.error("Error while updating label"))}),g.updateProjectProgress()},this.onChangeAnnotationLabel=function(t){g.tabStatus=g._imgLblLayoutService.changeAnnotationLabel(g.tabStatus,t),g.updateStateToRenderChild(),g.updateProjectProgress()},this.onDeleteAnnotation=function(t){g.tabStatus=g._imgLblLayoutService.deleteAnnotation(g.tabStatus,t),g.updateStateToRenderChild(),g.updateProjectProgress()},this.onDisplayModal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"modal-image-labelling";g.subLabelRegionVal="",g.subLabelValidateMsg="",g._modalService.open(t)},this.onCloseModal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"modal-image-labelling";g._imgLblActionService.setState({isActiveModal:!1,draw:!0,scroll:!0}),g._modalService.close(t)},this.onChangeInput=function(t,e){var n=t.target.value;"main"===e?g.mainLabelRegionVal=n:g.subLabelRegionVal=n},this.onSubmitLabel=function(){var t=g._subLabelSelect.nativeElement.value,e=!1;g.tabStatus.forEach(function(n){var i=n.annotation;return null==i?void 0:i.forEach(function(n){var i=n.bnd_box,a=n.polygons,o=null!=i?i:a;if(o){var s=o[g.currentAnnotationIndex].subLabel;s&&(null==s?void 0:s.length)>0&&(null==s||s.some(function(n){var i=n.label;return e=i===t}))}else console.log("missing prop bnd_box OR polygons")})}),e?g.subLabelValidateMsg="Invalid of duplicate label: "+t:(g.tabStatus=g._imgLblLayoutService.submitLabel(g.tabStatus,t,g.currentAnnotationIndex,{mainLabelRegion:g.mainLabelRegionVal,subLabelRegion:g.subLabelRegionVal}),g.subLabelValidateMsg="",g.updateStateToRenderChild(),g.updateProjectProgress()),g.subLabelRegionVal=""},this.onRemoveSubLabel=function(t,e){g.tabStatus=g._imgLblLayoutService.removeSubLabel(g.tabStatus,{selectedAnnoIndex:t,selectedSubLabelIndex:e}),g.updateStateToRenderChild(),g.updateProjectProgress()},this.updateStateToRenderChild=function(){g.tabStatus.forEach(function(t){var e=t.annotation;e&&(g.thumbnailList=g.thumbnailList.map(function(t){var n;return null!==(n=e.find(function(e){var n=e.uuid;return t.uuid===n}))&&void 0!==n?n:t}),g.selectedMetaData=e[0])})},this.resetProjectStatus=function(t){t&&g._dataSetService.manualCloseProject(t).pipe(Object(v.a)()).subscribe(function(t){n(t)})}}return c(t,[{key:"ngOnInit",value:function(){var t=this,e=this._imgLblLayoutService.getRouteState(history),n=e.thumbnailList,i=e.labelList,a=e.projectName;this.thumbnailList=n,this.selectedProjectName=a,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:n.length});var o=this._imgLblLayoutService.displayLabelList(this.tabStatus,i);this.tabStatus=o,this._annotateService.labelStaging$.pipe(Object(f.a)(this.unsubscribe$)).subscribe(function(e){var n=e.annotation;e.isDlbClick?(t.currentAnnotationIndex=n,t.tabStatus.forEach(function(e){var i=e.annotation;return null==i?void 0:i.forEach(function(e){var i=e.bnd_box,a=e.polygons,o=null!=i?i:a;if(o){var s=o[n],l=s.label,c=s.region;t.currentAnnotationLabel=l,t.mainLabelRegionVal=c||""}else console.log("missing prop bnd_box OR polygons")})}),t._imgLblActionService.setState({isActiveModal:!0,draw:!1,drag:!1,scroll:!1}),t.onDisplayModal()):(t.currentAnnotationLabel="",t.currentAnnotationIndex=-1)})}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this._imgLblModeService.setState(null),this._imgLblActionService.setState(null),this.resetProjectStatus(this.inputProjectName||this.selectedProjectName)}}]),t}(),Pe.\u0275fac=function(t){return new(t||Pe)(_.Hb(x.a),_.Hb(P),_.Hb(C.a),_.Hb(k.a),_.Hb(I),_.Hb(B),_.Hb(A),_.Hb(S.a))},Pe.\u0275cmp=_.Bb({type:Pe,selectors:[["image-labelling-layout"]],viewQuery:function(t,e){var n;1&t&&_.pc(ge,!0),2&t&&_.dc(n=_.Ub())&&(e._subLabelSelect=n.first)},hostBindings:function(t,e){1&t&&_.Tb("beforeunload",function(t){return e.resetProjectStatus(t)},!1,_.fc)},decls:43,vars:16,consts:[[1,"layout-container"],[3,"_onChange"],[3,"_onChange","_onClick"],[1,"content-container"],[4,"ngIf"],[3,"_thumbnailList","_tabStatus","_onClose","_onClickThumbNail","_onClickLabel","_onEnterLabel","_onChangeAnnotationLabel","_onDeleteAnnotation"],[3,"_thumbnailInfo","_imgSrc"],["id","modal-image-labelling"],[1,"modal-button","float-right",3,"click"],[1,"font-title"],[1,"main-label-container"],[1,"font-label"],[1,"static-select"],[4,"ngFor","ngForOf"],["type","text","placeholder","Input Main Region Info",1,"static-input",3,"value","change"],[1,"hr-line"],[1,"sub-label-container"],["subLabelSelect",""],["type","text","placeholder","Input Sub Region Info",1,"static-input",3,"value","change"],[1,"modal-button",3,"click"],[3,"_selectMetadata","_imgSrc","_onChangeMetadata"],[3,"value","selected"],[1,"validate-msg"],[1,"sub-label-flex-container","sub-label-padding"],[1,"font-label","flex-first"],[1,"font-label","flex-second"],[1,"flex-third"],[1,"modal-butto","flex-fourth",3,"click"]],template:function(t,e){1&t&&(_.Mb(0,"div",0),_.Mb(1,"div"),_.Ib(2,"page-header",1),_.Mb(3,"image-labelling-info",2),_.Tb("_onClick",function(t){return e.navigateByAction(t)}),_.Lb(),_.Lb(),_.Mb(4,"div",3),_.Ib(5,"image-labelling-left-sidebar",1),_.jc(6,be,2,2,"ng-container",4),_.jc(7,de,2,2,"ng-container",4),_.Mb(8,"image-labelling-project",5),_.Tb("_onClose",function(t){return e.onToggleTab(t)})("_onClickThumbNail",function(t){return e.displayImage(t)})("_onClickLabel",function(t){return e.onProcessLabel(t)})("_onEnterLabel",function(t){return e.onProcessLabel(t)})("_onChangeAnnotationLabel",function(t){return e.onChangeAnnotationLabel(t)})("_onDeleteAnnotation",function(t){return e.onDeleteAnnotation(t)}),_.Lb(),_.Mb(9,"image-labelling-right-sidebar",2),_.Tb("_onClick",function(t){return e.onToggleTab(t)}),_.Lb(),_.Lb(),_.Ib(10,"image-labelling-footer",6),_.Lb(),_.Mb(11,"modal",7),_.Mb(12,"button",8),_.Tb("click",function(){return e.onCloseModal()}),_.lc(13,"X"),_.Lb(),_.Mb(14,"div"),_.Mb(15,"h2",9),_.lc(16,"Main Label"),_.Lb(),_.Mb(17,"div",10),_.Mb(18,"label",11),_.lc(19,"Label: "),_.Lb(),_.Mb(20,"select",12),_.jc(21,ve,2,1,"ng-container",13),_.Lb(),_.Mb(22,"label",11),_.lc(23,"Region Info: "),_.Lb(),_.Mb(24,"input",14),_.Tb("change",function(t){return e.onChangeInput(t,"main")}),_.Lb(),_.Lb(),_.Lb(),_.Ib(25,"hr",15),_.Mb(26,"div"),_.Mb(27,"h2",9),_.lc(28,"Sub Label"),_.Lb(),_.Mb(29,"div",16),_.Mb(30,"label",11),_.lc(31,"Label: "),_.Lb(),_.Mb(32,"select",12,17),_.jc(34,ye,2,1,"ng-container",13),_.Lb(),_.Mb(35,"label",11),_.lc(36,"Region Info: "),_.Lb(),_.Mb(37,"input",18),_.Tb("change",function(t){return e.onChangeInput(t,"sub")}),_.Lb(),_.Mb(38,"button",19),_.Tb("click",function(){return e.onSubmitLabel()}),_.lc(39,"Add"),_.Lb(),_.Lb(),_.jc(40,_e,3,1,"ng-container",4),_.Lb(),_.Ib(41,"hr",15),_.jc(42,Se,2,1,"ng-container",13),_.Lb()),2&t&&(_.xb(2),_.ac("_onChange",e.onChangeSchema),_.xb(1),_.ac("_onChange",e.onChangeSchema),_.xb(2),_.ac("_onChange",e.onChangeSchema),_.xb(1),_.ac("ngIf",e._router.url.includes("imglabel/bndbox")),_.xb(1),_.ac("ngIf",e._router.url.includes("imglabel/seg")),_.xb(1),_.ac("_thumbnailList",e.thumbnailList)("_tabStatus",e.tabStatus),_.xb(1),_.ac("_onChange",e.onChangeSchema),_.xb(1),_.ac("_thumbnailInfo",e.selectedMetaData)("_imgSrc",e.imgSrc),_.xb(11),_.ac("ngForOf",e.tabStatus),_.xb(3),_.ac("value",e.mainLabelRegionVal),_.xb(10),_.ac("ngForOf",e.tabStatus),_.xb(3),_.ac("value",e.subLabelRegionVal),_.xb(3),_.ac("ngIf",e.subLabelValidateMsg),_.xb(2),_.ac("ngForOf",e.tabStatus))},directives:[D.a,$,U,r.k,Xt,Tt,Ut,Gt.a,r.j,oe,he,ue.h,ue.k],styles:[".layout-container[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;min-width:97.8vw;max-width:97.8vw}.modal-button[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw}.float-right[_ngcontent-%COMP%]{float:right}.font-title[_ngcontent-%COMP%]{font-size:1.7vw}.font-label[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.main-label-container[_ngcontent-%COMP%]{min-width:35vw;max-width:35vw}.main-label-container[_ngcontent-%COMP%], .sub-label-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.sub-label-container[_ngcontent-%COMP%]{min-width:40vw;max-width:40vw}.sub-label-flex-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1 1 100%;min-width:0}.static-select[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:5vh;margin:0;-moz-text-align-last:center;text-align-last:center;background:#262a2e;color:#fff;box-shadow:inset -.5vw 6.25vw 1vw 0 rgba(0,0,0,.2),inset -.5vw -.5vw 1vw 0 hsla(0,0%,100%,.4)}.static-select[_ngcontent-%COMP%]:hover{box-shadow:inset -.375vw -.375vw .625vw 0 rgba(0,0,0,.2),inset .375vw .375vw .625vw 0 hsla(0,0%,100%,.5)}.static-select[_ngcontent-%COMP%]:active{box-shadow:inset .375vw .375vw .625vw 0 rgba(0,0,0,.2),inset -.375vw -.375vw .625vw 0 hsla(0,0%,100%,.5)}.static-input[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;border-radius:2vw;border:none;outline:none;background-color:#363636;color:#fff;padding:0 1vw}.hr-line[_ngcontent-%COMP%]{height:.5vh;color:#000;background:#8c8b8b;margin:5vh 0}.sub-label-padding[_ngcontent-%COMP%]{padding:0 0 2vh}.validate-msg[_ngcontent-%COMP%]{color:red;padding:5vh 0 0;font-size:1vw}.flex-first[_ngcontent-%COMP%]{flex:1 1 35%}.flex-second[_ngcontent-%COMP%]{flex:1 1 55%}.flex-third[_ngcontent-%COMP%]{flex:0 0 5%}.flex-fourth[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;flex:0 0 5%}"]}),Pe)}],Ie=((Ce=function t(){s(this,t)}).\u0275mod=_.Fb({type:Ce}),Ce.\u0275inj=_.Eb({factory:function(t){return new(t||Ce)},imports:[[x.d.forChild(Le)]]}),Ce),je=l("KZX/"),Be=((ke=function t(){s(this,t)}).\u0275mod=_.Fb({type:ke}),ke.\u0275inj=_.Eb({factory:function(t){return new(t||ke)},imports:[[r.b,je.a]]}),ke),Ae=l("RKnZ"),De=l("O+1G"),Ee=l("sYmb"),Xe=((Oe=function t(){s(this,t)}).\u0275mod=_.Fb({type:Oe}),Oe.\u0275inj=_.Eb({factory:function(t){return new(t||Oe)},imports:[[r.b,je.a,Ee.b,Ie,Ae.a,x.d,De.a,Be]]}),Oe)}}])}();