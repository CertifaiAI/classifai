!function(){function t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,l=!0,r=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return l=t.done,t},e:function(t){r=!0,s=t},f:function(){try{l||null==n.return||n.return()}finally{if(r)throw s}}}}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,a=!1,o=void 0;try{for(var s,l=t[Symbol.iterator]();!(i=(s=l.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(r){a=!0,o=r}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}return n}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){if(null==t)throw new TypeError("Cannot destructure undefined")}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{i5u5:function(a,o,l){"use strict";l.r(o),l.d(o,"ImageLabellingLayoutModule",function(){return nn});var c=l("ofXK");function u(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]])}return n}var h,b,g,d,f,v=l("SxV6"),m=l("5+tZ"),y=l("1G5W"),p=l("XNiG"),_=l("l5mm"),x=l("z6cu"),w=l("fXoL"),S=l("tyNb"),M=l("/uUt"),C=l("cxbk"),P=l("tk/3"),k=l("14na"),L=((h=function(){function t(e,n,i){var a=this;s(this,t),this.http=e,this.mode=n,this.router=i,this.hostPort=C.a.baseURL,this.imageLabellingMode=null,this.getBase64Thumbnail=function(t,e){return a.http.get("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/uuid/").concat(e,"/imgsrc"))},this.updateLabelList=function(t,e){return a.http.put("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/newlabels"),{label_list:e})},this.updateProjectProgress=function(t,e,n){return a.http.put("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/uuid/").concat(e,"/update"),Object.assign({},n))},this.exportProject=function(t,e){return a.http.put("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/export/").concat(e),{newprojectid:t})},this.reloadProject=function(t){return a.http.put("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/reload"),{newprojectid:t})},this.reloadProjectStatus=function(t){return a.http.get("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/reloadstatus"))},this.mode.imgLabelMode$.pipe(Object(M.a)()).subscribe(function(t){return t?a.imageLabellingMode=t:a.router.navigate(["/"])})}return r(t,[{key:"checkIfBboxMetaType",value:function(t){return Array.isArray(t)?void 0!==t[0].bnd_box:void 0!==t.bnd_box}}]),t}()).\u0275fac=function(t){return new(t||h)(w.Qb(P.b),w.Qb(k.a),w.Qb(S.a))},h.\u0275prov=w.Db({token:h,factory:h.\u0275fac,providedIn:"any"}),h),O=l("1F7/"),I=l("LY9J"),j=l("2Vo4"),A={annotation:-1,isDlbClick:!1},B=((b=function t(){var e=this;s(this,t),this.labelStateSubject=new j.a(A),this.labelStaging$=this.labelStateSubject.asObservable(),this.setState=function(t){e.labelStateSubject.next(t?Object.assign(Object.assign({},A),t):A)}}).\u0275fac=function(t){return new(t||b)},b.\u0275prov=w.Db({token:b,factory:b.\u0275fac,providedIn:"any"}),b),D={scroll:!1,drag:!1,draw:!1,fitCenter:!1,clear:!1,isActiveModal:!1},X=((d=function t(){var e=this;s(this,t),this.actionSubject=new j.a(D),this.action$=this.actionSubject.asObservable(),this.setState=function(t){e.actionSubject.next(t?Object.assign(Object.assign({},D),t):D)}}).\u0275fac=function(t){return new(t||d)},d.\u0275prov=w.Db({token:d,factory:d.\u0275fac,providedIn:"any"}),d),E=((g=function t(e){var a=this;s(this,t),this._imgLblApiService=e,this.getRouteState=function(t){var e=t.state;return Object.assign({},e)},this.displayLabelList=function(t,e){return t.map(function(t){return t.label_list?Object.assign(Object.assign({},t),{label_list:e}):t})},this.calculateIndex=function(t,e,n){var i=e;return 1===t?i>=n-1?n-1:i+=1:i<=0?0:e-=1},this.checkAnnotationMetadataProp=function(t){var e=t.bnd_box,n=t.polygons;return null!=e?e:n},this.changeAnnotationLabel=function(t,e){var n=e.label,i=e.index;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var e=t.bnd_box,a=t.polygons,o=u(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},o),{bnd_box:null==e?void 0:e.map(function(t,e){return e===i?Object.assign(Object.assign({},t),{label:n}):t}),polygons:null==a?void 0:a.map(function(t,e){return e===i?Object.assign(Object.assign({},t),{label:n}):t})})})}):t})},this.deleteAnnotation=function(t,e){return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var n=t.bnd_box,i=t.polygons,a=u(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},a),{bnd_box:null==n?void 0:n.filter(function(t,n){return n!==e}),polygons:null==i?void 0:i.filter(function(t,n){return n!==e})})})}):t})},this.submitLabel=function(t,e,n,a){var o=a.mainLabelRegion,s=a.subLabelRegion;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var a=t.bnd_box,l=t.polygons,r=u(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},r),{bnd_box:null==a?void 0:a.map(function(t,a){return a===n?Object.assign(Object.assign({},t),{region:o,subLabel:t.subLabel&&t.subLabel.length>0?[].concat(i(t.subLabel),[{label:e,region:s}]):[{label:e,region:s}]}):t}),polygons:null==l?void 0:l.map(function(t,a){return a===n?Object.assign(Object.assign({},t),{region:o,subLabel:t.subLabel&&t.subLabel.length>0?[].concat(i(t.subLabel),[{label:e,region:s}]):[{label:e,region:s}]}):t})})})}):t})},this.removeSubLabel=function(t,e){var n=e.selectedAnnoIndex,i=e.selectedSubLabelIndex;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var e=t.bnd_box,a=t.polygons,o=u(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},o),{bnd_box:null==e?void 0:e.map(function(t,e){var a;return e===n?Object.assign(Object.assign({},t),{subLabel:null===(a=t.subLabel)||void 0===a?void 0:a.filter(function(t,e){return e!==i})}):t}),polygons:null==a?void 0:a.map(function(t,e){var a;return e===n?Object.assign(Object.assign({},t),{subLabel:null===(a=t.subLabel)||void 0===a?void 0:a.filter(function(t,e){return e!==i})}):t})})})}):t})},this.setLocalStorageProjectProgress=function(t,e){localStorage.setItem("".concat(t,"_").concat(a._imgLblApiService.imageLabellingMode),JSON.stringify({cache:e}))},this.getLocalStorageProjectProgress=function(t){var e=localStorage.getItem("".concat(t,"_").concat(a._imgLblApiService.imageLabellingMode));return e?JSON.parse(e):null},this.updateProjectProgress=function(t,e){t.forEach(function(t){var i=t.annotation;i&&(a.setLocalStorageProjectProgress(e,i),null==i||i.forEach(function(t){a._imgLblApiService.updateProjectProgress(e,t.uuid,t).pipe(Object(v.a)()).subscribe(function(t){n(t)})}))})}}).\u0275fac=function(t){return new(t||g)(w.Qb(L))},g.\u0275prov=w.Db({token:g,factory:g.\u0275fac,providedIn:"any"}),g),T=l("I7yr"),Y=l("F7l1"),z=l("x2Se"),R=((f=function(){function t(){s(this,t)}return r(t,[{key:"transform",value:function(t){return t?window.navigator.platform.startsWith("Mac")?t.split("/").slice(-1)[0]:t.split("\\").slice(-1)[0]:""}}]),t}()).\u0275fac=function(t){return new(t||f)},f.\u0275pipe=w.Gb({name:"fileNameSlice",type:f,pure:!0}),f),V=l("sYmb");function N(t,e){if(1&t&&(w.Kb(0),w.Ib(1,"div",7),w.Mb(2,"label",8),w.mc(3),w.Wb(4,"fileNameSlice"),w.Lb(),w.Jb()),2&t){var n=w.Vb();w.xb(1),w.ac("ngClass",n._onChange.hasAnnotation?"indicator":"no-indicator"),w.xb(2),w.nc(w.Xb(4,2,n._onChange.thumbnailName))}}function W(t,e){1&t&&w.Ib(0,"label",8)}function $(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"label"),w.mc(2),w.Lb(),w.Jb()),2&t){var n=w.Vb(3);w.xb(2),w.pc("",n._onChange.currentThumbnailIndex||0," / ",n._onChange.totalNumThumbnail,"")}}function F(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",10),w.Mb(2,"img",11),w.Tb("click",function(){return w.gc(n),w.Vb().$implicit.onClick()}),w.Wb(3,"translate"),w.Lb(),w.Lb(),w.Mb(4,"div",12),w.kc(5,$,3,2,"ng-container",13),w.Lb(),w.Jb()}if(2&t){var i=w.Vb(),a=i.$implicit,o=i.index,s=w.Vb();w.xb(2),w.ac("src",a.imgPath,w.hc)("alt",a.alt)("title",w.Xb(3,5,a.hoverLabel)),w.yb("data-index",o+a.alt),w.xb(3),w.ac("ngIf",s._onChange&&s._onChange.totalNumThumbnail)}}function K(t,e){if(1&t){var n=w.Nb();w.Mb(0,"div",10),w.Mb(1,"img",11),w.Tb("click",function(){return w.gc(n),w.Vb().$implicit.onClick()}),w.Wb(2,"translate"),w.Lb(),w.Lb()}if(2&t){var i=w.Vb(),a=i.$implicit,o=i.index;w.xb(1),w.ac("src",a.imgPath,w.hc)("alt",a.alt)("title",w.Xb(2,4,a.hoverLabel)),w.yb("data-index",o+a.alt)}}function U(t,e){if(1&t&&(w.Kb(0),w.kc(1,F,6,7,"ng-container",2),w.kc(2,K,3,6,"ng-template",null,9,w.lc),w.Jb()),2&t){var n=e.index,i=w.ec(3);w.xb(1),w.ac("ngIf",0===n)("ngIfElse",i)}}function J(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"div",10),w.Mb(2,"img",11),w.Tb("click",function(){return e.$implicit.onClick()}),w.Wb(3,"translate"),w.Lb(),w.Lb(),w.Jb()),2&t){var n=e.$implicit,i=e.index;w.xb(2),w.ac("src",n.imgPath,w.hc)("alt",n.alt)("title",w.Xb(3,4,n.hoverLabel)),w.yb("data-index",i+n.alt)}}var H,G=((H=function(){function t(){var e=this;s(this,t),this._onClick=new w.n,this.bindImagePath=function(){e.jsonSchema={logosCenter:[{imgPath:"../../../assets/icons/previous.svg",hoverLabel:"labellingInfo.previous",alt:"Previous",onClick:function(){return e.emitParentEvent({thumbnailAction:-1})}},{imgPath:"../../../assets/icons/next.svg",hoverLabel:"labellingInfo.next",alt:"Next",onClick:function(){return e.emitParentEvent({thumbnailAction:1})}}],logosEnd:[{imgPath:"../../../assets/icons/undo.svg",hoverLabel:"labellingInfo.undo",alt:"Undo",onClick:function(){return null}},{imgPath:"../../../assets/icons/redo.svg",hoverLabel:"labellingInfo.redo",alt:"Redo",onClick:function(){return null}}]}},this.emitParentEvent=function(t){var n=t.url,i=t.thumbnailAction;e._onClick.emit({url:n,thumbnailAction:i})}}return r(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"ngOnChanges",value:function(t){var e=t._onChange.currentValue.totalNumThumbnail;this._onChange.totalNumThumbnail=e,this.bindImagePath()}}]),t}()).\u0275fac=function(t){return new(t||H)},H.\u0275cmp=w.Bb({type:H,selectors:[["image-labelling-info"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick"},features:[w.vb],decls:9,vars:4,consts:[[1,"header-container"],[1,"container-flex-start"],[4,"ngIf","ngIfElse"],["defaultName",""],[1,"container-flex-center"],[4,"ngFor","ngForOf"],[1,"container-flex-end"],[3,"ngClass"],[1,"imageTitle"],["renderOtherIcons",""],[1,"utility-icon-container"],[1,"utility-icon-light",3,"src","alt","title","click"],[1,"totalThumbnail"],[4,"ngIf"]],template:function(t,e){if(1&t&&(w.Mb(0,"div",0),w.Mb(1,"div",1),w.kc(2,N,5,4,"ng-container",2),w.kc(3,W,1,0,"ng-template",null,3,w.lc),w.Lb(),w.Mb(5,"div",4),w.kc(6,U,4,2,"ng-container",5),w.Lb(),w.Mb(7,"div",6),w.kc(8,J,4,6,"ng-container",5),w.Lb(),w.Lb()),2&t){var n=w.ec(4);w.xb(2),w.ac("ngIf",e._onChange.thumbnailName)("ngIfElse",n),w.xb(4),w.ac("ngForOf",e.jsonSchema.logosCenter),w.xb(2),w.ac("ngForOf",e.jsonSchema.logosEnd)}},directives:[c.k,c.j,c.i],pipes:[R,V.c],styles:[".header-container[_ngcontent-%COMP%]{min-width:100vw;max-width:100vw;min-height:4vh;max-height:4vh;background:#525353;border-bottom:.0625vw solid hsla(0,0%,100%,.25);display:flex;justify-content:space-between;z-index:1000;position:absolute}.container-flex-start[_ngcontent-%COMP%]{margin-left:3vw}.container-flex-center[_ngcontent-%COMP%], .container-flex-start[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:inherit;max-height:inherit}.container-flex-center[_ngcontent-%COMP%]{margin-left:8vw}.container-flex-end[_ngcontent-%COMP%]{display:flex;margin-right:19vw}.logo-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw}.logo[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:2.2vh;max-height:2.2vh;padding:.3vw;position:fixed;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.position-absolute[_ngcontent-%COMP%]{position:absolute}.utility-icon-container[_ngcontent-%COMP%]{display:flex;min-height:3.5vh;max-height:3.5vh;min-width:2vw;max-width:2vw}.totalThumbnail[_ngcontent-%COMP%]{font-size:1.7vh;padding:.4vw 1vw 0;display:inline-block;color:#fff;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.img-container[_ngcontent-%COMP%]:hover   .img-description[_ngcontent-%COMP%]{visibility:visible;opacity:1}.imageTitle[_ngcontent-%COMP%]{font-size:1.7vh;color:#fff;align-items:center;margin-left:1vw;max-width:20vw;min-width:20vw;position:absolute;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:aboslute}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.horizontal-line[_ngcontent-%COMP%]{padding:1vh 0;margin:0 1vw;border:.01rem solid #707070}"],changeDetection:0}),H),Z=l("oSzE"),q=l("DlmY");function Q(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new q.a;++e<n;)this.add(t[e])}Q.prototype.add=Q.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Q.prototype.has=function(t){return this.__data__.has(t)};var tt=Q,et=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},nt=function(t,e,n,i,a,o){var s=1&n,l=t.length,r=e.length;if(l!=r&&!(s&&r>l))return!1;var c=o.get(t);if(c&&o.get(e))return c==e;var u=-1,h=!0,b=2&n?new tt:void 0;for(o.set(t,e),o.set(e,t);++u<l;){var g=t[u],d=e[u];if(i)var f=s?i(d,g,u,e,t,o):i(g,d,u,t,e,o);if(void 0!==f){if(f)continue;h=!1;break}if(b){if(!et(e,function(t,e){if(!b.has(e)&&(g===t||a(g,t,n,i,o)))return b.push(e)})){h=!1;break}}else if(g!==d&&!a(g,d,n,i,o)){h=!1;break}}return o.delete(t),o.delete(e),h},it=l("ylTp"),at=l("Ce4a"),ot=l("YHEm"),st=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n},lt=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},rt=it.a?it.a.prototype:void 0,ct=rt?rt.valueOf:void 0,ut=l("TFwu"),ht=Object.prototype.hasOwnProperty,bt=l("YM6B"),gt=l("/1FC"),dt=l("WOAq"),ft=l("oYcn"),vt="[object Object]",mt=Object.prototype.hasOwnProperty,yt=l("EUcb"),pt=function t(e,n,i,a,o){return e===n||(null==e||null==n||!Object(yt.a)(e)&&!Object(yt.a)(n)?e!=e&&n!=n:function(t,e,n,i,a,o){var s=Object(gt.a)(t),l=Object(gt.a)(e),r=s?"[object Array]":Object(bt.a)(t),c=l?"[object Array]":Object(bt.a)(e),u=(r="[object Arguments]"==r?vt:r)==vt,h=(c="[object Arguments]"==c?vt:c)==vt,b=r==c;if(b&&Object(dt.a)(t)){if(!Object(dt.a)(e))return!1;s=!0,u=!1}if(b&&!u)return o||(o=new Z.a),s||Object(ft.a)(t)?nt(t,e,n,i,a,o):function(t,e,n,i,a,o,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new at.a(t),new at.a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Object(ot.a)(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var l=st;case"[object Set]":if(l||(l=lt),t.size!=e.size&&!(1&i))return!1;var r=s.get(t);if(r)return r==e;i|=2,s.set(t,e);var c=nt(l(t),l(e),i,a,o,s);return s.delete(t),c;case"[object Symbol]":if(ct)return ct.call(t)==ct.call(e)}return!1}(t,e,r,n,i,a,o);if(!(1&n)){var g=u&&mt.call(t,"__wrapped__"),d=h&&mt.call(e,"__wrapped__");if(g||d){var f=g?t.value():t,v=d?e.value():e;return o||(o=new Z.a),a(f,v,n,i,o)}}return!!b&&(o||(o=new Z.a),function(t,e,n,i,a,o){var s=1&n,l=Object(ut.a)(t),r=l.length;if(r!=Object(ut.a)(e).length&&!s)return!1;for(var c=r;c--;){var u=l[c];if(!(s?u in e:ht.call(e,u)))return!1}var h=o.get(t);if(h&&o.get(e))return h==e;var b=!0;o.set(t,e),o.set(e,t);for(var g=s;++c<r;){var d=t[u=l[c]],f=e[u];if(i)var v=s?i(f,d,u,e,t,o):i(d,f,u,t,e,o);if(!(void 0===v?d===f||a(d,f,n,i,o):v)){b=!1;break}g||(g="constructor"==u)}if(b&&!g){var m=t.constructor,y=e.constructor;m==y||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof y&&y instanceof y||(b=!1)}return o.delete(t),o.delete(e),b}(t,e,n,i,a,o))}(e,n,i,a,t,o))},_t=function(t,e){return pt(t,e)};function xt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"img",4),w.Tb("click",function(){w.gc(n);var t=w.Vb(),e=t.index,i=t.$implicit;return w.Vb().getIndex(e),i.onClick()}),w.Wb(2,"translate"),w.Lb(),w.Jb()}if(2&t){var i=w.Vb(),a=i.$implicit,o=i.index,s=w.Vb();w.xb(1),w.ac("ngClass",s.conditionalIconTheme(!(null==a||!a.nonClickable)))("ngStyle",(null==a?null:a.toggleable)&&s.conditionalActiveIcon(o))("src",a.imgPath,w.hc)("alt",a.alt)("title",w.Xb(2,6,a.hoverLabel)),w.yb("data-index",o)}}function wt(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"div",2),w.kc(2,xt,3,8,"ng-container",3),w.Lb(),w.Jb()),2&t){var n=e.$implicit;w.xb(2),w.ac("ngIf",n)}}var St,Mt,Ct=((Mt=function(){function t(e,n){var i=this;s(this,t),this._imgLabelState=e,this._annotateService=n,this._currentUrl="",this._tabStatus=[],this._navigate=new w.n,this.labelList=[],this.updateLabelList=function(){i.labelList=i._tabStatus[1].label_list?i._tabStatus[1].label_list:[]},this.resetSelectedAnnotate=function(){i._annotateService.setState()},this.bindImagePath=function(){i.jsonSchema={logos:[{imgPath:"../../../assets/icons/separator.svg",hoverLabel:"",alt:"",nonClickable:!0,toggleable:!1,onClick:function(){return null}},{imgPath:"../../../assets/icons/pointer.svg",hoverLabel:"leftSideBar.pointer",alt:"Pointer",toggleable:!0,onClick:function(){i.resetSelectedAnnotate(),i._imgLabelState.setState({draw:!1,drag:!0,scroll:!0})}},"/imglabel/bndbox"===i._currentUrl?{imgPath:"../../../assets/icons/rec_bounding_box.svg",hoverLabel:"leftSideBar.rectangularBB",alt:"RectangularBB",toggleable:0!==i.labelList.length,onClick:function(){i.resetSelectedAnnotate(),i._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})}}:{imgPath:"../../../assets/icons/polygon.svg",hoverLabel:"leftSideBar.polygon",alt:"Polygon",toggleable:0!==i.labelList.length,onClick:function(){0!==i.labelList.length?(i.resetSelectedAnnotate(),i._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})):i.showAlertNoLabel()}},{imgPath:"../../../assets/icons/eraser.svg",hoverLabel:"leftSideBar.eraser",alt:"Eraser",toggleable:!1,onClick:function(){i.resetSelectedAnnotate(),i._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!0}),i._imgLabelState.setState(null)}},{imgPath:"../../../assets/icons/fit_center.svg",hoverLabel:"leftSideBar.fitCenter",alt:"Fit Center",toggleable:!1,onClick:function(){i.resetSelectedAnnotate(),i._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1}),i._imgLabelState.setState(null)}},{imgPath:"../../../assets/icons/save.svg",hoverLabel:"leftSideBar.save",alt:"Save",toggleable:!1,onClick:function(){i.resetSelectedAnnotate(),i._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1})}}]}},this.checkStateEqual=function(t,e){return!_t(t,e)},this.getIndex=function(t){i.iconIndex=t},this.conditionalIconTheme=function(t){return t?"plain-icon":"utility-icon-light"},this.conditionalActiveIcon=function(t){return t===i.iconIndex?{background:"rgb(59 59 59)"}:null}}return r(t,[{key:"ngOnInit",value:function(){this.updateLabelList(),this.bindImagePath()}},{key:"ngOnChanges",value:function(t){if(this.bindImagePath(),t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){var e=t._tabStatus.currentValue;this._tabStatus=i(e),this.updateLabelList()}}},{key:"showAlertNoLabel",value:function(){alert("No label exist yet. Please add new label.")}}]),t}()).\u0275fac=function(t){return new(t||Mt)(w.Hb(X),w.Hb(B))},Mt.\u0275cmp=w.Bb({type:Mt,selectors:[["image-labelling-left-sidebar"]],inputs:{_onChange:"_onChange",_currentUrl:"_currentUrl",_tabStatus:"_tabStatus"},outputs:{_navigate:"_navigate"},features:[w.vb],decls:2,vars:1,consts:[[1,"utility-left-sidebar-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[4,"ngIf"],[3,"ngClass","ngStyle","src","alt","title","click"]],template:function(t,e){1&t&&(w.Mb(0,"div",0),w.kc(1,wt,3,1,"ng-container",1),w.Lb()),2&t&&(w.xb(1),w.ac("ngForOf",e.jsonSchema.logos))},directives:[c.j,c.k,c.i,c.l],pipes:[V.c],styles:[".utility-left-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.14vw;max-width:2.14vw;min-height:95.4vh;max-height:95.4vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.plain-icon[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:auto}"],changeDetection:0}),Mt),Pt=((St=function(){function t(e){var n=this;s(this,t),this.el=e,this.srcAttr=null,this.canLazyLoad=function(){return window&&"IntersectionObserver"in window},this.lazyLoadImage=function(){new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting?n.loadImage():n.unloadImage()})}).observe(n.el.nativeElement)},this.loadImage=function(){n.srcAttr=n.src},this.unloadImage=function(){n.srcAttr=""}}return r(t,[{key:"ngAfterViewInit",value:function(){this.canLazyLoad()?this.lazyLoadImage():this.loadImage()}}]),t}()).\u0275fac=function(t){return new(t||St)(w.Hb(w.l))},St.\u0275dir=w.Cb({type:St,selectors:[["img","imgLazyLoad",""]],hostVars:1,hostBindings:function(t,e){2&t&&w.yb("src",e.srcAttr,w.hc)},inputs:{src:"src"}}),St),kt=l("3Pt+");function Lt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",12),w.Tb("click",function(){w.gc(n);var t=e.$implicit,i=e.index;return w.Vb(3).onClick(t,i)}),w.Mb(2,"div",13),w.Ib(3,"img",14),w.Lb(),w.Mb(4,"div",15),w.Mb(5,"label",16),w.mc(6),w.Wb(7,"fileNameSlice"),w.Lb(),w.Lb(),w.Mb(8,"div"),w.Ib(9,"div",17),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=e.$implicit;w.xb(3),w.ac("src",i.img_thumbnail,w.hc),w.xb(3),w.nc(w.Xb(7,3,i.img_path)),w.xb(3),w.ac("ngClass",(null==i.bnd_box?null:i.bnd_box.length)>0||(null==i.polygons?null:i.polygons.length)>0?"indicator":"no-indicator")}}function Ot(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",7),w.Mb(2,"label",8),w.mc(3),w.Wb(4,"translate"),w.Lb(),w.Mb(5,"span",9),w.Mb(6,"div",10),w.Tb("click",function(){w.gc(n);var t=w.Vb().$implicit;return w.Vb().onClose(t)}),w.mc(7,"x"),w.Lb(),w.Lb(),w.Mb(8,"section",11),w.kc(9,Lt,10,5,"ng-container",4),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=w.Vb(),a=i.$implicit,o=i.index,s=w.Vb();w.xb(1),w.ac("ngClass",s.checkCloseToggle(a)),w.yb("data-index",o),w.xb(2),w.nc(w.Xb(4,4,a.name)),w.xb(6),w.ac("ngForOf",s._thumbnailList)}}function It(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"span",29),w.Tb("click",function(){w.gc(n);var t=w.Vb().$implicit;return w.Vb(4).onDeleteLabel(t)}),w.mc(2),w.Wb(3,"translate"),w.Lb(),w.Jb()}if(2&t){var i=w.Vb(5);w.xb(1),w.ac("ngClass",i.clickAbilityToggle?"pointer":null),w.xb(1),w.nc(w.Xb(3,2,"labellingProject.delete"))}}function jt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",27),w.Mb(2,"label",28),w.Mb(3,"div",29),w.Tb("click",function(){w.gc(n);var t=e.$implicit,i=w.Vb(4);return i.clickAbilityToggle?i.onClickLabel(t):null}),w.mc(4),w.Lb(),w.Lb(),w.Mb(5,"label",30),w.kc(6,It,4,4,"ng-container",31),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=e.$implicit,a=e.index,o=w.Vb(4);w.xb(1),w.ac("ngClass",i===o.selectedLabel?"label-active":null),w.xb(2),w.ac("ngClass",o.clickAbilityToggle?"pointer":null),w.xb(1),w.oc(" ",i," "),w.xb(2),w.ac("ngIf",!o.action&&a>0)}}function At(t,e){1&t&&(w.Mb(0,"label",32),w.mc(1),w.Wb(2,"translate"),w.Lb()),2&t&&(w.xb(1),w.oc(" ",w.Xb(2,1,"labellingProject.labelNotExist")," "))}function Bt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",7),w.Mb(2,"label",8),w.mc(3),w.Wb(4,"translate"),w.Lb(),w.Mb(5,"div",19),w.Mb(6,"span",20),w.Mb(7,"div",10),w.Tb("click",function(){w.gc(n);var t=w.Vb(2).$implicit;return w.Vb().onClose(t)}),w.mc(8,"x"),w.Lb(),w.Lb(),w.Ib(9,"span",21),w.Ib(10,"span",21),w.Lb(),w.Mb(11,"div",22),w.Mb(12,"input",23),w.Tb("ngModelChange",function(t){return w.gc(n),w.Vb(3).inputLabel=t})("ngModelChange",function(t){return w.gc(n),w.Vb(3).inputLabelChange(t)})("keydown.enter",function(t){return w.gc(n),w.Vb(3).validateInputLabel(t)}),w.Wb(13,"translate"),w.Lb(),w.Lb(),w.Mb(14,"div",24),w.Mb(15,"div",25),w.kc(16,jt,7,4,"ng-container",4),w.kc(17,At,3,3,"label",26),w.Lb(),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=w.Vb(2),a=i.$implicit,o=i.index,s=w.Vb();w.xb(1),w.ac("ngClass",s.checkCloseToggle(a)),w.yb("data-index",o),w.xb(2),w.nc(w.Xb(4,8,a.name)),w.xb(9),w.ac("ngClass",s.invalidInput?"input-invalid":null)("ngModel",s.inputLabel)("placeholder",w.Xb(13,10,"labellingProject.enterLabel")),w.xb(4),w.ac("ngForOf",s.labelList),w.xb(1),w.ac("ngIf",0===s.labelList.length)}}function Dt(t,e){if(1&t){var n=w.Nb();w.Mb(0,"div",38),w.Tb("click",function(){return w.gc(n),w.Vb(8).onDeleteAnnotation()}),w.mc(1," - "),w.Lb()}if(2&t){var i=w.Vb(8);w.ac("ngClass",i.clickAbilityToggle?"pointer":null)}}function Xt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"label",36),w.Tb("click",function(){w.gc(n);var t=e.index,i=e.$implicit,a=w.Vb(7);return a.clickAbilityToggle?a.onClickAnnotation(t,i):null}),w.Mb(2,"div",17),w.mc(3),w.Lb(),w.kc(4,Dt,2,1,"div",37),w.Lb(),w.Jb()}if(2&t){var i=e.$implicit,a=e.index,o=w.Vb(7);w.xb(1),w.ac("ngClass",a===o.selectedIndexAnnotation?"annotation-active":null),w.yb("data-index",a),w.xb(1),w.ac("ngClass",o.clickAbilityToggle?"pointer":null),w.xb(1),w.pc(" ",i.label," : ",i.id," "),w.xb(1),w.ac("ngIf",a===o.selectedIndexAnnotation)}}function Et(t,e){if(1&t&&(w.Kb(0),w.kc(1,Xt,5,6,"ng-container",4),w.Jb()),2&t){var n=w.Vb().$implicit;w.xb(1),w.ac("ngForOf",n.bnd_box)}}function Tt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"label",36),w.Tb("click",function(){w.gc(n);var t=e.index,i=e.$implicit,a=w.Vb(7);return a.clickAbilityToggle?a.onClickAnnotation(t,i):null}),w.Mb(2,"div",17),w.mc(3),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=e.$implicit,a=e.index,o=w.Vb(7);w.xb(1),w.ac("ngClass",a===o.selectedIndexAnnotation?"annotation-active":null),w.yb("data-index",a),w.xb(1),w.ac("ngClass",o.clickAbilityToggle?"pointer":null),w.xb(1),w.pc(" ",i.label," : ",i.id," ")}}function Yt(t,e){if(1&t&&w.kc(0,Tt,4,5,"ng-container",4),2&t){var n=w.Vb().$implicit;w.ac("ngForOf",n.polygons)}}function zt(t,e){if(1&t&&(w.Kb(0),w.kc(1,Et,2,1,"ng-container",5),w.kc(2,Yt,1,1,"ng-template",null,35,w.lc),w.Jb()),2&t){var n=e.$implicit,i=w.ec(3);w.xb(1),w.ac("ngIf",n.bnd_box)("ngIfElse",i)}}function Rt(t,e){if(1&t&&(w.Kb(0),w.kc(1,zt,4,2,"ng-container",4),w.Jb()),2&t){var n=w.Vb(3).$implicit;w.xb(1),w.ac("ngForOf",n.annotation)}}function Vt(t,e){if(1&t){var n=w.Nb();w.Mb(0,"div",7),w.Mb(1,"label",8),w.mc(2),w.Wb(3,"translate"),w.Lb(),w.Mb(4,"div",19),w.Mb(5,"span",20),w.Mb(6,"div",10),w.Tb("click",function(){w.gc(n);var t=w.Vb(2).$implicit;return w.Vb().onClose(t)}),w.mc(7,"x"),w.Lb(),w.Lb(),w.Ib(8,"span",21),w.Ib(9,"span",21),w.Lb(),w.Mb(10,"div",33),w.Mb(11,"div",25),w.Mb(12,"div",34),w.kc(13,Rt,2,1,"ng-container",31),w.Lb(),w.Lb(),w.Lb(),w.Lb()}if(2&t){var i=w.Vb(2),a=i.$implicit,o=i.index,s=w.Vb();w.ac("ngClass",s.checkCloseToggle(a)),w.yb("data-index",o),w.xb(2),w.nc(w.Xb(3,4,a.name)),w.xb(11),w.ac("ngIf",null==a?null:a.annotation)}}function Nt(t,e){if(1&t&&(w.kc(0,Bt,18,12,"ng-container",5),w.kc(1,Vt,14,6,"ng-template",null,18,w.lc)),2&t){var n=w.ec(2),i=w.Vb().index;w.ac("ngIf",1===i)("ngIfElse",n)}}function Wt(t,e){if(1&t&&(w.Kb(0),w.kc(1,Ot,10,6,"ng-container",5),w.kc(2,Nt,3,2,"ng-template",null,6,w.lc),w.Jb()),2&t){var n=e.index,i=w.ec(3);w.xb(1),w.ac("ngIf",0===n)("ngIfElse",i)}}var $t,Ft=(($t=function(){function t(n,a){var o=this;s(this,t),this._annotateService=n,this._imgLblState=a,this._thumbnailList=[],this._tabStatus=[],this._onClose=new w.n,this._onClickThumbnail=new w.n,this._onClickLabel=new w.n,this._onEnterLabel=new w.n,this._onChangeAnnotationLabel=new w.n,this._onDeleteAnnotation=new w.n,this.action=-1,this.displayInputLabel=!1,this.inputLabel="",this.selectedIndexAnnotation=-1,this.selectedLabel="",this.unsubscribe$=new p.a,this.clickAbilityToggle=!1,this.invalidInput=!1,this.labelList=[],this.updateLabelList=function(){o.labelList=o._tabStatus[1].label_list?o._tabStatus[1].label_list:[]},this.onClose=function(t){o._onClose.emit({name:t.name,closed:!0})},this.onClick=function(t,e){o._onClickThumbnail.emit(Object.assign(Object.assign({},t),{thumbnailIndex:e})),o.selectedIndexAnnotation=-1,o.selectedLabel=""},this.onDisplayInputModal=function(){o.displayInputLabel=!o.displayInputLabel,o.inputLabel=""},this.validateInputLabel=function(t){var e=t.target.value,n=e.trim();if(n)if(n.match(/^[a-zA-Z0-9-]*$/))if(o._tabStatus.some(function(t){var e=t.label_list;return e&&e.length?e.some(function(t){return t===n}):null}))o.invalidInput=!0,console.error("Invalid existing label input");else{o.invalidInput=!1;var a=o._tabStatus.map(function(t){return t.label_list||[]}).filter(function(t){return t.length>0})[0];o._onEnterLabel.emit({action:1,label_list:a?[].concat(i(a),[e]):[e]}),o.displayInputLabel=!1,o.inputLabel=""}else o.invalidInput=!0,console.error("Invalid input value")},this.onDeleteLabel=function(t){var n=e(o._tabStatus.filter(function(t){return t.label_list}),1)[0].label_list;o._onClickLabel.emit({selectedLabel:t,label_list:n&&n.length>0?n:[],action:0})},this.onClickLabel=function(t){o.selectedLabel=t,o.selectedIndexAnnotation>-1&&o._onChangeAnnotationLabel.emit({label:t,index:o.selectedIndexAnnotation})},this.onClickAnnotation=function(t,e){var n=e.label;o.selectedLabel=n,o._annotateService.setState({annotation:t})},this.onDeleteAnnotation=function(){o.selectedIndexAnnotation>-1&&o._onDeleteAnnotation.emit(o.selectedIndexAnnotation)},this.checkCloseToggle=function(t){var e="";return"labellingProject.label"===t.name&&o._tabStatus[2].closed||"labellingProject.project"===t.name&&o._tabStatus[1].closed&&o._tabStatus[2].closed||"labellingProject.annotation"===t.name||(e="flex-content"),t.closed&&(e+=" closed"),e},this.checkStateEqual=function(t,e){return!_t(t,e)}}return r(t,[{key:"ngOnInit",value:function(){var t=this;this.updateLabelList(),this._imgLblState.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){var n=e.draw;return t.clickAbilityToggle=n}),this._thumbnailList.length>0&&this._annotateService.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(n){var i,a=n.annotation;t.selectedIndexAnnotation=a;var o=e(t._tabStatus.filter(function(t){return t.annotation}),1)[0].annotation,s=null==o?void 0:o.map(function(t){var e=t.bnd_box,n=t.polygons;return e?e.find(function(t,e){return e===a}):n?n.find(function(t,e){return e===a}):void 0})[0];t.selectedLabel=null!==(i=null==s?void 0:s.label)&&void 0!==i?i:""})}},{key:"inputLabelChange",value:function(t){var e;this.labelList=this._tabStatus[1].label_list?null===(e=this._tabStatus[1].label_list)||void 0===e?void 0:e.filter(function(e){return e.includes(t)}):[]}},{key:"ngOnChanges",value:function(t){if(t._thumbnailList){var e=t._thumbnailList.currentValue;this._thumbnailList=Object.assign([],this._thumbnailList,i(e))}if(t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){var n=t._tabStatus.currentValue;this._tabStatus=i(n),this.updateLabelList()}}},{key:"openAllTab",value:function(){this._tabStatus.forEach(function(t){t.closed=!1})}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),t}()).\u0275fac=function(t){return new(t||$t)(w.Hb(B),w.Hb(X))},$t.\u0275cmp=w.Bb({type:$t,selectors:[["image-labelling-project"]],inputs:{_thumbnailList:"_thumbnailList",_tabStatus:"_tabStatus"},outputs:{_onClose:"_onClose",_onClickThumbnail:"_onClickThumbnail",_onClickLabel:"_onClickLabel",_onEnterLabel:"_onEnterLabel",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onDeleteAnnotation:"_onDeleteAnnotation"},features:[w.vb],decls:10,vars:1,consts:[[1,"tab-container"],[1,"tab-skeleton"],[1,"choose-tab"],[1,"open-all-tabs",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["nonThumbnailTab",""],[1,"utility-right-project-container","tab","flex-fill-remaining",3,"ngClass"],[1,"tab-name"],[1,"tab-close-thumbnail"],[1,"div-close",3,"click"],[1,"utility-inner-container","tab-height","scroll"],[1,"img-container",3,"click"],[1,"img-skeleton"],["imgLazyLoad","",1,"img",3,"src"],[1,"img-name"],[1,"img-path"],[3,"ngClass"],["annotationTab",""],[1,"flex-tab-icons"],[1,"tab-close-thumbnailless"],[1,"tab-extra-icons"],[1,"div-input"],["type","text",1,"input",3,"ngClass","ngModel","placeholder","ngModelChange","keydown.enter"],["id","inner-container",1,"utility-inner-container","tab-height","scroll"],[1,"flex-item"],["class","not-exist",4,"ngIf"],[1,"flex-center-width",3,"ngClass"],[1,"label"],[3,"ngClass","click"],[1,"action"],[4,"ngIf"],[1,"not-exist"],["id","inner-container",1,"utility-inner-container","scroll","tab-smaller-height"],[1,"flex-center-width"],["polygon",""],[1,"label",3,"ngClass","click"],["class","delete-annotation",3,"ngClass","click",4,"ngIf"],[1,"delete-annotation",3,"ngClass","click"]],template:function(t,e){1&t&&(w.Mb(0,"div",0),w.Mb(1,"div",1),w.Mb(2,"p",2),w.mc(3,"Choose any tab to start"),w.Lb(),w.Mb(4,"p"),w.mc(5,"or"),w.Lb(),w.Mb(6,"p"),w.Mb(7,"span",3),w.Tb("click",function(){return e.openAllTab()}),w.mc(8,"Click here to open all tabs"),w.Lb(),w.Lb(),w.Lb(),w.kc(9,Wt,4,2,"ng-container",4),w.Lb()),2&t&&(w.xb(9),w.ac("ngForOf",e._tabStatus))},directives:[c.j,c.k,c.i,Pt,kt.a,kt.f,kt.i],pipes:[V.c,R],styles:['.tab-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;right:0;position:fixed;z-index:1000;min-width:18.5vw;max-width:18.5vw}.utility-right-project-container[_ngcontent-%COMP%]{height:100%;min-width:16.3vw;max-width:16.3vw;background:#696969;border:.0325vw solid hsla(0,0%,100%,.25);border-top:none;z-index:1000;align-items:stretch}.utility-right-project-container[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;min-width:8.5vw;max-width:8.5vw;min-height:4vh;max-height:4vh;background:#383535;z-index:-1;font-size:1.5vh;line-height:3vh;color:#fff;padding:.5vh 0 0 2vw}.tab[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;overflow:hidden}.tab[_ngcontent-%COMP%]:before{position:absolute;content:"";top:4vh;min-width:100vw;max-width:100vw;min-height:93vh;max-height:93vh;background:#383535;z-index:-1}.flex-fixed[_ngcontent-%COMP%]{flex:0 1 25vh}.flex-fill-remaining[_ngcontent-%COMP%]{flex:1 1 auto}.flex-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:33%;min-height:10%;flex-shrink:0;flex-grow:0;resize:vertical}.tab-name[_ngcontent-%COMP%]{font-size:1.7vh;padding:.5vw 2vw 0;display:inline-block;color:#fff;position:absolute}.tab-close-thumbnail[_ngcontent-%COMP%]{margin-left:3vw;justify-content:center}.tab-close-thumbnail[_ngcontent-%COMP%], .tab-close-thumbnailless[_ngcontent-%COMP%]{float:right;vertical-align:middle;min-height:4vh;max-height:4vh;color:#696969;font-size:2vh;line-height:4vh;text-align:center;display:inline-grid;padding-bottom:1vh}.tab-close-thumbnailless[_ngcontent-%COMP%]{flex:1 0 60%;justify-content:right}.div-close[_ngcontent-%COMP%]{min-width:1.6vw;max-width:1.6vw;min-height:4vh;max-height:4vh;color:#fff;cursor:pointer;text-align:center;float:right}.div-close[_ngcontent-%COMP%]:active{background:grey}.utility-inner-container[_ngcontent-%COMP%]{padding:2.5vh 0 0 .2vw;scroll-behavior:smooth;overflow:hidden auto;z-index:100;min-width:15.5vw;max-width:15.5vw}.tab-height[_ngcontent-%COMP%]{height:75%}.tab-smaller-height[_ngcontent-%COMP%]{height:60%}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.img-container[_ngcontent-%COMP%], .utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.img-container[_ngcontent-%COMP%]{font-size:1.5vh;color:#fff;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;cursor:pointer;margin:0 .3vw;padding:.1vh .4vw}.img-container[_ngcontent-%COMP%]:hover{background-color:#444;border-radius:2px}.img[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}.img[_ngcontent-%COMP%], .img-skeleton[_ngcontent-%COMP%]{max-height:4.3vh;min-height:4.3vh;max-width:3vw}.img-skeleton[_ngcontent-%COMP%]{min-width:3vw;border:.005vh dotted #525353}.img-name[_ngcontent-%COMP%]{margin-left:.5vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.closed[_ngcontent-%COMP%]{display:none}.utility-icon-dark[_ngcontent-%COMP%], .utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute}.flex-item[_ngcontent-%COMP%]{align-items:center;flex-direction:column;font-size:1.5vh;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.flex-center-width[_ngcontent-%COMP%], .flex-item[_ngcontent-%COMP%]{display:flex;justify-content:center}.flex-center-width[_ngcontent-%COMP%]{width:90%;flex-wrap:wrap}.label[_ngcontent-%COMP%]{flex:1 1 80%;display:flex;justify-content:flex-start;margin:.25vh 0}.pointer[_ngcontent-%COMP%]{cursor:pointer}.annotation-active[_ngcontent-%COMP%], .label-active[_ngcontent-%COMP%]{border:.15vw solid #ff0}.utility-info-btn[_ngcontent-%COMP%]{font-size:1vw;min-width:0;max-width:0;min-height:2.5vh;max-height:2.5vh;line-height:0;right:21vh;position:absolute;background:#383535;border:none;color:#fff}.flex-tab-icons[_ngcontent-%COMP%]{display:flex;width:100%}.extra-icons[_ngcontent-%COMP%]{cursor:pointer}.extra-icons[_ngcontent-%COMP%]:active{background:grey}.tab-extra-icons[_ngcontent-%COMP%]{float:right;vertical-align:middle;font-size:1.7vh;line-height:4vh;text-align:center;color:#fff;flex:1 0 15%;justify-content:flex-start}.tab-text[_ngcontent-%COMP%]{font-size:1.7vh;min-width:6vw;max-width:6vw}.inner-content[_ngcontent-%COMP%]{max-height:25vh;min-height:25vh;min-width:3vw;max-width:3vw}.div-input[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin:.5vh .9vw}.input[_ngcontent-%COMP%]{border-radius:8vw;border:none;outline:none;padding:.3vw 0 .3vw 1vw;min-height:1.5vh;max-height:1.5vh;min-width:13vw;max-width:13vw;font-size:1.3vh;background:#525353;color:#fff}.input-invalid[_ngcontent-%COMP%]{border:.2vw solid red}.img-path[_ngcontent-%COMP%]{margin-top:4vh}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:relative}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.not-exist[_ngcontent-%COMP%]{font-size:1.5vh;color:#999}.delete-annotation[_ngcontent-%COMP%]{position:absolute;right:2vw}.open-all-tabs[_ngcontent-%COMP%]{cursor:pointer;padding:.2vh .2vw;border-radius:.7vw}.open-all-tabs[_ngcontent-%COMP%]:hover{background:#636363}.open-all-tabs[_ngcontent-%COMP%]:active, .open-all-tabs[_ngcontent-%COMP%]:focus{background:#737474}.tab-skeleton[_ngcontent-%COMP%]{position:absolute;height:100vh;width:16.5vw;background:#525353;border-left:.0625vw solid hsla(0,0%,100%,.25);text-align:center;color:#cac8c8;font-size:2vh}.choose-tab[_ngcontent-%COMP%]{margin-top:42vh}']}),$t);function Kt(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"div",3),w.Mb(2,"label"),w.Mb(3,"img",4),w.Tb("click",function(){return e.$implicit.onClick()}),w.Wb(4,"translate"),w.Lb(),w.Lb(),w.Lb(),w.Jb()),2&t){var n=e.$implicit,i=e.index,a=w.Vb();w.xb(3),w.jc(n.style),w.ac("ngClass",a.conditionalIconTheme())("src",n.imgPath,w.hc)("alt",n.alt)("title",w.Xb(4,7,n.hoverLabel)),w.yb("data-index",i)}}var Ut,Jt=((Ut=function(){function t(){var e=this;s(this,t),this._onClick=new w.n,this._onExport=new w.n,this._onReload=new w.n,this.bindImagePath=function(){e.jsonSchema={logos:[{imgPath:"../../../assets/icons/folder.svg",hoverLabel:"rightSideBar.folderOrFiles",alt:"Folder",onClick:function(){e._onClick.emit({name:"labellingProject.project",closed:!1})}},{imgPath:"../../../assets/icons/tag.svg",hoverLabel:"rightSideBar.label",alt:"Label",onClick:function(){e._onClick.emit({name:"labellingProject.label",closed:!1})}},{imgPath:"../../../assets/icons/bounding_box.svg",hoverLabel:"rightSideBar.annotation",alt:"Annotation",onClick:function(){e._onClick.emit({name:"labellingProject.annotation",closed:!1})}},{imgPath:"../../../assets/icons/statistic.svg",hoverLabel:"rightSideBar.statistic",alt:"Statistic",onClick:function(){}},{imgPath:"../../../assets/icons/export.svg",hoverLabel:"rightSideBar.export",alt:"Export",style:"padding: 1.5vh 0.5vw;",onClick:function(){e._onExport.emit()}},{imgPath:"../../../assets/icons/reload.svg",hoverLabel:"rightSideBar.reload",alt:"Reload",style:"padding: 1.5vh 0.5vw;",onClick:function(){e._onReload.emit()}}]}},this.conditionalIconTheme=function(){return"utility-icon-light"}}return r(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"ngOnChanges",value:function(t){this.bindImagePath()}}]),t}()).\u0275fac=function(t){return new(t||Ut)},Ut.\u0275cmp=w.Bb({type:Ut,selectors:[["image-labelling-right-sidebar"]],inputs:{_onChange:"_onChange"},outputs:{_onClick:"_onClick",_onExport:"_onExport",_onReload:"_onReload"},features:[w.vb],decls:3,vars:1,consts:[[1,"utility-right-sidebar-container"],[1,"utility-inner-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"]],template:function(t,e){1&t&&(w.Mb(0,"div",0),w.Mb(1,"div",1),w.kc(2,Kt,5,9,"ng-container",2),w.Lb(),w.Lb()),2&t&&(w.xb(2),w.ac("ngForOf",e.jsonSchema.logos))},directives:[c.j,c.i],pipes:[V.c],styles:[".utility-right-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.2vw;max-width:2.2vw;min-height:95.5vh;max-height:95.5vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-inner-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw;position:absolute}.utility-icon-container[_ngcontent-%COMP%], .utility-inner-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.input-none[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),Ut);function Ht(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"div",3),w.mc(2),w.Wb(3,"translate"),w.Lb(),w.Jb()),2&t){var n=w.Vb(2);w.xb(2),w.pc("",w.Xb(3,2,"footer.image"),": ",n.thumbnailType,"")}}function Gt(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",2),w.Mb(2,"div",3),w.mc(3),w.Wb(4,"translate"),w.Lb(),w.kc(5,Ht,4,4,"ng-container",1),w.Mb(6,"div",3),w.mc(7),w.Lb(),w.Mb(8,"div",4),w.Wb(9,"translate"),w.Mb(10,"label",5),w.Tb("click",function(){w.gc(n);var t=w.Vb();return t.copyMessage(t._thumbnailInfo.img_path)}),w.mc(11),w.Lb(),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=w.Vb();w.xb(3),w.pc("",w.Xb(4,7,"footer.size"),": ",i.thumbnailSize,""),w.xb(2),w.ac("ngIf",i.thumbnailType),w.xb(2),w.pc("",i._thumbnailInfo.img_ori_w," x ",i._thumbnailInfo.img_ori_h,""),w.xb(1),w.ac("title",w.Xb(9,9,"footer.copyToClipboard")),w.xb(3),w.nc(i._thumbnailInfo.img_path)}}var Zt,qt,Qt,te,ee,ne,ie=((Zt=function(){function t(){s(this,t),this._imgSrc="",this.thumbnailSize="",this.thumbnailType="",this.formatBytes=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 Bytes";var n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}return r(t,[{key:"ngOnInit",value:function(){}},{key:"copyMessage",value:function(t){var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}},{key:"ngOnChanges",value:function(t){if(t._thumbnailInfo&&t._imgSrc){var e=t._thumbnailInfo.currentValue,n=t._imgSrc.currentValue;this._thumbnailInfo=Object.assign(Object.assign({},this._thumbnailInfo),e),this.thumbnailSize=this.formatBytes(n.length);var i=n.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(i&&i.length){var a=i[1].split("/")[1];this.thumbnailType=a}}}}]),t}()).\u0275fac=function(t){return new(t||Zt)},Zt.\u0275cmp=w.Bb({type:Zt,selectors:[["image-labelling-footer"]],inputs:{_thumbnailInfo:"_thumbnailInfo",_imgSrc:"_imgSrc"},features:[w.vb],decls:3,vars:3,consts:[[1,"footer-container"],[4,"ngIf"],[1,"footer-label-container"],[1,"footer-label"],[1,"footer-image-path",3,"title"],[1,"footer-path-label",3,"click"]],template:function(t,e){1&t&&(w.Mb(0,"div",0),w.kc(1,Gt,12,11,"ng-container",1),w.Wb(2,"json"),w.Lb()),2&t&&(w.xb(1),w.ac("ngIf","{}"!=w.Xb(2,1,e._thumbnailInfo)))},directives:[c.k],pipes:[c.e,V.c],styles:[".footer-container[_ngcontent-%COMP%]{position:absolute;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);min-height:2.3vh;max-height:2.3vh;min-width:100vw;max-width:100vw;bottom:0;padding-left:2.5vw}.footer-label-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:baseline;width:80%}.footer-label[_ngcontent-%COMP%]{flex:0 1 15%;text-align:center}.footer-image-path[_ngcontent-%COMP%], .footer-label[_ngcontent-%COMP%]{font-size:1.6vh;color:#fff;outline:none;border-right:.05vw solid #fff;padding:0 1vw}.footer-image-path[_ngcontent-%COMP%]{display:flex;flex:0 1 130%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border-right[_ngcontent-%COMP%]{border-right:1rem #fff}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:1.5vh;max-height:1.5vh;padding:0;position:absolute;cursor:context-menu}.footer-path-label[_ngcontent-%COMP%]{cursor:pointer;padding:0 .2vw;border-radius:.5vw}.footer-path-label[_ngcontent-%COMP%]:hover{background:#636363}.footer-path-label[_ngcontent-%COMP%]:active, .footer-path-label[_ngcontent-%COMP%]:focus{background:#737474}"],changeDetection:0}),Zt),ae=l("44N4"),oe=l("TJKd"),se=l("XIp8"),le=l("CfRg"),re=function(t){return Object(le.a)(t,4)},ce=function(){function t(){s(this,t)}return r(t,[{key:"stringifyObject",value:function(t){try{return JSON.stringify(t)}catch(e){return console.log("StringifyObject(content) ----\x3e ",e.name+": ",e.message),""}}},{key:"deepCloneObject",value:function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.log("DeepCloneObject(content) ----\x3e ",e.name+": ",e.message),null}}},{key:"deepCloneVariable",value:function(t){try{return(t?JSON.parse(JSON.stringify({item:t})):"").item}catch(e){return console.log("DeepCloneVariable(variable) ----\x3e ",e.name+": ",e.message),""}}},{key:"generateUniquesID",value:function(){try{var t="",e=new Date;return t+=e.getDate().toString(),t+=(e.getMonth()+1).toString(),t+=e.getFullYear().toString(),t+=e.getHours().toString(),t+=e.getMinutes().toString(),t+=e.getSeconds().toString(),t+=e.getMilliseconds().toString(),parseInt(t,10)}catch(n){return console.log("GenerateUniquesID() ----\x3e ",n.name+": ",n.message),-1}}},{key:"matchStringHead",value:function(t,e){try{return e.substr(0,t.length)===t}catch(n){return console.log("MatchStringHead(StrToMatch:string, oristr:string) ----\x3e ",n.name+": ",n.message),!1}}},{key:"getFilename",value:function(t){try{var e=this.deepCloneVariable(t).split("\\").join("/").split("/");return e[e.length-1]}catch(n){return console.log("GetFilename(strs) ----\x3e ",n.name+": ",n.message),""}}},{key:"GetFoldername",value:function(t){try{var e=JSON.parse(JSON.stringify({st:t})).st.split("\\").join("/").split("/");return e.pop(),e.join("/")}catch(n){return console.log("GetFoldername(strs) ----\x3e ",n.name+": ",n.message),""}}},{key:"RemoveHTMLElement",value:function(t){var e;try{var n=document.getElementById(t);null!=n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}catch(i){console.log("RemoveHTMLElement(ids) ----\x3e ",i.name+": ",i.message)}}}]),t}(),ue=((te=function(){function n(){s(this,n),this.globalXY={x:0,y:0},this.panXY={x:0,y:0},this.currentClickedBox={box:-1,pos:"o"},this.lineOffset=3,this.anchrSize=2.5,this.currentDrawing={x1:0,x2:0,y1:0,y2:0},this.currentSelectedBndBox=-1,this.util=new ce}return r(n,[{key:"getDiffXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{var i={diffX:0,diffY:0};return i.diffX=this.globalXY.x+(e-this.panXY.x),i.diffY=this.globalXY.y+(n-this.panXY.y),i}catch(a){return console.log("ObjectDetection getDiffXY(offsetX: number,offsetY: number): { diffX: number; diffY: number }",a.name+": ",a.message),{diffX:-1,diffY:-1}}}},{key:"setCurrentX1Y1",value:function(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x1=t,this.currentDrawing.y1=e)}catch(n){console.log("ObjectDetection setCurrentX1Y1(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}},{key:"setCurrentX2Y2",value:function(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x2=t,this.currentDrawing.y2=e)}catch(n){console.log("ObjectDetection setCurrentX2Y2(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}},{key:"moveAllBbox",value:function(e,n,i,a){try{var o,s=t(e);try{for(s.s();!(o=s.n()).done;){var l=o.value,r=l.x2-l.x1,c=l.y2-l.y1;l.x1=re(n+l.distancetoImg.x),l.y1=re(i+l.distancetoImg.y),l.x2=re(l.x1+r),l.y2=re(l.y1+c)}}catch(u){s.e(u)}finally{s.f()}a&&a(!0)}catch(u){}}},{key:"calScaleTofitScreen",value:function(t,e,n,i){try{var a={factor:-1,newX:-1,newY:-1};return a.factor=Math.min(n/t,i/e),a.factor=a.factor-.05*a.factor,a.newX=n/2-t/2*a.factor,a.newY=i/2-e/2*a.factor,a}catch(o){return{factor:-1,newX:-1,newY:-1}}}},{key:"deleteSingleBox",value:function(t,e,n){try{t.splice(e,1),this.currentSelectedBndBox=-1,this.currentClickedBox={box:-1,pos:"o"},n(!0)}catch(i){}}},{key:"keyboardMoveBox",value:function(t,e,n,i){var a=n.img_w,o=n.img_h,s=n.img_x,l=n.img_y;try{switch(t){case"up":this.moveBoxWithinPointPath(s,l,a,o,0,-3,e)&&(e.y1-=3,e.y2-=3);break;case"down":this.moveBoxWithinPointPath(s,l,a,o,0,3,e)&&(e.y1+=3,e.y2+=3);break;case"left":this.moveBoxWithinPointPath(s,l,a,o,-3,0,e)&&(e.x1-=3,e.x2-=3);break;case"right":this.moveBoxWithinPointPath(s,l,a,o,3,0,e)&&(e.x1+=3,e.x2+=3)}i(!0)}catch(r){}}},{key:"moveBoxWithinPointPath",value:function(t,e,n,i,a,o,s){try{return!(s.x1+a<t||s.x2+a>t+n||s.y1+o<e||s.y2+o>e+i)}catch(l){return console.log("ObjectDetection isWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, addx:number, addy:number, box:Boundingbox):Boolean",l.name+": ",l.message),!1}}},{key:"mouseMoveBox",value:function(t,e,n){try{if(this.moveBoxWithinPointPath(n.img_x,n.img_y,n.img_w,n.img_h,t-this.currentDrawing.x1,e-this.currentDrawing.y1,n.bnd_box[this.currentSelectedBndBox])){this.setCurrentX2Y2(t,e);var i=this.currentDrawing.x2-this.currentDrawing.x1,a=this.currentDrawing.y2-this.currentDrawing.y1;this.setCurrentX1Y1(this.currentDrawing.x2,this.currentDrawing.y2),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"l"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x1+=i),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"t"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y1+=a),"i"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos&&"r"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x2+=i),"i"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos&&"b"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y2+=a)}}catch(o){console.log("ObjectDetection mouseMoveBox(MouseX:number, MouseY:number, CurrMeta:Metadata):void",o.name+": ",o.message)}}},{key:"getCurrentSelectedBox",value:function(){try{return this.currentSelectedBndBox}catch(t){return-1}}},{key:"setCurrentSelectedbBox",value:function(t){try{this.currentSelectedBndBox=t}catch(e){console.log("ObjectDetection setCurrentSelectedbBox(newNUM:number):void",e.name+": ",e.message)}}},{key:"mouseUpDrawEnable",value:function(t,e,n){try{var i={selBox:-1,isNew:!1};if(-1===this.currentClickedBox.box&&null!==this.tmpbox)t.bnd_box.push(this.tmpbox),this.currentSelectedBndBox=t.bnd_box.length-1,t.bnd_box[this.currentSelectedBndBox].label=e.length>0?e[0].name:"",i.isNew=!0,i.selBox=re(this.currentSelectedBndBox);else if(this.currentClickedBox.box>-1&&this.tmpbox){if(t.bnd_box[this.currentSelectedBndBox].x1>t.bnd_box[this.currentSelectedBndBox].x2){var a=re(t.bnd_box[this.currentSelectedBndBox].x1);t.bnd_box[this.currentSelectedBndBox].x1=re(t.bnd_box[this.currentSelectedBndBox].x2),t.bnd_box[this.currentSelectedBndBox].x2=a}if(t.bnd_box[this.currentSelectedBndBox].y1>t.bnd_box[this.currentSelectedBndBox].y2){var o=re(t.bnd_box[this.currentSelectedBndBox].y1);t.bnd_box[this.currentSelectedBndBox].y1=re(t.bnd_box[this.currentSelectedBndBox].y2),t.bnd_box[this.currentSelectedBndBox].y2=o}}return this.currentClickedBox={box:-1,pos:"o"},this.setCurrentX1Y1(0,0),this.setCurrentX2Y2(0,0),this.tmpbox=null,n(!0),i}catch(s){return console.log("ObjectDetection MouseUpDrawEnable(CurrMeta: Metadata): number",s.name+": ",s.message),{selBox:-1,isNew:!1}}}},{key:"panRectangle",value:function(e,n,i,a){try{var o,s=t(e);try{for(s.s();!(o=s.n()).done;){var l=o.value,r=l.x2-l.x1,c=l.y2-l.y1;l.x1=n+l.distancetoImg.x,l.y1=i+l.distancetoImg.y,l.x2=l.x1+r,l.y2=l.y1+c}}catch(u){s.e(u)}finally{s.f()}a(!0)}catch(u){console.log("ObjectDetection panRectangle(bbox:Boundingbox[], img_X:number, img_Y:number)",u.name+": ",u.message)}}},{key:"scaleAllBoxes",value:function(e,n,i,a,o){try{var s,l=t(n);try{for(l.s();!(s=l.n()).done;){var r=s.value;console.log(r);var c=r.distancetoImg.x*e+i,u=r.distancetoImg.y*e+a,h=c+(r.x2-r.x1)*e,b=u+(r.y2-r.y1)*e;r.x1=re(c),r.y1=re(u),r.x2=re(h),r.y2=re(b);var g=r.y1-a;r.distancetoImg.x=re(r.x1-i),r.distancetoImg.y=re(g)}}catch(d){l.e(d)}finally{l.f()}o&&o(!0)}catch(d){console.log("ObjectDetection scaleAllBoxes(scalefactor: number,boxes:Boundingbox[],imgX:number,imgY:number)",d.name+": ",d.message)}}},{key:"mouseMoveDrawEnable",value:function(t,e,n){try{-1===this.currentClickedBox.box?this.setCurrentX2Y2(t,e):this.mouseMoveBox(t,e,n)}catch(i){console.log("ObjectDetection MouseMoveDrawEnable(MouseX: number,MouseY: number,SelectedMeta: Metadata): void",i.name+": ",i.message)}}},{key:"mouseDownDrawEnable",value:function(t,e,n){try{return this.getCurrentClickBox(t,e,n),this.setCurrentX1Y1(t,e),this.setCurrentX2Y2(t,e),this.currentSelectedBndBox=-1!==this.currentClickedBox.box?this.currentClickedBox.box:-1,this.currentClickedBox.box}catch(i){return console.log("ObjectDetection MouseDownDrawEnable(MouseX:number,MouseY:number,BBox:Boundingbox[]):number",i.name+": ",i.message),-1}}},{key:"setPanXY",value:function(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"setGlobalXY",value:function(t,e){try{return!(!t||!e||(this.globalXY.x=t,this.globalXY.y=e,0))}catch(n){return console.log("ObjectDetection SetGlobalXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"changeLabel",value:function(t,e){t&&e&&(t.label=e)}},{key:"mouseClickWithinPointPath",value:function(t,e){var n=t.img_x,i=t.img_y,a=t.img_w,o=t.img_h,s=e.offsetX,l=e.offsetY;try{return s>n&&s<n+a&&l>i&&l<i+o}catch(r){return console.log(r),!1}}},{key:"drawAllBoxOn",value:function(n,i,a){try{if(i.length>0){var o,s=t(i.entries());try{for(s.s();!(o=s.n()).done;){var l=e(o.value,2),r=l[0],c=l[1];r===this.currentClickedBox.box||r===this.currentSelectedBndBox?(c.color="rgba(0,255,0,1.0)",c.lineWidth=2,this.drawEachBoxOn(n,c,a,!0)):(c.color="rgba(255,255,0,0.8)",c.lineWidth=1,this.drawEachBoxOn(n,c,a,!1))}}catch(y){s.e(y)}finally{s.f()}}if(-1===this.currentClickedBox.box&&-1===this.currentSelectedBndBox){var u,h=t(i);try{for(h.s();!(u=h.n()).done;){var b=u.value;b.color="rgba(255,255,0,0.8)",this.drawEachBoxOn(n,b,a,!1)}}catch(y){h.e(y)}finally{h.f()}var g=this.currentDrawing,d=g.x1,f=g.x2,v=g.y1,m=g.y2;this.tmpbox=this.generateNewBox(d,f,v,m),this.tmpbox&&this.drawEachBoxOn(n,this.tmpbox,a,!0)}}catch(y){console.log("redraw(boundbox) ----\x3e ",y.name+": ",y.message)}}},{key:"drawEachBoxOn",value:function(t,e,n,i){try{if(n){var a=e.x1+(e.x2-e.x1)/2,o=e.y1+(e.y2-e.y1)/2;n.strokeStyle="white",n.fillStyle="black",n.font="bold 12px Arial",""==e.label?(n.strokeText("",e.x1+10,e.y1+15),n.fillText("",e.x1+10,e.y1+15)):t.find(function(t){return t.name===e.label})?(n.strokeText(e.label,e.x1+10,e.y1+15),n.fillText(e.label,e.x1+10,e.y1+15)):(n.strokeText("Text",e.x1+10,e.y1+15),n.fillText("Text",e.x1+10,e.y1+15)),n.strokeStyle=e.color,n.beginPath(),n.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),n.lineWidth=e.lineWidth,n.stroke(),n.fillStyle=e.color,i&&(n.beginPath(),n.fillRect(e.x1-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(a-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(a-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(a-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize))}}catch(s){console.log("ObjectDetection drawEachBoxOn(box:Boundingbox, context:CanvasRenderingContext2D, isSelected:boolean):void",s.name+": ",s.message)}}},{key:"generateNewBox",value:function(t,e,n,i){try{var a=t<e?t:e,o=n<i?n:i,s=t>e?t:e,l=n>i?n:i;return s-a>this.lineOffset&&l-o>this.lineOffset?{x1:a,y1:o,x2:s,y2:l,lineWidth:2,color:"rgba(0,255,0,1.0)",distancetoImg:{x:0,y:0},label:"",id:this.util.generateUniquesID()}:null}catch(r){return console.log("ObjectDetection GenerateNewBox(x1:number,x2:number,y1:number,y2:number):Boundingbox",r.name+": ",r.message),null}}},{key:"getBBoxDistfromImg",value:function(e,n,i){try{var a,o=t(e);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=s.x1,r=s.y1,c=s.distancetoImg,u=r-i;c.x=re(l-n),c.y=re(u)}}catch(h){o.e(h)}finally{o.f()}}catch(h){console.log("ObjectDetection GetBBoxDistfromImg(bbox:Boundingbox[],imgX:number,imgY:number)",h.name+": ",h.message)}}},{key:"getCurrentClickBox",value:function(t,e,n){try{return this.currentClickedBox=this.mouseClickOnBoxes(t,e,n),this.currentClickedBox}catch(i){return console.log("ObjectDetection getCurrentClickBox(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}},{key:"mouseClickOnBoxes",value:function(t,e,n){try{for(var i=0;i<n.length;++i){var a=n[i].x1+(n[i].x2-n[i].x1)/2,o=n[i].y1+(n[i].y2-n[i].y1)/2;if(n[i].x1-this.lineOffset<t&&t<n[i].x1+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tl"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"bl"};if(o-this.lineOffset<e&&e<o+this.lineOffset)return{box:i,pos:"l"}}else if(n[i].x2-this.lineOffset<t&&t<n[i].x2+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"tr"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"br"};if(o-this.lineOffset<e&&e<o+this.lineOffset)return{box:i,pos:"r"}}else if(a-this.lineOffset<t&&t<a+this.lineOffset){if(n[i].y1-this.lineOffset<e&&e<n[i].y1+this.lineOffset)return{box:i,pos:"t"};if(n[i].y2-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"b"};if(n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}else if(n[i].x1-this.lineOffset<t&&t<n[i].x2+this.lineOffset&&n[i].y1-this.lineOffset<e&&e<n[i].y2+this.lineOffset)return{box:i,pos:"i"}}return{box:-1,pos:"o"}}catch(s){return console.log("ObjectDetection mouseClickOnBoxes(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",s.name+": ",s.message),{box:-1,pos:"o"}}}}]),n}()).\u0275fac=function(t){return new(t||te)},te.\u0275prov=w.Db({token:te,factory:te.\u0275fac,providedIn:"any"}),te),he=((Qt=function(){function n(){s(this,n),this.currentArr=[],this.undoArr=[],this.redoArr=[],this.maxStageSize=51,this.allowUndo=!1,this.allowRedo=!1,this.utility=new ce,this.removeLastArray=function(t){return t.splice(-1,1)[0]}}return r(n,[{key:"appendStages",value:function(t){t&&(this.redoArr=[],this.allowRedo=!1,0===this.currentArr.length?this.currentArr.push(this.utility.deepCloneVariable(t)):(this.undoArr.length===this.maxStageSize&&this.undoArr.splice(0,1),this.undoArr.push(this.removeLastArray(this.currentArr)),this.currentArr.push(this.utility.deepCloneVariable(t)),this.allowUndo=!0))}},{key:"clearAllStages",value:function(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.allowUndo=!1,this.allowRedo=!1}},{key:"undo",value:function(){if(this.allowRedo=!0,this.undoArr.length>0){this.redoArr.push(this.removeLastArray(this.currentArr));var t=this.removeLastArray(this.undoArr);return this.currentArr.push(t),this.allowUndo=0!==this.undoArr.length,t}return null}},{key:"redo",value:function(){var t=null;return 0!==this.redoArr.length&&(this.undoArr.push(this.removeLastArray(this.currentArr)),t=this.removeLastArray(this.redoArr),this.currentArr.push(t),this.allowRedo=0!==this.redoArr.length),this.allowUndo=this.undoArr.length>0,t}},{key:"clearRedundantStages",value:function(){var t,e;(null===(t=this.currentArr[0])||void 0===t?void 0:t.meta)&&"polygons"in this.currentArr[0].meta||this.undoArr.length>0&&(!this.isStateChange((null===(e=this.undoArr[this.undoArr.length-1])||void 0===e?void 0:e.meta).bnd_box)||(this.currentArr.pop(),this.currentArr.push(this.removeLastArray(this.undoArr))))}},{key:"isAllowRedo",value:function(){return this.allowRedo}},{key:"isAllowUndo",value:function(){return this.allowUndo}},{key:"isMethodChange",value:function(t){var e;return(null===(e=this.currentArr[0])||void 0===e?void 0:e.method)!==t}},{key:"replaceStages",value:function(t){t&&(this.currentArr[0]=this.utility.deepCloneVariable(t))}},{key:"isStateChange",value:function(t){return!!t&&!!(t&&this.isAnnotationChange(t)||this.isLabelChange(t))}},{key:"isLabelChange",value:function(n){var i,a,o,s;if((null===(i=this.currentArr[0])||void 0===i?void 0:i.meta)&&"polygons"in(null===(a=this.currentArr[0])||void 0===a?void 0:a.meta)){var l=n,r=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).polygons;if(l.length!==r.length)return!0;var c,u=t(r.entries());try{for(u.s();!(c=u.n()).done;){var h=e(c.value,2);h[0],h[1].label}}catch(p){u.e(p)}finally{u.f()}}else{var b=n,g=(null===(s=this.currentArr[0])||void 0===s?void 0:s.meta).bnd_box;if(b.length!==g.length)return!0;var d,f=t(g.entries());try{for(f.s();!(d=f.n()).done;){var v=e(d.value,2),m=v[0],y=v[1].label;if(b[m].label!==y)return!0}}catch(p){f.e(p)}finally{f.f()}}return!1}},{key:"isAnnotationChange",value:function(n){var i,a,o,s;if((null===(i=this.currentArr[0])||void 0===i?void 0:i.meta)&&"polygons"in(null===(a=this.currentArr[0])||void 0===a?void 0:a.meta)){if(this.currentArr.length<1)return!0;var l=n,r=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).polygons;return l.length!==r.length||!!r.some(function(t,e){var n=t.coorPt;return l.some(function(t,i){var a=t.coorPt;return n[e].x!==a[i].x||n[e].y!==a[i].y})})||null}if(this.currentArr.length<1)return!0;var c=n,u=(null===(s=this.currentArr[0])||void 0===s?void 0:s.meta).bnd_box;if(c.length!==u.length)return!0;var h,b=t(c.entries());try{for(b.s();!(h=b.n()).done;){var g=e(h.value,2),d=g[0],f=g[1],v=f.x1,m=f.x2,y=f.y1,p=f.y2;return v!==u[d].x1||m!==u[d].x2||y!==u[d].y1||p!==u[d].y2||null}}catch(_){b.e(_)}finally{b.f()}return!1}}]),n}()).\u0275fac=function(t){return new(t||Qt)},Qt.\u0275prov=w.Db({token:Qt,factory:Qt.\u0275fac,providedIn:"any"}),Qt),be=((qt=function(){function e(){s(this,e),this.MEMO=null,this.utility=new ce}return r(e,[{key:"copy",value:function(t){this.MEMO=this.utility.deepCloneVariable(t)}},{key:"paste",value:function(){return this.MEMO?"coorPt"in this.MEMO?this.polygonPaste():this.boundingBoxPaste():null}},{key:"isAvailable",value:function(){return!!this.MEMO}},{key:"clear",value:function(){this.MEMO=null}},{key:"polygonPaste",value:function(){var e,n=this.utility.deepCloneObject(this.MEMO),i=n.coorPt,a=(n.id,t(i));try{for(a.s();!(e=a.n()).done;){var o=e.value;o.x+=8,o.y+=8,o.distancetoImg.x=0,o.distancetoImg.y=0}}catch(s){a.e(s)}finally{a.f()}return this.utility.generateUniquesID(),n}},{key:"boundingBoxPaste",value:function(){var t=this.utility.deepCloneObject(this.MEMO),e=t.x2-t.x1,n=t.y2-t.y1;return t.x1+=8,t.y1+=8,t.x2=t.x1+e,t.y2=t.y1+n,t.id=this.utility.generateUniquesID(),t.distancetoImg.x=0,t.distancetoImg.y=0,t}}]),e}()).\u0275fac=function(t){return new(t||qt)},qt.\u0275prov=w.Db({token:qt,factory:qt.\u0275fac,providedIn:"any"}),qt),ge={scale:1,factor:.05,max_scale:4},de=((ee=function(){function t(){var e=this;s(this,t),this.zoomSubject=new j.a(ge),this.zoom$=this.zoomSubject.asObservable(),this.setState=function(t){e.zoomSubject.next(t?Object.assign(Object.assign({},ge),t):ge)}}return r(t,[{key:"resetZoomScale",value:function(){this.zoomSubject.next(ge)}},{key:"calculateZoomScale",value:function(t,e,n){var i=e.scale,a=e.factor,o=e.max_scale,s=t.wheelDelta;void 0===s&&(s=t.detail),s=Math.max(-1,Math.min(1,s));var l=n.scrollLeft,r=n.scrollTop,c=(t.pageX+l)/i,u=(t.pageY+r)/i;return i+=s*a*i,i=Math.max(1,Math.min(o,i)),Object.assign(Object.assign({},{x:c*i-t.pageX,y:u*i-t.pageY}),{scale:i})}},{key:"validateZoomScale",value:function(t,e){return t.canvas.style.transform!=="scale(".concat(e,", ").concat(e,")")}}]),t}()).\u0275fac=function(t){return new(t||ee)},ee.\u0275prov=w.Db({token:ee,factory:ee.\u0275fac,providedIn:"any"}),ee),fe={move:!1,pointer:!1,grab:!1,grabbing:!1,crosshair:!1,"zoom-in":!1,"zoom-out":!1,resize:!1},ve=((ne=function(){function t(){var e=this;s(this,t),this.mouseCursorSubject=new j.a(fe),this.mouseCursor$=this.mouseCursorSubject.asObservable(),this.setState=function(t){e.mouseCursorSubject.next(t?Object.assign(Object.assign({},fe),t):fe)}}return r(t,[{key:"changeCursor",value:function(t,n){if(n){var i=n.wheelDelta,a=n.detail;void 0!==i?150===i?this.setState({"zoom-in":!0}):-150===i&&this.setState({"zoom-out":!0}):3===a?this.setState({"zoom-in":!0}):-3===a&&this.setState({"zoom-out":!0})}else for(var o=0,s=Object.entries(t);o<s.length;o++){var l=e(s[o],2),r=l[0];if(!0===l[1])return r}}}]),t}()).\u0275fac=function(t){return new(t||ne)},ne.\u0275prov=w.Db({token:ne,factory:ne.\u0275fac,providedIn:"any"}),ne),me=["canvasdrawing"],ye=["floatdiv"],pe=["lbltypetxt"],_e=["availablelbl"];function xe(t,e){if(1&t){var n=w.Nb();w.Mb(0,"li",12),w.Tb("click",function(){w.gc(n);var t=e.$implicit;return w.Vb().labelNameClicked(t.name)}),w.Mb(1,"span",13),w.mc(2),w.Lb(),w.Mb(3,"span",14),w.mc(4),w.Lb(),w.Lb()}if(2&t){var i=e.$implicit;w.xb(2),w.nc(i.name),w.xb(2),w.nc(i.count)}}function we(t,e){1&t&&(w.Mb(0,"li",15),w.Mb(1,"div",16),w.mc(2),w.Wb(3,"translate"),w.Lb(),w.Mb(4,"div",16),w.mc(5),w.Wb(6,"translate"),w.Lb(),w.Lb()),2&t&&(w.xb(2),w.nc(w.Xb(3,2,"searchLabel.labelNotExist")),w.xb(3),w.nc(w.Xb(6,4,"searchLabel.enterToAdd")))}var Se,Me,Ce,Pe=function(){return{standalone:!0}},ke=function(t){return{cursor:t}},Le=((Me=function(){function t(e,n,i,a,o,l,r){var c=this;s(this,t),this._boundingBoxCanvas=e,this._imgLblStateService=n,this._undoRedoService=i,this._copyPasteService=a,this._annotateSelectState=o,this._zoomService=l,this._mouseCursorService=r,this.image=new Image,this.mousedown=!1,this.unsubscribe$=new p.a,this.labelSearch="",this.labelList=[],this.allLabelList=[],this.showDropdownLabelBox=!1,this.invalidInput=!1,this.closeEnough=5,this._imgSrc="",this._tabStatus=[],this._onChangeMetadata=new w.n,this._onChangeAnnotationLabel=new w.n,this._onEnterLabel=new w.n,this.validateInputLabel=function(t){var e=t.target.value,n=e.trim();n&&(c._tabStatus.some(function(t){var e=t.label_list;return e&&e.length?e.some(function(t){return t===n}):null})?(c.invalidInput=!0,console.error("Invalid existing label input")):(c.invalidInput=!1,c.showDropdownLabelBox=!1,c._onChangeAnnotationLabel.emit({label:e,index:c.annotateState.annotation}),c.labelSearch=""))}}return r(t,[{key:"ngOnInit",value:function(){var t=this;this.getLabelList(),this._imgLblStateService.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){var n=e.clear,i=e.fitCenter,a=u(e,["clear","fitCenter"]);t.boundingBoxState=Object.assign(Object.assign({},a),{clear:n,fitCenter:i}),i&&t.imgFitToCenter(),n&&(t._selectMetadata.bnd_box=[],t._undoRedoService.appendStages({meta:t._selectMetadata,method:"draw"}),t.redrawImage(t._selectMetadata),t.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){t.annotateState=e,t._boundingBoxCanvas.setCurrentSelectedbBox(e.annotation),t._selectMetadata&&t.redrawImage(t._selectMetadata)}),this._zoomService.zoom$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.zoom=e}),this._mouseCursorService.mouseCursor$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.mouseCursor=e})}},{key:"ngOnChanges",value:function(t){var e,n,i;(null===(e=t._selectMetadata)||void 0===e?void 0:e.previousValue)&&(null===(n=t._selectMetadata)||void 0===n?void 0:n.currentValue)&&this.redrawImage(this._selectMetadata),(null===(i=t._imgSrc)||void 0===i?void 0:i.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this.loadImage(t._imgSrc.currentValue),this._boundingBoxCanvas.setCurrentSelectedbBox(-1))}},{key:"initializeCanvas",value:function(){this.canvas.nativeElement.style.width="80%",this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}},{key:"emitMetadata",value:function(){this._onChangeMetadata.emit(this._selectMetadata)}},{key:"annotateSelectChange",value:function(t){this._annotateSelectState.setState(t)}},{key:"resetZoom",value:function(){this._zoomService.resetZoomScale()}},{key:"imgFitToCenter",value:function(){try{var t=this._boundingBoxCanvas.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._boundingBoxCanvas.scaleAllBoxes(t.factor,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._boundingBoxCanvas.setGlobalXY(t.newX,t.newY),this._boundingBoxCanvas.moveAllBbox(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(e){console.log(e)}}},{key:"keyStrokeEvent",value:function(t){var e=this,n=t.ctrlKey,i=t.shiftKey,a=t.key;try{var o=this.boundingBoxState.isActiveModal;if(!this.mousedown&&!o&&!this.showDropdownLabelBox&&this._selectMetadata)if(!n||"c"!==a&&"C"!==a)if(!n||"v"!==a&&"V"!==a){if(n&&i&&("z"===a||"Z"===a)){if(this._undoRedoService.isAllowRedo()){var s=this._undoRedoService.redo();this._selectMetadata=Object(se.a)(null==s?void 0:s.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}else if(!n||"z"!==a&&"Z"!==a)if(!o&&this.annotateState.annotation>-1&&("Delete"===a||"Backspace"===a))this._boundingBoxCanvas.deleteSingleBox(this._selectMetadata.bnd_box,this.annotateState.annotation,function(t){t&&(e.annotateSelectChange({annotation:-1,isDlbClick:!1}),e.redrawImage(e._selectMetadata),e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"}),e.emitMetadata())});else{var l="ArrowLeft"===a?"left":"ArrowRight"===a?"right":"ArrowUp"===a?"up":"ArrowDown"===a&&"down";l&&this.keyMoveBox(l)}else if(this._undoRedoService.isAllowUndo()){var r=this._undoRedoService.undo();this._selectMetadata=Object(se.a)(null==r?void 0:r.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}else{if(this._copyPasteService.isAvailable()){this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation]);var c=this._copyPasteService.paste();c&&this._selectMetadata.bnd_box.push(c),this.annotateSelectChange({annotation:this._selectMetadata.bnd_box.length-1,isDlbClick:!1}),this.getBBoxDistanceFromImage(),this.redrawImage(this._selectMetadata)}this._undoRedoService.appendStages({meta:Object(se.a)(this._selectMetadata),method:"draw"}),this.emitMetadata()}else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation])}catch(u){console.log(u)}}},{key:"toggleEvent",value:function(t){try{this.annotateState.annotation>-1&&(this._undoRedoService.clearRedundantStages(),this.annotateSelectChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}catch(e){console.log(e)}}},{key:"mouseScroll",value:function(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){var e=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement),n=e.scale,i=e.x,a=e.y;this.boundingBoxState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,n)&&(this.canvasContext.canvas.style.transformOrigin="".concat(t.offsetX,"px ").concat(t.offsetY,"px"),this.canvasContext.canvas.style.transform="scale(".concat(n,", ").concat(n,")"),this._zoomService.setState({scale:n}))),this.canvasContext.canvas.scrollTop=a,this.canvasContext.canvas.scrollLeft=i,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(o){console.log(o)}}},{key:"mouseDown",value:function(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.mousedown=!0,this.boundingBoxState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._boundingBoxCanvas.setPanXY(t.offsetX,t.offsetY)),this.boundingBoxState.draw){var e=this._boundingBoxCanvas.mouseDownDrawEnable(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.annotateSelectChange({annotation:e,isDlbClick:!1}),this.redrawImage(this._selectMetadata)}}else this.mousedown=!1}catch(n){console.log(n)}}},{key:"mouseUp",value:function(t){var e=this;try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.boundingBoxState.drag&&this.mousedown&&this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.boundingBoxState.draw&&this.mousedown){this.getLabelList(),this.sortingLabelList(this.labelList,this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box?this._tabStatus[2].annotation[0].bnd_box:[]);var n=this._boundingBoxCanvas.mouseUpDrawEnable(this._selectMetadata,this.labelList,function(t){t&&(e._undoRedoService.isStateChange(e._selectMetadata.bnd_box)&&e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"}),e.getBBoxDistanceFromImage(),e.emitMetadata())});if(n.isNew){var i=t.offsetY*(100/document.documentElement.clientHeight)+8.5,a=t.offsetX*(100/document.documentElement.clientWidth)+2.5;i<9&&(i=9),i>76&&(i=76),a<2.5&&(a=2.5),a>66&&(a=66),this.floatdiv.nativeElement.style.top=i.toString()+"vh",this.floatdiv.nativeElement.style.left=a.toString()+"vw",this.showDropdownLabelBox=!0,this.labelSearch="",this.invalidInput=!1,setTimeout(function(){e.lbltypetxt.nativeElement.focus()},100)}else this.showDropdownLabelBox=!1;n.isNew&&this.annotateSelectChange({annotation:n.selBox,isDlbClick:!1})}this.mousedown=!1}}catch(o){console.log(o)}}},{key:"mouseMove",value:function(t){var e=this;try{if(this._selectMetadata)if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)&&!this.showDropdownLabelBox){if(this.boundingBoxState.drag&&this.mousedown){var n=this._boundingBoxCanvas.getDiffXY(t);this._selectMetadata.img_x=n.diffX,this._selectMetadata.img_y=n.diffY,this._boundingBoxCanvas.panRectangle(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){if(t){var n=Object(se.a)(e._selectMetadata);e._undoRedoService.isMethodChange("pan")?e._undoRedoService.appendStages({meta:n,method:"pan"}):e._undoRedoService.replaceStages({meta:n,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.boundingBoxState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.boundingBoxState.draw&&this.mousedown&&(this._boundingBoxCanvas.mouseMoveDrawEnable(t.offsetX,t.offsetY,this._selectMetadata),this.redrawImage(this._selectMetadata)),this.boundingBoxState.draw&&!this.mousedown){var i=this._boundingBoxCanvas.getCurrentClickBox(t.offsetX,t.offsetY,this._selectMetadata.bnd_box).box;this.changeMouseCursorState(-1!==i?{move:!0}:{crosshair:!0})}}else this.changeMouseCursorState()}catch(a){console.log(a)}}},{key:"changeMouseCursorState",value:function(t){this._mouseCursorService.setState(t)}},{key:"checkCloseEnough",value:function(t,e){var n=Math.abs(t-e)<this.closeEnough;return console.log(n),n}},{key:"mouseOut",value:function(t){var e,n;try{"canvasstyle"!==t.target.className&&!t.target.className.includes("unclosedOut")||(null===(e=t.relatedTarget)||void 0===e?void 0:e.className.includes("unclosedOut"))||(null===(n=t.relatedTarget)||void 0===n?void 0:n.className.includes("canvasstyle"))||(this.showDropdownLabelBox=!1,0!=this._selectMetadata.bnd_box.filter(function(t){return""==t.label}).length&&(this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.filter(function(t){return""!=t.label}),this._onChangeMetadata.emit(this._selectMetadata),this.redrawImage(this._selectMetadata),alert("Some bounding boxes will be deleted because they were not labelled."))),this.boundingBoxState.drag&&this.mousedown&&(this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata)),this.mousedown=!1}catch(i){console.log(i)}}},{key:"loadImage",value:function(t){var e=this;try{this.image.src=t,this.image.onload=function(){e._selectMetadata.img_w=e._selectMetadata.img_w<1?e._selectMetadata.img_ori_w:e._selectMetadata.img_w,e._selectMetadata.img_h=e._selectMetadata.img_h<1?e._selectMetadata.img_ori_h:e._selectMetadata.img_h,e._boundingBoxCanvas.setGlobalXY(e._selectMetadata.img_x,e._selectMetadata.img_y),e.imgFitToCenter(),e.emitMetadata(),e.changeMouseCursorState(),e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"})}}catch(n){console.log(n)}}},{key:"keyMoveBox",value:function(t){var e=this;try{var n=this._selectMetadata.bnd_box[this.annotateState.annotation];n&&this._boundingBoxCanvas.keyboardMoveBox(t,n,this._selectMetadata,function(t){t&&(e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"}),e.getBBoxDistanceFromImage(),e.redrawImage(e._selectMetadata),e.emitMetadata())})}catch(i){console.log(i)}}},{key:"redrawImage",value:function(t){var e,n=t.img_x,i=t.img_y,a=t.img_w,o=t.img_h;this.clearCanvas(),this.canvasContext.drawImage(this.image,n,i,a,o),0!=(null===(e=this._tabStatus[2].annotation)||void 0===e?void 0:e.length)&&(this.getLabelList(),this.sortingLabelList(this.labelList,this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box?this._tabStatus[2].annotation[0].bnd_box:[])),this._boundingBoxCanvas.drawAllBoxOn(this.labelList,this._selectMetadata.bnd_box,this.canvasContext)}},{key:"clearCanvas",value:function(){this.canvasContext.clearRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height)}},{key:"getBBoxDistanceFromImage",value:function(){this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y)}},{key:"getLabelList",value:function(){var t=this;this.labelList=[],this.allLabelList=[],(this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]).forEach(function(e){t.labelList.push({name:e,count:0}),t.allLabelList.push({name:e,count:0})})}},{key:"labelTypeTextChange",value:function(t){this.labelList=this.allLabelList.filter(function(e){return e.name.includes(t)})}},{key:"labelNameClicked",value:function(t){this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:t,index:this.annotateState.annotation})}},{key:"sortingLabelList",value:function(t,e){var n=this;t.forEach(function(t,i){n.labelList[i].count=e.filter(function(e){return e.label===t.name}).length,n.allLabelList[i].count=e.filter(function(e){return e.label===t.name}).length}),this.labelList.sort(function(t,e){return t.count<e.count?1:e.count<t.count?-1:0}),this.allLabelList.sort(function(t,e){return t.count<e.count?1:e.count<t.count?-1:0})}},{key:"currentCursor",value:function(){return this._mouseCursorService.changeCursor(this.mouseCursor)}},{key:"ngOnDestroy",value:function(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),t}()).\u0275fac=function(t){return new(t||Me)(w.Hb(ue),w.Hb(X),w.Hb(he),w.Hb(be),w.Hb(B),w.Hb(de),w.Hb(ve))},Me.\u0275cmp=w.Bb({type:Me,selectors:[["image-labelling-object-detection"]],viewQuery:function(t,e){var n;1&t&&(w.qc(me,!0),w.qc(ye,!0),w.qc(pe,!0),w.qc(_e,!0)),2&t&&(w.dc(n=w.Ub())&&(e.canvas=n.first),w.dc(n=w.Ub())&&(e.floatdiv=n.first),w.dc(n=w.Ub())&&(e.lbltypetxt=n.first),w.dc(n=w.Ub())&&(e.availablelbl=n.first))},hostBindings:function(t,e){1&t&&w.Tb("keydown",function(t){return e.keyStrokeEvent(t)},!1,w.fc)("dblclick",function(t){return e.toggleEvent(t)})("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc",_tabStatus:"_tabStatus"},outputs:{_onChangeMetadata:"_onChangeMetadata",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onEnterLabel:"_onEnterLabel"},features:[w.vb],decls:13,vars:10,consts:[[1,"floatdiv","unclosedOut",3,"hidden"],["floatdiv",""],["autocomplete","off","spellcheck","false",1,"unclosedOut"],["type","text",1,"lbltypetxt","unclosedOut",3,"ngClass","ngModel","ngModelOptions","ngModelChange","keydown.enter"],["lbltypetxt",""],[1,"availablelbl","unclosedOut"],["availablelbl",""],[1,"lblList","unclosedOut"],["class","lblElement unclosedOut",3,"click",4,"ngFor","ngForOf"],["class","unclosedOut notExist",4,"ngIf"],[1,"canvasstyle",3,"ngStyle"],["canvasdrawing",""],[1,"lblElement","unclosedOut",3,"click"],[1,"lblName","unclosedOut"],[1,"lblCount","unclosedOut"],[1,"unclosedOut","notExist"],[1,"unclosedOut"]],template:function(t,e){1&t&&(w.Mb(0,"div"),w.Mb(1,"div",0,1),w.Mb(3,"form",2),w.Mb(4,"input",3,4),w.Tb("ngModelChange",function(t){return e.labelSearch=t})("ngModelChange",function(t){return e.labelTypeTextChange(t)})("keydown.enter",function(t){return e.validateInputLabel(t)}),w.Lb(),w.Lb(),w.Mb(6,"div",5,6),w.Mb(8,"ul",7),w.kc(9,xe,5,2,"li",8),w.kc(10,we,7,6,"li",9),w.Lb(),w.Lb(),w.Lb(),w.Ib(11,"canvas",10,11),w.Lb()),2&t&&(w.xb(1),w.ac("hidden",!e.showDropdownLabelBox),w.xb(3),w.ac("ngClass",e.invalidInput?"invalidInput":"validInput")("ngModel",e.labelSearch)("ngModelOptions",w.bc(7,Pe)),w.xb(5),w.ac("ngForOf",e.labelList),w.xb(1),w.ac("ngIf",0===e.labelList.length),w.xb(1),w.ac("ngStyle",w.cc(8,ke,e.currentCursor())))},directives:[kt.n,kt.g,kt.h,kt.a,c.i,kt.f,kt.i,c.j,c.k,c.l],pipes:[V.c],styles:[".canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}.floatdiv[_ngcontent-%COMP%]{position:absolute;z-index:10000}.lbltypetxt[_ngcontent-%COMP%]{height:4vh;border-radius:.2vh;border:.2vw solid grey;border-bottom:none;padding:0;text-indent:.4vw}.availablelbl[_ngcontent-%COMP%], .lbltypetxt[_ngcontent-%COMP%]{width:11vw;color:snow;font-size:2vh;background-color:#000;outline:none}.availablelbl[_ngcontent-%COMP%]{height:15vh;font-weight:700;border-radius:.2vh;border:.2vw solid grey;border-top:.1vh dotted snow;overflow:auto;scrollbar-width:none}.lblList[_ngcontent-%COMP%]{padding:0 .2vw}.lblElement[_ngcontent-%COMP%]{list-style-type:none;margin:.3vh 0;padding:0;justify-content:space-between;display:flex}.lblElement[_ngcontent-%COMP%]:hover{background-color:#111}.lblName[_ngcontent-%COMP%]{margin-left:.2vw;overflow:hidden;text-overflow:ellipsis}.lblCount[_ngcontent-%COMP%]{background-color:#222;margin-right:.2vw;padding:.1vh .2vw;border-radius:.2vw}.availablelbl[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.notExist[_ngcontent-%COMP%]{color:#999;font-size:1.5vh}.invalidInput[_ngcontent-%COMP%]{border:.2vw solid red}.validInput[_ngcontent-%COMP%]{border:.2vw solid grey}"],changeDetection:0}),Me),Oe=((Se=function(){function n(){s(this,n),this.globalXY={x:-1,y:-1},this.panXY={x:0,y:0},this.clickPoint={polygonIndex:-1,pointIndex:-1},this.clipPath=null,this.radius=3.5,this.distanceOffset=8,this.polygonAreaIndex=-1,this.selectedPolygonIndex=-1,this.util=new ce,this.isNewPoly=!1}return r(n,[{key:"mouseDownDraw",value:function(t,e,n,i,a,o,s){var l=t.offsetX,r=t.offsetY;this.polygonAreaIndex=this.findPolygonArea(t,e),this.clickPoint=this.findClickPoint(l,r,e);var c=this.isNewPolygon();return c&&o?this.setPanXY(t):!this.returnTempPoly()&&this.polygonAreaIndex<0&&this.clickPoint.pointIndex<0?(this.setPolygonLineWidth(e,-1),this.selectedPolygonIndex=-1,this.pushTempPoint(t,e),this.setNewPolygon(!0)):c?(this.pushTempPoint(t,e),this.drawNewPolygon(e,i,a,n,!1),this.drawfromPreviousPoint(t,a)):(this.selectedPolygonIndex=this.findPolygonArea(t,e)>-1?this.findPolygonArea(t,e):this.findClickPoint(l,r,e).polygonIndex,this.setPolygonLineWidth(e,this.selectedPolygonIndex),this.setNewPolygon(!1)),this.selectedPolygonIndex}},{key:"mouseMoveDraw",value:function(t,e,n,i,a,o,s,l){var r=this.findPolygonArea(a,t),c=this.isNewPolygon(),u=this.clickPoint,h=u.pointIndex,b=u.polygonIndex;if(c&&s&&o){var g=this.getDiffXY(a),d=g.diffX,f=g.diffY;t.img_x=d,t.img_y=f,this.panPolygons(t,!0),l("pan")}else c?(this.drawNewPolygon(t,e,n,i,!1),this.drawfromPreviousPoint(a,n)):s&&-1===h&&this.selectedPolygonIndex>-1?(this.mouseMovePolygon(a,t,n,this.selectedPolygonIndex,e,i),this.resetClipPath(t),l("pan")):s&&h>-1&&b>-1&&(this.setPolygonCoordinate(a,t,this.clickPoint),l("draw"));return r>-1}},{key:"setPanXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{this.panXY={x:e,y:n}}catch(i){console.log("setPanXY",i)}}},{key:"getPanXY",value:function(){return this.panXY}},{key:"getDiffXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{var i={diffX:0,diffY:0},a=this.getGlobalXY(),o=a.x,s=a.y;return i.diffX=o+(e-this.panXY.x),i.diffY=s+(n-this.panXY.y),i}catch(l){return console.log(l),{diffX:-1,diffY:-1}}}},{key:"setSelectedPolygon",value:function(t,e){this.selectedPolygonIndex=t,e&&this.setPolygonLineWidth(e,this.selectedPolygonIndex)}},{key:"getSelectedPolygonIndex",value:function(){return this.selectedPolygonIndex}},{key:"mouseClickWithinPointPath",value:function(t,e){var n=t.img_x,i=t.img_y,a=t.img_w,o=t.img_h,s=e.offsetX,l=e.offsetY;return s>n&&s<n+a&&l>i&&l<i+o}},{key:"calScaleToFitScreen",value:function(t,e){var n=t.img_w,i=t.img_h,a=e.offsetWidth,o=e.offsetHeight;try{var s={factor:-1,newX:-1,newY:-1},l=Math.min(a/n,o/i);return s.factor=l-.05*l,s.newX=a/2-n/2*s.factor,s.newY=o/2-i/2*s.factor,s}catch(r){return console.log("calScaleToFitScreen",r),{factor:-1,newX:-1,newY:-1}}}},{key:"pushTempPoint",value:function(t,e){var n=t.offsetX,i=t.offsetY,a=e.img_x,o=e.img_y,s=e.polygons;try{var l=n-a,r=i-o,c=s.length;!this.tmpPolygon&&this.generateNewTempPolygon(c),this.tmpPolygon.coorPt.push({x:n,y:i,distancetoImg:{x:l,y:r}})}catch(u){console.log("pushTempPoint",u)}}},{key:"removeLastPoint",value:function(t,e,n,i){var a;try{return(null===(a=this.tmpPolygon)||void 0===a?void 0:a.coorPt)&&this.tmpPolygon.coorPt.length>1?(this.tmpPolygon.coorPt.pop(),!1):(this.resetDrawing(t,n,e,i),!0)}catch(o){return console.log("removeLastPoint",o),!1}}},{key:"calculatePointDistance",value:function(t,e,n,i){try{var a=t-n,o=e-i;return Math.sqrt(a*a+o*o)}catch(s){return void console.log("calculatePointDistance",s)}}},{key:"generateNewTempPolygon",value:function(t){try{var e=this.util.generateUniquesID(),n=(t+1).toString();this.tmpPolygon={coorPt:[],label:"default",id:e,lineWidth:2,color:"#FFFAFA",region:n,subLabel:[]}}catch(i){console.log("generateNewTempPolygon",i)}}},{key:"getClickPoint",value:function(){return this.clickPoint}},{key:"resetClickPoint",value:function(){this.clickPoint={pointIndex:-1,polygonIndex:-1}}},{key:"resetDrawing",value:function(t,e,n,i){try{this.tmpPolygon=null,this.setNewPolygon(!1),this.redraw(t,e,n,i,-1)}catch(a){console.log("resetDrawing",a)}}},{key:"setNewPolygon",value:function(t){this.isNewPoly=t}},{key:"redraw",value:function(t,e,n,i,a){var o=i.width,s=i.height;try{var l=t.img_w,r=t.img_h,c=t.img_x,u=t.img_y;n.restore(),n.clearRect(0,0,o,s),n.save(),n.beginPath(),n.rect(c,u,l,r),n.clip(),n.beginPath(),n.drawImage(e,c,u,l,r),this.drawAllPolygon(t,n,a)}catch(h){console.log("redraw",h)}}},{key:"drawAllPolygon",value:function(t,e,n){try{this.validatePolygonMetadata(t.polygons)&&(this.drawAllPolygonLine(t,e),this.drawAllPolygonsDots(t,e,n,this.radius),this.plotAllFloatLabel(t,e))}catch(i){console.log("drawAllPolygon",i)}}},{key:"validatePolygonMetadata",value:function(t){return t.length>0}},{key:"drawAllPolygonLine",value:function(n,i){var a=n.polygons;try{var o,s=t(a.entries());try{for(s.s();!(o=s.n()).done;){var l=e(o.value,2),r=(l[0],l[1]),c=r.lineWidth,u=r.color,h=r.coorPt;i.lineWidth=c,i.strokeStyle=u||"white",i.fillStyle=u||"white",i.beginPath(),i.moveTo(h[0].x,h[0].y);var b,g=t(h.entries());try{for(g.s();!(b=g.n()).done;){var d=e(b.value,1)[0];d+1<h.length&&i.lineTo(h[d+1].x,h[d+1].y)}}catch(f){g.e(f)}finally{g.f()}i.closePath(),i.stroke()}}catch(f){s.e(f)}finally{s.f()}}catch(f){console.log("drawAllPolygonLine",f)}}},{key:"drawAllPolygonsDots",value:function(n,i,a,o){var s=n.polygons;try{var l,r=t(s.entries());try{for(r.s();!(l=r.n()).done;){var c=e(l.value,2),u=c[0],h=c[1].coorPt;if(a===u){i.strokeStyle="green",i.fillStyle="green";var b,g=t(h.entries());try{for(g.s();!(b=g.n()).done;){var d=e(b.value,1)[0];i.beginPath(),i.arc(h[d].x,h[d].y,o,0,2*Math.PI),i.fill(),i.closePath(),i.stroke()}}catch(f){g.e(f)}finally{g.f()}}}}catch(f){r.e(f)}finally{r.f()}}catch(f){console.log("drawAllPolygonsDots",f)}}},{key:"plotAllFloatLabel",value:function(t,e){var n=t.polygons;try{n.forEach(function(t){var n=t.label,i=t.coorPt[0],a=i.x,o=i.y;e.strokeStyle="white",e.fillStyle="black",e.font="bold 12px Arial",e.strokeText(n,a+10,o+15),e.fillText(n,a+10,o+15)})}catch(i){console.log("plotAllFloatLabel",i)}}},{key:"setGlobalXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{this.globalXY={x:e,y:n}}catch(i){console.log("setGlobalXY",i)}}},{key:"getGlobalXY",value:function(){return this.globalXY}},{key:"mouseMovePolygon",value:function(n,i,a,o,s,l){var r=n.offsetX,c=n.offsetY;try{var u=this.getGlobalXY(),h=u.x,b=u.y,g=r-h,d=c-b;if(this.withinPointPath(i,o,{offsetX:g,offsetY:d})){this.setGlobalXY({offsetX:r,offsetY:c});var f,v=t(i.polygons[o].coorPt.entries());try{for(v.s();!(f=v.n()).done;){var m=e(f.value,1)[0];i.polygons[o].coorPt[m].x+=g,i.polygons[o].coorPt[m].y+=d}}catch(y){v.e(y)}finally{v.f()}this.redraw(i,s,a,l,o)}}catch(y){console.log("mouseMovePolygon",y)}}},{key:"keyboardMovePolygon",value:function(n,i,a,o,s,l,r){try{if(a>-1){var c=-3;switch(i){case"up":if(this.withinPointPath(n,a,{offsetX:0,offsetY:c})){var u,h=t(n.polygons[a].coorPt.entries());try{for(h.s();!(u=h.n()).done;){var b=e(u.value,1)[0];n.polygons[a].coorPt[b].y+=c}}catch(w){h.e(w)}finally{h.f()}}break;case"down":if(this.withinPointPath(n,a,{offsetX:0,offsetY:c})){var g,d=t(n.polygons[a].coorPt.entries());try{for(d.s();!(g=d.n()).done;){var f=e(g.value,1)[0];n.polygons[a].coorPt[f].y-=c}}catch(w){d.e(w)}finally{d.f()}}break;case"left":if(this.withinPointPath(n,a,{offsetX:c,offsetY:0})){var v,m=t(n.polygons[a].coorPt.entries());try{for(m.s();!(v=m.n()).done;){var y=e(v.value,1)[0];n.polygons[a].coorPt[y].x+=c}}catch(w){m.e(w)}finally{m.f()}}break;case"right":if(this.withinPointPath(n,a,{offsetX:c,offsetY:0})){var p,_=t(n.polygons[a].coorPt.entries());try{for(_.s();!(p=_.n()).done;){var x=e(p.value,1)[0];n.polygons[a].coorPt[x].x-=c}}catch(w){_.e(w)}finally{_.f()}}}this.redraw(n,o,s,l,a),r(!0)}return!0}catch(w){return console.log("keyboardMovePolygon",w),!0}}},{key:"withinPointPath",value:function(n,i,a){var o=n.polygons,s=n.img_x,l=n.img_y,r=n.img_w,c=n.img_h,u=a.offsetX,h=a.offsetY;try{var b,g=t(o[i].coorPt.entries());try{for(g.s();!(b=g.n()).done;){var d=e(b.value,1)[0];return!(o[i].coorPt[d].x+u<s||o[i].coorPt[d].x+u>s+r||o[i].coorPt[d].y+h<l||o[i].coorPt[d].y+h>l+c)}}catch(f){g.e(f)}finally{g.f()}}catch(f){return!1}}},{key:"validateXYDistance",value:function(n){try{var i,a=t(n.polygons.entries());try{for(a.s();!(i=a.n()).done;){var o,s=e(i.value,1)[0],l=t(n.polygons[s].coorPt.entries());try{for(l.s();!(o=l.n()).done;){var r=e(o.value,1)[0],c=n.polygons[s].coorPt[r].y-n.img_y;n.polygons[s].coorPt[r].distancetoImg.x=n.polygons[s].coorPt[r].x-n.img_x,n.polygons[s].coorPt[r].distancetoImg.y=c}}catch(u){l.e(u)}finally{l.f()}}}catch(u){a.e(u)}finally{a.f()}}catch(u){console.log("validateXYDistance",u)}}},{key:"setPolygonLineWidth",value:function(t,e){try{t.polygons=t.polygons.map(function(t,n){return Object.assign(Object.assign({},t),{lineWidth:t.lineWidth=n===e?2:1})})}catch(n){console.log("setPolygonLineWidth",n)}}},{key:"drawNewPolygon",value:function(n,i,a,o,s){var l;try{if(this.redraw(n,i,a,o,-1),null===(l=this.tmpPolygon)||void 0===l?void 0:l.coorPt){var r,c=t(this.tmpPolygon.coorPt.entries());try{for(c.s();!(r=c.n()).done;){var u=e(r.value,2),h=(u[0],u[1]),b=h.x,g=h.y;a.strokeStyle="green",a.fillStyle="green",a.beginPath(),a.arc(b,g,this.radius,0,2*Math.PI),a.fill(),a.closePath(),a.stroke()}}catch(y){c.e(y)}finally{c.f()}a.beginPath(),a.lineWidth=this.tmpPolygon.lineWidth,a.strokeStyle=this.tmpPolygon.color,a.fillStyle=this.tmpPolygon.color,a.moveTo(this.tmpPolygon.coorPt[0].x,this.tmpPolygon.coorPt[0].y);var d,f=t(this.tmpPolygon.coorPt.entries());try{for(f.s();!(d=f.n()).done;){var v=e(d.value,1)[0];v+1<this.tmpPolygon.coorPt.length&&a.lineTo(this.tmpPolygon.coorPt[v+1].x,this.tmpPolygon.coorPt[v+1].y)}}catch(y){f.e(y)}finally{f.f()}if(s){a.closePath(),a.stroke();var m=n.polygons.length;this.tmpPolygon&&(n.polygons.push(Object(se.a)(this.tmpPolygon)),this.setPolygonLineWidth(n,m-1),this.tmpPolygon=null),this.setNewPolygon(!1)}else a.stroke()}}catch(y){console.log("drawNewPolygon",y)}}},{key:"drawfromPreviousPoint",value:function(t,e){var n,i=t.offsetX,a=t.offsetY;try{if(null===(n=this.tmpPolygon)||void 0===n?void 0:n.coorPt){var o=this.tmpPolygon.coorPt.length-1;e.beginPath(),e.moveTo(this.tmpPolygon.coorPt[o].x,this.tmpPolygon.coorPt[o].y),e.lineTo(i,a),e.stroke()}}catch(s){console.log("drawfromPreviousPoint",s)}}},{key:"returnTempPoly",value:function(){try{return this.tmpPolygon}catch(t){return console.log("returnTempPoly",t),null}}},{key:"setPolygonCoordinate",value:function(t,e,n){var i=t.offsetX,a=t.offsetY,o=n.polygonIndex,s=n.pointIndex;try{o>-1&&s>-1&&(e.polygons[o].coorPt[s].x=i,e.polygons[o].coorPt[s].y=a)}catch(l){console.log("setPolygonCoordinate",l)}}},{key:"insidePolygonArea",value:function(t,e){var n=e.offsetX,i=e.offsetY;try{for(var a=!1,o=0,s=t.length-1;o<t.length;s=o++)t[o].y>i!=t[s].y>i&&n<(t[s].x-t[o].x)*(i-t[o].y)/(t[s].y-t[o].y)+t[o].x&&(a=!a);return a}catch(l){return console.log("insidePolygonArea",l),!1}}},{key:"calPolygonArea",value:function(t){var e=t.coorPt;try{for(var n=0,i=e.length-1,a=0;a<e.length;++a)n+=(e[i].x+e[a].x)*(e[i].y-e[a].y),i=a;return Math.abs(n/2)}catch(o){return console.log("calPolygonArea",o),-1}}},{key:"findPolygonArea",value:function(n,i){var a=i.polygons;try{var o,s=-1,l=1e7,r=t(a.entries());try{for(r.s();!(o=r.n()).done;){var c=e(o.value,2),u=c[0],h=c[1];if(this.insidePolygonArea(h.coorPt,n)){var b=this.calPolygonArea(h);b<l&&(s=u,l=b)}}}catch(g){r.e(g)}finally{r.f()}return s}catch(g){return console.log("findPolygonArea",g),-1}}},{key:"findClickPoint",value:function(t,e,n){try{for(var i={polygonIndex:-1,pointIndex:-1},a=0;a<n.polygons.length;++a)for(var o=0;o<n.polygons[a].coorPt.length;++o)if(Math.sqrt(Math.pow(t-n.polygons[a].coorPt[o].x,2)+Math.pow(e-n.polygons[a].coorPt[o].y,2))<=this.radius){i.polygonIndex=a,i.pointIndex=o;break}return i}catch(s){return console.log("findClickPoint",s),{polygonIndex:-1,pointIndex:-1}}}},{key:"isNewPolygon",value:function(){try{return this.isNewPoly}catch(t){return console.log("isNewPolygon",t),!1}}},{key:"deleteSinglePolygon",value:function(t,e,n){try{t.polygons.splice(e,1),this.selectedPolygonIndex=-1,n(!0)}catch(i){console.log("deleteSinglePolygon",i)}}},{key:"scalePolygons",value:function(n,i,a){var o=i.factor,s=i.newX,l=i.newY;try{var r,c=t(n.polygons.entries());try{for(c.s();!(r=c.n()).done;){var u,h=e(r.value,1)[0],b=t(n.polygons[h].coorPt.entries());try{for(b.s();!(u=b.n()).done;){var g=e(u.value,1)[0];n.polygons[h].coorPt[g].x=n.polygons[h].coorPt[g].distancetoImg.x*o+s,n.polygons[h].coorPt[g].y=n.polygons[h].coorPt[g].distancetoImg.y*o+l,n.polygons[h].coorPt[g].distancetoImg.x=n.polygons[h].coorPt[g].x-s,n.polygons[h].coorPt[g].distancetoImg.y=n.polygons[h].coorPt[g].y-l}}catch(d){b.e(d)}finally{b.f()}}}catch(d){c.e(d)}finally{c.f()}this.setPolygonLineWidth(n,-1),a&&a(!0)}catch(d){console.log("scalePolygons",d)}}},{key:"panPolygons",value:function(n,i,a){var o;try{if(i&&(null===(o=this.tmpPolygon)||void 0===o?void 0:o.coorPt)){var s,l=t(this.tmpPolygon.coorPt.entries());try{for(l.s();!(s=l.n()).done;){var r=e(s.value,1)[0];this.tmpPolygon.coorPt[r].x=n.img_x+this.tmpPolygon.coorPt[r].distancetoImg.x,this.tmpPolygon.coorPt[r].y=n.img_y+this.tmpPolygon.coorPt[r].distancetoImg.y}}catch(f){l.e(f)}finally{l.f()}}var c,u=t(n.polygons.entries());try{for(u.s();!(c=u.n()).done;){var h,b=e(c.value,1)[0],g=t(n.polygons[b].coorPt.entries());try{for(g.s();!(h=g.n()).done;){var d=e(h.value,1)[0];n.polygons[b].coorPt[d].x=n.img_x+n.polygons[b].coorPt[d].distancetoImg.x,n.polygons[b].coorPt[d].y=n.img_y+n.polygons[b].coorPt[d].distancetoImg.y}}catch(f){g.e(f)}finally{g.f()}}}catch(f){u.e(f)}finally{u.f()}a&&a(!0)}catch(f){console.log("panPolygons",f)}}},{key:"resetClipPath",value:function(t){var e=t.img_x,n=t.img_y,i=t.img_w,a=t.img_h;try{this.clipPath=null,this.clipPath=new Path2D,this.clipPath.rect(e,n,i,a)}catch(o){console.log(o)}}}]),n}()).\u0275fac=function(t){return new(t||Se)},Se.\u0275prov=w.Db({token:Se,factory:Se.\u0275fac,providedIn:"any"}),Se),Ie=["canvasdrawing"],je=function(t){return{cursor:t}},Ae=((Ce=function(){function t(e,n,i,a,o,l,r){s(this,t),this._segCanvasService=e,this._imgLblStateService=n,this._undoRedoService=i,this._copyPasteService=a,this._annotateSelectState=o,this._zoomService=l,this._mouseCursorService=r,this.image=new Image,this.isMouseWithinPoint=!1,this.altKey=!1,this.ctrlKey=!1,this.unsubscribe$=new p.a,this.mousedown=!1,this._imgSrc="",this._onChangeMetadata=new w.n}return r(t,[{key:"ngOnInit",value:function(){var t=this;this._imgLblStateService.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){var n=e.clear,i=e.fitCenter,a=u(e,["clear","fitCenter"]);t.segState=Object.assign(Object.assign({},a),{clear:n,fitCenter:i}),i&&t.imgFitToCenter(),n&&(t._selectMetadata.polygons=[],t._undoRedoService.appendStages({meta:t._selectMetadata,method:"draw"}),t.redrawImage(t._selectMetadata),t.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){t.annotateState=e,t._selectMetadata&&(t._segCanvasService.setSelectedPolygon(e.annotation,t._selectMetadata),t.redrawImage(t._selectMetadata))}),this._zoomService.zoom$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.zoom=e}),this._mouseCursorService.mouseCursor$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.mouseCursor=e})}},{key:"ngOnChanges",value:function(t){var e;(null===(e=t._imgSrc)||void 0===e?void 0:e.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this._segCanvasService.setSelectedPolygon(-1),this.loadImage(t._imgSrc.currentValue))}},{key:"initializeCanvas",value:function(){this.canvas.nativeElement.style.width="80%",this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}},{key:"loadImage",value:function(t){var e=this;this.image.src=t,this.image.onload=function(){var t=e._selectMetadata,n=t.img_x,i=t.img_y;e._selectMetadata.img_w=e._selectMetadata.img_w<1?e._selectMetadata.img_ori_w:e._selectMetadata.img_w,e._selectMetadata.img_h=e._selectMetadata.img_h<1?e._selectMetadata.img_ori_h:e._selectMetadata.img_h,e._segCanvasService.setGlobalXY({offsetX:n,offsetY:i}),e.imgFitToCenter(),e.emitMetadata(),e.changeMouseCursorState(),e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"})}}},{key:"emitMetadata",value:function(){this._onChangeMetadata.emit(this._selectMetadata)}},{key:"annotateStateChange",value:function(t){t&&this._annotateSelectState.setState(t)}},{key:"resetZoom",value:function(){this._zoomService.resetZoomScale()}},{key:"imgFitToCenter",value:function(){var t=this;try{var e=this._segCanvasService.calScaleToFitScreen(this._selectMetadata,this.canvas.nativeElement);this._selectMetadata.img_w*=e.factor,this._selectMetadata.img_h*=e.factor,this._selectMetadata.img_x=e.newX,this._selectMetadata.img_y=e.newY,this._segCanvasService.scalePolygons(this._selectMetadata,e),this._segCanvasService.setGlobalXY({offsetX:e.newX,offsetY:e.newY}),this._segCanvasService.panPolygons(this._selectMetadata,!1,function(e){if(e){var n=Object(se.a)(t._selectMetadata);t._undoRedoService.isMethodChange("zoom")?t._undoRedoService.appendStages({meta:n,method:"zoom"}):t._undoRedoService.replaceStages({meta:n,method:"zoom"})}}),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(n){console.log("imgFitToCenter",n)}}},{key:"redrawImage",value:function(t){var e=t.img_x,n=t.img_y,i=t.img_w,a=t.img_h;this.clearcanvas(),this.canvasContext.drawImage(this.image,e,n,i,a),this._segCanvasService.drawAllPolygon(this._selectMetadata,this.canvasContext,this.annotateState.annotation)}},{key:"clearcanvas",value:function(){var t=this.canvas.nativeElement,e=t.width,n=t.height;this.canvasContext.clearRect(0,0,e,n)}},{key:"mouseScroll",value:function(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){var e=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement),n=e.scale,i=e.x,a=e.y;this.segState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,n)&&(this.canvasContext.canvas.style.transformOrigin="".concat(t.offsetX,"px ").concat(t.offsetY,"px"),this.canvasContext.canvas.style.transform="scale(".concat(n,", ").concat(n,")"),this._zoomService.setState({scale:n}))),this.canvasContext.canvas.scrollTop=a,this.canvasContext.canvas.scrollLeft=i,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(o){console.log("mouseScroll",o)}}},{key:"validateEndDrawPolygon",value:function(t,e,n){var i=t.isActiveModal,a=t.draw;return!i&&a&&e&&"none"!==n.canvas.style.pointerEvents}},{key:"canvasDblClickEvent",value:function(t){this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)&&(this._segCanvasService.isNewPolygon()&&(this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()),this.annotateState.annotation>-1&&this.annotateStateChange({annotation:this.annotateState.annotation,isDlbClick:!0}))}},{key:"canvasKeyDownEvent",value:function(t){var e=this,n=t.ctrlKey,i=t.shiftKey,a=t.key;try{if(this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)){if(this._segCanvasService.isNewPolygon())switch(a){case"Enter":this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata();break;case"Escape":this._segCanvasService.resetDrawing(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement)}else switch(a){case"Delete":case"Backspace":this._segCanvasService.deleteSinglePolygon(this._selectMetadata,this.annotateState.annotation,function(t){t&&(e.annotateStateChange(),e.redrawImage(e._selectMetadata),e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"}),e.emitMetadata())})}var o="ArrowLeft"===a?"left":"ArrowRight"===a?"right":"ArrowUp"===a?"up":"ArrowDown"===a&&"down";o&&this.keyMoveBox(o)}if(!this.isMouseWithinPoint)if(!n||"c"!==a&&"C"!==a)if(!n||"v"!==a&&"V"!==a){if(n&&i&&("z"===a||"Z"===a)){if(this._undoRedoService.isAllowRedo()){var s=this._undoRedoService.redo();this._selectMetadata=Object(se.a)(null==s?void 0:s.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else if(n&&("z"===a||"Z"===a)&&this._undoRedoService.isAllowUndo()){var l=this._undoRedoService.undo();this._selectMetadata=Object(se.a)(null==l?void 0:l.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}else this._copyPasteService.isAvailable()&&(this._selectMetadata.polygons.push(this._copyPasteService.paste()),this.annotateStateChange({annotation:this._selectMetadata.polygons.length-1}),this._segCanvasService.validateXYDistance(this._selectMetadata)),this._undoRedoService.appendStages({meta:Object(se.a)(this._selectMetadata),method:"draw"}),this.emitMetadata();else this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.polygons[this.annotateState.annotation])}catch(r){console.log("canvasKeyDownEvent",r)}}},{key:"keyMoveBox",value:function(t){var e=this;try{this._selectMetadata.polygons[this.annotateState.annotation]&&this._segCanvasService.keyboardMovePolygon(this._selectMetadata,t,this.annotateState.annotation,this.image,this.canvasContext,this.canvas.nativeElement,function(t){t&&(e._undoRedoService.appendStages({meta:Object(se.a)(e._selectMetadata),method:"draw"}),e._segCanvasService.validateXYDistance(e._selectMetadata),e.redrawImage(e._selectMetadata),e.emitMetadata())})}catch(n){console.log("keyMoveBox",n)}}},{key:"mouseDown",value:function(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint)if(this.mousedown=!0,this.segState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._segCanvasService.setPanXY(t),this.initializeCanvas(),this.redrawImage(this._selectMetadata)),this.segState.draw){var e=this._segCanvasService.mouseDownDraw(t,this._selectMetadata,this.canvas.nativeElement,this.image,this.canvasContext,this.ctrlKey,this.altKey);if(e>-1)this._segCanvasService.setGlobalXY(t);else{var n=this._selectMetadata,i=n.img_x,a=n.img_y;this._segCanvasService.setGlobalXY({offsetX:i,offsetY:a})}this.annotateStateChange({annotation:e}),this.redrawImage(this._selectMetadata),this.mouseMoveDrawCanvas(t)}else this.segState.draw&&!this.mousedown&&this.redrawImage(this._selectMetadata);else this.mousedown=!1}catch(o){console.log("mouseDown",o)}}},{key:"mouseUp",value:function(t){try{this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t);var e=this._segCanvasService.isNewPolygon();if(this._selectMetadata&&this.isMouseWithinPoint)if(this.mousedown){var n=this._selectMetadata,i=n.img_x,a=n.img_y;this.segState.drag&&this._segCanvasService.setGlobalXY({offsetX:i,offsetY:a}),this.segState.draw&&!e&&this.annotateState.annotation>-1&&this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(se.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.setGlobalXY({offsetX:i,offsetY:a}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}else{var o=this._segCanvasService.getClickPoint(),s=o.pointIndex,l=o.polygonIndex;this.segState.draw&&l>-1&&s>-1?this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(se.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.resetClickPoint(),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()):this.segState.draw&&(this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}this.mousedown=!1}catch(r){console.log("mouseUp",r)}}},{key:"mouseMove",value:function(t){var e=this;try{if(this.isMouseWithinPoint=this._selectMetadata&&this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){if(this.segState.drag&&this.mousedown){var n=this._segCanvasService.getDiffXY(t),i=n.diffX,a=n.diffY;this._selectMetadata.img_x=i,this._selectMetadata.img_y=a,this._segCanvasService.panPolygons(this._selectMetadata,!1,function(t){if(t){var n=Object(se.a)(e._selectMetadata);e._undoRedoService.isMethodChange("pan")?e._undoRedoService.appendStages({meta:n,method:"pan"}):e._undoRedoService.replaceStages({meta:n,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.segState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.segState.draw){var o=this.mouseMoveDrawCanvas(t);this.changeMouseCursorState(o?{move:!0}:{crosshair:!0})}}else this.changeMouseCursorState(),this.mousedown=!1}catch(s){console.log("mouseMove",s)}}},{key:"mouseMoveDrawCanvas",value:function(t){var e=this;return this._segCanvasService.mouseMoveDraw(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,t,this.ctrlKey,this.mousedown,function(t){e.redrawImage(e._selectMetadata)})}},{key:"changeMouseCursorState",value:function(t){this._mouseCursorService.setState(t)}},{key:"mouseOut",value:function(t){try{this.segState.drag&&this.isMouseWithinPoint&&this.mousedown&&(this._segCanvasService.setGlobalXY(t),this.redrawImage(this._selectMetadata)),this.isMouseWithinPoint=!1}catch(e){console.log("mouseOut",e)}}},{key:"currentCursor",value:function(){return this._mouseCursorService.changeCursor(this.mouseCursor)}},{key:"ngOnDestroy",value:function(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),t}()).\u0275fac=function(t){return new(t||Ce)(w.Hb(Oe),w.Hb(X),w.Hb(he),w.Hb(be),w.Hb(B),w.Hb(de),w.Hb(ve))},Ce.\u0275cmp=w.Bb({type:Ce,selectors:[["image-labelling-segmentation"]],viewQuery:function(t,e){var n;1&t&&w.qc(Ie,!0),2&t&&w.dc(n=w.Ub())&&(e.canvas=n.first)},hostBindings:function(t,e){1&t&&w.Tb("mousewheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("dblclick",function(t){return e.canvasDblClickEvent(t)})("keydown",function(t){return e.canvasKeyDownEvent(t)},!1,w.fc)("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc"},outputs:{_onChangeMetadata:"_onChangeMetadata"},features:[w.vb],decls:3,vars:3,consts:[[1,"canvasstyle",3,"ngStyle"],["canvasdrawing",""]],template:function(t,e){1&t&&(w.Mb(0,"div"),w.Ib(1,"canvas",0,1),w.Lb()),2&t&&(w.xb(1),w.ac("ngStyle",w.cc(1,je,e.currentCursor())))},directives:[c.l],styles:[".canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}"],changeDetection:0}),Ce),Be=["subLabelSelect"];function De(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"image-labelling-object-detection",31),w.Tb("_onChangeMetadata",function(t){return w.gc(n),w.Vb().onChangeMetadata(t)})("_onChangeAnnotationLabel",function(t){return w.gc(n),w.Vb().onChangeAnnotationLabel(t)})("_onEnterLabel",function(t){return w.gc(n),w.Vb().onProcessLabel(t)}),w.Lb(),w.Jb()}if(2&t){var i=w.Vb();w.xb(1),w.ac("_selectMetadata",i.selectedMetaData)("_imgSrc",i.imgSrc)("_tabStatus",i.tabStatus)}}function Xe(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"image-labelling-segmentation",32),w.Tb("_onChangeMetadata",function(t){return w.gc(n),w.Vb().onChangeMetadata(t)}),w.Lb(),w.Jb()}if(2&t){var i=w.Vb();w.xb(1),w.ac("_selectMetadata",i.selectedMetaData)("_imgSrc",i.imgSrc)}}function Ee(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"option",33),w.mc(2),w.Lb(),w.Jb()),2&t){var n=e.$implicit,i=w.Vb(2);w.xb(1),w.ac("value",n)("selected",n===i.currentAnnotationLabel),w.xb(1),w.oc(" ",n," ")}}function Te(t,e){if(1&t&&(w.Kb(0),w.kc(1,Ee,3,3,"ng-container",15),w.Jb()),2&t){var n=e.$implicit;w.xb(1),w.ac("ngForOf",n.label_list)}}function Ye(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"option",33),w.mc(2),w.Lb(),w.Jb()),2&t){var n=e.$implicit,i=w.Vb().$implicit;w.xb(1),w.ac("value",n)("selected",i.label_list[0].label),w.xb(1),w.oc(" ",n," ")}}function ze(t,e){if(1&t&&(w.Kb(0),w.kc(1,Ye,3,3,"ng-container",15),w.Jb()),2&t){var n=e.$implicit;w.xb(1),w.ac("ngForOf",n.label_list)}}function Re(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"div",34),w.mc(2),w.Lb(),w.Jb()),2&t){var n=w.Vb();w.xb(2),w.oc(" ",n.subLabelValidateMsg," ")}}function Ve(t,e){if(1&t){var n=w.Nb();w.Kb(0),w.Mb(1,"div",35),w.Mb(2,"label",36),w.mc(3),w.Wb(4,"translate"),w.Lb(),w.Mb(5,"label",37),w.mc(6),w.Wb(7,"translate"),w.Lb(),w.Ib(8,"span",38),w.Mb(9,"button",39),w.Tb("click",function(){w.gc(n);var t=e.index,i=w.Vb(2).index;return w.Vb(3).onRemoveSubLabel(i,t)}),w.mc(10," X "),w.Lb(),w.Lb(),w.Jb()}if(2&t){var i=e.$implicit;w.xb(3),w.pc("",w.Xb(4,4,"labellingArea.label"),": ",i.label,""),w.xb(3),w.pc("",w.Xb(7,6,"labellingArea.regionInfo"),": ",i.region,"")}}function Ne(t,e){if(1&t&&(w.Kb(0),w.Mb(1,"h2",11),w.mc(2),w.Wb(3,"translate"),w.Lb(),w.kc(4,Ve,11,8,"ng-container",15),w.Jb()),2&t){var n=w.Vb().$implicit;w.xb(2),w.nc(w.Xb(3,2,"labellingArea.addedSubLabel")),w.xb(2),w.ac("ngForOf",n.subLabel)}}function We(t,e){if(1&t&&(w.Kb(0),w.kc(1,Ne,5,4,"ng-container",5),w.Jb()),2&t){var n=e.$implicit,i=e.index,a=w.Vb(3);w.xb(1),w.ac("ngIf",(null==n||null==n.subLabel?null:n.subLabel.length)>0&&i===a.currentAnnotationIndex)}}function $e(t,e){if(1&t&&(w.Kb(0),w.kc(1,We,2,1,"ng-container",15),w.Jb()),2&t){var n=e.$implicit;w.xb(1),w.ac("ngForOf",null==n?null:n.bnd_box)}}function Fe(t,e){if(1&t&&(w.Kb(0),w.kc(1,$e,2,1,"ng-container",15),w.Jb()),2&t){var n=e.$implicit;w.xb(1),w.ac("ngForOf",n.annotation)}}var Ke,Ue,Je,He,Ge=[{path:"",component:(Ke=function(){function t(e,i,a,o,l,r,c,h,b,g){var d=this;s(this,t),this._router=e,this._imgLblApiService=i,this._modalService=a,this._dataSetService=o,this._annotateService=l,this._imgLblActionService=r,this._imgLblLayoutService=c,this._imgLblModeService=h,this._languageService=b,this._spinnerService=g,this.currentUrl="",this.selectedProjectName="",this.imgSrc="",this.loading=!1,this.thumbnailList=[],this.unsubscribe$=new p.a,this.subject$=new p.a,this.tabStatus=[{name:"labellingProject.project",closed:!1},{name:"labellingProject.label",closed:!1,label_list:[]},{name:"labellingProject.annotation",closed:!1,annotation:[]}],this.mainLabelRegionVal="",this.subLabelRegionVal="",this.subLabelValidateMsg="",this.currentAnnotationLabel="",this.currentAnnotationIndex=-1,this.currentImageDisplayIndex=-1,this.isLoading=!1,this.showLoading=!1,this.displayExportModal=!1,this.updateProjectProgress=function(){d._imgLblLayoutService.updateProjectProgress(d.tabStatus,d.selectedProjectName)},this.onChangeMetadata=function(t){d.tabStatus=d.tabStatus.map(function(e){return e.annotation?Object.assign(Object.assign({},e),{annotation:[t]}):e}),d.thumbnailList=d.thumbnailList.map(function(e,n){return d.currentImageDisplayIndex===n?t:e});var e=t.bnd_box?t.bnd_box.length>0:t.polygons.length>0;d.onChangeSchema=Object.assign(Object.assign({},d.onChangeSchema),{hasAnnotation:e}),d.updateProjectProgress()},this.onToggleTab=function(t){var e=t.name,n=t.closed;!d.tabStatus.some(function(t){return t.name.toLowerCase()===e.toLowerCase()&&t.closed===n})&&(d.tabStatus=d.tabStatus.map(function(t){return t.name.toLowerCase()===e.toLowerCase()?Object.assign(Object.assign({},t),{closed:n}):Object.assign({},t)}))},this.onExport=function(){d.displayExportModal=!0},this.exportProject=function(t){var e=d.selectedProjectName;d._imgLblApiService.exportProject(e,t).pipe(Object(v.a)()).subscribe(function(t){1===t.message?d._languageService._translate.get("exportSuccess").subscribe(function(t){alert(e+t)}):d._languageService._translate.get("exportFailed").subscribe(function(t){alert(t+e)})}),d.displayExportModal=!1},this.onReload=function(){var t=d.selectedProjectName,e=d._imgLblApiService.reloadProject(t),n=d._imgLblApiService.reloadProjectStatus(t),i=d._dataSetService.getThumbnailList,a=[];d.subjectSubscription=d.subject$.pipe(Object(v.a)(),Object(m.a)(function(){return e}),Object(m.a)(function(e){return 5!==(a=e.message)&&1===a?Object(_.a)(500).pipe(Object(m.a)(function(){return n}),Object(v.a)(function(t){var e=t.message;return 4===e||1===e}),Object(m.a)(function(e){var n=e.uuid_add_list,a=e.uuid_delete_list,o=e.message;d.isLoading=!0;var s=[];d.thumbnailList.forEach(function(t){s.push(t.uuid)}),n.forEach(function(t){s.push(t)}),a.forEach(function(t){s=s.filter(function(e){return e!==t})});var l=4===o&&s.length>0?s.map(function(e){return i(t,e)}):[];return d.thumbnailList=[],l}),Object(m.a)(function(t){return t})):Object(x.a)(function(t){return console.error(t),d.isLoading=!1,t});var a})).subscribe(function(t){d.isLoading=!0,a.push(t)},function(t){},function(){d.thumbnailList=a,d.onChangeSchema=Object.assign(Object.assign({},d.onChangeSchema),{totalNumThumbnail:d.thumbnailList.length}),d.isLoading=!1}),d.subject$.next()},this.navigateByUrl=function(t){var e=t.url;e?d._router.navigate([e]):console.error("No url received from child component")},this.keyDownEvent=function(t){var e=t.key;d._imgLblActionService.action$.pipe(Object(v.a)()).subscribe(function(t){if(!t.draw)switch(e){case"ArrowLeft":d.navigateByAction({thumbnailAction:-1});break;case"ArrowRight":d.navigateByAction({thumbnailAction:1});break;case"Escape":d.onCloseModal()}})},this.navigateByAction=function(t){var e=t.thumbnailAction;if(e){d.showLoading=!0;var n=d._imgLblLayoutService.calculateIndex(e,d.currentImageDisplayIndex,d.thumbnailList.length);if(n!==d.currentImageDisplayIndex){d.currentImageDisplayIndex=n;var i=d.thumbnailList.find(function(t,e){return e===n}),a=d.thumbnailList.findIndex(function(t,e){return e===n});i&&-1!==a&&d.displayImage(Object.assign(Object.assign({},i),{thumbnailIndex:a}))}}},this.displayImage=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.selectedProjectName,i=t.thumbnailIndex,a=u(t,["thumbnailIndex"]);(null===(e=d.selectedMetaData)||void 0===e?void 0:e.uuid)!==a.uuid&&d._imgLblApiService.getBase64Thumbnail(n,a.uuid).pipe(Object(v.a)()).subscribe(function(t){var e=t.message,n=t.img_src;if(1===e){d.selectedMetaData=a,d.imgSrc=n,d.currentImageDisplayIndex=i;var o=a.bnd_box?a.bnd_box.length>0:a.polygons&&a.polygons.length>0||!1;d.onChangeSchema=Object.assign(Object.assign({},d.onChangeSchema),{currentThumbnailIndex:i+1,thumbnailName:a.img_path,hasAnnotation:o})}},function(t){return console.error(t)},function(){return d.showLoading=!1})},this.onProcessLabel=function(t){var e=t.selectedLabel,n=t.label_list,i=t.action,a=e&&!i?n.filter(function(t){return t!==e}):n;d._imgLblApiService.updateLabelList(d.selectedProjectName,a.length>0?a:[]).pipe(Object(v.a)()).subscribe(function(t){1===t.message?d.tabStatus=d._imgLblLayoutService.displayLabelList(d.tabStatus,a):console.error("Error while updating label")}),d.updateProjectProgress()},this.onChangeAnnotationLabel=function(t){d.tabStatus=d._imgLblLayoutService.changeAnnotationLabel(d.tabStatus,t),d.updateStateToRenderChild(),d.updateProjectProgress()},this.onDeleteAnnotation=function(t){d.tabStatus=d._imgLblLayoutService.deleteAnnotation(d.tabStatus,t),d.updateStateToRenderChild(),d.updateProjectProgress()},this.onDisplayModal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"modal-image-labelling";d.subLabelRegionVal="",d.subLabelValidateMsg="",d._modalService.open(t)},this.onCloseModal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"modal-image-labelling";d._imgLblActionService.setState({isActiveModal:!1,draw:!0,scroll:!0}),d._modalService.close(t)},this.onChangeInput=function(t,e){var n=t.target.value;"main"===e?d.mainLabelRegionVal=n:d.subLabelRegionVal=n},this.onSubmitLabel=function(){var t=d._subLabelSelect.nativeElement.value,e=!1;d.tabStatus.forEach(function(n){var i=n.annotation;return null==i?void 0:i.forEach(function(n){var i=n.bnd_box,a=n.polygons,o=null!=i?i:a;if(o){var s=o[d.currentAnnotationIndex].subLabel;s&&(null==s?void 0:s.length)>0&&(null==s||s.some(function(n){var i=n.label;return e=i===t}))}else console.log("missing prop bnd_box OR polygons")})}),e?d.subLabelValidateMsg="Invalid of duplicate label: "+t:(d.tabStatus=d._imgLblLayoutService.submitLabel(d.tabStatus,t,d.currentAnnotationIndex,{mainLabelRegion:d.mainLabelRegionVal,subLabelRegion:d.subLabelRegionVal}),d.subLabelValidateMsg="",d.updateStateToRenderChild(),d.updateProjectProgress()),d.subLabelRegionVal=""},this.onRemoveSubLabel=function(t,e){d.tabStatus=d._imgLblLayoutService.removeSubLabel(d.tabStatus,{selectedAnnoIndex:t,selectedSubLabelIndex:e}),d.updateStateToRenderChild(),d.updateProjectProgress()},this.updateStateToRenderChild=function(){d.tabStatus.forEach(function(t){var e=t.annotation;e&&(d.thumbnailList=d.thumbnailList.map(function(t){var n;return null!==(n=e.find(function(e){var n=e.uuid;return t.uuid===n}))&&void 0!==n?n:t}),d.selectedMetaData=e[0])})},this.resetProjectStatus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.selectedProjectName;t.trim()&&d._dataSetService.manualCloseProject(t).pipe(Object(y.a)(d.unsubscribe$)).subscribe(function(t){n(t),d._router.navigate(["/"])})},this._languageService.initializeLanguage("image-labelling",["image-labelling-en","image-labelling-cn","image-labelling-ms"])}return r(t,[{key:"ngOnInit",value:function(){var t=this;this.currentUrl=this._router.url;var e=this._imgLblLayoutService.getRouteState(history),n=e.thumbnailList,i=e.labelList,a=e.projectName;this.thumbnailList=n,this.selectedProjectName=a,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:n.length}),this.navigateByAction({thumbnailAction:1});var o=this._imgLblLayoutService.displayLabelList(this.tabStatus,i);this.tabStatus=o,this._annotateService.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){var n=e.annotation;e.isDlbClick?(t.currentAnnotationIndex=n,t.tabStatus.forEach(function(e){var i=e.annotation;return null==i?void 0:i.forEach(function(e){var i=e.bnd_box,a=e.polygons,o=null!=i?i:a;if(o){var s=o[n],l=s.label,r=s.region;t.currentAnnotationLabel=l,t.mainLabelRegionVal=r||""}else console.log("missing prop bnd_box OR polygons")})}),t._imgLblActionService.setState({isActiveModal:!0,draw:!1,drag:!1,scroll:!1}),t.onDisplayModal()):(t.currentAnnotationLabel="",t.currentAnnotationIndex=n)}),this._imgLblActionService.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){e.clear&&(t.thumbnailList[0].bnd_box&&(t.thumbnailList[t.currentImageDisplayIndex].bnd_box=[]),t.thumbnailList[0].polygons&&(t.thumbnailList[t.currentImageDisplayIndex].polygons=[]),t.onChangeSchema=Object.assign(Object.assign({},t.onChangeSchema),{hasAnnotation:!1}))}),this._spinnerService.returnAsObservable().pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.isLoading=t.showLoading&&e})}},{key:"cancelExportProject",value:function(){this.displayExportModal=!1}},{key:"onWindowClose",value:function(t){this.resetProjectStatus(),t.preventDefault()}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this._imgLblModeService.setState(null),this._imgLblActionService.setState(null),this.resetProjectStatus()}}]),t}(),Ke.\u0275fac=function(t){return new(t||Ke)(w.Hb(S.a),w.Hb(L),w.Hb(O.a),w.Hb(I.a),w.Hb(B),w.Hb(X),w.Hb(E),w.Hb(k.a),w.Hb(T.a),w.Hb(Y.a))},Ke.\u0275cmp=w.Bb({type:Ke,selectors:[["image-labelling-layout"]],viewQuery:function(t,e){var n;1&t&&w.qc(Be,!0),2&t&&w.dc(n=w.Ub())&&(e._subLabelSelect=n.first)},hostBindings:function(t,e){1&t&&w.Tb("keydown",function(t){return e.keyDownEvent(t)},!1,w.fc)("beforeunload",function(t){return e.onWindowClose(t)},!1,w.fc)},decls:70,vars:59,consts:[[1,"layout-container"],[3,"_onChange"],[3,"_onChange","_onClick"],[1,"content-container"],[3,"_onChange","_currentUrl","_tabStatus"],[4,"ngIf"],[3,"_thumbnailList","_tabStatus","_onClose","_onClickThumbnail","_onClickLabel","_onEnterLabel","_onChangeAnnotationLabel","_onDeleteAnnotation"],[3,"_onChange","_onClick","_onExport","_onReload"],[3,"_thumbnailInfo","_imgSrc"],["id","modal-image-labelling"],[1,"modal-button","float-right",3,"click"],[1,"font-title"],[1,"main-label-container"],[1,"font-label"],[1,"static-select"],[4,"ngFor","ngForOf"],["type","text",1,"static-input",3,"value","placeholder","change"],[1,"hr-line"],[1,"sub-label-container"],["subLabelSelect",""],[1,"modal-button",3,"click"],[3,"hidden"],[1,"modal"],[1,"modal-content"],[1,"modal-content-container"],[1,"modal-content-header"],[1,"modal-button-container"],[1,"button-style","cancel-btn",3,"click"],[1,"button-style","confgdata-btn",3,"click"],[1,"button-style","confg-btn",3,"click"],[3,"_loading"],[3,"_selectMetadata","_imgSrc","_tabStatus","_onChangeMetadata","_onChangeAnnotationLabel","_onEnterLabel"],[3,"_selectMetadata","_imgSrc","_onChangeMetadata"],[3,"value","selected"],[1,"validate-msg"],[1,"sub-label-flex-container","sub-label-padding"],[1,"font-label","flex-first"],[1,"font-label","flex-second"],[1,"flex-third"],[1,"modal-butto","flex-fourth",3,"click"]],template:function(t,e){1&t&&(w.Mb(0,"div",0),w.Mb(1,"div"),w.Ib(2,"page-header",1),w.Mb(3,"image-labelling-info",2),w.Tb("_onClick",function(t){return e.navigateByAction(t)}),w.Lb(),w.Lb(),w.Mb(4,"div",3),w.Ib(5,"image-labelling-left-sidebar",4),w.kc(6,De,2,3,"ng-container",5),w.kc(7,Xe,2,2,"ng-container",5),w.Mb(8,"image-labelling-project",6),w.Tb("_onClose",function(t){return e.onToggleTab(t)})("_onClickThumbnail",function(t){return e.displayImage(t)})("_onClickLabel",function(t){return e.onProcessLabel(t)})("_onEnterLabel",function(t){return e.onProcessLabel(t)})("_onChangeAnnotationLabel",function(t){return e.onChangeAnnotationLabel(t)})("_onDeleteAnnotation",function(t){return e.onDeleteAnnotation(t)}),w.Lb(),w.Mb(9,"image-labelling-right-sidebar",7),w.Tb("_onClick",function(t){return e.onToggleTab(t)})("_onExport",function(){return e.onExport()})("_onReload",function(){return e.onReload()}),w.Lb(),w.Lb(),w.Ib(10,"image-labelling-footer",8),w.Lb(),w.Mb(11,"modal",9),w.Mb(12,"button",10),w.Tb("click",function(){return e.onCloseModal()}),w.mc(13,"X"),w.Lb(),w.Mb(14,"div"),w.Mb(15,"h2",11),w.mc(16),w.Wb(17,"translate"),w.Lb(),w.Mb(18,"div",12),w.Mb(19,"label",13),w.mc(20),w.Wb(21,"translate"),w.Lb(),w.Mb(22,"select",14),w.kc(23,Te,2,1,"ng-container",15),w.Lb(),w.Mb(24,"label",13),w.mc(25),w.Wb(26,"translate"),w.Lb(),w.Mb(27,"input",16),w.Tb("change",function(t){return e.onChangeInput(t,"main")}),w.Wb(28,"translate"),w.Lb(),w.Lb(),w.Lb(),w.Ib(29,"hr",17),w.Mb(30,"div"),w.Mb(31,"h2",11),w.mc(32),w.Wb(33,"translate"),w.Lb(),w.Mb(34,"div",18),w.Mb(35,"label",13),w.mc(36),w.Wb(37,"translate"),w.Lb(),w.Mb(38,"select",14,19),w.kc(40,ze,2,1,"ng-container",15),w.Lb(),w.Mb(41,"label",13),w.mc(42),w.Wb(43,"translate"),w.Lb(),w.Mb(44,"input",16),w.Tb("change",function(t){return e.onChangeInput(t,"sub")}),w.Wb(45,"translate"),w.Lb(),w.Mb(46,"button",20),w.Tb("click",function(){return e.onSubmitLabel()}),w.mc(47),w.Wb(48,"translate"),w.Lb(),w.Lb(),w.kc(49,Re,3,1,"ng-container",5),w.Lb(),w.Ib(50,"hr",17),w.kc(51,Fe,2,1,"ng-container",15),w.Lb(),w.Mb(52,"div",21),w.Mb(53,"div",22),w.Mb(54,"div",23),w.Mb(55,"div",24),w.Mb(56,"h1",25),w.mc(57),w.Wb(58,"translate"),w.Lb(),w.Mb(59,"div",26),w.Mb(60,"button",27),w.Tb("click",function(){return e.cancelExportProject()}),w.mc(61),w.Wb(62,"translate"),w.Lb(),w.Mb(63,"button",28),w.Tb("click",function(){return e.exportProject("cfg")}),w.mc(64),w.Wb(65,"translate"),w.Lb(),w.Mb(66,"button",29),w.Tb("click",function(){return e.exportProject("cfgdata")}),w.mc(67),w.Wb(68,"translate"),w.Lb(),w.Lb(),w.Lb(),w.Lb(),w.Lb(),w.Lb(),w.Ib(69,"spinner",30)),2&t&&(w.xb(2),w.ac("_onChange",e.onChangeSchema),w.xb(1),w.ac("_onChange",e.onChangeSchema),w.xb(2),w.ac("_onChange",e.onChangeSchema)("_currentUrl",e.currentUrl)("_tabStatus",e.tabStatus),w.xb(1),w.ac("ngIf",e._router.url.includes("imglabel/bndbox")),w.xb(1),w.ac("ngIf",e._router.url.includes("imglabel/seg")),w.xb(1),w.ac("_thumbnailList",e.thumbnailList)("_tabStatus",e.tabStatus),w.xb(1),w.ac("_onChange",e.onChangeSchema),w.xb(1),w.ac("_thumbnailInfo",e.selectedMetaData)("_imgSrc",e.imgSrc),w.xb(6),w.nc(w.Xb(17,33,"labellingArea.mainLabel")),w.xb(4),w.oc("",w.Xb(21,35,"labellingArea.label"),": "),w.xb(3),w.ac("ngForOf",e.tabStatus),w.xb(2),w.oc("",w.Xb(26,37,"labellingArea.regionInfo"),": "),w.xb(2),w.ac("value",e.mainLabelRegionVal)("placeholder",w.Xb(28,39,"labellingArea.mainRegionInfo")),w.xb(5),w.nc(w.Xb(33,41,"labellingArea.subLabel")),w.xb(4),w.oc("",w.Xb(37,43,"labellingArea.label"),": "),w.xb(4),w.ac("ngForOf",e.tabStatus),w.xb(2),w.oc("",w.Xb(43,45,"labellingArea.regionInfo"),": "),w.xb(2),w.ac("value",e.subLabelRegionVal)("placeholder",w.Xb(45,47,"labellingArea.subRegionInfo")),w.xb(3),w.nc(w.Xb(48,49,"labellingArea.add")),w.xb(2),w.ac("ngIf",e.subLabelValidateMsg),w.xb(2),w.ac("ngForOf",e.tabStatus),w.xb(1),w.ac("hidden",!e.displayExportModal),w.xb(5),w.nc(w.Xb(58,51,"exportModal.exportOptions")),w.xb(4),w.oc(" ",w.Xb(62,53,"exportModal.cancel")," "),w.xb(3),w.oc(" ",w.Xb(65,55,"exportModal.configFile")," "),w.xb(3),w.oc(" ",w.Xb(68,57,"exportModal.configFileWithData")," "),w.xb(2),w.ac("_loading",e.isLoading))},directives:[z.a,G,Ct,c.k,Ft,Jt,ie,ae.a,c.j,oe.a,Le,Ae,kt.j,kt.m],pipes:[V.c],styles:[".layout-container[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;min-width:97.8vw;max-width:97.8vw}.modal-button[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw}.float-right[_ngcontent-%COMP%]{float:right}.font-title[_ngcontent-%COMP%]{font-size:1.7vw}.font-label[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.main-label-container[_ngcontent-%COMP%]{min-width:35vw;max-width:35vw}.main-label-container[_ngcontent-%COMP%], .sub-label-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.sub-label-container[_ngcontent-%COMP%]{min-width:40vw;max-width:40vw}.sub-label-flex-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1 1 100%;min-width:0}.static-select[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:5vh;margin:0;-moz-text-align-last:center;text-align-last:center;background:#262a2e;color:#fff;box-shadow:inset -.5vw 6.25vw 1vw 0 rgba(0,0,0,.2),inset -.5vw -.5vw 1vw 0 hsla(0,0%,100%,.4)}.static-select[_ngcontent-%COMP%]:hover{box-shadow:inset -.375vw -.375vw .625vw 0 rgba(0,0,0,.2),inset .375vw .375vw .625vw 0 hsla(0,0%,100%,.5)}.static-select[_ngcontent-%COMP%]:active{box-shadow:inset .375vw .375vw .625vw 0 rgba(0,0,0,.2),inset -.375vw -.375vw .625vw 0 hsla(0,0%,100%,.5)}.static-input[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;border-radius:2vw;border:none;outline:none;background-color:#363636;color:#fff;padding:0 1vw}.hr-line[_ngcontent-%COMP%]{height:.5vh;color:#000;background:#8c8b8b;margin:5vh 0}.sub-label-padding[_ngcontent-%COMP%]{padding:0 0 2vh}.validate-msg[_ngcontent-%COMP%]{color:red;padding:5vh 0 0;font-size:1vw}.flex-first[_ngcontent-%COMP%]{flex:1 1 35%}.flex-second[_ngcontent-%COMP%]{flex:1 1 55%}.flex-third[_ngcontent-%COMP%]{flex:0 0 5%}.flex-fourth[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;flex:0 0 5%}.modal[_ngcontent-%COMP%]{z-index:1000;padding-top:10vh;top:0;width:100%;height:100%;overflow:auto;background-color:transparent;scrollbar-width:none;position:fixed;background:rgba(0,0,0,.8)}.modal-content[_ngcontent-%COMP%]{background-color:#525353;padding:1vw;max-width:30vw;min-width:30vw;border-radius:1vw;margin:15vh auto auto}.model-content-container[_ngcontent-%COMP%]{margin-left:1.3vw}.modal-content-header[_ngcontent-%COMP%]{text-align:center;color:#fff;font-size:3vh}.modal-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:1vw}.button-style[_ngcontent-%COMP%]{padding:1vh 1.5vw;border-radius:1vh;border:none;outline:none;color:#fff;cursor:pointer;font-size:2vh}.confg-btn[_ngcontent-%COMP%], .confgdata-btn[_ngcontent-%COMP%]{background-color:#169887}.cancel-btn[_ngcontent-%COMP%], .confgdata-btn[_ngcontent-%COMP%]{margin-right:.7vw}.cancel-btn[_ngcontent-%COMP%]{background-color:#444}"]}),Ke)}],Ze=((Ue=function t(){s(this,t)}).\u0275mod=w.Fb({type:Ue}),Ue.\u0275inj=w.Eb({factory:function(t){return new(t||Ue)},imports:[[S.d.forChild(Ge)]]}),Ue),qe=l("KZX/"),Qe=((Je=function t(){s(this,t)}).\u0275mod=w.Fb({type:Je}),Je.\u0275inj=w.Eb({factory:function(t){return new(t||Je)},imports:[[c.b,qe.a,V.b]]}),Je),tn=l("RKnZ"),en=l("O+1G"),nn=((He=function t(){s(this,t)}).\u0275mod=w.Fb({type:He}),He.\u0275inj=w.Eb({factory:function(t){return new(t||He)},imports:[[c.b,qe.a,V.b,Ze,tn.a,S.d,en.a,Qe]]}),He)}}])}();