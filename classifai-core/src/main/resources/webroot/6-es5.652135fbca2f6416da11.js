!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,a=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(l){a=!0,o=l}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}return n}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}function n(t){if(null==t)throw new TypeError("Cannot destructure undefined")}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{i5u5:function(a,o,s){"use strict";s.r(o),s.d(o,"ImageLabellingLayoutModule",function(){return ai});var c,u,h,d,g,b,f,m=s("ofXK"),v=s("mrSG"),p=s("5+tZ"),_=s("SxV6"),y=s("1G5W"),x=s("XNiG"),w=s("cp0P"),S=s("l5mm"),k=s("z6cu"),C=s("fXoL"),P=s("tyNb"),O=s("tk/3"),M=s("/uUt"),L=s("cxbk"),I=s("14na"),A=((c=function(){function t(e,n,i){var a=this;r(this,t),this.http=e,this.mode=n,this.router=i,this.hostPort=L.a.baseURL,this.imageLabellingMode=null,this.getBase64Thumbnail=function(t,e){return a.http.get("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/uuid/").concat(e,"/imgsrc"))},this.updateLabelList=function(t,e){return a.http.put("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/newlabels"),{label_list:e})},this.updateProjectProgress=function(t,e,n){return a.http.put("".concat(a.hostPort).concat(a.imageLabellingMode,"/projects/").concat(t,"/uuid/").concat(e,"/update"),Object.assign({},n))},this.exportProject=function(t,e){return a.http.put("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/export/").concat(e),{newprojectid:t})},this.reloadProject=function(t){return a.http.put("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/reload"),{newprojectid:t})},this.reloadProjectStatus=function(t){return a.http.get("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/reloadstatus"))},this.renameImage=function(t,e,n){return a.http.put("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(n,"/imgsrc/rename"),{uuid:t,new_fname:e})},this.deleteImage=function(t,e,n){var i={headers:new O.e({"Content-Type":"application/json"}),body:{uuid_list:[t],img_path_list:[e]}};return a.http.delete("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(n,"/uuids"),i)},this.submitSelectedImageFile=function(t,e,n){return a.http.put("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/add"),{img_name_list:e,img_base64_list:n})},this.addImagesStatus=function(t){return a.http.get("".concat(a.hostPort,"v2/").concat(a.imageLabellingMode,"/projects/").concat(t,"/addstatus"))},this.mode.imgLabelMode$.pipe(Object(M.a)()).subscribe(function(t){t?a.imageLabellingMode=t:a.router.navigate(["/"])})}return l(t,[{key:"checkIfBboxMetaType",value:function(t){return Array.isArray(t)?void 0!==t[0].bnd_box:void 0!==t.bnd_box}},{key:"exportProjectStatus",value:function(){return this.http.get("".concat(this.hostPort,"v2/").concat(this.imageLabellingMode,"/projects/exportstatus"))}}]),t}()).\u0275fac=function(t){return new(t||c)(C.Tb(O.b),C.Tb(I.a),C.Tb(P.a))},c.\u0275prov=C.Fb({token:c,factory:c.\u0275fac,providedIn:"any"}),c),j=s("1EsL"),B=s("LY9J"),E=s("2Vo4"),z={annotation:-1,isDlbClick:!1},D=((u=function t(){var e=this;r(this,t),this.labelStateSubject=new E.a(z),this.labelStaging$=this.labelStateSubject.asObservable(),this.setState=function(t){e.labelStateSubject.next(t?Object.assign(Object.assign({},z),t):z)}}).\u0275fac=function(t){return new(t||u)},u.\u0275prov=C.Fb({token:u,factory:u.\u0275fac,providedIn:"any"}),u),T=s("qlDG"),N=((h=function t(e){var a=this;r(this,t),this._imgLblApiService=e,this.getRouteState=function(t){var e=t.state;return Object.assign({},e)},this.displayLabelList=function(t,e){return t.map(function(t){return t.label_list?Object.assign(Object.assign({},t),{label_list:e}):t})},this.calculateIndex=function(t,e,n){return 1===t?e>=n-1?n-1:e+1:e<=0?0:e-1},this.checkAnnotationMetadataProp=function(t){var e=t.bnd_box,n=t.polygons;return null!=e?e:n},this.changeAnnotationLabel=function(t,e){var n=e.label,i=e.index;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var e=t.bnd_box,a=t.polygons,o=Object(v.c)(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},o),{bnd_box:null==e?void 0:e.map(function(t,e){return e===i?Object.assign(Object.assign({},t),{label:n}):t}),polygons:null==a?void 0:a.map(function(t,e){return e===i?Object.assign(Object.assign({},t),{label:n}):t})})})}):t})},this.deleteAnnotation=function(t,e){return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var n=t.bnd_box,i=t.polygons,a=Object(v.c)(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},a),{bnd_box:null==n?void 0:n.filter(function(t,n){return n!==e}),polygons:null==i?void 0:i.filter(function(t,n){return n!==e})})})}):t})},this.submitLabel=function(t,e,n,a){var o=a.mainLabelRegion,r=a.subLabelRegion;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var a=t.bnd_box,s=t.polygons,l=Object(v.c)(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},l),{bnd_box:null==a?void 0:a.map(function(t,a){return a===n?Object.assign(Object.assign({},t),{region:o,subLabel:t.subLabel&&t.subLabel.length>0?[].concat(i(t.subLabel),[{label:e,region:r}]):[{label:e,region:r}]}):t}),polygons:null==s?void 0:s.map(function(t,a){return a===n?Object.assign(Object.assign({},t),{region:o,subLabel:t.subLabel&&t.subLabel.length>0?[].concat(i(t.subLabel),[{label:e,region:r}]):[{label:e,region:r}]}):t})})})}):t})},this.removeSubLabel=function(t,e){var n=e.selectedAnnoIndex,i=e.selectedSubLabelIndex;return t.map(function(t){return t.annotation?Object.assign(Object.assign({},t),{annotation:t.annotation.map(function(t){var e=t.bnd_box,a=t.polygons,o=Object(v.c)(t,["bnd_box","polygons"]);return Object.assign(Object.assign({},o),{bnd_box:null==e?void 0:e.map(function(t,e){var a;return e===n?Object.assign(Object.assign({},t),{subLabel:null===(a=t.subLabel)||void 0===a?void 0:a.filter(function(t,e){return e!==i})}):t}),polygons:null==a?void 0:a.map(function(t,e){var a;return e===n?Object.assign(Object.assign({},t),{subLabel:null===(a=t.subLabel)||void 0===a?void 0:a.filter(function(t,e){return e!==i})}):t})})})}):t})},this.setLocalStorageProjectProgress=function(t,e){localStorage.setItem("".concat(t,"_").concat(a._imgLblApiService.imageLabellingMode),JSON.stringify({cache:e}))},this.getLocalStorageProjectProgress=function(t){var e=localStorage.getItem("".concat(t,"_").concat(a._imgLblApiService.imageLabellingMode));return e?JSON.parse(e):null},this.updateProjectProgress=function(t,e){t.forEach(function(t){var i=t.annotation;i&&(a.setLocalStorageProjectProgress(e,i),null==i||i.forEach(function(t){a._imgLblApiService.updateProjectProgress(e,t.uuid,t).pipe(Object(_.a)()).subscribe(function(t){n(t)})}))})}}).\u0275fac=function(t){return new(t||h)(C.Tb(A))},h.\u0275prov=C.Fb({token:h,factory:h.\u0275fac,providedIn:"any"}),h),R=s("I7yr"),F=s("2Qtc"),W=s("Iab2"),U=s("xOOu"),X=((g=function(){function n(){r(this,n)}return l(n,[{key:"exportSaveFormat",value:function(t){var e=t.saveCurrentImage,n=t.saveFormat,i=t.metadata,a=t.projectName,o=t.fullLabelList,r=t.labelList,s=t.projectFullMetadata;return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var l,c,u,h,d,g,b,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n,t.next="pascalVoc"===t.t0?3:"yolo"===t.t0?4:"ocr"===t.t0?5:"label"===t.t0?6:"coco"===t.t0?10:"json"===t.t0?14:22;break;case 3:return t.abrupt("return",this.exportPascalVOC(i,r,e,s,a));case 4:return t.abrupt("return",this.exportYolo(i,r,e,s,a,n));case 5:return t.abrupt("return",this.exportOCR(i,s,a,o));case 6:if(r){t.next=8;break}return t.abrupt("return",{message:0,msg:"warning.noLabelList"});case 8:return l=a+"_label.txt",c=this.generateLabelFormat(r),t.abrupt("return",""===c?{message:0,msg:"warning.noLabelSelected"}:(this.saveFile({content:c,filename:l,type:"text/plain;charset=utf-8"}),{message:1,msg:"success"}));case 10:if(s){t.next=12;break}return t.abrupt("return",{message:0,msg:"warning.noImageList"});case 12:return u=this.calPolyCoorOriginalImages(s),h=this.getCocoContent(u,r),d=this.getCocoFileName(a),t.abrupt("return",(this.saveFile({content:h,filename:d,type:"text/json;charset=utf-8"}),{message:1,msg:"success"}));case 14:if(i){t.next=16;break}return t.abrupt("return",{message:0,msg:"warning.noMetadata"});case 16:if(null==i?void 0:i.polygons){t.next=18;break}return t.abrupt("return",{message:0,msg:"warning.noPolygon"});case 18:if(s){t.next=20;break}return t.abrupt("return",{message:0,msg:"warning.noImageList"});case 20:return g=this.calPolyCoorOriginalImages(s),b=this.getJsonContent(g),f=this.getJsonFileName(a),t.abrupt("return",(this.saveFile({content:b,filename:f,type:"text/json;charset=utf-8"}),{message:1,msg:"success"}));case 22:case"end":return t.stop()}},t,this)}))}},{key:"exportPascalVOC",value:function(t,e,n,i,a){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark(function o(){var r,s,l,c,u,h,d,g,b,f;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t){o.next=2;break}return o.abrupt("return",{message:0,msg:"warning.noMetadata"});case 2:if(null==t?void 0:t.bnd_box){o.next=4;break}return o.abrupt("return",{message:0,msg:"warning.noBoundingBox"});case 4:if(e){o.next=6;break}return o.abrupt("return",{message:0,msg:"warning.noLabelList"});case 6:if(!n){o.next=9;break}return r=this.calBoxCoorOriginalImages(t),s=this.getFileName(t.img_path),l=t.img_path,c=t.img_depth,u=t.img_ori_w,h=t.img_ori_h,d=this.generatePascalVocFormat({img_path:l,img_depth:c,img_ori_w:u,img_ori_h:h,bnd_box:r},e),g=s.split("."),o.abrupt("return",(this.saveFile({content:d,filename:g[0]+".xml",type:"text/xml;charset=utf-8"}),{message:1,msg:"success"}));case 9:if(i){o.next=11;break}return o.abrupt("return",{message:0,msg:"warning.noImageList"});case 11:if(b=this.pushPascalVOCToList(i,e),f=b.pascalVocList,!b.isEmpty){o.next=16;break}o.t0={message:0,msg:"warning.noLabelSelected"},o.next=24;break;case 16:if(!f){o.next=22;break}return o.next=19,this.saveAsZip(f,"pascal_voc",a);case 19:o.t1={message:1,msg:"success"},o.next=23;break;case 22:o.t1={message:0,msg:"warning.noProgress"};case 23:o.t0=o.t1;case 24:return o.abrupt("return",o.t0);case 25:case"end":return o.stop()}},o,this)}))}},{key:"pushPascalVOCToList",value:function(t,e){var n=this,i=[],a=!0;return t.forEach(function(t){var o=(t.bnd_box?t.bnd_box.map(function(t){return t.label}):[]).some(function(t){return e.indexOf(t)>=0});if(t.bnd_box&&t.bnd_box.length>0&&o){a=!1;var r=n.calBoxCoorOriginalImages(t),s=n.getFileName(t.img_path),l=t.img_path,c=t.img_depth,u=t.img_ori_w,h=t.img_ori_h,d=n.generatePascalVocFormat({img_path:l,img_depth:c,img_ori_w:u,img_ori_h:h,bnd_box:r},e),g=s.split(".");i.push({filename:g[0]+".xml",content:d})}}),{pascalVocList:i,isEmpty:a}}},{key:"exportYolo",value:function(t,e,n,i,a,o){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark(function r(){var s,l,c,u,h,d,g,b;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return",{message:0,msg:"warning.noMetadata"});case 2:if(null==t?void 0:t.bnd_box){r.next=4;break}return r.abrupt("return",{message:0,msg:"warning.noBoundingBox"});case 4:if(e){r.next=6;break}return r.abrupt("return",{message:0,msg:"warning.noLabelList"});case 6:if(!n){r.next=9;break}return s=this.calBoxCoorOriginalImages(t),l=this.getFileName(t.img_path),c=t.img_ori_w,u=t.img_ori_h,h=this.generateYoloFormat(Object.assign({},{img_ori_w:c,img_ori_h:u,bnd_box:s}),e),d=l.split("."),r.abrupt("return",(this.saveFile({content:h,filename:d[0]+".txt",type:"text/plain;charset=utf-8"}),{message:1,msg:"success"}));case 9:if(i){r.next=11;break}return r.abrupt("return",{message:0,msg:"warning.noImageList"});case 11:if(g=this.pushYoloToList(i,e),b=g.yoloList,!g.isEmpty){r.next=16;break}r.t0={message:0,msg:"warning.noLabelSelected"},r.next=24;break;case 16:if(!b){r.next=22;break}return r.next=19,this.saveAsZip(b,o,a);case 19:r.t1={message:1,msg:"success"},r.next=23;break;case 22:r.t1={message:0,msg:"warning.noProgress"};case 23:r.t0=r.t1;case 24:return r.abrupt("return",r.t0);case 25:case"end":return r.stop()}},r,this)}))}},{key:"pushYoloToList",value:function(t,e){var n=this,i=[],a=!0;return t.forEach(function(t){var o=(t.bnd_box?t.bnd_box.map(function(t){return t.label}):[]).some(function(t){return e.indexOf(t)>=0});if(t.bnd_box&&t.bnd_box.length>0&&o){a=!1;var r=n.calBoxCoorOriginalImages(t),s=n.getFileName(t.img_path),l=t.img_ori_w,c=t.img_ori_h,u=n.generateYoloFormat(Object.assign({},{img_ori_w:l,img_ori_h:c,bnd_box:r}),e),h=s.split(".");i.push({filename:h[0]+".txt",content:u})}}),{yoloList:i,isEmpty:a}}},{key:"exportOCR",value:function(t,e,n,i){var a=this;if(!t)return{message:0,msg:"warning.noMetadata"};if(!(null==t?void 0:t.bnd_box))return{message:0,msg:"warning.noBoundingBox"};if(!e)return{message:0,msg:"warning.noImageList"};if(!i)return{message:0,msg:"warning.noImageList"};var o="",r=0;return e.forEach(function(t,e){0===e&&(o+="filename,x1,y1,x2,y2,label\n");var n=a.calBoxCoorOriginalImages(t),s=a.getFileName(t.img_path),l=a.generateOCRFormat({bnd_box:n},s,i);""===l&&r++,o+=""+l}),o&&r!==e.length?(this.saveFile({content:o,filename:n+"_text_ocr_labels.csv",type:"text/csv;charset=utf-8"}),{message:1,msg:"success"}):{message:0,msg:"warning.noProgress"}}},{key:"calBoxCoorOriginalImages",value:function(t){var e=t.bnd_box,n=t.img_w,i=t.img_h,a=t.img_ori_w,o=t.img_ori_h,r=a/n,s=o/i;return e.map(function(t){var e=Object(v.c)(t,["subLabel","region"]),n=t.distancetoImg.x*r,i=n+(t.x2-t.x1)*r,a=t.distancetoImg.y*s,o=a+(t.y2-t.y1)*s;return Object.assign(Object.assign({},e),{x1:n,x2:i,y1:a,y2:o})})}},{key:"calPolyCoorOriginalImages",value:function(t){return t.map(function(t){var e=t.img_ori_w,n=t.img_ori_h,i=t.img_w,a=t.img_h,o=t.polygons,r=Object(v.c)(t,["img_ori_w","img_ori_h","img_w","img_h","polygons"]),s=e/i,l=n/a,c=o.filter(function(t){return t.coorPt.map(function(t){var e=t.distancetoImg;return{distancetoImg:e,x:e.x*s,y:e.y*l}})});return Object.assign(Object.assign({},r),{img_ori_w:e,img_ori_h:n,img_w:i,img_h:a,polygons:c})})}},{key:"generatePascalVocFormat",value:function(n,i){var a=n.bnd_box,o=n.img_path,r=n.img_depth,s=n.img_ori_w,l=n.img_ori_h,c="<annotation>\n",u=this.getItemName("file",o),h=this.getItemName("folder",o),d=this.createNode("folder");c+="\t"+d[0]+h+d[1];var g=this.createNode("filename");c+="\t"+g[0]+u+g[1];var b=this.createNode("path");c+="\t"+b[0]+o.split("\\").join("/")+b[1];var f=this.createNode("source"),m=this.createNode("database");c+="\t"+f[0]+"\n",c+="\t\t"+m[0]+"unknown"+m[1],c+="\t"+f[1];var v=this.createNode("size");c+="\t"+v[0]+"\n";var p=this.createNode("width"),_=this.createNode("height"),y=this.createNode("depth");c+="\t\t"+p[0]+s.toString()+p[1],c+="\t\t"+_[0]+l.toString()+_[1],c+="\t\t"+y[0]+(null==r?void 0:r.toString())+y[1],c+="\t"+v[1];var x=this.createNode("segmented");c+="\t"+x[0]+"0"+x[1];var w,S=this.createNode("object"),k=e(a.entries());try{for(k.s();!(w=k.n()).done;){var C=t(w.value,2),P=(C[0],C[1]),O=P.label,M=P.x1,L=P.x2,I=P.y1,A=P.y2;if(-1!==i.indexOf(O)){c+="\t"+S[0]+"\n";var j=this.createNode("name"),B=this.createNode("pose"),E=this.createNode("truncated"),z=this.createNode("difficult"),D=this.createNode("bndbox"),T=this.createNode("xmin"),N=this.createNode("ymin"),R=this.createNode("xmax"),F=this.createNode("ymax");c+="\t\t"+j[0]+O+j[1],c+="\t\t"+B[0]+"Unspecified"+B[1],c+="\t\t"+E[0]+"0"+E[1],c+="\t\t"+z[0]+"0"+z[1],c+="\t\t"+D[0]+"\n",c+="\t\t\t"+T[0]+Math.floor(M).toString()+T[1],c+="\t\t\t"+N[0]+Math.floor(I).toString()+N[1],c+="\t\t\t"+R[0]+Math.floor(L).toString()+R[1],c+="\t\t\t"+F[0]+Math.floor(A).toString()+F[1],c+="\t\t"+D[1],c+="\t"+S[1]}}}catch(W){k.e(W)}finally{k.f()}return c+="</annotation>"}},{key:"generateYoloFormat",value:function(t,e){var n=t.bnd_box,i=t.img_ori_w,a=t.img_ori_h;return n.reduce(function(t,o,r){var s=o.x1,l=o.x2,c=o.y1,u=o.y2,h=o.label;if(-1===e.indexOf(h))return t;var d=(s+l)/2,g=(c+u)/2,b=l-s,f=u-c;return t+=e.indexOf(h).toString()+" ",t+="".concat((d/i).toString()," ").concat((g/a).toString()," "),t+="".concat((b/i).toString()," ").concat((f/a).toString()," "),r!==n.length&&(t+="\n"),t},"")}},{key:"generateOCRFormat",value:function(t,e,n){return t.bnd_box.reduce(function(t,i){var a=i.x1,o=i.x2,r=i.y1,s=i.y2,l=i.label;return-1===n.indexOf(l)?(t+="".concat(e,",").concat(a.toString(),",").concat(r.toString()),t+=",".concat(o.toString(),",").concat(s.toString(),",").concat(l.toString(),"\n")):t},"")}},{key:"getItemName",value:function(t,e){var n=e.split("\\").join("/").split("/");return"folder"===t?(n.pop(),n.join("/")):n[n.length-1]}},{key:"createNode",value:function(t){return["<"+t+">","</"+t+">\n"]}},{key:"generateLabelFormat",value:function(t){return t.reduce(function(t,e,n){return n!==(t+=e).length?t+"\n":t},"")}},{key:"saveFile",value:function(t){var e=t.content,n=t.filename,i=t.type,a=new Blob([e],{type:i});W.saveAs(a,n)}},{key:"saveAsZip",value:function(n,i,a){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark(function o(){var r,s,l,c,u,h,d,g;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:r=new U,s=e(n.entries());try{for(s.s();!(l=s.n()).done;)(c=t(l.value,2))[0],u=c[1],h=u.content,d=u.filename,r.file(d,h)}catch(b){s.e(b)}finally{s.f()}return o.next=5,r.generateAsync({type:"blob"});case 5:g=o.sent,W.saveAs(g,"".concat(a,"_").concat(i,"_labels.zip"));case 7:case"end":return o.stop()}},o)}))}},{key:"getFileName",value:function(t){var e=t.split("\\").join("/").split("/");return e[e.length-1]}},{key:"getCocoFileName",value:function(t){return t+"_segmentation_coco.json"}},{key:"getJsonFileName",value:function(t){return t+"_segmentation_JSON.json"}},{key:"getCocoContent",value:function(t,e){var n="{";return n+=this.generateCocoInfo(),n+=this.generateCocoImage(t),n+=this.generateCocoAnnotation(t,e),n+=this.generateCocoLicense(),n+=this.generateCocoCategory(e),n=(n+="}").replace(/(}{)/gi,"},{")}},{key:"generateCocoInfo",value:function(){var t=new Date,e='"info":{';return e+='"year":"'.concat(t.getFullYear().toString(),'",'),e+='"version":"1.0",',e+='"description":"VIA project exported to COCO format using classifai(https://classifai.ai/)",',e+='"contributor":"",',e+='"url":"https://classifai.ai/",',e+='"date_created":"'.concat(t.toUTCString(),'"'),e+="},"}},{key:"generateCocoImage",value:function(t){var e=this,n='"images":[';return n=(n+=t.reduce(function(n,i,a){var o=i.img_ori_w,r=i.img_ori_h,s=i.img_path;return n+='{"id":'.concat((a+1).toString(),","),n+='"width":'.concat(o.toString(),","),n+='"height":'.concat(r.toString(),","),n+='"file_name":"'.concat(e.getFileName(s),'",'),n+='"license":0,',n+='"date_captured":""}',a!==t.length&&(n+=","),n},"")).slice(0,-1),n+="],"}},{key:"generateCocoAnnotation",value:function(t,e){var n=this,i='"annotations":[',a=0;return i+=t.reduce(function(i,o,r){if(o.polygons.length>0){a+=1;var s=n.calPolyCoorOriginalImages(t);i+=n.getFilteredPoly(s).reduce(function(t,i,o){var s=i.coorPt,l=i.label,c=Object(v.c)(i,["coorPt","label"]);t+='{"segmentation":[',s.length>0&&(t+="[",t+=n.getPolyCoordinate(s),t+="]");var u=n.getPolyBBox(Object.assign({coorPt:s,label:l},c));return u&&(t+="],",t+='"area":'.concat(((u.x2-u.x1)*(u.y2-u.y1)).toString(),","),t+='"bbox":['.concat(u.x1.toString(),",").concat(u.y1.toString(),",").concat((u.x2-u.x1).toString(),",").concat((u.y2-u.y1).toString(),"],"),t+='"iscrowd":0,',t+='"id":'.concat(a.toString(),","),t+='"image_id":'.concat((r+1).toString(),","),t+='"category_id":'.concat(null==e?void 0:e.indexOf(l),"}")),t},"")}return i},""),i+="]",i+=","}},{key:"getPolyCoordinate",value:function(t){return t.reduce(function(e,n,i){var a=n.x,o=n.y;return e+=a.toString()+",",e+=""+o.toString(),i!==t.length-1&&(e+=","),e},"")}},{key:"getFilteredPoly",value:function(t){return t.map(function(t){return t.polygons})[0]}},{key:"getPolyBBox",value:function(n){var i=n.coorPt;if(i.length>0){var a,o={x1:1e7,x2:-1e8,y1:1e7,y2:-1e8},r=e(i.entries());try{for(r.s();!(a=r.n()).done;){var s=t(a.value,2),l=(s[0],s[1]),c=l.x,u=l.y;c<o.x1&&(o.x1=c),c>o.x2&&(o.x2=c),u<o.y1&&(o.y1=u),u>o.y2&&(o.y2=u)}}catch(h){r.e(h)}finally{r.f()}return o}return null}},{key:"generateCocoLicense",value:function(){return'"licenses":[{"id":1,"name":"APACHE LICENSE, VERSION 2.0","url":"https://www.apache.org/licenses/LICENSE-2.0"}],'}},{key:"generateCocoCategory",value:function(t){var e='"categories":[';return t&&(e+=t.reduce(function(t,e,n){return t+='{"supercategory":"type",',t+='"id":'.concat((n+1).toString(),","),(t+='"name":"'.concat(e,'"'))+"},"},"")),e=e.slice(0,-1),e+="]"}},{key:"getJsonContent",value:function(t){var e=this,n="{";return n=(n+=t.reduce(function(t,n,i){var a=n.polygons,o=n.file_size,r=n.img_path,s=e.getFileName(r),l=o>0?o.toString():"";return(t+=e.generateImageString(a,s,l))+","},"")).slice(0,-1),n+="}"}},{key:"generateImageString",value:function(t,e,n){var i='"'.concat(e,'":{');return i+='"fileref":"",',i+='"size":"'.concat(n,'",'),i+='"filename":"'.concat(e,'",'),i+='"base64_img_data":"",',i+='"file_attributes":{},',i+='"regions":{'.concat(this.generateRegion(t),"}")}},{key:"generateRegion",value:function(t){var e=this;return t.length>0?t.reduce(function(n,i,a){var o=i.coorPt,r=i.label,s=i.region,l=i.subLabel,c="[",u="[";return o.forEach(function(t,e){var n=t.x,i=t.y;c+=n.toString(),u+=i.toString(),e===o.length-1?(c+="]",u+="]"):(c+=",",u+=",")},""),n+='"'.concat(a.toString(),'":{'),n+='"shape_attributes":{"name":"polygon",',n+='"all_points_x":'.concat(c,","),n+='"all_points_y":'.concat(u,"},"),n+='"region_attributes":{"'.concat(r.trim(),'":"').concat(s.trim(),'"'),(n+=0===l.length?"}":e.subLabelExist(l))+(a!==t.length-1?"},":"}}")},""):"}"}},{key:"subLabelExist",value:function(n){var i,a=",",o=e(n.entries());try{for(o.s();!(i=o.n()).done;){var r=t(i.value,2),s=(r[0],r[1]),l=s.label,c=s.region;a+='"'.concat(l.trim(),'":"').concat(c.trim(),'",')}}catch(u){o.e(u)}finally{o.f()}return a=a.slice(0,-1),a+="}"}}]),n}()).\u0275fac=function(t){return new(t||g)},g.\u0275prov=C.Fb({token:g,factory:g.\u0275fac,providedIn:"any"}),g),Y=((d=function(){function t(){r(this,t),this.projectLabelColorListMap=new Map,this.fixedColors=["red","orange","yellow","blue","cyan","royalblue","teal","orangered","coral","slateblue","navy","gold","skyblue","brown","green","indigo","magenta","springgreen","violet","purple"]}return l(t,[{key:"getLabelColors",value:function(t){return t<=this.fixedColors.length-1?this.fixedColors[t]:"hsl(".concat(Math.floor(360*Math.random()),"deg, ").concat(100*Math.random(),"%, 70%")}},{key:"getLabelColorList",value:function(t){return this.projectLabelColorListMap.get(t)}},{key:"setLabelColors",value:function(t,n){var i,a=0,o=new Map,r=e(t);try{for(r.s();!(i=r.n()).done;){var s=i.value;o.set(s,this.getLabelColors(a)),a++}}catch(l){r.e(l)}finally{r.f()}this.setProjectLabelColorListMap(n,o)}},{key:"setProjectLabelColorListMap",value:function(t,e){this.projectLabelColorListMap.set(t,e)}}]),t}()).\u0275fac=function(t){return new(t||d)},d.\u0275prov=C.Fb({token:d,factory:d.\u0275fac,providedIn:"root"}),d),K=s("fll7"),Z=((f=function t(){r(this,t),this.action=new E.a("")}).\u0275fac=function(t){return new(t||f)},f.\u0275prov=C.Fb({token:f,factory:f.\u0275fac,providedIn:"root"}),f),H=((b=function(){function t(){r(this,t)}return l(t,[{key:"transform",value:function(t){return t?window.navigator.platform.startsWith("Mac")||window.navigator.platform.startsWith("Linux")?t.split("/").slice(-1)[0]:t.split("\\").slice(-1)[0]:""}}]),t}()).\u0275fac=function(t){return new(t||b)},b.\u0275pipe=C.Ib({name:"fileNameSlice",type:b,pure:!0}),b),$=s("sYmb");function V(t,e){if(1&t&&(C.Nb(0),C.Kb(1,"div",4),C.Pb(2,"label",6),C.yc(3),C.bc(4,"fileNameSlice"),C.Ob(),C.Mb()),2&t){var n=C.ac();C.xb(1),C.gc("ngClass",n._onChange.hasAnnotation?"indicator":"no-indicator"),C.xb(2),C.zc(C.cc(4,2,n._onChange.thumbnailName))}}function J(t,e){1&t&&C.Kb(0,"label",6)}function G(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"label"),C.yc(2),C.Ob(),C.Mb()),2&t){var n=C.ac(3);C.xb(2),C.Bc("",n._onChange.currentThumbnailIndex||0," / ",n._totalUuid,"")}}function q(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"div",8),C.Pb(2,"img",9),C.Wb("click",function(){return C.qc(n),C.ac().$implicit.onClick()}),C.bc(3,"translate"),C.Ob(),C.Ob(),C.Pb(4,"div",10),C.wc(5,G,3,2,"ng-container",11),C.Ob(),C.Mb()}if(2&t){var i=C.ac(),a=i.$implicit,o=i.index,r=C.ac();C.xb(2),C.gc("src",a.imgPath,C.sc)("alt",a.alt)("title",C.cc(3,5,a.hoverLabel)),C.yb("data-index",o+a.alt),C.xb(3),C.gc("ngIf",r._onChange&&r._onChange.totalNumThumbnail)}}function Q(t,e){if(1&t){var n=C.Qb();C.Pb(0,"div",8),C.Pb(1,"img",9),C.Wb("click",function(){return C.qc(n),C.ac().$implicit.onClick()}),C.bc(2,"translate"),C.Ob(),C.Ob()}if(2&t){var i=C.ac(),a=i.$implicit,o=i.index;C.xb(1),C.gc("src",a.imgPath,C.sc)("alt",a.alt)("title",C.cc(2,4,a.hoverLabel)),C.yb("data-index",o+a.alt)}}function tt(t,e){if(1&t&&(C.Nb(0),C.wc(1,q,6,7,"ng-container",2),C.wc(2,Q,3,6,"ng-template",null,7,C.xc),C.Mb()),2&t){var n=e.index,i=C.nc(3);C.xb(1),C.gc("ngIf",0===n)("ngIfElse",i)}}function et(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",8),C.Pb(2,"img",9),C.Wb("click",function(){return e.$implicit.onClick()}),C.bc(3,"translate"),C.Ob(),C.Ob(),C.Mb()),2&t){var n=e.$implicit,i=e.index;C.xb(2),C.gc("src",n.imgPath,C.sc)("alt",n.alt)("title",C.cc(3,4,n.hoverLabel)),C.yb("data-index",i+n.alt)}}var nt,it=((nt=function(){function t(e,n){var i=this;r(this,t),this._sharedUndoRedoService=e,this.router=n,this._totalUuid=0,this._tabStatus=[],this._onClick=new C.n,this.isTabStillOpen=!0,this.bindImagePath=function(){i.jsonSchema={logosCenter:[{imgPath:"assets/icons/previous.svg",hoverLabel:"labellingInfo.previous",alt:"Previous",onClick:function(){return i.emitParentEvent({thumbnailAction:-1})}},{imgPath:"assets/icons/next.svg",hoverLabel:"labellingInfo.next",alt:"Next",onClick:function(){return i.emitParentEvent({thumbnailAction:1})}}],logosEnd:[{imgPath:"assets/icons/undo.svg",hoverLabel:"labellingInfo.undo",alt:"Undo",onClick:function(){return i.undoRedo("UNDO")}},{imgPath:"assets/icons/redo.svg",hoverLabel:"labellingInfo.redo",alt:"Redo",onClick:function(){return i.undoRedo("REDO")}}]}},this.emitParentEvent=function(t){var e=t.url,n=t.thumbnailAction;i._onClick.emit({url:e,thumbnailAction:n})}}return l(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"undoRedo",value:function(t){var e=this.router.url;"UNDO"===t&&("/imglabel/bndbox"===e&&this._sharedUndoRedoService.action.next("BBOX_UNDO"),"/imglabel/seg"===e&&this._sharedUndoRedoService.action.next("SEG_UNDO")),"REDO"===t&&("/imglabel/bndbox"===e&&this._sharedUndoRedoService.action.next("BBOX_REDO"),"/imglabel/seg"===e&&this._sharedUndoRedoService.action.next("SEG_REDO"))}},{key:"ngOnChanges",value:function(t){if(t._onChange){var n=t._onChange.currentValue.totalNumThumbnail;this._onChange.totalNumThumbnail=n,this.bindImagePath()}if(t._tabStatus){this.isTabStillOpen=!1;var i,a=e(this._tabStatus);try{for(a.s();!(i=a.n()).done;)if(!i.value.closed){this.isTabStillOpen=!0;break}}catch(o){a.e(o)}finally{a.f()}}}}]),t}()).\u0275fac=function(t){return new(t||nt)(C.Jb(Z),C.Jb(P.a))},nt.\u0275cmp=C.Db({type:nt,selectors:[["image-labelling-info"]],inputs:{_totalUuid:"_totalUuid",_onChange:"_onChange",_tabStatus:"_tabStatus"},outputs:{_onClick:"_onClick"},features:[C.vb],decls:9,vars:6,consts:[[1,"info-container"],[1,"container-flex-start"],[4,"ngIf","ngIfElse"],["defaultName",""],[3,"ngClass"],[4,"ngFor","ngForOf"],[1,"imageTitle"],["renderOtherIcons",""],[1,"utility-icon-container"],[1,"utility-icon-light",3,"src","alt","title","click"],[1,"totalThumbnail"],[4,"ngIf"]],template:function(t,e){if(1&t&&(C.Pb(0,"div",0),C.Pb(1,"div",1),C.wc(2,V,5,4,"ng-container",2),C.wc(3,J,1,0,"ng-template",null,3,C.xc),C.Ob(),C.Pb(5,"div",4),C.wc(6,tt,4,2,"ng-container",5),C.Ob(),C.Pb(7,"div",4),C.wc(8,et,4,6,"ng-container",5),C.Ob(),C.Ob()),2&t){var n=C.nc(4);C.xb(2),C.gc("ngIf",e._onChange.thumbnailName)("ngIfElse",n),C.xb(3),C.gc("ngClass",e.isTabStillOpen?"container-flex-center":"container-flex-center-adjust"),C.xb(1),C.gc("ngForOf",e.jsonSchema.logosCenter),C.xb(1),C.gc("ngClass",e.isTabStillOpen?"container-flex-end":"container-flex-end-adjust"),C.xb(1),C.gc("ngForOf",e.jsonSchema.logosEnd)}},directives:[m.l,m.j,m.k],pipes:[H,$.c],styles:[".info-container[_ngcontent-%COMP%]{min-width:100vw;max-width:100vw;min-height:4vh;max-height:4vh;background:#525353;border-bottom:.0625vw solid hsla(0,0%,100%,.25);display:flex;justify-content:space-between;z-index:1;position:absolute}.utility-icon-container[_ngcontent-%COMP%]{display:flex;min-height:3.5vh;max-height:3.5vh;min-width:2vw;max-width:2vw}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:2.2vh;max-height:2.2vh;padding:.3vw;position:fixed;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.container-flex-start[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:3vw;min-height:inherit;max-height:inherit}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:aboslute}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.imageTitle[_ngcontent-%COMP%]{font-size:1.7vh;color:#fff;align-items:center;margin-left:1vw;max-width:20vw;min-width:20vw;position:absolute;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.container-flex-center[_ngcontent-%COMP%]{margin-left:8vw}.container-flex-center[_ngcontent-%COMP%], .container-flex-center-adjust[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:inherit;max-height:inherit}.container-flex-center-adjust[_ngcontent-%COMP%]{margin-left:2vw}.totalThumbnail[_ngcontent-%COMP%]{font-size:1.7vh;padding:.4vw 1vw 0;display:inline-block;color:#fff;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.container-flex-end[_ngcontent-%COMP%]{display:flex;margin-right:19vw}.container-flex-end-adjust[_ngcontent-%COMP%]{display:flex;margin-right:3vw}"],changeDetection:0}),nt),at=s("oSzE"),ot=s("DlmY");function rt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new ot.a;++e<n;)this.add(t[e])}rt.prototype.add=rt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},rt.prototype.has=function(t){return this.__data__.has(t)};var st,lt=rt,ct=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},ut=function(t,e,n,i,a,o){var r=1&n,s=t.length,l=e.length;if(s!=l&&!(r&&l>s))return!1;var c=o.get(t);if(c&&o.get(e))return c==e;var u=-1,h=!0,d=2&n?new lt:void 0;for(o.set(t,e),o.set(e,t);++u<s;){var g=t[u],b=e[u];if(i)var f=r?i(b,g,u,e,t,o):i(g,b,u,t,e,o);if(void 0!==f){if(f)continue;h=!1;break}if(d){if(!ct(e,function(t,e){if(!d.has(e)&&(g===t||a(g,t,n,i,o)))return d.push(e)})){h=!1;break}}else if(g!==b&&!a(g,b,n,i,o)){h=!1;break}}return o.delete(t),o.delete(e),h},ht=s("ylTp"),dt=s("Ce4a"),gt=s("YHEm"),bt=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n},ft=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},mt=ht.a?ht.a.prototype:void 0,vt=mt?mt.valueOf:void 0,pt=s("TFwu"),_t=Object.prototype.hasOwnProperty,yt=s("YM6B"),xt=s("/1FC"),wt=s("WOAq"),St=s("oYcn"),kt="[object Object]",Ct=Object.prototype.hasOwnProperty,Pt=s("EUcb"),Ot=function t(e,n,i,a,o){return e===n||(null==e||null==n||!Object(Pt.a)(e)&&!Object(Pt.a)(n)?e!=e&&n!=n:function(t,e,n,i,a,o){var r=Object(xt.a)(t),s=Object(xt.a)(e),l=r?"[object Array]":Object(yt.a)(t),c=s?"[object Array]":Object(yt.a)(e),u=(l="[object Arguments]"==l?kt:l)==kt,h=(c="[object Arguments]"==c?kt:c)==kt,d=l==c;if(d&&Object(wt.a)(t)){if(!Object(wt.a)(e))return!1;r=!0,u=!1}if(d&&!u)return o||(o=new at.a),r||Object(St.a)(t)?ut(t,e,n,i,a,o):function(t,e,n,i,a,o,r){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new dt.a(t),new dt.a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Object(gt.a)(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=bt;case"[object Set]":if(s||(s=ft),t.size!=e.size&&!(1&i))return!1;var l=r.get(t);if(l)return l==e;i|=2,r.set(t,e);var c=ut(s(t),s(e),i,a,o,r);return r.delete(t),c;case"[object Symbol]":if(vt)return vt.call(t)==vt.call(e)}return!1}(t,e,l,n,i,a,o);if(!(1&n)){var g=u&&Ct.call(t,"__wrapped__"),b=h&&Ct.call(e,"__wrapped__");if(g||b){var f=g?t.value():t,m=b?e.value():e;return o||(o=new at.a),a(f,m,n,i,o)}}return!!d&&(o||(o=new at.a),function(t,e,n,i,a,o){var r=1&n,s=Object(pt.a)(t),l=s.length;if(l!=Object(pt.a)(e).length&&!r)return!1;for(var c=l;c--;){var u=s[c];if(!(r?u in e:_t.call(e,u)))return!1}var h=o.get(t);if(h&&o.get(e))return h==e;var d=!0;o.set(t,e),o.set(e,t);for(var g=r;++c<l;){var b=t[u=s[c]],f=e[u];if(i)var m=r?i(f,b,u,e,t,o):i(b,f,u,t,e,o);if(!(void 0===m?b===f||a(b,f,n,i,o):m)){d=!1;break}g||(g="constructor"==u)}if(d&&!g){var v=t.constructor,p=e.constructor;v==p||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof p&&p instanceof p||(d=!1)}return o.delete(t),o.delete(e),d}(t,e,n,i,a,o))}(e,n,i,a,t,o))},Mt=function(t,e){return Ot(t,e)},Lt={move:!1,pointer:!1,grab:!1,grabbing:!1,crosshair:!1,default:!1,"zoom-in":!1,"zoom-out":!1,"n-resize":!1,"w-resize":!1,"ne-resize":!1,"nw-resize":!1,"se-resize":!1,"sw-resize":!1},It=((st=function(){function e(){var t=this;r(this,e),this.mouseCursorSubject=new E.a(Lt),this.mouseCursor$=this.mouseCursorSubject.asObservable(),this.setState=function(e){t.mouseCursorSubject.next(e?Object.assign(Object.assign({},Lt),e):Lt)}}return l(e,[{key:"changeCursor",value:function(e,n){if(n){var i=n.wheelDelta,a=n.detail;void 0!==i?150===i?this.setState({"zoom-in":!0}):-150===i&&this.setState({"zoom-out":!0}):3===a?this.setState({"zoom-in":!0}):-3===a&&this.setState({"zoom-out":!0})}else for(var o=0,r=Object.entries(e);o<r.length;o++){var s=t(r[o],2),l=s[0];if(!0===s[1])return l}}}]),e}()).\u0275fac=function(t){return new(t||st)},st.\u0275prov=C.Fb({token:st,factory:st.\u0275fac,providedIn:"any"}),st);function At(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"img",4),C.Wb("click",function(){C.qc(n);var t=C.ac(),e=t.index,i=t.$implicit;return C.ac().getIndex(e),i.onClick()}),C.bc(2,"translate"),C.Ob(),C.Mb()}if(2&t){var i=C.ac(),a=i.$implicit,o=i.index,r=C.ac();C.xb(1),C.gc("ngClass",r.conditionalIconTheme(!(null==a||!a.nonClickable)))("ngStyle",(null==a?null:a.toggleable)&&r.conditionalActiveIcon(o))("src",a.imgPath,C.sc)("alt",a.alt)("title",C.cc(2,6,a.hoverLabel)),C.yb("data-index",o)}}function jt(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",2),C.wc(2,At,3,8,"ng-container",3),C.Ob(),C.Mb()),2&t){var n=e.$implicit;C.xb(2),C.gc("ngIf",n)}}var Bt,Et,zt,Dt=((Bt=function(){function t(e,n,i){var a=this;r(this,t),this._imgLabelState=e,this._annotateService=n,this._mouseCursorService=i,this._currentUrl="",this._tabStatus=[],this._clickAbilityToggleStatus=!1,this._navigate=new C.n,this._modalNoLabel=new C.n,this._clickAbilityToggle=new C.n,this.labelList=[],this.isCrossLineOn=!1,this.updateLabelList=function(){a.labelList=a._tabStatus[1].label_list?a._tabStatus[1].label_list:[]},this.resetSelectedAnnotate=function(){a._annotateService.setState()},this.bindImagePath=function(){a.jsonSchema={logos:[{imgPath:"assets/icons/separator.svg",hoverLabel:"",alt:"",nonClickable:!0,toggleable:!1,onClick:function(){return null}},{imgPath:"assets/icons/pointer.svg",hoverLabel:"leftSideBar.pointer",alt:"Pointer",toggleable:!0,onClick:function(){a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!1,drag:!0,scroll:!0}),a.emitClickAbilityToggleStatus(a._clickAbilityToggleStatus)}},"/imglabel/bndbox"===a._currentUrl?{imgPath:"assets/icons/rec_bounding_box.svg",hoverLabel:"leftSideBar.rectangularBB",alt:"RectangularBB",toggleable:!0,onClick:function(){a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!0,drag:!1,scroll:!1,crossLine:a.isCrossLineOn})}}:{imgPath:"assets/icons/polygon.svg",hoverLabel:"leftSideBar.polygon",alt:"Polygon",toggleable:!0,onClick:function(){0!==a.labelList.length?(a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!0,drag:!1,scroll:!1})):a.showAlertNoLabel()}},{imgPath:a.isCrossLineOn?"assets/icons/indicator_on.svg":"assets/icons/indicator.svg",hoverLabel:a.isCrossLineOn?"leftSideBar.offCrossLine":"leftSideBar.onCrossLine",alt:"Cross Guiding Line",toggleable:!1,onClick:function(){a.isCrossLineOn=!a.isCrossLineOn,a.bindImagePath(),2===a.iconIndex&&a._imgLabelState.setState({draw:!0,drag:!1,scroll:!1,crossLine:a.isCrossLineOn})}},{imgPath:"assets/icons/eraser.svg",hoverLabel:"leftSideBar.eraser",alt:"Eraser",toggleable:!1,onClick:function(){a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!0}),a._imgLabelState.setState(null),a.emitClickAbilityToggleStatus(a._clickAbilityToggleStatus)}},{imgPath:"assets/icons/fit_center.svg",hoverLabel:"leftSideBar.fitCenter",alt:"Fit Center",toggleable:!1,onClick:function(){a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!0,scroll:!1}),a._imgLabelState.setState(null),a.emitClickAbilityToggleStatus(a._clickAbilityToggleStatus)}},{imgPath:"assets/icons/save.svg",hoverLabel:"leftSideBar.save",alt:"Save",toggleable:!1,onClick:function(){a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1,save:!0,keyInfo:!1}),a.emitClickAbilityToggleStatus(a._clickAbilityToggleStatus)}},{imgPath:"assets/icons/info.svg",hoverLabel:"leftSideBar.info",alt:"KeyPoint",toggleable:!1,onClick:function(){a.resetSelectedAnnotate(),a._imgLabelState.setState({draw:!1,drag:!1,fitCenter:!1,scroll:!1,clear:!1,save:!1,keyInfo:!0}),a.emitClickAbilityToggleStatus(a._clickAbilityToggleStatus)}}]}},this.checkStateEqual=function(t,e){return!Mt(t,e)},this.getIndex=function(t){3!==t&&(a.iconIndex=t)},this.conditionalIconTheme=function(t){return t?"plain-icon":"utility-icon-light"},this.conditionalActiveIcon=function(t){return t===a.iconIndex?{background:"rgb(59 59 59)"}:null}}return l(t,[{key:"ngOnInit",value:function(){this.updateLabelList(),this.bindImagePath()}},{key:"ngOnChanges",value:function(t){if(this.bindImagePath(),t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){var e=t._tabStatus.currentValue;this._tabStatus=i(e),this.updateLabelList()}}},{key:"showAlertNoLabel",value:function(){alert("No label exist yet. Please add new label.")}},{key:"keyStrokeEvent",value:function(t){var e=t.altKey,n=t.key;try{!e||"z"!==n&&"Z"!==n?!e||"a"!==n&&"A"!==n?!e||"x"!==n&&"X"!==n||(this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!1,scroll:!1,crossLine:!1}),this._mouseCursorService.setState({default:!0}),this.getIndex(0),this.emitClickAbilityToggleStatus(this._clickAbilityToggleStatus)):(this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!0,drag:!1,scroll:!1,crossLine:this.isCrossLineOn}),this.getIndex(2)):(this.resetSelectedAnnotate(),this._imgLabelState.setState({draw:!1,drag:!0,scroll:!0}),this.getIndex(1),this.emitClickAbilityToggleStatus(this._clickAbilityToggleStatus))}catch(i){console.log(i)}}},{key:"emitClickAbilityToggleStatus",value:function(t){t&&this._clickAbilityToggle.emit(!1)}}]),t}()).\u0275fac=function(t){return new(t||Bt)(C.Jb(T.a),C.Jb(D),C.Jb(It))},Bt.\u0275cmp=C.Db({type:Bt,selectors:[["image-labelling-left-sidebar"]],hostBindings:function(t,e){1&t&&C.Wb("keydown",function(t){return e.keyStrokeEvent(t)},!1,C.pc)},inputs:{_onChange:"_onChange",_currentUrl:"_currentUrl",_tabStatus:"_tabStatus",_clickAbilityToggleStatus:"_clickAbilityToggleStatus"},outputs:{_navigate:"_navigate",_modalNoLabel:"_modalNoLabel",_clickAbilityToggle:"_clickAbilityToggle"},features:[C.vb],decls:2,vars:1,consts:[[1,"utility-left-sidebar-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[4,"ngIf"],[3,"ngClass","ngStyle","src","alt","title","click"]],template:function(t,e){1&t&&(C.Pb(0,"div",0),C.wc(1,jt,3,1,"ng-container",1),C.Ob()),2&t&&(C.xb(1),C.gc("ngForOf",e.jsonSchema.logos))},directives:[m.k,m.l,m.j,m.m],pipes:[$.c],styles:[".utility-left-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.14vw;max-width:2.14vw;min-height:95.4vh;max-height:95.4vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-icon-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh;align-items:baseline}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}.plain-icon[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:auto}"],changeDetection:0}),Bt),Tt=function(){function t(){r(this,t)}return l(t,[{key:"stringifyObject",value:function(t){try{return JSON.stringify(t)}catch(e){return console.log("StringifyObject(content) ----\x3e ",e.name+": ",e.message),""}}},{key:"deepCloneObject",value:function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.log("DeepCloneObject(content) ----\x3e ",e.name+": ",e.message),null}}},{key:"deepCloneVariable",value:function(t){try{return(t?JSON.parse(JSON.stringify({item:t})):"").item}catch(e){return console.log("DeepCloneVariable(variable) ----\x3e ",e.name+": ",e.message),""}}},{key:"generateUniquesID",value:function(){try{var t="",e=new Date;return t+=e.getDate().toString(),t+=(e.getMonth()+1).toString(),t+=e.getFullYear().toString(),t+=e.getHours().toString(),t+=e.getMinutes().toString(),t+=e.getSeconds().toString(),t+=e.getMilliseconds().toString(),parseInt(t,10)}catch(n){return console.log("GenerateUniquesID() ----\x3e ",n.name+": ",n.message),-1}}},{key:"matchStringHead",value:function(t,e){try{return e.substr(0,t.length)===t}catch(n){return console.log("MatchStringHead(StrToMatch:string, oristr:string) ----\x3e ",n.name+": ",n.message),!1}}},{key:"getFilename",value:function(t){try{var e=this.deepCloneVariable(t).split("\\").join("/").split("/");return e[e.length-1]}catch(n){return console.log("GetFilename(strs) ----\x3e ",n.name+": ",n.message),""}}},{key:"GetFoldername",value:function(t){try{var e=JSON.parse(JSON.stringify({st:t})).st.split("\\").join("/").split("/");return e.pop(),e.join("/")}catch(n){return console.log("GetFoldername(strs) ----\x3e ",n.name+": ",n.message),""}}},{key:"RemoveHTMLElement",value:function(t){var e;try{var n=document.getElementById(t);null!=n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}catch(i){console.log("RemoveHTMLElement(ids) ----\x3e ",i.name+": ",i.message)}}}]),t}(),Nt=((zt=function(){function n(){r(this,n),this.currentArr=[],this.undoArr=[],this.redoArr=[],this.maxStageSize=51,this.allowUndo=!1,this.allowRedo=!1,this.utility=new Tt,this.removeLastArray=function(t){return t.splice(-1,1)[0]}}return l(n,[{key:"getCurrentArray",value:function(){return{undoArr:this.undoArr,redoArr:this.redoArr,curr:this.currentArr}}},{key:"appendStages",value:function(t){t&&(this.redoArr=[],this.allowRedo=!1,0===this.currentArr.length?this.currentArr.push(this.utility.deepCloneVariable(t)):this.currentArrExist(t))}},{key:"currentArrExist",value:function(t){this.undoArr.length===this.maxStageSize&&this.undoArr.splice(0,1),this.undoArr.push(this.removeLastArray(this.currentArr)),this.currentArr.push(this.utility.deepCloneVariable(t)),this.allowUndo=!0}},{key:"clearAllStages",value:function(){this.currentArr=[],this.undoArr=[],this.redoArr=[],this.allowUndo=!1,this.allowRedo=!1}},{key:"undo",value:function(){if(this.allowRedo=!0,this.undoArr.length>0){this.redoArr.push(this.removeLastArray(this.currentArr));var t=this.removeLastArray(this.undoArr);return this.currentArr.push(t),this.allowUndo=0!==this.undoArr.length,t}return null}},{key:"redo",value:function(){var t=null;return 0!==this.redoArr.length&&(this.undoArr.push(this.removeLastArray(this.currentArr)),t=this.removeLastArray(this.redoArr),this.currentArr.push(t),this.allowRedo=0!==this.redoArr.length),this.allowUndo=this.undoArr.length>0,t}},{key:"clearRedundantStages",value:function(){var t,e;(null===(t=this.currentArr[0])||void 0===t?void 0:t.meta)&&"polygons"in this.currentArr[0].meta||!(this.undoArr.length>0)||this.isStateChange((null===(e=this.undoArr[this.undoArr.length-1])||void 0===e?void 0:e.meta).bnd_box)&&(this.currentArr.pop(),this.currentArr.push(this.removeLastArray(this.undoArr)))}},{key:"isAllowRedo",value:function(){return this.allowRedo}},{key:"isAllowUndo",value:function(){return this.allowUndo}},{key:"isMethodChange",value:function(t){var e;return(null===(e=this.currentArr[0])||void 0===e?void 0:e.method)!==t}},{key:"replaceStages",value:function(t){t&&(this.currentArr[0]=this.utility.deepCloneVariable(t))}},{key:"isStateChange",value:function(t){return!!t&&!!(t&&this.isAnnotationChange(t)||this.isLabelChange(t))}},{key:"isLabelChange",value:function(n){var i,a,o,r;if((null===(i=this.currentArr[0])||void 0===i?void 0:i.meta)&&"polygons"in(null===(a=this.currentArr[0])||void 0===a?void 0:a.meta)){var s=n,l=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).polygons;if(s.length!==l.length)return!0;var c,u=e(l.entries());try{for(u.s();!(c=u.n()).done;){var h=t(c.value,2),d=h[0];if(h[1].label!==s[d].label)return!0}}catch(y){u.e(y)}finally{u.f()}}else{var g=n,b=(null===(r=this.currentArr[0])||void 0===r?void 0:r.meta).bnd_box;if(g.length!==b.length)return!0;var f,m=e(b.entries());try{for(m.s();!(f=m.n()).done;){var v=t(f.value,2),p=v[0],_=v[1].label;if(g[p].label!==_)return!0}}catch(y){m.e(y)}finally{m.f()}}return!1}},{key:"isAnnotationChange",value:function(n){var i,a,o,r;if((null===(i=this.currentArr[0])||void 0===i?void 0:i.meta)&&"polygons"in(null===(a=this.currentArr[0])||void 0===a?void 0:a.meta)){if(this.currentArr.length<1)return!0;var s=n,l=(null===(o=this.currentArr[0])||void 0===o?void 0:o.meta).polygons;return s.length!==l.length||!!l.some(function(t,e){var n=t.coorPt;return s.some(function(t,i){var a=t.coorPt;return n[e].x!==a[i].x||n[e].y!==a[i].y})})||null}if(this.currentArr.length<1)return!0;var c=n,u=(null===(r=this.currentArr[0])||void 0===r?void 0:r.meta).bnd_box;if(c.length!==u.length)return!0;var h,d=e(c.entries());try{for(d.s();!(h=d.n()).done;){var g=t(h.value,2),b=g[0],f=g[1],m=f.x1,v=f.x2,p=f.y1,_=f.y2,y=f.label;if(Math.ceil(m)!==Math.ceil(u[b].x1)||Math.ceil(v)!==Math.ceil(u[b].x2)||Math.ceil(p)!==Math.ceil(u[b].y1)||Math.ceil(_)!==Math.ceil(u[b].y2)||y!==u[b].label)return!0}}catch(x){d.e(x)}finally{d.f()}return!1}}]),n}()).\u0275fac=function(t){return new(t||zt)},zt.\u0275prov=C.Fb({token:zt,factory:zt.\u0275fac,providedIn:"any"}),zt),Rt=((Et=function(){function t(e){var n=this;r(this,t),this.el=e,this.srcAttr=null,this.canLazyLoad=function(){return window&&"IntersectionObserver"in window},this.lazyLoadImage=function(){new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting?n.loadImage():n.unloadImage()})}).observe(n.el.nativeElement)},this.loadImage=function(){n.srcAttr=n.src},this.unloadImage=function(){n.srcAttr=""}}return l(t,[{key:"ngAfterViewInit",value:function(){this.canLazyLoad()?this.lazyLoadImage():this.loadImage()}}]),t}()).\u0275fac=function(t){return new(t||Et)(C.Jb(C.l))},Et.\u0275dir=C.Eb({type:Et,selectors:[["img","imgLazyLoad",""]],hostVars:1,hostBindings:function(t,e){2&t&&C.yb("src",e.srcAttr,C.sc)},inputs:{src:"src"}}),Et),Ft=s("3Pt+"),Wt=["thumbnailList"],Ut=function(t,e){return{i:t,tab:e}};function Xt(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",9),C.Lb(2,10),C.Ob(),C.Mb()),2&t){var n=e.$implicit,i=e.index,a=C.ac(2),o=C.nc(2),r=C.nc(4);C.xb(1),C.gc("ngClass",a.checkCloseToggle(n)),C.yb("data-index",i),C.xb(1),C.gc("ngTemplateOutlet",0===i?o:r)("ngTemplateOutletContext",C.kc(4,Ut,i,n))}}function Yt(t,e){if(1&t&&(C.Pb(0,"div",7),C.wc(1,Xt,3,7,"ng-container",8),C.Ob()),2&t){var n=C.ac();C.xb(1),C.gc("ngForOf",n._tabStatus)}}var Kt=function(t){return{"img-selected":t}};function Zt(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"div",17),C.Wb("click",function(){C.qc(n);var t=e.$implicit,i=e.index;return C.ac(2).onClick(t,i)}),C.Pb(2,"div",18),C.Kb(3,"img",19),C.Ob(),C.Pb(4,"div",20),C.Pb(5,"label",21),C.yc(6),C.bc(7,"fileNameSlice"),C.Ob(),C.Ob(),C.Pb(8,"div",22),C.Pb(9,"img",23),C.Wb("click",function(){C.qc(n);var t=e.$implicit;return C.ac(2).renameImage(t)}),C.bc(10,"translate"),C.Ob(),C.Pb(11,"img",24),C.Wb("click",function(){C.qc(n);var t=e.$implicit,i=e.index;return C.ac(2).deleteImage(t,i)}),C.bc(12,"translate"),C.Ob(),C.Ob(),C.Pb(13,"div"),C.Kb(14,"div",25),C.Ob(),C.Ob(),C.Mb()}if(2&t){var i=e.$implicit,a=e.index,o=C.ac(2);C.xb(1),C.gc("ngClass",C.jc(12,Kt,a===o._onChange.currentThumbnailIndex-1)),C.xb(2),C.gc("src",i.img_thumbnail,C.sc),C.xb(3),C.zc(C.cc(7,6,i.img_path)),C.xb(3),C.gc("title",C.cc(10,8,"renameModal.renameImg")),C.xb(2),C.gc("title",C.cc(12,10,"Delete Image")),C.xb(3),C.gc("ngClass",(null==i.bnd_box?null:i.bnd_box.length)>0||(null==i.polygons?null:i.polygons.length)>0?"indicator":"no-indicator")}}function Ht(t,e){if(1&t){var n=C.Qb();C.Pb(0,"label",11),C.yc(1),C.bc(2,"translate"),C.Ob(),C.Pb(3,"div",12),C.Pb(4,"span",13),C.Pb(5,"div",14),C.Wb("click",function(){C.qc(n);var t=e.tab;return C.ac().onClose(t)}),C.yc(6,"\u2716"),C.Ob(),C.Ob(),C.Ob(),C.Pb(7,"div",15,16),C.Wb("scroll",function(){return C.qc(n),C.ac().mouseScroll()}),C.wc(9,Zt,15,14,"ng-container",8),C.Ob()}if(2&t){var i=e.tab,a=C.ac();C.xb(1),C.Cc("",C.cc(2,4,i.name)," (",a._thumbnailList.length,"/",a._totalUuid,")"),C.xb(8),C.gc("ngForOf",a._thumbnailList)}}function $t(t,e){if(1&t&&C.Lb(0,10),2&t){var n=e.i,i=e.tab;C.ac();var a=C.nc(6),o=C.nc(8);C.gc("ngTemplateOutlet",1===n?a:o)("ngTemplateOutletContext",C.kc(2,Ut,n,i))}}function Vt(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"span",35),C.Wb("click",function(){C.qc(n);var t=C.ac().$implicit;return C.ac(2).onDeleteLabel(t)}),C.yc(2,"x"),C.Ob(),C.Mb()}if(2&t){var i=C.ac(3);C.xb(1),C.gc("ngClass",i.clickAbilityToggle?"pointer":null)}}function Jt(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"div",31),C.Pb(2,"label",32),C.Pb(3,"div",33),C.Wb("click",function(){C.qc(n);var t=e.$implicit,i=C.ac(2);return i.clickAbilityToggle?i.onClickLabel(t):null}),C.yc(4),C.Ob(),C.Ob(),C.Pb(5,"label"),C.wc(6,Vt,3,1,"ng-container",34),C.Ob(),C.Ob(),C.Mb()}if(2&t){var i=e.$implicit,a=C.ac(2);C.xb(1),C.gc("ngClass",i===a.selectedLabel?"label-active":null),C.xb(2),C.gc("ngClass",a.clickAbilityToggle?"pointer":null),C.xb(1),C.Ac(" ",i," "),C.xb(2),C.gc("ngIf",i===a.selectedLabel)}}function Gt(t,e){1&t&&(C.Pb(0,"label",36),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.Ac(" ",C.cc(2,1,"labellingProject.labelNotExist")," "))}function qt(t,e){if(1&t){var n=C.Qb();C.Pb(0,"label",11),C.yc(1),C.bc(2,"translate"),C.Ob(),C.Pb(3,"div",12),C.Pb(4,"span",13),C.Pb(5,"div",14),C.Wb("click",function(){C.qc(n);var t=e.tab;return C.ac().onClose(t)}),C.yc(6,"\u2716"),C.Ob(),C.Ob(),C.Ob(),C.Pb(7,"div",26),C.Pb(8,"input",27),C.Wb("ngModelChange",function(t){return C.qc(n),C.ac().inputLabel=t})("ngModelChange",function(t){return C.qc(n),C.ac().inputLabelChange(t)})("keydown.enter",function(t){return C.qc(n),C.ac().validateInputLabel(t)}),C.bc(9,"translate"),C.Ob(),C.Ob(),C.Pb(10,"div",28),C.Pb(11,"div",29),C.wc(12,Jt,7,4,"ng-container",8),C.wc(13,Gt,3,3,"label",30),C.Ob(),C.Ob()}if(2&t){var i=e.tab,a=C.ac();C.xb(1),C.zc(C.cc(2,6,i.name)),C.xb(7),C.gc("ngClass",a.invalidInput?"input-invalid":null)("ngModel",a.inputLabel)("placeholder",C.cc(9,8,"labellingProject.enterLabel")),C.xb(4),C.gc("ngForOf",a.labelList),C.xb(1),C.gc("ngIf",0===a.labelList.length)}}var Qt=function(t){return{annotation:t}};function te(t,e){if(1&t&&(C.Nb(0),C.Lb(1,10),C.Mb()),2&t){var n=e.$implicit;C.ac(3);var i=C.nc(10),a=C.nc(12);C.xb(1),C.gc("ngTemplateOutlet",n.bnd_box?i:a)("ngTemplateOutletContext",C.jc(2,Qt,n))}}function ee(t,e){if(1&t&&(C.Nb(0),C.wc(1,te,2,4,"ng-container",8),C.Mb()),2&t){var n=C.ac().tab;C.xb(1),C.gc("ngForOf",n.annotation)}}function ne(t,e){if(1&t){var n=C.Qb();C.Pb(0,"label",11),C.yc(1),C.bc(2,"translate"),C.Ob(),C.Pb(3,"div",12),C.Pb(4,"span",13),C.Pb(5,"div",14),C.Wb("click",function(){C.qc(n);var t=e.tab;return C.ac().onClose(t)}),C.yc(6,"\u2716"),C.Ob(),C.Ob(),C.Ob(),C.Pb(7,"div",37),C.Pb(8,"div",29),C.Pb(9,"div",38),C.wc(10,ee,2,1,"ng-container",34),C.Ob(),C.Ob(),C.Ob()}if(2&t){var i=e.tab;C.xb(1),C.zc(C.cc(2,2,i.name)),C.xb(9),C.gc("ngIf",null==i?null:i.annotation)}}function ie(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"label",39),C.Wb("click",function(){C.qc(n);var t=e.index,i=e.$implicit,a=C.ac(2);return a.clickAbilityToggle?a.onClickAnnotation(t,i):null}),C.Pb(2,"div",25),C.yc(3),C.Ob(),C.Ob(),C.Mb()}if(2&t){var i=e.$implicit,a=e.index,o=C.ac(2);C.xb(1),C.gc("ngClass",a===o.selectedIndexAnnotation?"annotation-active":null),C.yb("data-index",a),C.xb(1),C.gc("ngClass",o.clickAbilityToggle?"pointer":null),C.xb(1),C.Bc("",i.label," : ",i.id,"")}}function ae(t,e){1&t&&C.wc(0,ie,4,5,"ng-container",8),2&t&&C.gc("ngForOf",e.annotation.bnd_box)}function oe(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"label",39),C.Wb("click",function(){C.qc(n);var t=e.index,i=e.$implicit,a=C.ac(2);return a.clickAbilityToggle?a.onClickAnnotation(t,i):null}),C.Pb(2,"div",25),C.yc(3),C.Ob(),C.Ob(),C.Mb()}if(2&t){var i=e.$implicit,a=e.index,o=C.ac(2);C.xb(1),C.gc("ngClass",a===o.selectedIndexAnnotation?"annotation-active":null),C.yb("data-index",a),C.xb(1),C.gc("ngClass",o.clickAbilityToggle?"pointer":null),C.xb(1),C.Bc("",i.label," : ",i.id,"")}}function re(t,e){1&t&&C.wc(0,oe,4,5,"ng-container",8),2&t&&C.gc("ngForOf",e.annotation.polygons)}var se,le=((se=function(){function n(e,a,o,s,l){var c=this;r(this,n),this._annotateService=e,this._imgLblState=a,this._languageService=o,this._undoRedoService=s,this._labelColorService=l,this._totalUuid=0,this._thumbnailList=[],this._tabStatus=[],this._onClose=new C.n,this._onClickThumbnail=new C.n,this._onClickLabel=new C.n,this._onEnterLabel=new C.n,this._onChangeAnnotationLabel=new C.n,this._onDeleteAnnotation=new C.n,this._loadMoreThumbnails=new C.n,this._onRenameImage=new C.n,this._onDeleteImage=new C.n,this._clickAbilityToggleStatus=new C.n,this._refreshLabelColor=new C.n,this.action=-1,this.displayInputLabel=!1,this.inputLabel="",this.selectedIndexAnnotation=-1,this.selectedLabel="",this.unsubscribe$=new x.a,this.clickAbilityToggle=!1,this.invalidInput=!1,this.labelList=[],this.isTabStillOpen=!0,this.tempMax=0,this.max=0,this.updateLabelList=function(){c.labelList=c._tabStatus[1].label_list?c._tabStatus[1].label_list:[],c.pickRandomColorForLabel()},this.onClose=function(t){c._onClose.emit({name:t.name,closed:!0})},this.onClick=function(t,e){c._onClickThumbnail.emit(Object.assign(Object.assign({},t),{thumbnailIndex:e})),c.selectedIndexAnnotation=-1,c.selectedLabel=""},this.onDisplayInputModal=function(){c.displayInputLabel=!c.displayInputLabel,c.inputLabel=""},this.validateInputLabel=function(t){var e=t.target.value,n=e.trim();if(n)if(n.match(/^[a-zA-Z0-9-]*$/))if(c._tabStatus.some(function(t){var e=t.label_list;return e&&e.length&&e.some(function(t){return t===n})}))c.invalidInput=!0,console.error("Invalid existing label input");else{c.invalidInput=!1;var a=c._tabStatus.map(function(t){return t.label_list||[]}).filter(function(t){return t.length>0})[0];c._onEnterLabel.emit({action:1,label_list:a?[].concat(i(a),[e]):[e]}),c.displayInputLabel=!1,c.inputLabel=""}else c.invalidInput=!0,console.error("Invalid input value")},this.onDeleteLabel=function(e){var n=!1;if(c._thumbnailList.forEach(function(t){t.bnd_box&&t.bnd_box.forEach(function(t){t.label===e&&(n=!0)}),t.polygons&&t.polygons.forEach(function(t){t.label===e&&(n=!0)})}),n)c._languageService._translate.get("labelExist").subscribe(function(t){alert(t)});else{var i=t(c._tabStatus.filter(function(t){return t.label_list}),1)[0].label_list;c._onClickLabel.emit({selectedLabel:e,label_list:i&&i.length>0?i:[],action:0})}c._refreshLabelColor.emit()},this.onClickLabel=function(t){c.selectedLabel=t,c._onChangeAnnotationLabel.emit({label:t,index:c.selectedIndexAnnotation}),c._undoRedoService.appendStages({meta:c._selectMetadata,method:"draw"})},this.onClickAnnotation=function(t,e){var n=e.label;c.selectedLabel=n,c._annotateService.setState({annotation:t})},this.checkCloseToggle=function(t){var e="";return"labellingProject.label"===t.name&&c._tabStatus[2].closed||"labellingProject.project"===t.name&&c._tabStatus[1].closed&&c._tabStatus[2].closed||"labellingProject.annotation"===t.name||(e="flex-content"),t.closed&&(e+=" closed"),e},this.checkStateEqual=function(t,e){return!Mt(t,e)}}return l(n,[{key:"ngOnInit",value:function(){var e=this;this.updateLabelList(),this._imgLblState.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(t){var n=t.draw;return e.clickAbilityToggle=n}),this._thumbnailList.length>0&&this._annotateService.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(n){var i,a=n.annotation;e.selectedIndexAnnotation=a;var o=t(e._tabStatus.filter(function(t){return t.annotation}),1)[0].annotation,r=null==o?void 0:o.map(function(t){var e=t.bnd_box,n=t.polygons;return e?e.find(function(t,e){return e===a}):n?n.find(function(t,e){return e===a}):void 0})[0];e.selectedLabel=null!==(i=null==r?void 0:r.label)&&void 0!==i?i:""})}},{key:"inputLabelChange",value:function(t){var e;this.labelList=this._tabStatus[1].label_list?null===(e=this._tabStatus[1].label_list)||void 0===e?void 0:e.filter(function(e){return e.includes(t)}):[]}},{key:"ngOnChanges",value:function(t){var n=this;if(t._thumbnailList){var a=t._thumbnailList.currentValue;this._thumbnailList=Object.assign([],this._thumbnailList,i(a))}if(t._tabStatus&&this.checkStateEqual(t._tabStatus.currentValue,t._tabStatus.previousValue)){var o=t._tabStatus.currentValue;this._tabStatus=i(o),this.updateLabelList(),this.isTabStillOpen=!1;var r,s=e(this._tabStatus);try{for(s.s();!(r=s.n()).done;)if(!r.value.closed){this.isTabStillOpen=!0;break}}catch(l){s.e(l)}finally{s.f()}this.pickRandomColorForLabel()}t._changeClickAbilityToggleStatus&&(this.clickAbilityToggle=this._changeClickAbilityToggleStatus,this.clickAbilityToggle||(this.selectedIndexAnnotation=-1,this.selectedLabel="")),this.clickAbilityToggle&&setTimeout(function(){return n._clickAbilityToggleStatus.emit(!0)}),t.selectedIndexAnnotation&&console.log(this.selectedIndexAnnotation)}},{key:"openAllTab",value:function(){this._tabStatus.forEach(function(t){t.closed=!1})}},{key:"mouseScroll",value:function(){var t=this.thumbnailList.nativeElement.scrollTop+this.thumbnailList.nativeElement.clientHeight;this.max=this.thumbnailList.nativeElement.scrollHeight,t+1500>=this.max&&this.tempMax!==this.max&&(this.tempMax=this.max,this._loadMoreThumbnails.emit())}},{key:"renameImage",value:function(t){this._onRenameImage.emit(t)}},{key:"deleteImage",value:function(t,e){this.onClick(t,e),this._onDeleteImage.emit(t)}},{key:"pickRandomColorForLabel",value:function(){this._labelColorService.setLabelColors(this.labelList,this._projectName)}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),n}()).\u0275fac=function(t){return new(t||se)(C.Jb(D),C.Jb(T.a),C.Jb(R.a),C.Jb(Nt),C.Jb(Y))},se.\u0275cmp=C.Db({type:se,selectors:[["image-labelling-project"]],viewQuery:function(t,e){var n;1&t&&C.Dc(Wt,!0),2&t&&C.mc(n=C.Xb())&&(e.thumbnailList=n.first)},hostBindings:function(t,e){1&t&&C.Wb("scroll",function(t){return e.mouseScroll(t)})},inputs:{_onChange:"_onChange",_totalUuid:"_totalUuid",_selectMetadata:"_selectMetadata",_thumbnailList:"_thumbnailList",_tabStatus:"_tabStatus",_changeClickAbilityToggleStatus:"_changeClickAbilityToggleStatus",_projectName:"_projectName"},outputs:{_onClose:"_onClose",_onClickThumbnail:"_onClickThumbnail",_onClickLabel:"_onClickLabel",_onEnterLabel:"_onEnterLabel",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onDeleteAnnotation:"_onDeleteAnnotation",_loadMoreThumbnails:"_loadMoreThumbnails",_onRenameImage:"_onRenameImage",_onDeleteImage:"_onDeleteImage",_clickAbilityToggleStatus:"_clickAbilityToggleStatus",_refreshLabelColor:"_refreshLabelColor"},features:[C.vb],decls:13,vars:1,consts:[["class","tab-container",4,"ngIf"],["thumbnailTab",""],["nonThumbnailTab",""],["labelTab",""],["annotationTab",""],["boundingBox",""],["polygon",""],[1,"tab-container"],[4,"ngFor","ngForOf"],[1,"utility-right-project-container","tab","flex-fill-remaining",3,"ngClass"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"tab-name"],[1,"flex-tab-icons"],[1,"tab-close-thumbnailless"],[1,"div-close",3,"click"],["id","thumbnailList",1,"utility-inner-container","tab-height","scroll",3,"scroll"],["thumbnailList",""],[1,"img-container",3,"ngClass","click"],[1,"img-skeleton"],["imgLazyLoad","","alt","thumbnail",1,"img",3,"src"],[1,"img-name"],[1,"img-path"],[1,"thumbnail-actions"],["src","assets/icons/last_modify.svg","alt","edit","height","20vh","width","20vw",1,"thumbnail-actions-icon",3,"title","click"],["src","assets/icons/trash.svg","alt","edit","height","20vh","width","20vw",1,"thumbnail-actions-icon",3,"title","click"],[3,"ngClass"],[1,"div-input"],["type","text",1,"input",3,"ngClass","ngModel","placeholder","ngModelChange","keydown.enter"],["id","inner-container",1,"utility-inner-container","tab-height","scroll"],[1,"flex-item"],["class","not-exist",4,"ngIf"],[1,"flex-center-width",3,"ngClass"],[1,"label"],[3,"ngClass","click"],[4,"ngIf"],[1,"delete-label",3,"ngClass","click"],[1,"not-exist"],["id","inner-container",1,"utility-inner-container","scroll","tab-smaller-height"],[1,"flex-center-width"],[1,"label",3,"ngClass","click"]],template:function(t,e){1&t&&(C.wc(0,Yt,2,1,"div",0),C.wc(1,Ht,10,6,"ng-template",null,1,C.xc),C.wc(3,$t,1,5,"ng-template",null,2,C.xc),C.wc(5,qt,14,10,"ng-template",null,3,C.xc),C.wc(7,ne,11,4,"ng-template",null,4,C.xc),C.wc(9,ae,1,1,"ng-template",null,5,C.xc),C.wc(11,re,1,1,"ng-template",null,6,C.xc)),2&t&&C.gc("ngIf",e.isTabStillOpen)},directives:[m.l,m.k,m.j,m.o,Rt,Ft.a,Ft.f,Ft.i],pipes:[$.c,H],styles:['.flex-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:33%;min-height:10%;flex-shrink:0;flex-grow:0;resize:vertical}.closed[_ngcontent-%COMP%]{display:none}.tab-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;right:0;position:fixed;z-index:1;min-width:18.5vw;max-width:18.5vw}.utility-right-project-container[_ngcontent-%COMP%]{height:100%;min-width:16.3vw;max-width:16.3vw;background:#383535;border:.0325vw solid hsla(0,0%,100%,.25);border-top:none;position:relative;z-index:1;align-items:stretch}.utility-right-project-container[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;min-width:8.5vw;max-width:8.5vw;min-height:4vh;max-height:4vh;background:#383535;z-index:-1;font-size:1.5vh;line-height:3vh;color:#fff;padding:.5vh 0 0 2vw}.tab[_ngcontent-%COMP%]{position:relative;overflow:hidden}.tab[_ngcontent-%COMP%]:before{position:absolute;content:"";top:4vh;min-width:100vw;max-width:100vw;min-height:93vh;max-height:93vh;background:#383535;z-index:-1}.flex-fill-remaining[_ngcontent-%COMP%]{flex:1 1 auto}.tab-name[_ngcontent-%COMP%]{font-size:1.7vh;padding:.5vw 2vw 0 1vw;display:inline-block;color:#fff;position:absolute}.flex-tab-icons[_ngcontent-%COMP%]{display:flex;width:100%}.tab-close-thumbnailless[_ngcontent-%COMP%]{vertical-align:middle;color:#696969;font-size:1.8vh;line-height:4vh;display:inline-grid;padding-bottom:1vh;flex:1 0 60%;justify-content:right;position:relative;z-index:1}.div-close[_ngcontent-%COMP%], .tab-close-thumbnailless[_ngcontent-%COMP%]{float:right;min-height:4vh;max-height:4vh;text-align:center}.div-close[_ngcontent-%COMP%]{margin-right:.5vw;min-width:1.6vw;max-width:1.6vw;color:#fff;cursor:pointer}.div-close[_ngcontent-%COMP%]:active{background:grey}.utility-inner-container[_ngcontent-%COMP%]{padding:2.5vh 0 0 .2vw;scroll-behavior:smooth;overflow:hidden auto;z-index:1;min-width:15.5vw;max-width:15.5vw;position:relative}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:.5vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.tab-height[_ngcontent-%COMP%]{height:85%}.flex-item[_ngcontent-%COMP%]{align-items:center;flex-direction:column;font-size:1.5vh;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.flex-center-width[_ngcontent-%COMP%], .flex-item[_ngcontent-%COMP%]{display:flex;justify-content:center}.flex-center-width[_ngcontent-%COMP%]{width:90%;flex-wrap:wrap}.annotation-active[_ngcontent-%COMP%], .label-active[_ngcontent-%COMP%]{border:.15vw solid #ff0;padding:1.5px}.delete-annotation[_ngcontent-%COMP%], .delete-label[_ngcontent-%COMP%]{position:absolute;right:2vw;color:#ff0}.img-container[_ngcontent-%COMP%]{font-size:1.5vh;color:#fff;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;min-height:5vh;max-height:5vh;cursor:pointer;margin:0 .3vw;padding:.1vh .4vw}.img-container[_ngcontent-%COMP%]:hover{background-color:#444;border-radius:2px}.img-selected[_ngcontent-%COMP%]{background:#555}.img-skeleton[_ngcontent-%COMP%]{min-width:3vw;border:.005vh dotted #525353}.img[_ngcontent-%COMP%], .img-skeleton[_ngcontent-%COMP%]{max-height:4.3vh;min-height:4.3vh;max-width:3vw}.img[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}.img-name[_ngcontent-%COMP%]{margin-left:.5vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.img-path[_ngcontent-%COMP%]{margin-top:4vh}.thumbnail-actions[_ngcontent-%COMP%]{text-align:end;padding-right:1vw;width:10vw}.thumbnail-actions-icon[_ngcontent-%COMP%]{border-radius:50%;padding:.2vh;min-height:3vh;max-height:3vh;min-width:1.5vw;max-width:1.5vw}.thumbnail-actions-icon[_ngcontent-%COMP%]:hover{background:#555}.indicator[_ngcontent-%COMP%]{background-color:#75fe7c}.indicator[_ngcontent-%COMP%], .no-indicator[_ngcontent-%COMP%]{height:1vh;width:.5vw;border-radius:50%;position:relative}.no-indicator[_ngcontent-%COMP%]{background-color:#ffba54}.div-input[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin:.5vh .9vw}.input[_ngcontent-%COMP%]{border-radius:8vw;border:none;outline:none;padding:.3vw 0 .3vw 1vw;min-height:1.5vh;max-height:1.5vh;min-width:13vw;max-width:13vw;font-size:1.3vh;background:#525353;color:#fff}.input-invalid[_ngcontent-%COMP%]{border:.2vw solid red}.label[_ngcontent-%COMP%]{flex:1 1 80%;display:flex;justify-content:flex-start;margin:.25vh 0 .25vh .5vw}.pointer[_ngcontent-%COMP%]{cursor:pointer}.not-exist[_ngcontent-%COMP%]{font-size:1.5vh;color:#999}.tab-smaller-height[_ngcontent-%COMP%]{height:60%}']}),se);function ce(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",3),C.Pb(2,"label"),C.Pb(3,"img",4),C.Wb("click",function(){return e.$implicit.onClick()}),C.bc(4,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Mb()),2&t){var n=e.$implicit,i=e.index,a=C.ac();C.xb(3),C.uc(n.style),C.gc("ngClass",a.conditionalIconTheme())("src",n.imgPath,C.sc)("alt",n.alt)("title",C.cc(4,7,n.hoverLabel)),C.yb("data-index",i)}}var ue,he=((ue=function(){function t(){var e=this;r(this,t),this._onClick=new C.n,this._onExport=new C.n,this._onReload=new C.n,this._onOpenProjectStats=new C.n,this._onAddImage=new C.n,this.toggleProject=!0,this.toggleLabel=!0,this.toggleAnnotation=!0,this.bindImagePath=function(){e.jsonSchema={logos:[{imgPath:"assets/icons/folder.svg",hoverLabel:"rightSideBar.folderOrFiles",alt:"Folder",onClick:function(){e.toggleProject?(e._onClick.emit({name:"labellingProject.project",closed:!0}),e.toggleProject=!1):(e._onClick.emit({name:"labellingProject.project",closed:!1}),e.toggleProject=!0)}},{imgPath:"assets/icons/tag.svg",hoverLabel:"rightSideBar.label",alt:"Label",onClick:function(){e.toggleLabel?(e._onClick.emit({name:"labellingProject.label",closed:!0}),e.toggleLabel=!1):(e._onClick.emit({name:"labellingProject.label",closed:!1}),e.toggleLabel=!0)}},{imgPath:"assets/icons/bounding_box.svg",hoverLabel:"rightSideBar.annotation",alt:"Annotation",onClick:function(){e.toggleAnnotation?(e._onClick.emit({name:"labellingProject.annotation",closed:!0}),e.toggleAnnotation=!1):(e._onClick.emit({name:"labellingProject.annotation",closed:!1}),e.toggleAnnotation=!0)}},{imgPath:"assets/icons/statistic.svg",hoverLabel:"rightSideBar.statistic",alt:"Statistic",onClick:function(){e._onOpenProjectStats.emit()}},{imgPath:"assets/icons/export.svg",hoverLabel:"rightSideBar.export",alt:"Export",style:"padding: 1.5vh 0.5vw;",onClick:function(){e._onExport.emit()}},{imgPath:"assets/icons/reload.svg",hoverLabel:"rightSideBar.reload",alt:"Reload",style:"padding: 1.5vh 0.5vw;",onClick:function(){e._onReload.emit()}},{imgPath:"assets/icons/add_image.svg",hoverLabel:"rightSideBar.addImageFiles",alt:"Add Images",style:"padding: 1.4vh 0.4vw;",onClick:function(){e._onAddImage.emit()}}]}},this.conditionalIconTheme=function(){return"utility-icon-light"}}return l(t,[{key:"ngOnInit",value:function(){this.bindImagePath()}},{key:"ngOnChanges",value:function(t){this.bindImagePath(),this._tabClosedStatus&&("labellingProject.project"===this._tabClosedStatus.name&&(this.toggleProject=!this._tabClosedStatus.closed),"labellingProject.label"===this._tabClosedStatus.name&&(this.toggleLabel=!this._tabClosedStatus.closed),"labellingProject.annotation"===this._tabClosedStatus.name&&(this.toggleAnnotation=!this._tabClosedStatus.closed))}}]),t}()).\u0275fac=function(t){return new(t||ue)},ue.\u0275cmp=C.Db({type:ue,selectors:[["image-labelling-right-sidebar"]],inputs:{_onChange:"_onChange",_tabClosedStatus:"_tabClosedStatus"},outputs:{_onClick:"_onClick",_onExport:"_onExport",_onReload:"_onReload",_onOpenProjectStats:"_onOpenProjectStats",_onAddImage:"_onAddImage"},features:[C.vb],decls:3,vars:1,consts:[[1,"utility-right-sidebar-container"],[1,"utility-inner-container"],[4,"ngFor","ngForOf"],[1,"utility-icon-container"],[3,"ngClass","src","alt","title","click"]],template:function(t,e){1&t&&(C.Pb(0,"div",0),C.Pb(1,"div",1),C.wc(2,ce,5,9,"ng-container",2),C.Ob(),C.Ob()),2&t&&(C.xb(2),C.gc("ngForOf",e.jsonSchema.logos))},directives:[m.k,m.j],pipes:[$.c],styles:[".utility-right-sidebar-container[_ngcontent-%COMP%]{position:absolute;top:4.5vh;min-width:2.2vw;max-width:2.2vw;min-height:95.5vh;max-height:95.5vh;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);z-index:1000}.utility-inner-container[_ngcontent-%COMP%]{min-width:2.2vw;max-width:2.2vw;position:absolute}.utility-icon-container[_ngcontent-%COMP%], .utility-inner-container[_ngcontent-%COMP%]{min-height:5vh;max-height:5vh}.utility-icon-light[_ngcontent-%COMP%]{min-width:1.5vw;max-width:1.5vw;min-height:3vh;max-height:3vh;padding:.3vw;position:absolute;cursor:pointer}.utility-icon-light[_ngcontent-%COMP%]:active, .utility-icon-light[_ngcontent-%COMP%]:focus{background:#a9a9a9}"],changeDetection:0}),ue);function de(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",4),C.yc(2),C.bc(3,"translate"),C.Ob(),C.Mb()),2&t){var n=C.ac(2);C.xb(2),C.Bc("",C.cc(3,2,"footer.image"),": ",n.thumbnailType,"")}}function ge(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"div",2),C.Pb(2,"div",3),C.yc(3),C.bc(4,"translate"),C.Ob(),C.Pb(5,"div",4),C.yc(6),C.bc(7,"translate"),C.Ob(),C.wc(8,de,4,4,"ng-container",1),C.Pb(9,"div",4),C.yc(10),C.Ob(),C.Pb(11,"div",5),C.bc(12,"translate"),C.Pb(13,"label",6),C.Wb("click",function(){C.qc(n);var t=C.ac();return t.copyMessage(t._thumbnailInfo.img_path)}),C.yc(14),C.Ob(),C.Ob(),C.Ob(),C.Mb()}if(2&t){var i=C.ac();C.xb(3),C.Bc(" ",C.cc(4,9,"footer.projectName"),": ",i._thumbnailInfo.project_name," "),C.xb(3),C.Bc("",C.cc(7,11,"footer.size"),": ",i.thumbnailSize,""),C.xb(2),C.gc("ngIf",i.thumbnailType),C.xb(2),C.Bc("",i._thumbnailInfo.img_ori_w," x ",i._thumbnailInfo.img_ori_h,""),C.xb(1),C.gc("title",C.cc(12,13,"footer.copyToClipboard")),C.xb(3),C.zc(i._thumbnailInfo.img_path)}}var be,fe=((be=function(){function t(){r(this,t),this._imgSrc="",this.thumbnailSize="",this.thumbnailType="",this.formatBytes=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 Bytes";var n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}return l(t,[{key:"copyMessage",value:function(t){var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}},{key:"ngOnChanges",value:function(t){if(t._thumbnailInfo&&t._imgSrc){var e=t._thumbnailInfo.currentValue,n=t._imgSrc.currentValue;this._thumbnailInfo=Object.assign(Object.assign({},this._thumbnailInfo),e),this.thumbnailSize=this.formatBytes(n.length);var i=n.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(i&&i.length){var a=i[1].split("/")[1];this.thumbnailType=a}}}}]),t}()).\u0275fac=function(t){return new(t||be)},be.\u0275cmp=C.Db({type:be,selectors:[["image-labelling-footer"]],inputs:{_thumbnailInfo:"_thumbnailInfo",_imgSrc:"_imgSrc"},features:[C.vb],decls:3,vars:3,consts:[[1,"footer-container"],[4,"ngIf"],[1,"footer-label-container"],[1,"footer-label","footer-project-name"],[1,"footer-label"],[1,"footer-image-path",3,"title"],[1,"footer-path-label",3,"click"]],template:function(t,e){1&t&&(C.Pb(0,"div",0),C.wc(1,ge,15,15,"ng-container",1),C.bc(2,"json"),C.Ob()),2&t&&(C.xb(1),C.gc("ngIf","{}"!=C.cc(2,1,e._thumbnailInfo)))},directives:[m.l],pipes:[m.f,$.c],styles:[".footer-container[_ngcontent-%COMP%]{position:absolute;background:#525353;border:.0625vw solid hsla(0,0%,100%,.25);min-height:2.3vh;max-height:2.3vh;min-width:97vw;max-width:100vw;bottom:0;padding-left:2.5vw}.footer-label-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:baseline;width:80%}.footer-label[_ngcontent-%COMP%]{font-size:1.6vh;color:#fff;outline:none;border-right:.05vw solid #fff;padding:0 1vw;text-align:left}.footer-project-name[_ngcontent-%COMP%]{max-width:20vw}.footer-image-path[_ngcontent-%COMP%], .footer-project-name[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.footer-image-path[_ngcontent-%COMP%]{display:flex;font-size:1.6vh;color:#fff;outline:none;border-right:.05vw solid #fff;padding:0 1vw}.footer-path-label[_ngcontent-%COMP%]{cursor:pointer;padding:0 .2vw;border-radius:.5vw}.footer-path-label[_ngcontent-%COMP%]:hover{background:#636363}.footer-path-label[_ngcontent-%COMP%]:active, .footer-path-label[_ngcontent-%COMP%]:focus{background:#737474}"],changeDetection:0}),be),me=s("rq/W"),ve=s("FHhj"),pe=s("s4fJ"),_e=s("9lAI");function ye(t,e){if(1&t&&(C.Pb(0,"span"),C.yc(1),C.Ob()),2&t){var n=C.ac(2);C.xb(1),C.Ac("Zipping ",n._processingNum," file")}}function xe(t,e){1&t&&(C.Pb(0,"span"),C.yc(1,"Done"),C.Ob())}function we(t,e){1&t&&C.Kb(0,"div",5)}function Se(t,e){1&t&&(C.Pb(0,"div",6),C.yc(1,"\u2714"),C.Ob())}function ke(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",1),C.Pb(2,"div",2),C.wc(3,ye,2,1,"span",0),C.wc(4,xe,2,0,"span",0),C.Ob(),C.wc(5,we,1,0,"div",3),C.wc(6,Se,2,0,"div",4),C.Ob(),C.Mb()),2&t){var n=C.ac();C.xb(3),C.gc("ngIf",n._processingNum>0),C.xb(1),C.gc("ngIf",0===n._processingNum),C.xb(1),C.gc("ngIf",n._processingNum>0),C.xb(1),C.gc("ngIf",0===n._processingNum)}}var Ce,Pe,Oe,Me,Le,Ie=((Ce=function(){function t(){r(this,t),this._processingNum=0,this.doneProcess=!1}return l(t,[{key:"delay",value:function(t){return new Promise(function(e){return setTimeout(e,t)})}},{key:"ngOnChanges",value:function(t){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t._processingNum&&1===t._processingNum.previousValue&&0===t._processingNum.currentValue,!e.t0){e.next=6;break}return this.doneProcess=!0,e.next=5,this.delay(1e3);case 5:this.doneProcess=!1;case 6:case"end":return e.stop()}},e,this)}))}}]),t}()).\u0275fac=function(t){return new(t||Ce)},Ce.\u0275cmp=C.Db({type:Ce,selectors:[["toastr"]],inputs:{_processingNum:"_processingNum"},features:[C.vb],decls:1,vars:1,consts:[[4,"ngIf"],[1,"toastr"],[1,"text"],["class","loader",4,"ngIf"],["class","done",4,"ngIf"],[1,"loader"],[1,"done"]],template:function(t,e){1&t&&C.wc(0,ke,7,4,"ng-container",0),2&t&&C.gc("ngIf",e._processingNum>0||e.doneProcess)},directives:[m.l],styles:[".toastr[_ngcontent-%COMP%]{position:absolute;z-index:10000;background:#262a2e;border-radius:1vh;color:#fff;bottom:5vh;right:5vw;padding:2vh 2vw;display:flex;justify-content:center}.text[_ngcontent-%COMP%]{margin:auto 1vw auto auto;font-size:2vh}.loader[_ngcontent-%COMP%]{border-radius:50%;border:.5vh solid #f3f3f3;border-top-color:#de1c44;width:2vh;height:2vh;-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite}.done[_ngcontent-%COMP%]{color:#92c91b;font-size:2vh}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}"]}),Ce),Ae=s("XIp8"),je=s("CfRg"),Be=function(t){return Object(je.a)(t,4)},Ee=((Oe=function(){function n(){r(this,n),this.globalXY={x:0,y:0},this.panXY={x:0,y:0},this.currentClickedBox={box:-1,pos:"o"},this.lineOffset=3,this.anchrSize=2.5,this.currentDrawing={x1:0,x2:0,y1:0,y2:0},this.currentSelectedBndBox=-1,this.util=new Tt}return l(n,[{key:"getDiffXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{var i={diffX:0,diffY:0};return i.diffX=this.globalXY.x+(e-this.panXY.x),i.diffY=this.globalXY.y+(n-this.panXY.y),i}catch(a){return console.log("ObjectDetection getDiffXY(offsetX: number,offsetY: number): { diffX: number; diffY: number }",a.name+": ",a.message),{diffX:-1,diffY:-1}}}},{key:"setCurrentX1Y1",value:function(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x1=t,this.currentDrawing.y1=e)}catch(n){console.log("ObjectDetection setCurrentX1Y1(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}},{key:"setCurrentX2Y2",value:function(t,e){try{null!==t&&null!==e&&void 0!==t&&void 0!==e&&(this.currentDrawing.x2=t,this.currentDrawing.y2=e)}catch(n){console.log("ObjectDetection setCurrentX2Y2(MouseX:number, MouseY:number):void",n.name+": ",n.message)}}},{key:"moveAllBbox",value:function(t,n,i,a){try{var o,r=e(t);try{for(r.s();!(o=r.n()).done;){var s=o.value,l=s.x2-s.x1,c=s.y2-s.y1;s.x1=Be(n+s.distancetoImg.x),s.y1=Be(i+s.distancetoImg.y),s.x2=Be(s.x1+l),s.y2=Be(s.y1+c)}}catch(u){r.e(u)}finally{r.f()}a&&a(!0)}catch(u){}}},{key:"calScaleTofitScreen",value:function(t,e,n,i){try{var a={factor:-1,newX:-1,newY:-1};return a.factor=Math.min(n/t,i/e),a.factor=a.factor-.05*a.factor,a.newX=n/2-t/2*a.factor,a.newY=i/2-e/2*a.factor,a}catch(o){return{factor:-1,newX:-1,newY:-1}}}},{key:"deleteSingleBox",value:function(t,e,n){try{t.splice(e,1),this.currentSelectedBndBox=-1,this.currentClickedBox={box:-1,pos:"o"},n(!0)}catch(i){}}},{key:"keyboardMoveBox",value:function(t,e,n,i){var a=n.img_w,o=n.img_h,r=n.img_x,s=n.img_y;try{switch(t){case"up":this.moveBoxWithinPointPath(r,s,a,o,0,-3,e)&&this.moveBbox(0,0,-3,-3,e);break;case"down":this.moveBoxWithinPointPath(r,s,a,o,0,3,e)&&this.moveBbox(0,0,3,3,e);break;case"left":this.moveBoxWithinPointPath(r,s,a,o,-3,0,e)&&this.moveBbox(-3,-3,0,0,e);break;case"right":this.moveBoxWithinPointPath(r,s,a,o,3,0,e)&&this.moveBbox(3,3,0,0,e)}i(!0)}catch(l){}}},{key:"moveBbox",value:function(t,e,n,i,a){a.x1+=t,a.x2+=e,a.y1+=n,a.y2+=i}},{key:"moveBoxWithinPointPath",value:function(t,e,n,i,a,o,r){try{return!(r.x1+a<t||r.x2+a>t+n||r.y1+o<e||r.y2+o>e+i)}catch(s){return console.log("ObjectDetection isWithinPointPath(imgx:number, imgy:number, imgw:number, imgh:number, addx:number, addy:number, box:Boundingbox):Boolean",s.name+": ",s.message),!1}}},{key:"mouseMoveBox",value:function(t,e,n){try{if(this.moveBoxWithinPointPath(n.img_x,n.img_y,n.img_w,n.img_h,t-this.currentDrawing.x1,e-this.currentDrawing.y1,n.bnd_box[this.currentSelectedBndBox])){this.setCurrentX2Y2(t,e);var i=this.currentDrawing.x2-this.currentDrawing.x1,a=this.currentDrawing.y2-this.currentDrawing.y1;this.setCurrentX1Y1(this.currentDrawing.x2,this.currentDrawing.y2),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"l"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x1+=i),"i"!==this.currentClickedBox.pos&&"tl"!==this.currentClickedBox.pos&&"t"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y1+=a),"i"!==this.currentClickedBox.pos&&"tr"!==this.currentClickedBox.pos&&"r"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].x2+=i),"i"!==this.currentClickedBox.pos&&"bl"!==this.currentClickedBox.pos&&"b"!==this.currentClickedBox.pos&&"br"!==this.currentClickedBox.pos||(n.bnd_box[this.currentSelectedBndBox].y2+=a)}}catch(o){console.log("ObjectDetection mouseMoveBox(MouseX:number, MouseY:number, CurrMeta:Metadata):void",o.name+": ",o.message)}}},{key:"getCurrentSelectedBox",value:function(){try{return this.currentSelectedBndBox}catch(t){return-1}}},{key:"setCurrentSelectedbBox",value:function(t){try{this.currentSelectedBndBox=t}catch(e){console.log("ObjectDetection setCurrentSelectedbBox(newNUM:number):void",e.name+": ",e.message)}}},{key:"mouseUpDrawEnable",value:function(t,e,n){try{var i={selBox:-1,isNew:!1};if(-1===this.currentClickedBox.box&&null!==this.tmpbox)t.bnd_box.push(this.tmpbox),this.currentSelectedBndBox=t.bnd_box.length-1,t.bnd_box[this.currentSelectedBndBox].label=e.length>0?e[0].name:"",i.isNew=!0,i.selBox=Be(this.currentSelectedBndBox);else if(this.currentClickedBox.box>-1&&this.tmpbox){if(t.bnd_box[this.currentSelectedBndBox].x1>t.bnd_box[this.currentSelectedBndBox].x2){var a=Be(t.bnd_box[this.currentSelectedBndBox].x1);t.bnd_box[this.currentSelectedBndBox].x1=Be(t.bnd_box[this.currentSelectedBndBox].x2),t.bnd_box[this.currentSelectedBndBox].x2=a}if(t.bnd_box[this.currentSelectedBndBox].y1>t.bnd_box[this.currentSelectedBndBox].y2){var o=Be(t.bnd_box[this.currentSelectedBndBox].y1);t.bnd_box[this.currentSelectedBndBox].y1=Be(t.bnd_box[this.currentSelectedBndBox].y2),t.bnd_box[this.currentSelectedBndBox].y2=o}}return this.currentClickedBox={box:-1,pos:"o"},this.setCurrentX1Y1(0,0),this.setCurrentX2Y2(0,0),this.tmpbox=null,n(!0),i}catch(r){return console.log("ObjectDetection MouseUpDrawEnable(CurrMeta: Metadata): number",r.name+": ",r.message),{selBox:-1,isNew:!1}}}},{key:"panRectangle",value:function(t,n,i,a){try{var o,r=e(t);try{for(r.s();!(o=r.n()).done;){var s=o.value,l=s.x2-s.x1,c=s.y2-s.y1;s.x1=n+s.distancetoImg.x,s.y1=i+s.distancetoImg.y,s.x2=s.x1+l,s.y2=s.y1+c}}catch(u){r.e(u)}finally{r.f()}a(!0)}catch(u){console.log("ObjectDetection panRectangle(bbox:Boundingbox[], img_X:number, img_Y:number)",u.name+": ",u.message)}}},{key:"scaleAllBoxes",value:function(t,n,i,a,o){try{var r,s=e(n);try{for(s.s();!(r=s.n()).done;){var l=r.value,c=l.distancetoImg.x*t+i,u=l.distancetoImg.y*t+a,h=c+(l.x2-l.x1)*t,d=u+(l.y2-l.y1)*t;l.x1=Be(c),l.y1=Be(u),l.x2=Be(h),l.y2=Be(d);var g=l.y1-a;l.distancetoImg.x=Be(l.x1-i),l.distancetoImg.y=Be(g)}}catch(b){s.e(b)}finally{s.f()}o&&o(!0)}catch(b){console.log("ObjectDetection scaleAllBoxes(scalefactor: number,boxes:Boundingbox[],imgX:number,imgY:number)",b.name+": ",b.message)}}},{key:"mouseMoveDrawEnable",value:function(t,e,n){try{-1===this.currentClickedBox.box?this.setCurrentX2Y2(t,e):this.mouseMoveBox(t,e,n)}catch(i){console.log("ObjectDetection MouseMoveDrawEnable(MouseX: number,MouseY: number,SelectedMeta: Metadata): void",i.name+": ",i.message)}}},{key:"mouseDownDrawEnable",value:function(t,e,n){try{return this.getCurrentClickBox(t,e,n),this.setCurrentX1Y1(t,e),this.setCurrentX2Y2(t,e),this.currentClickedBox.box}catch(i){return console.log("ObjectDetection MouseDownDrawEnable(MouseX:number,MouseY:number,BBox:Boundingbox[]):number",i.name+": ",i.message),-1}}},{key:"setPanXY",value:function(t,e){try{return!(!t||!e||(this.panXY.x=t,this.panXY.y=e,0))}catch(n){return console.log("ObjectDetection setPanXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"setGlobalXY",value:function(t,e){try{return!(!t||!e||(this.globalXY.x=t,this.globalXY.y=e,0))}catch(n){return console.log("ObjectDetection SetGlobalXY(newX: number, newY: number):boolean",n.name+": ",n.message),!1}}},{key:"changeLabel",value:function(t,e){t&&e&&(t.label=e)}},{key:"mouseClickWithinPointPath",value:function(t,e){var n=t.img_x,i=t.img_y,a=t.img_w,o=t.img_h,r=e.offsetX,s=e.offsetY;try{return r>n&&r<n+a&&s>i&&s<i+o}catch(l){return console.log(l),!1}}},{key:"drawAllBoxOn",value:function(n,i,a,o){try{if(i.length>0){var r,s=e((i=i.map(function(t){return Object.assign(Object.assign({},t),{color:o.get(t.label)})})).entries());try{for(s.s();!(r=s.n()).done;){var l=t(r.value,2),c=l[0],u=l[1];this.setEachBbox(c===this.currentClickedBox.box||c===this.currentSelectedBndBox,n,u,a)}}catch(m){s.e(m)}finally{s.f()}}if(-1===this.currentClickedBox.box&&-1===this.currentSelectedBndBox){var h=this.currentDrawing,d=h.x1,g=h.x2,b=h.y1,f=h.y2;this.tmpbox=this.generateNewBox(d,g,b,f),this.tmpbox&&this.drawEachBoxOn(n,this.tmpbox,a,!0)}}catch(m){console.log("redraw(boundbox) ----\x3e ",m.name+": ",m.message)}}},{key:"setEachBbox",value:function(t,e,n,i){n.lineWidth=t?3:2,this.drawEachBoxOn(e,n,i,!!t)}},{key:"drawEachBoxOn",value:function(t,e,n,i){try{if(n){var a=e.x1+(e.x2-e.x1)/2,o=e.y1+(e.y2-e.y1)/2;n.strokeStyle="white",n.fillStyle="black",n.font="bold 12px Arial",""===e.label?(n.strokeText("",e.x1+10,e.y1+15),n.fillText("",e.x1+10,e.y1+15)):t.find(function(t){return t.name===e.label})?(n.strokeText(e.label,e.x1+10,e.y1+15),n.fillText(e.label,e.x1+10,e.y1+15)):(n.strokeText("Text",e.x1+10,e.y1+15),n.fillText("Text",e.x1+10,e.y1+15)),n.strokeStyle=e.color,n.beginPath(),n.rect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),n.lineWidth=e.lineWidth,n.stroke(),n.fillStyle=e.color,i&&(n.beginPath(),n.fillRect(e.x1-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x1-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(a-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(a-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(a-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y1-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,o-this.anchrSize,2*this.anchrSize,2*this.anchrSize),n.fillRect(e.x2-this.anchrSize,e.y2-this.anchrSize,2*this.anchrSize,2*this.anchrSize))}}catch(r){console.log("ObjectDetection drawEachBoxOn(box:Boundingbox, context:CanvasRenderingContext2D, isSelected:boolean):void",r.name+": ",r.message)}}},{key:"generateNewBox",value:function(t,e,n,i){try{var a=t<e?t:e,o=n<i?n:i,r=t>e?t:e,s=n>i?n:i;return r-a>this.lineOffset&&s-o>this.lineOffset?{x1:a,y1:o,x2:r,y2:s,lineWidth:2,color:"rgba(0,255,0,1.0)",distancetoImg:{x:0,y:0},label:"",id:this.util.generateUniquesID()}:null}catch(l){return console.log("ObjectDetection GenerateNewBox(x1:number,x2:number,y1:number,y2:number):Boundingbox",l.name+": ",l.message),null}}},{key:"getBBoxDistfromImg",value:function(t,n,i){try{var a,o=e(t);try{for(o.s();!(a=o.n()).done;){var r=a.value,s=r.x1,l=r.y1,c=r.distancetoImg,u=l-i;c.x=Be(s-n),c.y=Be(u)}}catch(h){o.e(h)}finally{o.f()}}catch(h){console.log("ObjectDetection GetBBoxDistfromImg(bbox:Boundingbox[],imgX:number,imgY:number)",h.name+": ",h.message)}}},{key:"getCurrentClickBox",value:function(t,e,n){try{return this.currentClickedBox=this.mouseClickOnBoxes(t,e,n),this.currentClickedBox}catch(i){return console.log("ObjectDetection getCurrentClickBox(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",i.name+": ",i.message),{box:-1,pos:"o"}}}},{key:"mouseClickOnBoxes",value:function(t,e,n){try{for(var i=0;i<n.length;++i){var a=this.getPosition(t,e,n,n[i].x1+(n[i].x2-n[i].x1)/2,n[i].y1+(n[i].y2-n[i].y1)/2,i);if(""!==a)return{box:i,pos:a}}return{box:-1,pos:"o"}}catch(o){return console.log("ObjectDetection mouseClickOnBoxes(MouseX:number, MouseY:number, box:Boundingbox[]):{box:number,pos:string}",o.name+": ",o.message),{box:-1,pos:"o"}}}},{key:"getPosition",value:function(t,e,n,i,a,o){var r="";switch(this.getXPos(t,n,i,o)){case"l":r=this.getYLPos(e,n,a,o);break;case"r":r=this.getYRPos(e,n,a,o);break;case"m":r=this.getYMPos(e,n,a,o);break;case"i":n[o].y1-this.lineOffset<e&&e<n[o].y2+this.lineOffset&&(r="i")}return r}},{key:"getXPos",value:function(t,e,n,i){return e[i].x1-this.lineOffset<t&&t<e[i].x1+this.lineOffset?"l":e[i].x2-this.lineOffset<t&&t<e[i].x2+this.lineOffset?"r":n-this.lineOffset<t&&t<n+this.lineOffset?"m":e[i].x1-this.lineOffset<t&&t<e[i].x2+this.lineOffset?"i":"o"}},{key:"getYLPos",value:function(t,e,n,i){var a="";return e[i].y1-this.lineOffset<t&&t<e[i].y1+this.lineOffset?a="tl":e[i].y2-this.lineOffset<t&&t<e[i].y2+this.lineOffset?a="bl":n-this.lineOffset<t&&t<n+this.lineOffset&&(a="l"),a}},{key:"getYRPos",value:function(t,e,n,i){var a="";return e[i].y1-this.lineOffset<t&&t<e[i].y1+this.lineOffset?a="tr":e[i].y2-this.lineOffset<t&&t<e[i].y2+this.lineOffset?a="br":n-this.lineOffset<t&&t<n+this.lineOffset&&(a="r"),a}},{key:"getYMPos",value:function(t,e,n,i){var a="";return e[i].y1-this.lineOffset<t&&t<e[i].y1+this.lineOffset?a="t":e[i].y2-this.lineOffset<t&&t<e[i].y2+this.lineOffset?a="b":e[i].y1-this.lineOffset<t&&t<e[i].y2+this.lineOffset&&(a="i"),a}}]),n}()).\u0275fac=function(t){return new(t||Oe)},Oe.\u0275prov=C.Fb({token:Oe,factory:Oe.\u0275fac,providedIn:"any"}),Oe),ze=((Pe=function(){function t(){r(this,t),this.MEMO=null,this.utility=new Tt}return l(t,[{key:"copy",value:function(t){this.MEMO=this.utility.deepCloneVariable(t)}},{key:"paste",value:function(){return this.MEMO?"coorPt"in this.MEMO?this.polygonPaste():this.boundingBoxPaste():null}},{key:"isAvailable",value:function(){return!!this.MEMO}},{key:"clear",value:function(){this.MEMO=null}},{key:"polygonPaste",value:function(){var t,n=this.utility.deepCloneObject(this.MEMO),i=e(n.coorPt);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.x+=8,a.y+=8,a.distancetoImg.x=0,a.distancetoImg.y=0}}catch(o){i.e(o)}finally{i.f()}return n.id=this.utility.generateUniquesID(),n}},{key:"boundingBoxPaste",value:function(){var t=this.utility.deepCloneObject(this.MEMO),e=t.x2-t.x1,n=t.y2-t.y1;return t.x1+=8,t.y1+=8,t.x2=t.x1+e,t.y2=t.y1+n,t.id=this.utility.generateUniquesID(),t.distancetoImg.x=0,t.distancetoImg.y=0,t}}]),t}()).\u0275fac=function(t){return new(t||Pe)},Pe.\u0275prov=C.Fb({token:Pe,factory:Pe.\u0275fac,providedIn:"any"}),Pe),De={scale:1,factor:.05,max_scale:4},Te=((Le=function(){function t(){var e=this;r(this,t),this.zoomSubject=new E.a(De),this.zoom$=this.zoomSubject.asObservable(),this.setState=function(t){e.zoomSubject.next(t?Object.assign(Object.assign({},De),t):De)}}return l(t,[{key:"resetZoomScale",value:function(){this.zoomSubject.next(De)}},{key:"calculateZoomScale",value:function(t,e,n){var i=e.scale,a=e.factor,o=e.max_scale,r=t.wheelDelta;void 0===r&&(r=t.detail),r=Math.max(-1,Math.min(1,r));var s=n.scrollLeft,l=n.scrollTop,c=(t.pageX+s)/i,u=(t.pageY+l)/i;return i+=r*a*i,i=Math.max(1,Math.min(o,i)),Object.assign(Object.assign({},{x:c*i-t.pageX,y:u*i-t.pageY}),{scale:i})}},{key:"validateZoomScale",value:function(t,e){return t.canvas.style.transform!=="scale(".concat(e,", ").concat(e,")")}}]),t}()).\u0275fac=function(t){return new(t||Le)},Le.\u0275prov=C.Fb({token:Le,factory:Le.\u0275fac,providedIn:"any"}),Le),Ne=((Me=function(){function t(){r(this,t)}return l(t,[{key:"checkKey",value:function(t,e,n,i,a){var o=!1,r=t||e;switch(a){case"copy":o=r&&("c"===i||"C"===i);break;case"paste":o=r&&("v"===i||"V"===i);break;case"redo":o=r&&n&&("z"===i||"Z"===i);break;case"undo":o=r&&("z"===i||"Z"===i)}return o}}]),t}()).\u0275fac=function(t){return new(t||Me)},Me.\u0275prov=C.Fb({token:Me,factory:Me.\u0275fac,providedIn:"root"}),Me),Re=["canvasdrawing"],Fe=["floatdiv"],We=["lbltypetxt"],Ue=["availablelbl"],Xe=["crossH"],Ye=["crossV"];function Ke(t,e){if(1&t){var n=C.Qb();C.Pb(0,"li",16),C.Wb("click",function(){C.qc(n);var t=e.$implicit;return C.ac().labelNameClicked(t.name)}),C.Pb(1,"span",17),C.yc(2),C.Ob(),C.Pb(3,"span",18),C.yc(4),C.Ob(),C.Ob()}if(2&t){var i=e.$implicit;C.xb(2),C.zc(i.name),C.xb(2),C.zc(i.count)}}function Ze(t,e){1&t&&(C.Pb(0,"li",19),C.Pb(1,"div",20),C.yc(2),C.bc(3,"translate"),C.Ob(),C.Pb(4,"div",20),C.yc(5),C.bc(6,"translate"),C.Ob(),C.Ob()),2&t&&(C.xb(2),C.zc(C.cc(3,2,"searchLabel.labelNotExist")),C.xb(3),C.zc(C.cc(6,4,"searchLabel.enterToAdd")))}var He,$e,Ve=function(){return{standalone:!0}},Je=function(t){return{cursor:t}},Ge=(($e=function(){function t(e,n,a,o,s,l,c,u,h,d,g){var b=this;r(this,t),this._ref=e,this._boundingBoxCanvas=n,this._imgLblStateService=a,this._undoRedoService=o,this._copyPasteService=s,this._annotateSelectState=l,this._zoomService=c,this._mouseCursorService=u,this._shortcutKeyService=h,this._sharedUndoRedoService=d,this._labelColorService=g,this.image=new Image,this.mousedown=!1,this.unsubscribe$=new x.a,this.labelSearch="",this.labelList=[],this.allLabelList=[],this.showDropdownLabelBox=!1,this.invalidInput=!1,this.closeEnough=5,this._imgSrc="",this._tabStatus=[],this._onChangeMetadata=new C.n,this._onChangeAnnotationLabel=new C.n,this._onEnterLabel=new C.n,this._clickAbilityToggle=new C.n,this._onRefresh=new C.n,this.validateInputLabel=function(t){var e=t.target.value,n=e.trim();if(n)if(b._tabStatus.some(function(t){var e=t.label_list;return e&&e.length&&e.some(function(t){return t===n})}))b.invalidInput=!0,console.error("Invalid existing label input");else{b.invalidInput=!1,b.showDropdownLabelBox=!1,b._onChangeAnnotationLabel.emit({label:e,index:b.annotateState.annotation}),b._selectMetadata.bnd_box[b.annotateState.annotation].label=e,b._undoRedoService.isStateChange(b._selectMetadata.bnd_box)&&b._undoRedoService.appendStages({meta:b._selectMetadata,method:"draw"});var a=b._tabStatus.map(function(t){return t.label_list||[]}).filter(function(t){return t.length>0})[0];b._onEnterLabel.emit({action:1,label_list:a?[].concat(i(a),[e]):[e]}),b.labelSearch=""}}}return l(t,[{key:"ngOnInit",value:function(){var t=this;this.getLabelList(),this._imgLblStateService.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){var n=e.clear,i=e.fitCenter,a=e.crossLine,o=Object(v.c)(e,["clear","fitCenter","crossLine"]);(n||i||o.drag||o.draw||o.save||o.keyInfo)&&(t.showDropdownLabelBox=!1,t._ref.detectChanges()),t.boundingBoxState=Object.assign(Object.assign({},o),{clear:n,fitCenter:i,crossLine:a}),i&&t.imgFitToCenter(),n&&(t._selectMetadata.bnd_box=[],t._undoRedoService.appendStages({meta:t._selectMetadata,method:"draw"}),t.redrawImage(t._selectMetadata),t.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){t.annotateState=e,t._boundingBoxCanvas.setCurrentSelectedbBox(e.annotation),t._selectMetadata&&t.redrawImage(t._selectMetadata)}),this._zoomService.zoom$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.zoom=e}),this._mouseCursorService.mouseCursor$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.mouseCursor=e}),this._sharedUndoRedoService.action.subscribe(function(e){switch(e){case"BBOX_UNDO":t.undoAction();break;case"BBOX_REDO":t.redoAction()}})}},{key:"ngOnChanges",value:function(t){var n,i,a,o=this;if((null===(n=t._selectMetadata)||void 0===n?void 0:n.previousValue)&&(null===(i=t._selectMetadata)||void 0===i?void 0:i.currentValue)&&this.redrawImage(this._selectMetadata),(null===(a=t._imgSrc)||void 0===a?void 0:a.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this.loadImage(t._imgSrc.currentValue),this._boundingBoxCanvas.setCurrentSelectedbBox(-1)),t._tabStatus){var r,s=!0,l=e(this._tabStatus);try{for(l.s();!(r=l.n()).done;)if(!r.value.closed){s=!1;break}}catch(c){l.e(c)}finally{l.f()}this.canvas&&(!0===s?(this.initializeCanvas("96%"),this.imgFitToCenter()):this.redrawImage(this._selectMetadata))}t._refreshAllLabelColor&&this._refreshAllLabelColor&&setTimeout(function(){return o.updateColor()})}},{key:"initializeCanvas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"80%";this.canvas.nativeElement.style.width=t,this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}},{key:"emitMetadata",value:function(){this._onChangeMetadata.emit(this._selectMetadata)}},{key:"annotateSelectChange",value:function(t){this._annotateSelectState.setState(t)}},{key:"resetZoom",value:function(){this._zoomService.resetZoomScale()}},{key:"imgFitToCenter",value:function(){try{var t=this._boundingBoxCanvas.calScaleTofitScreen(this._selectMetadata.img_w,this._selectMetadata.img_h,this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.offsetHeight);this._selectMetadata.img_w*=t.factor,this._selectMetadata.img_h*=t.factor,this._boundingBoxCanvas.scaleAllBoxes(t.factor,this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this._selectMetadata.img_x=t.newX,this._selectMetadata.img_y=t.newY,this._boundingBoxCanvas.setGlobalXY(t.newX,t.newY),this._boundingBoxCanvas.moveAllBbox(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(e){console.log(e)}}},{key:"keyStrokeEvent",value:function(t){var e=t.ctrlKey,n=t.metaKey,i=t.shiftKey,a=t.key;try{var o=this.boundingBoxState.isActiveModal;this.mousedown||o||this.showDropdownLabelBox||!this._selectMetadata||(this._shortcutKeyService.checkKey(e,n,i,a,"copy")?this.copyImage():this._shortcutKeyService.checkKey(e,n,i,a,"paste")?this.pasteImage():this._shortcutKeyService.checkKey(e,n,i,a,"redo")?this.redoAction():this._shortcutKeyService.checkKey(e,n,i,a,"undo")?this.undoAction():this.annotateState.annotation>-1&&("Delete"===a||"Backspace"===a)?this.deleteSelectedBbox():this.moveBbox(a))}catch(r){console.log(r)}}},{key:"copyImage",value:function(){this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation])}},{key:"pasteImage",value:function(){if(this._copyPasteService.isAvailable()){this._copyPasteService.copy(this._selectMetadata.bnd_box[this.annotateState.annotation]);var t=this._copyPasteService.paste();t&&this._selectMetadata.bnd_box.push(t),this.annotateSelectChange({annotation:this._selectMetadata.bnd_box.length-1,isDlbClick:!1}),this.getBBoxDistanceFromImage(),this.redrawImage(this._selectMetadata)}this._undoRedoService.appendStages({meta:Object(Ae.a)(this._selectMetadata),method:"draw"}),this.emitMetadata()}},{key:"redoAction",value:function(){if(this._undoRedoService.isAllowRedo()){var t=this._undoRedoService.redo();this._selectMetadata=Object(Ae.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}},{key:"undoAction",value:function(){if(this._undoRedoService.isAllowUndo()){var t=this._undoRedoService.undo();this._selectMetadata=Object(Ae.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.getBBoxDistanceFromImage(),this.emitMetadata()}}},{key:"deleteSelectedBbox",value:function(){var t=this;this._boundingBoxCanvas.deleteSingleBox(this._selectMetadata.bnd_box,this.annotateState.annotation,function(e){e&&(t.annotateSelectChange({annotation:-1,isDlbClick:!1}),t.redrawImage(t._selectMetadata),t._undoRedoService.appendStages({meta:Object(Ae.a)(t._selectMetadata),method:"draw"}),t.emitMetadata())})}},{key:"moveBbox",value:function(t){switch(t){case"ArrowLeft":this.keyMoveBox("left");break;case"ArrowRight":this.keyMoveBox("right");break;case"ArrowUp":this.keyMoveBox("up");break;case"ArrowDown":this.keyMoveBox("down")}}},{key:"toggleEvent",value:function(t){try{this.annotateState.annotation>-1&&this.doubleClickEvent()}catch(e){console.log(e)}}},{key:"doubleClickEvent",value:function(){this._undoRedoService.clearRedundantStages(),this.annotateSelectChange({annotation:this.annotateState.annotation,isDlbClick:!0})}},{key:"mouseScroll",value:function(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){var e=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement),n=e.scale,i=e.x,a=e.y;this.boundingBoxState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,n)&&(this.canvasContext.canvas.style.transformOrigin="".concat(t.offsetX,"px ").concat(t.offsetY,"px"),this.canvasContext.canvas.style.transform="scale(".concat(n,", ").concat(n,")"),this._zoomService.setState({scale:n}))),this.canvasContext.canvas.scrollTop=a,this.canvasContext.canvas.scrollLeft=i,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(o){console.log(o)}}},{key:"mouseDown",value:function(t){try{if(this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)){if(this.mousedown=!0,this.boundingBoxState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._boundingBoxCanvas.setPanXY(t.offsetX,t.offsetY)),this.boundingBoxState.draw){var e=this._boundingBoxCanvas.mouseDownDrawEnable(t.offsetX,t.offsetY,this._selectMetadata.bnd_box);this.annotateSelectChange({annotation:e,isDlbClick:!1}),this.redrawImage(this._selectMetadata)}}else this.mousedown=!1}catch(n){console.log(n)}}},{key:"mouseUp",value:function(t){var e=this;try{this.boundingBoxState.draw&&this.mousedown&&(this.finishDrawBoundingBox(t),this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.map(function(t){return Object.assign(Object.assign({},t),{color:e.labelColorList.get(t.label)})}),this.emitMetadata()),this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t)&&(this.boundingBoxState.drag&&this.mousedown&&this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.mousedown=!1)}catch(n){console.log(n)}}},{key:"mouseMove",value:function(t){var e=this;try{if(this._selectMetadata){var n=this._boundingBoxCanvas.mouseClickWithinPointPath(this._selectMetadata,t);if(n&&!this.showDropdownLabelBox&&this.boundingBoxState.draw&&this.boundingBoxState.crossLine?(this.crossH.nativeElement.style.visibility="visible",this.crossV.nativeElement.style.visibility="visible",this.crossH.nativeElement.style.top=t.pageY.toString()+"px",this.crossV.nativeElement.style.left=t.pageX.toString()+"px"):(this.crossH.nativeElement.style.visibility="hidden",this.crossV.nativeElement.style.visibility="hidden"),n&&!this.showDropdownLabelBox){if(this.boundingBoxState.drag&&this.mousedown){var i=this._boundingBoxCanvas.getDiffXY(t);this._selectMetadata.img_x=i.diffX,this._selectMetadata.img_y=i.diffY,this._boundingBoxCanvas.panRectangle(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y,function(t){if(t){var n=Object(Ae.a)(e._selectMetadata);e._undoRedoService.isMethodChange("pan")?e._undoRedoService.appendStages({meta:n,method:"pan"}):e._undoRedoService.replaceStages({meta:n,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.boundingBoxState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});if(this.boundingBoxState.draw&&this.mousedown&&(this._boundingBoxCanvas.mouseMoveDrawEnable(t.offsetX,t.offsetY,this._selectMetadata),this.redrawImage(this._selectMetadata)),this.boundingBoxState.draw&&!this.mousedown){var a=this._boundingBoxCanvas.getCurrentClickBox(t.offsetX,t.offsetY,this._selectMetadata.bnd_box),o=a.box,r=a.pos;-1!==o?"tl"===r?this.changeMouseCursorState({"nw-resize":!0}):"tr"===r?this.changeMouseCursorState({"ne-resize":!0}):"bl"===r?this.changeMouseCursorState({"sw-resize":!0}):"br"===r?this.changeMouseCursorState({"se-resize":!0}):"l"===r||"r"===r?this.changeMouseCursorState({"w-resize":!0}):"t"===r||"b"===r?this.changeMouseCursorState({"n-resize":!0}):(this.crossH.nativeElement.style.visibility="hidden",this.crossV.nativeElement.style.visibility="hidden",this.changeMouseCursorState({move:!0})):this.changeMouseCursorState({crosshair:!0})}}else this.changeMouseCursorState()}}catch(s){console.log(s)}}},{key:"finishDrawBoundingBox",value:function(t){var e=this;this.getLabelList();var n=[];this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box&&(n=this._tabStatus[2].annotation[0].bnd_box),this.sortingLabelList(this.labelList,n);var i=this._boundingBoxCanvas.mouseUpDrawEnable(this._selectMetadata,this.labelList,function(t){t&&(e._undoRedoService.isStateChange(e._selectMetadata.bnd_box)&&e._undoRedoService.appendStages({meta:Object(Ae.a)(e._selectMetadata),method:"draw"}),e.getBBoxDistanceFromImage(),e.emitMetadata())});if(i.isNew||"mouseout"===t.type){var a=t.offsetY*(100/document.documentElement.clientHeight)+8.5,o=t.offsetX*(100/document.documentElement.clientWidth)+2.5;a<9&&(a=9),a>76&&(a=76),o<2.5&&(o=2.5),o>66&&(o=66),this.floatdiv.nativeElement.style.top=a.toString()+"vh",this.floatdiv.nativeElement.style.left=o.toString()+"vw",this.showDropdownLabelBox=!0,this.labelSearch="",this.invalidInput=!1,setTimeout(function(){e.lbltypetxt.nativeElement.focus()},100)}else this.showDropdownLabelBox=!1;i.isNew&&this.annotateSelectChange({annotation:i.selBox,isDlbClick:!1})}},{key:"changeMouseCursorState",value:function(t){this._mouseCursorService.setState(t)}},{key:"mouseOut",value:function(t){var e,n,i=this;try{this.crossH.nativeElement.style.visibility="hidden",this.crossV.nativeElement.style.visibility="hidden",this.boundingBoxState.draw&&this.mousedown&&(this.finishDrawBoundingBox(t),this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.map(function(t){return Object.assign(Object.assign({},t),{color:i.labelColorList.get(t.label)})}),this.emitMetadata()),"canvasstyle"!==t.target.className&&!t.target.className.includes("unclosedOut")||(null===(e=t.relatedTarget)||void 0===e?void 0:e.className.includes("unclosedOut"))||(null===(n=t.relatedTarget)||void 0===n?void 0:n.className.includes("canvasstyle"))||0!==this._selectMetadata.bnd_box.filter(function(t){return""===t.label}).length&&(this.showDropdownLabelBox=!1,this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.filter(function(t){return""!==t.label}),this._onChangeMetadata.emit(this._selectMetadata),this.redrawImage(this._selectMetadata),alert("Some bounding boxes will be deleted because they were not labelled.")),this.boundingBoxState.drag&&this.mousedown&&(this._boundingBoxCanvas.setGlobalXY(this._selectMetadata.img_x,this._selectMetadata.img_y),this.redrawImage(this._selectMetadata)),this.mousedown=!1}catch(a){console.log(a)}}},{key:"loadImage",value:function(t){var e=this;try{this.showDropdownLabelBox=!1,this.image.src=t,this.image.onload=function(){e._selectMetadata.img_w=e._selectMetadata.img_w<1?e._selectMetadata.img_ori_w:e._selectMetadata.img_w,e._selectMetadata.img_h=e._selectMetadata.img_h<1?e._selectMetadata.img_ori_h:e._selectMetadata.img_h,e._boundingBoxCanvas.setGlobalXY(e._selectMetadata.img_x,e._selectMetadata.img_y),e.imgFitToCenter(),e.emitMetadata(),e.changeMouseCursorState(),e._undoRedoService.appendStages({meta:Object(Ae.a)(e._selectMetadata),method:"draw"})}}catch(n){console.log(n)}}},{key:"keyMoveBox",value:function(t){var e=this;try{var n=this._selectMetadata.bnd_box[this.annotateState.annotation];n&&this._boundingBoxCanvas.keyboardMoveBox(t,n,this._selectMetadata,function(t){t&&(e._undoRedoService.appendStages({meta:Object(Ae.a)(e._selectMetadata),method:"draw"}),e.getBBoxDistanceFromImage(),e.redrawImage(e._selectMetadata),e.emitMetadata())})}catch(i){console.log(i)}}},{key:"redrawImage",value:function(t){var e,n=t.img_x,i=t.img_y,a=t.img_w,o=t.img_h;if(this.clearCanvas(),this.canvasContext.drawImage(this.image,n,i,a,o),0!==(null===(e=this._tabStatus[2].annotation)||void 0===e?void 0:e.length)){this.getLabelList();var r=[];this._tabStatus[2].annotation&&this._tabStatus[2].annotation[0].bnd_box&&(r=this._tabStatus[2].annotation[0].bnd_box),this.sortingLabelList(this.labelList,r)}this.labelColorList=this._labelColorService.getLabelColorList(this._projectName),this._boundingBoxCanvas.drawAllBoxOn(this.labelList,this._selectMetadata.bnd_box,this.canvasContext,this.labelColorList)}},{key:"clearCanvas",value:function(){this.canvasContext.clearRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height)}},{key:"getBBoxDistanceFromImage",value:function(){this._boundingBoxCanvas.getBBoxDistfromImg(this._selectMetadata.bnd_box,this._selectMetadata.img_x,this._selectMetadata.img_y)}},{key:"getLabelList",value:function(){var t=this;this.labelList=[],this.allLabelList=[],(this._tabStatus[1].label_list?this._tabStatus[1].label_list:[]).forEach(function(e){t.labelList.push({name:e,count:0}),t.allLabelList.push({name:e,count:0})})}},{key:"labelTypeTextChange",value:function(t){this.labelList=this.allLabelList.filter(function(e){return e.name.includes(t)})}},{key:"labelNameClicked",value:function(t){var e=this;this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:t,index:this.annotateState.annotation}),this._selectMetadata.bnd_box[this.annotateState.annotation].label=t,this._undoRedoService.isStateChange(this._selectMetadata.bnd_box)&&this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.map(function(t){return Object.assign(Object.assign({},t),{color:e.labelColorList.get(t.label)})}),this.emitMetadata()}},{key:"sortingLabelList",value:function(t,e){var n=this;t.forEach(function(t,i){var a=t.name;n.labelList[i].count=e.filter(function(t){return t.label===a}).length,n.allLabelList[i].count=e.filter(function(t){return t.label===a}).length}),this.labelList.sort(function(t,e){return n.sortAlgo(t,e)}),this.allLabelList.sort(function(t,e){return n.sortAlgo(t,e)})}},{key:"sortAlgo",value:function(t,e){return t.count<e.count?1:e.count<t.count?-1:0}},{key:"currentCursor",value:function(){return this._mouseCursorService.changeCursor(this.mouseCursor)}},{key:"cancelClickAbilityToggleStatus",value:function(){this._clickAbilityToggle.emit(!1)}},{key:"updateColor",value:function(){var t=this;this._selectMetadata.bnd_box=this._selectMetadata.bnd_box.map(function(e){return Object.assign(Object.assign({},e),{color:t.labelColorList.get(e.label)})}),this.redrawImage(this._selectMetadata),this.emitMetadata(),this._onRefresh.emit()}},{key:"ngOnDestroy",value:function(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),t}()).\u0275fac=function(t){return new(t||$e)(C.Jb(C.h),C.Jb(Ee),C.Jb(T.a),C.Jb(Nt),C.Jb(ze),C.Jb(D),C.Jb(Te),C.Jb(It),C.Jb(Ne),C.Jb(Z),C.Jb(Y))},$e.\u0275cmp=C.Db({type:$e,selectors:[["image-labelling-object-detection"]],viewQuery:function(t,e){var n;1&t&&(C.Dc(Re,!0),C.Dc(Fe,!0),C.Dc(We,!0),C.Dc(Ue,!0),C.Dc(Xe,!0),C.Dc(Ye,!0)),2&t&&(C.mc(n=C.Xb())&&(e.canvas=n.first),C.mc(n=C.Xb())&&(e.floatdiv=n.first),C.mc(n=C.Xb())&&(e.lbltypetxt=n.first),C.mc(n=C.Xb())&&(e.availablelbl=n.first),C.mc(n=C.Xb())&&(e.crossH=n.first),C.mc(n=C.Xb())&&(e.crossV=n.first))},hostBindings:function(t,e){1&t&&C.Wb("keydown",function(t){return e.keyStrokeEvent(t)},!1,C.pc)("dblclick",function(t){return e.toggleEvent(t)})("wheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc",_tabStatus:"_tabStatus",_refreshAllLabelColor:"_refreshAllLabelColor",_projectName:"_projectName"},outputs:{_onChangeMetadata:"_onChangeMetadata",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_onEnterLabel:"_onEnterLabel",_clickAbilityToggle:"_clickAbilityToggle",_onRefresh:"_onRefresh"},features:[C.vb],decls:17,vars:10,consts:[[1,"floatdiv","unclosedOut",3,"hidden"],["floatdiv",""],["autocomplete","off","spellcheck","false",1,"unclosedOut"],["type","text",1,"lbltypetxt","unclosedOut",3,"ngClass","ngModel","ngModelOptions","ngModelChange","keydown.enter"],["lbltypetxt",""],[1,"availablelbl","unclosedOut"],["availablelbl",""],[1,"lblList","unclosedOut"],["class","lblElement unclosedOut",3,"click",4,"ngFor","ngForOf"],["class","unclosedOut notExist",4,"ngIf"],[1,"canvasstyle",3,"ngStyle","click"],["canvasdrawing",""],["id","cross-h",1,"crosses"],["crossH",""],["id","cross-v",1,"crosses"],["crossV",""],[1,"lblElement","unclosedOut",3,"click"],[1,"lblName","unclosedOut"],[1,"lblCount","unclosedOut"],[1,"unclosedOut","notExist"],[1,"unclosedOut"]],template:function(t,e){1&t&&(C.Pb(0,"div"),C.Pb(1,"div",0,1),C.Pb(3,"form",2),C.Pb(4,"input",3,4),C.Wb("ngModelChange",function(t){return e.labelSearch=t})("ngModelChange",function(t){return e.labelTypeTextChange(t)})("keydown.enter",function(t){return e.validateInputLabel(t)}),C.Ob(),C.Ob(),C.Pb(6,"div",5,6),C.Pb(8,"ul",7),C.wc(9,Ke,5,2,"li",8),C.wc(10,Ze,7,6,"li",9),C.Ob(),C.Ob(),C.Ob(),C.Pb(11,"canvas",10,11),C.Wb("click",function(){return e.cancelClickAbilityToggleStatus()}),C.Ob(),C.Kb(13,"div",12,13),C.Kb(15,"div",14,15),C.Ob()),2&t&&(C.xb(1),C.gc("hidden",!e.showDropdownLabelBox),C.xb(3),C.gc("ngClass",e.invalidInput?"invalidInput":"validInput")("ngModel",e.labelSearch)("ngModelOptions",C.ic(7,Ve)),C.xb(5),C.gc("ngForOf",e.labelList),C.xb(1),C.gc("ngIf",0===e.labelList.length),C.xb(1),C.gc("ngStyle",C.jc(8,Je,e.currentCursor())))},directives:[Ft.n,Ft.g,Ft.h,Ft.a,m.j,Ft.f,Ft.i,m.k,m.l,m.m],pipes:[$.c],styles:[".floatdiv[_ngcontent-%COMP%]{position:absolute;z-index:10000}.lbltypetxt[_ngcontent-%COMP%]{width:11vw;height:4vh;color:snow;font-size:2vh;background-color:#000;outline:none;border-radius:.2vh;border:.2vw solid grey;border-bottom:none;padding:0;text-indent:.4vw}.invalidInput[_ngcontent-%COMP%]{border:.2vw solid red}.validInput[_ngcontent-%COMP%]{border:.2vw solid grey}.availablelbl[_ngcontent-%COMP%]{background-color:#000;width:11vw;height:15vh;color:snow;font-size:2vh;font-weight:700;outline:none;border-radius:.2vh;border:.2vw solid grey;border-top:.1vh dotted snow;overflow:auto;scrollbar-width:none}.availablelbl[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.lblList[_ngcontent-%COMP%]{padding:0 .2vw}.lblElement[_ngcontent-%COMP%]{list-style-type:none;margin:.3vh 0;padding:0;justify-content:space-between;display:flex}.lblElement[_ngcontent-%COMP%]:hover{background-color:#111}.lblName[_ngcontent-%COMP%]{margin-left:.2vw;overflow:hidden;text-overflow:ellipsis}.lblCount[_ngcontent-%COMP%]{background-color:#222;margin-right:.2vw;padding:.1vh .2vw;border-radius:.2vw}.notExist[_ngcontent-%COMP%]{color:#999;font-size:1.5vh}.canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}#cross-h[_ngcontent-%COMP%]{left:0;width:100%;height:1px;margin-top:-1px;opacity:.4}#cross-v[_ngcontent-%COMP%]{top:0;height:100%;width:1px;margin-left:-1px;opacity:.4}.crosses[_ngcontent-%COMP%]{position:fixed;background-color:#dc1d46;box-shadow:0 0 5px #646464;pointer-events:none;visibility:hidden;z-index:100}"],changeDetection:0}),$e),qe=((He=function(){function n(){r(this,n),this.globalXY={x:-1,y:-1},this.panXY={x:0,y:0},this.clickPoint={polygonIndex:-1,pointIndex:-1},this.clipPath=null,this.radius=3.5,this.distanceOffset=8,this.polygonAreaIndex=-1,this.selectedPolygonIndex=-1,this.util=new Tt,this.isNewPoly=!1,this.labelList=[]}return l(n,[{key:"mouseDownDraw",value:function(t,e,n,i,a,o,r,s){this.labelList=s;var l=t.offsetX,c=t.offsetY;this.polygonAreaIndex=this.findPolygonArea(t,e),this.clickPoint=this.findClickPoint(l,c,e);var u=this.isNewPolygon();return u&&o?this.setPanXY(t):!this.returnTempPoly()&&this.polygonAreaIndex<0&&this.clickPoint.pointIndex<0?(this.setPolygonLineWidth(e,-1),this.selectedPolygonIndex=-1,this.pushTempPoint(t,e),this.setNewPolygon(!0)):u?(this.pushTempPoint(t,e),this.drawNewPolygon(e,i,a,n,!1),this.drawfromPreviousPoint(t,a)):(this.selectedPolygonIndex=this.findPolygonArea(t,e)>-1?this.findPolygonArea(t,e):this.findClickPoint(l,c,e).polygonIndex,this.setPolygonLineWidth(e,this.selectedPolygonIndex),this.setNewPolygon(!1)),this.selectedPolygonIndex}},{key:"mouseMoveDraw",value:function(t,e,n,i,a,o,r,s){var l=this.findPolygonArea(a,t),c=this.isNewPolygon(),u=this.clickPoint,h=u.pointIndex,d=u.polygonIndex;if(c&&r&&o){var g=this.getDiffXY(a),b=g.diffX,f=g.diffY;t.img_x=b,t.img_y=f,this.panPolygons(t,!0),s("pan")}else c?(this.drawNewPolygon(t,e,n,i,!1),this.drawfromPreviousPoint(a,n)):r&&-1===h&&this.selectedPolygonIndex>-1?(this.mouseMovePolygon(a,t,n,this.selectedPolygonIndex,e,i),this.resetClipPath(t),s("pan")):r&&h>-1&&d>-1&&(this.setPolygonCoordinate(a,t,this.clickPoint),s("draw"));return l>-1}},{key:"setPanXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{this.panXY={x:e,y:n}}catch(i){console.log("setPanXY",i)}}},{key:"getPanXY",value:function(){return this.panXY}},{key:"getDiffXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{var i={diffX:0,diffY:0},a=this.getGlobalXY(),o=a.x,r=a.y;return i.diffX=o+(e-this.panXY.x),i.diffY=r+(n-this.panXY.y),i}catch(s){return console.log(s),{diffX:-1,diffY:-1}}}},{key:"setSelectedPolygon",value:function(t,e){this.selectedPolygonIndex=t,e&&this.setPolygonLineWidth(e,this.selectedPolygonIndex)}},{key:"getSelectedPolygonIndex",value:function(){return this.selectedPolygonIndex}},{key:"mouseClickWithinPointPath",value:function(t,e){var n=t.img_x,i=t.img_y,a=t.img_w,o=t.img_h,r=e.offsetX,s=e.offsetY;return r>n&&r<n+a&&s>i&&s<i+o}},{key:"calScaleToFitScreen",value:function(t,e){var n=t.img_w,i=t.img_h,a=e.offsetWidth,o=e.offsetHeight;try{var r={factor:-1,newX:-1,newY:-1},s=Math.min(a/n,o/i);return r.factor=s-.05*s,r.newX=a/2-n/2*r.factor,r.newY=o/2-i/2*r.factor,r}catch(l){return console.log("calScaleToFitScreen",l),{factor:-1,newX:-1,newY:-1}}}},{key:"pushTempPoint",value:function(t,e){var n=t.offsetX,i=t.offsetY,a=e.img_x,o=e.img_y,r=e.polygons;try{var s=n-a,l=i-o,c=r.length;!this.tmpPolygon&&this.generateNewTempPolygon(c),this.tmpPolygon.coorPt.push({x:n,y:i,distancetoImg:{x:s,y:l}})}catch(u){console.log("pushTempPoint",u)}}},{key:"removeLastPoint",value:function(t,e,n,i){var a;try{return(null===(a=this.tmpPolygon)||void 0===a?void 0:a.coorPt)&&this.tmpPolygon.coorPt.length>1?(this.tmpPolygon.coorPt.pop(),!1):(this.resetDrawing(t,n,e,i),!0)}catch(o){return console.log("removeLastPoint",o),!1}}},{key:"calculatePointDistance",value:function(t,e,n,i){try{var a=t-n,o=e-i;return Math.sqrt(a*a+o*o)}catch(r){return void console.log("calculatePointDistance",r)}}},{key:"generateNewTempPolygon",value:function(t){try{var e=this.util.generateUniquesID(),n=(t+1).toString();this.tmpPolygon={coorPt:[],label:this.labelList.length>0?this.labelList[0].name:"",id:e,lineWidth:2,color:"rgba(0,255,0,1.0)",region:n,subLabel:[]}}catch(i){console.log("generateNewTempPolygon",i)}}},{key:"getClickPoint",value:function(){return this.clickPoint}},{key:"resetClickPoint",value:function(){this.clickPoint={pointIndex:-1,polygonIndex:-1}}},{key:"resetDrawing",value:function(t,e,n,i){try{this.tmpPolygon=null,this.setNewPolygon(!1),this.redraw(t,e,n,i,-1)}catch(a){console.log("resetDrawing",a)}}},{key:"setNewPolygon",value:function(t){this.isNewPoly=t}},{key:"redraw",value:function(t,e,n,i,a){var o=i.width,r=i.height;try{var s=t.img_w,l=t.img_h,c=t.img_x,u=t.img_y;n.restore(),n.clearRect(0,0,o,r),n.save(),n.beginPath(),n.rect(c,u,s,l),n.clip(),n.beginPath(),n.drawImage(e,c,u,s,l),this.drawAllPolygon(t,n,a,this.labelColorList)}catch(h){console.log("redraw",h)}}},{key:"drawAllPolygon",value:function(t,e,n,i){try{this.labelColorList=i,this.validatePolygonMetadata(t.polygons)&&(-1===this.selectedPolygonIndex&&(this.drawAllPolygonLine(t,e),this.drawAllPolygonsDots(t,e,n,this.radius),this.plotAllFloatLabel(t,e)),-1!==this.selectedPolygonIndex&&this.assignLabelColorAndDrawPolygon(t,e,n))}catch(a){console.log("drawAllPolygon",a)}}},{key:"assignLabelColorAndDrawPolygon",value:function(t,e,n){var i=this;t.polygons=t.polygons.map(function(t){return Object.assign(Object.assign({},t),{color:i.labelColorList.get(t.label)})}),this.drawAllPolygonLine(t,e),this.drawAllPolygonsDots(t,e,n,this.radius),this.plotAllFloatLabel(t,e)}},{key:"validatePolygonMetadata",value:function(t){return t.length>0}},{key:"drawAllPolygonLine",value:function(n,i){var a=n.polygons;try{var o,r=e(a.entries());try{for(r.s();!(o=r.n()).done;){var s=t(o.value,2),l=(s[0],s[1]),c=l.lineWidth,u=l.color,h=l.coorPt;i.lineWidth=c,i.strokeStyle=u||"white",i.fillStyle=u||"white",i.beginPath(),i.moveTo(h[0].x,h[0].y);var d,g=e(h.entries());try{for(g.s();!(d=g.n()).done;){var b=t(d.value,1)[0];b+1<h.length&&i.lineTo(h[b+1].x,h[b+1].y)}}catch(f){g.e(f)}finally{g.f()}i.closePath(),i.stroke()}}catch(f){r.e(f)}finally{r.f()}}catch(f){console.log("drawAllPolygonLine",f)}}},{key:"drawAllPolygonsDots",value:function(n,i,a,o){var r=n.polygons;try{var s,l=e(r.entries());try{for(l.s();!(s=l.n()).done;){var c=t(s.value,2),u=c[0],h=c[1],d=h.coorPt,g=h.color;if(a===u){i.strokeStyle=g,i.fillStyle=g;var b,f=e(d.entries());try{for(f.s();!(b=f.n()).done;){var m=t(b.value,1)[0];i.beginPath(),i.arc(d[m].x,d[m].y,o,0,2*Math.PI),i.fill(),i.closePath(),i.stroke()}}catch(v){f.e(v)}finally{f.f()}}}}catch(v){l.e(v)}finally{l.f()}}catch(v){console.log("drawAllPolygonsDots",v)}}},{key:"plotAllFloatLabel",value:function(t,e){var n=t.polygons;try{n.forEach(function(t){var n=t.label,i=t.coorPt[0],a=i.x,o=i.y;e.strokeStyle="white",e.fillStyle="black",e.font="bold 12px Arial",e.strokeText(n,a+10,o+15),e.fillText(n,a+10,o+15)})}catch(i){console.log("plotAllFloatLabel",i)}}},{key:"setGlobalXY",value:function(t){var e=t.offsetX,n=t.offsetY;try{this.globalXY={x:e,y:n}}catch(i){console.log("setGlobalXY",i)}}},{key:"getGlobalXY",value:function(){return this.globalXY}},{key:"mouseMovePolygon",value:function(n,i,a,o,r,s){var l=n.offsetX,c=n.offsetY;try{var u=this.getGlobalXY(),h=u.x,d=u.y,g=l-h,b=c-d;if(this.withinPointPath(i,o,{offsetX:g,offsetY:b})){this.setGlobalXY({offsetX:l,offsetY:c});var f,m=e(i.polygons[o].coorPt.entries());try{for(m.s();!(f=m.n()).done;){var v=t(f.value,1)[0];i.polygons[o].coorPt[v].x+=g,i.polygons[o].coorPt[v].y+=b}}catch(p){m.e(p)}finally{m.f()}this.redraw(i,r,a,s,o)}}catch(p){console.log("mouseMovePolygon",p)}}},{key:"keyboardMovePolygon",value:function(n,i,a,o,r,s,l){try{if(a>-1){var c=-3;switch(i){case"up":if(this.withinPointPath(n,a,{offsetX:0,offsetY:c})){var u,h=e(n.polygons[a].coorPt.entries());try{for(h.s();!(u=h.n()).done;){var d=t(u.value,1)[0];n.polygons[a].coorPt[d].y+=c}}catch(w){h.e(w)}finally{h.f()}}break;case"down":if(this.withinPointPath(n,a,{offsetX:0,offsetY:c})){var g,b=e(n.polygons[a].coorPt.entries());try{for(b.s();!(g=b.n()).done;){var f=t(g.value,1)[0];n.polygons[a].coorPt[f].y-=c}}catch(w){b.e(w)}finally{b.f()}}break;case"left":if(this.withinPointPath(n,a,{offsetX:c,offsetY:0})){var m,v=e(n.polygons[a].coorPt.entries());try{for(v.s();!(m=v.n()).done;){var p=t(m.value,1)[0];n.polygons[a].coorPt[p].x+=c}}catch(w){v.e(w)}finally{v.f()}}break;case"right":if(this.withinPointPath(n,a,{offsetX:c,offsetY:0})){var _,y=e(n.polygons[a].coorPt.entries());try{for(y.s();!(_=y.n()).done;){var x=t(_.value,1)[0];n.polygons[a].coorPt[x].x-=c}}catch(w){y.e(w)}finally{y.f()}}}this.redraw(n,o,r,s,a),l(!0)}return!0}catch(w){return console.log("keyboardMovePolygon",w),!0}}},{key:"withinPointPath",value:function(n,i,a){var o=n.polygons,r=n.img_x,s=n.img_y,l=n.img_w,c=n.img_h,u=a.offsetX,h=a.offsetY;try{var d,g=e(o[i].coorPt.entries());try{for(g.s();!(d=g.n()).done;){var b=t(d.value,1)[0];return!(o[i].coorPt[b].x+u<r||o[i].coorPt[b].x+u>r+l||o[i].coorPt[b].y+h<s||o[i].coorPt[b].y+h>s+c)}}catch(f){g.e(f)}finally{g.f()}}catch(f){return!1}}},{key:"validateXYDistance",value:function(n){try{var i,a=e(n.polygons.entries());try{for(a.s();!(i=a.n()).done;){var o,r=t(i.value,1)[0],s=e(n.polygons[r].coorPt.entries());try{for(s.s();!(o=s.n()).done;){var l=t(o.value,1)[0],c=n.polygons[r].coorPt[l].y-n.img_y;n.polygons[r].coorPt[l].distancetoImg.x=n.polygons[r].coorPt[l].x-n.img_x,n.polygons[r].coorPt[l].distancetoImg.y=c}}catch(u){s.e(u)}finally{s.f()}}}catch(u){a.e(u)}finally{a.f()}}catch(u){console.log("validateXYDistance",u)}}},{key:"setPolygonLineWidth",value:function(t,e){try{t.polygons=t.polygons.map(function(t,n){return Object.assign(Object.assign({},t),{lineWidth:n===e?3:2})})}catch(n){console.log("setPolygonLineWidth",n)}}},{key:"drawNewPolygon",value:function(n,i,a,o,r){var s;try{if(this.redraw(n,i,a,o,-1),null===(s=this.tmpPolygon)||void 0===s?void 0:s.coorPt){var l,c=e(this.tmpPolygon.coorPt.entries());try{for(c.s();!(l=c.n()).done;){var u=t(l.value,2),h=(u[0],u[1]),d=h.x,g=h.y;a.strokeStyle="green",a.fillStyle="green",a.beginPath(),a.arc(d,g,this.radius,0,2*Math.PI),a.fill(),a.closePath(),a.stroke()}}catch(p){c.e(p)}finally{c.f()}a.beginPath(),a.lineWidth=this.tmpPolygon.lineWidth,a.strokeStyle=this.tmpPolygon.color,a.fillStyle=this.tmpPolygon.color,a.moveTo(this.tmpPolygon.coorPt[0].x,this.tmpPolygon.coorPt[0].y);var b,f=e(this.tmpPolygon.coorPt.entries());try{for(f.s();!(b=f.n()).done;){var m=t(b.value,1)[0];m+1<this.tmpPolygon.coorPt.length&&a.lineTo(this.tmpPolygon.coorPt[m+1].x,this.tmpPolygon.coorPt[m+1].y)}}catch(p){f.e(p)}finally{f.f()}if(r){a.closePath(),a.stroke();var v=n.polygons.length;this.tmpPolygon&&(n.polygons.push(Object(Ae.a)(this.tmpPolygon)),this.setPolygonLineWidth(n,v),this.tmpPolygon=null),this.setNewPolygon(!1)}else a.stroke()}}catch(p){console.log("drawNewPolygon",p)}}},{key:"drawfromPreviousPoint",value:function(t,e){var n,i=t.offsetX,a=t.offsetY,o=t.layerX,r=t.layerY;try{if(null===(n=this.tmpPolygon)||void 0===n?void 0:n.coorPt){var s=this.tmpPolygon.coorPt.length,l=0===i?o:i,c=0===a?r:a,u=s-1;e.beginPath(),e.moveTo(this.tmpPolygon.coorPt[u].x,this.tmpPolygon.coorPt[u].y),e.lineTo(l,c),e.stroke()}}catch(h){console.log("drawfromPreviousPoint",h)}}},{key:"returnTempPoly",value:function(){try{return this.tmpPolygon}catch(t){return console.log("returnTempPoly",t),null}}},{key:"setPolygonCoordinate",value:function(t,e,n){var i=t.offsetX,a=t.offsetY,o=n.polygonIndex,r=n.pointIndex;try{o>-1&&r>-1&&(e.polygons[o].coorPt[r].x=i,e.polygons[o].coorPt[r].y=a)}catch(s){console.log("setPolygonCoordinate",s)}}},{key:"insidePolygonArea",value:function(t,e){var n=e.offsetX,i=e.offsetY;try{for(var a=!1,o=0,r=t.length-1;o<t.length;r=o++)t[o].y>i!=t[r].y>i&&n<(t[r].x-t[o].x)*(i-t[o].y)/(t[r].y-t[o].y)+t[o].x&&(a=!a);return a}catch(s){return console.log("insidePolygonArea",s),!1}}},{key:"calPolygonArea",value:function(t){var e=t.coorPt;try{for(var n=0,i=e.length-1,a=0;a<e.length;++a)n+=(e[i].x+e[a].x)*(e[i].y-e[a].y),i=a;return Math.abs(n/2)}catch(o){return console.log("calPolygonArea",o),-1}}},{key:"findPolygonArea",value:function(n,i){var a=i.polygons;try{var o,r=-1,s=1e7,l=e(a.entries());try{for(l.s();!(o=l.n()).done;){var c=t(o.value,2),u=c[0],h=c[1];if(this.insidePolygonArea(h.coorPt,n)){var d=this.calPolygonArea(h);d<s&&(r=u,s=d)}}}catch(g){l.e(g)}finally{l.f()}return r}catch(g){return console.log("findPolygonArea",g),-1}}},{key:"findClickPoint",value:function(t,e,n){try{for(var i={polygonIndex:-1,pointIndex:-1},a=0;a<n.polygons.length;++a)for(var o=0;o<n.polygons[a].coorPt.length;++o)if(Math.sqrt(Math.pow(t-n.polygons[a].coorPt[o].x,2)+Math.pow(e-n.polygons[a].coorPt[o].y,2))<=this.radius){i.polygonIndex=a,i.pointIndex=o;break}return i}catch(r){return console.log("findClickPoint",r),{polygonIndex:-1,pointIndex:-1}}}},{key:"isNewPolygon",value:function(){try{return this.isNewPoly}catch(t){return console.log("isNewPolygon",t),!1}}},{key:"deleteSinglePolygon",value:function(t,e,n){try{t.polygons.splice(e,1),this.selectedPolygonIndex=-1,n(!0)}catch(i){console.log("deleteSinglePolygon",i)}}},{key:"scalePolygons",value:function(n,i,a){var o=i.factor,r=i.newX,s=i.newY;try{var l,c=e(n.polygons.entries());try{for(c.s();!(l=c.n()).done;){var u,h=t(l.value,1)[0],d=e(n.polygons[h].coorPt.entries());try{for(d.s();!(u=d.n()).done;){var g=t(u.value,1)[0];n.polygons[h].coorPt[g].x=n.polygons[h].coorPt[g].distancetoImg.x*o+r,n.polygons[h].coorPt[g].y=n.polygons[h].coorPt[g].distancetoImg.y*o+s,n.polygons[h].coorPt[g].distancetoImg.x=n.polygons[h].coorPt[g].x-r,n.polygons[h].coorPt[g].distancetoImg.y=n.polygons[h].coorPt[g].y-s}}catch(b){d.e(b)}finally{d.f()}}}catch(b){c.e(b)}finally{c.f()}this.setPolygonLineWidth(n,-1),a&&a(!0)}catch(b){console.log("scalePolygons",b)}}},{key:"panPolygons",value:function(n,i,a){var o;try{if(i&&(null===(o=this.tmpPolygon)||void 0===o?void 0:o.coorPt)){var r,s=e(this.tmpPolygon.coorPt.entries());try{for(s.s();!(r=s.n()).done;){var l=t(r.value,1)[0];this.tmpPolygon.coorPt[l].x=n.img_x+this.tmpPolygon.coorPt[l].distancetoImg.x,this.tmpPolygon.coorPt[l].y=n.img_y+this.tmpPolygon.coorPt[l].distancetoImg.y}}catch(f){s.e(f)}finally{s.f()}}var c,u=e(n.polygons.entries());try{for(u.s();!(c=u.n()).done;){var h,d=t(c.value,1)[0],g=e(n.polygons[d].coorPt.entries());try{for(g.s();!(h=g.n()).done;){var b=t(h.value,1)[0];n.polygons[d].coorPt[b].x=n.img_x+n.polygons[d].coorPt[b].distancetoImg.x,n.polygons[d].coorPt[b].y=n.img_y+n.polygons[d].coorPt[b].distancetoImg.y}}catch(f){g.e(f)}finally{g.f()}}}catch(f){u.e(f)}finally{u.f()}a&&a(!0)}catch(f){console.log("panPolygons",f)}}},{key:"resetClipPath",value:function(t){var e=t.img_x,n=t.img_y,i=t.img_w,a=t.img_h;try{this.clipPath=null,this.clipPath=new Path2D,this.clipPath.rect(e,n,i,a)}catch(o){console.log(o)}}}]),n}()).\u0275fac=function(t){return new(t||He)},He.\u0275prov=C.Fb({token:He,factory:He.\u0275fac,providedIn:"any"}),He),Qe=["canvasdrawing"],tn=["floatdiv"],en=["lbltypetxt"],nn=["availablelbl"],an=["crossH"],on=["crossV"];function rn(t,e){if(1&t){var n=C.Qb();C.Pb(0,"li",16),C.Wb("click",function(){C.qc(n);var t=e.$implicit;return C.ac().labelNameClicked(t.name)}),C.Pb(1,"span",17),C.yc(2),C.Ob(),C.Pb(3,"span",18),C.yc(4),C.Ob(),C.Ob()}if(2&t){var i=e.$implicit;C.xb(2),C.zc(i.name),C.xb(2),C.zc(i.count)}}function sn(t,e){1&t&&(C.Pb(0,"li",19),C.Pb(1,"div",20),C.yc(2),C.bc(3,"translate"),C.Ob(),C.Pb(4,"div",20),C.yc(5),C.bc(6,"translate"),C.Ob(),C.Ob()),2&t&&(C.xb(2),C.zc(C.cc(3,2,"searchLabel.labelNotExist")),C.xb(3),C.zc(C.cc(6,4,"searchLabel.enterToAdd")))}var ln,cn=function(){return{standalone:!0}},un=function(t){return{cursor:t}},hn=((ln=function(){function n(t,e,a,o,s,l,c,u,h,d){var g=this;r(this,n),this._segCanvasService=t,this._imgLblStateService=e,this._undoRedoService=a,this._copyPasteService=o,this._annotateSelectState=s,this._zoomService=l,this._mouseCursorService=c,this._shortcutKeyService=u,this._sharedUndoRedoService=h,this._labelColorListService=d,this.image=new Image,this.isMouseWithinPoint=!1,this.altKey=!1,this.ctrlKey=!1,this.unsubscribe$=new x.a,this.mousedown=!1,this.showDropdownLabelBox=!1,this.labelSearch="",this.labelList=[],this.allLabelList=[],this.invalidInput=!1,this._imgSrc="",this._tabStatus=[],this._onChangeMetadata=new C.n,this._onChangeAnnotationLabel=new C.n,this._clickAbilityToggle=new C.n,this._onCompleteRefresh=new C.n,this._onEnterLabel=new C.n,this.validateInputLabel=function(t){var e=t.target.value,n=e.trim();if(n)if(g._tabStatus.some(function(t){var e=t.label_list;return e&&e.length&&e.some(function(t){return t===n})}))g.invalidInput=!0,console.error("Invalid existing label input");else{g.invalidInput=!1,g.showDropdownLabelBox=!1,g._onChangeAnnotationLabel.emit({label:e,index:g.annotateState.annotation}),g._selectMetadata.polygons[g.annotateState.annotation].label=e,g._undoRedoService.isStateChange(g._selectMetadata.polygons)&&g._undoRedoService.appendStages({meta:g._selectMetadata,method:"draw"});var a=g._tabStatus.map(function(t){return t.label_list||[]}).filter(function(t){return t.length>0})[0];g._onEnterLabel.emit({action:1,label_list:a?[].concat(i(a),[e]):[e]}),g.labelSearch=""}}}return l(n,[{key:"ngOnInit",value:function(){var t=this;this.getLabelList(),this._imgLblStateService.action$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){var n=e.clear,i=e.fitCenter,a=Object(v.c)(e,["clear","fitCenter"]);t.segState=Object.assign(Object.assign({},a),{clear:n,fitCenter:i}),i&&t.imgFitToCenter(),n&&(t._selectMetadata.polygons=[],t._undoRedoService.appendStages({meta:t._selectMetadata,method:"draw"}),t.redrawImage(t._selectMetadata),t.emitMetadata())}),this._annotateSelectState.labelStaging$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){t.annotateState=e,t._selectMetadata&&(t._segCanvasService.setSelectedPolygon(e.annotation,t._selectMetadata),t.redrawImage(t._selectMetadata))}),this._zoomService.zoom$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.zoom=e}),this._mouseCursorService.mouseCursor$.pipe(Object(y.a)(this.unsubscribe$)).subscribe(function(e){return t.mouseCursor=e}),this._sharedUndoRedoService.action.subscribe(function(e){switch(e){case"SEG_UNDO":t.undoAction();break;case"SEG_REDO":t.redoAction()}})}},{key:"ngOnChanges",value:function(t){var n,i,a,o=this;if((null===(n=t._selectMetadata)||void 0===n?void 0:n.previousValue)&&(null===(i=t._selectMetadata)||void 0===i?void 0:i.currentValue)&&this.redrawImage(this._selectMetadata),(null===(a=t._imgSrc)||void 0===a?void 0:a.currentValue)&&(this.initializeCanvas(),this._undoRedoService.clearAllStages(),this._segCanvasService.setSelectedPolygon(-1),this.loadImage(t._imgSrc.currentValue)),t._tabStatus){var r,s=!0,l=e(this._tabStatus);try{for(l.s();!(r=l.n()).done;)if(!r.value.closed){s=!1;break}}catch(c){l.e(c)}finally{l.f()}this.canvas&&(!0===s?(this.initializeCanvas(),this.imgFitToCenter()):this.redrawImage(this._selectMetadata))}t._refreshAllLabelColor&&this._refreshAllLabelColor&&setTimeout(function(){return o.updateLabelColor()})}},{key:"initializeCanvas",value:function(){this.canvas.nativeElement.style.width="80%",this.canvas.nativeElement.style.height="90%",this.canvas.nativeElement.width=this.canvas.nativeElement.offsetWidth,this.canvas.nativeElement.height=this.canvas.nativeElement.offsetHeight,this.canvasContext=this.canvas.nativeElement.getContext("2d")}},{key:"loadImage",value:function(t){var e=this;this.image.src=t,this.image.onload=function(){var t=e._selectMetadata,n=t.img_x,i=t.img_y;e._selectMetadata.img_w=e._selectMetadata.img_w<1?e._selectMetadata.img_ori_w:e._selectMetadata.img_w,e._selectMetadata.img_h=e._selectMetadata.img_h<1?e._selectMetadata.img_ori_h:e._selectMetadata.img_h,e._segCanvasService.setGlobalXY({offsetX:n,offsetY:i}),e.imgFitToCenter(),e.emitMetadata(),e.changeMouseCursorState()}}},{key:"emitMetadata",value:function(){this._onChangeMetadata.emit(this._selectMetadata)}},{key:"annotateStateChange",value:function(t){t&&this._annotateSelectState.setState(t)}},{key:"resetZoom",value:function(){this._zoomService.resetZoomScale()}},{key:"imgFitToCenter",value:function(){var t=this;try{var e=this._segCanvasService.calScaleToFitScreen(this._selectMetadata,this.canvas.nativeElement);this._selectMetadata.img_w*=e.factor,this._selectMetadata.img_h*=e.factor,this._selectMetadata.img_x=e.newX,this._selectMetadata.img_y=e.newY,this._segCanvasService.scalePolygons(this._selectMetadata,e),this._segCanvasService.setGlobalXY({offsetX:e.newX,offsetY:e.newY}),this._segCanvasService.panPolygons(this._selectMetadata,!1,function(e){if(e){var n=Object(Ae.a)(t._selectMetadata);t._undoRedoService.isMethodChange("zoom")?t._undoRedoService.appendStages({meta:n,method:"zoom"}):t._undoRedoService.replaceStages({meta:n,method:"zoom"})}}),this.redrawImage(this._selectMetadata),this.resetZoom(),this.canvasContext.canvas.style.transformOrigin="0 0",this.canvasContext.canvas.style.transform="scale(1, 1)"}catch(n){console.log("imgFitToCenter",n)}}},{key:"redrawImage",value:function(t){var e,n,i=t.img_x,a=t.img_y,o=t.img_w,r=t.img_h;if(this.clearcanvas(),this.canvasContext.drawImage(this.image,i,a,o,r),0!==(null===(e=this._tabStatus[2].annotation)||void 0===e?void 0:e.length)){this.getLabelList();var s=this._tabStatus[2].annotation&&null!==(n=this._tabStatus[2].annotation[0].polygons)&&void 0!==n?n:[];this.sortingLabelList(this.labelList,s)}this.labelColorList=this._labelColorListService.getLabelColorList(this._projectName),this._segCanvasService.drawAllPolygon(this._selectMetadata,this.canvasContext,this.annotateState.annotation,this.labelColorList)}},{key:"clearcanvas",value:function(){var t=this.canvas.nativeElement,e=t.width,n=t.height;this.canvasContext.clearRect(0,0,e,n)}},{key:"mouseScroll",value:function(t){try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint){var e=this._zoomService.calculateZoomScale(t,this.zoom,this.canvas.nativeElement),n=e.scale,i=e.x,a=e.y;this.segState.scroll&&(this._mouseCursorService.changeCursor(this.mouseCursor,t),this._zoomService.validateZoomScale(this.canvasContext,n)&&(this.canvasContext.canvas.style.transformOrigin="".concat(t.offsetX,"px ").concat(t.offsetY,"px"),this.canvasContext.canvas.style.transform="scale(".concat(n,", ").concat(n,")"),this._zoomService.setState({scale:n}))),this.canvasContext.canvas.scrollTop=a,this.canvasContext.canvas.scrollLeft=i,this._copyPasteService.isAvailable()&&this._copyPasteService.clear()}}catch(o){console.log("mouseScroll",o)}}},{key:"validateEndDrawPolygon",value:function(t,e,n){var i=t.isActiveModal,a=t.draw;return!i&&a&&e&&"none"!==n.canvas.style.pointerEvents}},{key:"canvasDblClickEvent",value:function(t){this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)&&(this._segCanvasService.isNewPolygon()&&this.completingPolygon(),this.segState.draw)&&this.mouseMoveDrawCanvas(t)&&this.annotateStateChange({annotation:this.annotateState.annotation,isDlbClick:!0})}},{key:"canvasKeyDownEvent",value:function(t){var e=this,n=t.ctrlKey,i=t.metaKey,a=t.shiftKey,o=t.key;try{if(this.validateEndDrawPolygon(this.segState,this.isMouseWithinPoint,this.canvasContext)){if(this._segCanvasService.isNewPolygon())switch(o){case"Enter":this.completingPolygon();break;case"Escape":this.resetDrawingPolygon();break;case"Backspace":this.removeLastPointPolygon()}else switch(o){case"Delete":case"Backspace":this.deletePolygon()}this.movePolygon(o)}n&&(this._imgLblStateService.setState({draw:!1,drag:!0,scroll:!0}),this.intervalId=setInterval(function(){e._segCanvasService.panPolygons(e._selectMetadata,!0,function(){}),e._segCanvasService.drawNewPolygon(e._selectMetadata,e.image,e.canvasContext,e.canvas.nativeElement,!1)},100)),"x"!==o&&"X"!==o||(clearInterval(this.intervalId),this._segCanvasService.setGlobalXY(this.mouseEvent),this._imgLblStateService.setState({draw:!0,drag:!1,scroll:!1})),this._shortcutKeyService.checkKey(n,i,a,o,"copy")?this.copyPolygon():this._shortcutKeyService.checkKey(n,i,a,o,"paste")?this.pastePolygon():this._shortcutKeyService.checkKey(n,i,a,o,"redo")?this._segCanvasService.isNewPolygon()||this.redoAction():this._shortcutKeyService.checkKey(n,i,a,o,"undo")&&(this._segCanvasService.isNewPolygon()||this.undoAction())}catch(r){console.log("canvasKeyDownEvent",r)}}},{key:"completingPolygon",value:function(){this._segCanvasService.drawNewPolygon(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,!0),this.positioningLabelListPopup(this._selectMetadata.polygons),this.annotateStateChange({annotation:this._selectMetadata.polygons.length-1}),this._segCanvasService.validateXYDistance(this._selectMetadata),this._undoRedoService.appendStages({meta:Object(Ae.a)(this._selectMetadata),method:"draw"}),this.redrawImage(this._selectMetadata),this.emitMetadata()}},{key:"resetDrawingPolygon",value:function(){this._segCanvasService.resetDrawing(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement)}},{key:"removeLastPointPolygon",value:function(){this._segCanvasService.removeLastPoint(this._selectMetadata,this.canvasContext,this.image,this.canvas.nativeElement),this.redrawImage(this._selectMetadata),this.mouseMoveDrawCanvas(this.mouseEvent)}},{key:"deletePolygon",value:function(){var t=this;this._segCanvasService.deleteSinglePolygon(this._selectMetadata,this.annotateState.annotation,function(e){e&&(t.annotateStateChange(),t.redrawImage(t._selectMetadata),t._undoRedoService.appendStages({meta:Object(Ae.a)(t._selectMetadata),method:"draw"}),t.emitMetadata())})}},{key:"movePolygon",value:function(t){var e="ArrowLeft"===t?"left":"ArrowRight"===t?"right":"ArrowUp"===t?"up":"ArrowDown"===t&&"down";e&&this.keyMoveBox(e)}},{key:"copyPolygon",value:function(){this.annotateState.annotation>-1&&this._copyPasteService.copy(this._selectMetadata.polygons[this.annotateState.annotation])}},{key:"pastePolygon",value:function(){this._copyPasteService.isAvailable()&&(this._selectMetadata.polygons.push(this._copyPasteService.paste()),this.annotateStateChange({annotation:this._selectMetadata.polygons.length-1}),this._segCanvasService.validateXYDistance(this._selectMetadata)),this._undoRedoService.appendStages({meta:Object(Ae.a)(this._selectMetadata),method:"draw"}),this.emitMetadata()}},{key:"redoAction",value:function(){if(this._undoRedoService.isAllowRedo()){var t=this._undoRedoService.redo();this._selectMetadata=Object(Ae.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}},{key:"undoAction",value:function(){if(this._undoRedoService.isAllowUndo()){var t=this._undoRedoService.undo();this._selectMetadata=Object(Ae.a)(null==t?void 0:t.meta),this.redrawImage(this._selectMetadata),this.emitMetadata()}}},{key:"keyMoveBox",value:function(t){var e=this;try{this._selectMetadata.polygons[this.annotateState.annotation]&&this._segCanvasService.keyboardMovePolygon(this._selectMetadata,t,this.annotateState.annotation,this.image,this.canvasContext,this.canvas.nativeElement,function(t){t&&(e._undoRedoService.appendStages({meta:Object(Ae.a)(e._selectMetadata),method:"draw"}),e._segCanvasService.validateXYDistance(e._selectMetadata),e.redrawImage(e._selectMetadata),e.emitMetadata())})}catch(n){console.log("keyMoveBox",n)}}},{key:"mouseDown",value:function(t){var e;try{if(this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint)if(this.mousedown=!0,this.segState.drag&&(this.changeMouseCursorState({grabbing:!0}),this._segCanvasService.setPanXY(t),this.initializeCanvas(),this.redrawImage(this._selectMetadata)),this.segState.draw){this.getLabelList();var n=this._tabStatus[2].annotation&&null!==(e=this._tabStatus[2].annotation[0].polygons)&&void 0!==e?e:[];this.sortingLabelList(this.labelList,n),this.showDropdownLabelBox=!1;var i=this._segCanvasService.mouseDownDraw(t,this._selectMetadata,this.canvas.nativeElement,this.image,this.canvasContext,this.ctrlKey,this.altKey,this.labelList);if(i>-1)this._segCanvasService.setGlobalXY(t);else{var a=this._selectMetadata,o=a.img_x,r=a.img_y;this._segCanvasService.setGlobalXY({offsetX:o,offsetY:r})}this.annotateStateChange({annotation:i}),this.redrawImage(this._selectMetadata),this.mouseMoveDrawCanvas(t)}else this.segState.draw&&!this.mousedown&&this.redrawImage(this._selectMetadata);else this.mousedown=!1}catch(s){console.log("mouseDown",s)}}},{key:"mouseUp",value:function(t){try{this.isMouseWithinPoint=this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t);var e=this._segCanvasService.isNewPolygon();if(this._selectMetadata&&this.isMouseWithinPoint)if(this.mousedown){var n=this._selectMetadata,i=n.img_x,a=n.img_y;this.segState.drag&&this._segCanvasService.setGlobalXY({offsetX:i,offsetY:a}),this.segState.draw&&!e&&this.annotateState.annotation>-1&&this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(Ae.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.setGlobalXY({offsetX:i,offsetY:a}),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}else{var o=this._segCanvasService.getClickPoint(),r=o.pointIndex,s=o.polygonIndex;this.segState.draw&&s>-1&&r>-1?this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&(this._undoRedoService.appendStages({meta:Object(Ae.a)(this._selectMetadata),method:"draw"}),this._segCanvasService.resetClickPoint(),this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata()):this.segState.draw&&(this._segCanvasService.validateXYDistance(this._selectMetadata),this.redrawImage(this._selectMetadata),this.emitMetadata())}this.mousedown=!1}catch(l){console.log("mouseUp",l)}}},{key:"mouseMove",value:function(t){var e=this;try{if(this.isMouseWithinPoint=this._selectMetadata&&this._segCanvasService.mouseClickWithinPointPath(this._selectMetadata,t),this.isMouseWithinPoint&&!this.showDropdownLabelBox&&this.segState.draw&&this.segState.crossLine?(this.crossH.nativeElement.style.visibility="visible",this.crossV.nativeElement.style.visibility="visible",this.crossH.nativeElement.style.top=t.pageY.toString()+"px",this.crossV.nativeElement.style.left=t.pageX.toString()+"px"):(this.crossH.nativeElement.style.visibility="hidden",this.crossV.nativeElement.style.visibility="hidden"),this.isMouseWithinPoint){if(this.segState.drag&&this.mousedown){var n=this._segCanvasService.getDiffXY(t),i=n.diffX,a=n.diffY;this._selectMetadata.img_x=i,this._selectMetadata.img_y=a,this._segCanvasService.panPolygons(this._selectMetadata,!1,function(t){if(t){var n=Object(Ae.a)(e._selectMetadata);e._undoRedoService.isMethodChange("pan")?e._undoRedoService.appendStages({meta:n,method:"pan"}):e._undoRedoService.replaceStages({meta:n,method:"pan"})}}),this.redrawImage(this._selectMetadata)}else this.segState.drag&&!this.mousedown&&this.changeMouseCursorState({grab:!0});this.segState.draw&&(this.mouseEvent=t,this.mouseMoveDrawCanvas(t)?(this.crossH.nativeElement.style.visibility="hidden",this.crossV.nativeElement.style.visibility="hidden",this.changeMouseCursorState({move:!0})):this.changeMouseCursorState({crosshair:!0}))}else this.changeMouseCursorState(),this.mousedown=!1}catch(o){console.log("mouseMove",o)}}},{key:"mouseMoveDrawCanvas",value:function(t){var e=this;return this._segCanvasService.mouseMoveDraw(this._selectMetadata,this.image,this.canvasContext,this.canvas.nativeElement,t,this.ctrlKey,this.mousedown,function(t){e.redrawImage(e._selectMetadata)})}},{key:"changeMouseCursorState",value:function(t){this._mouseCursorService.setState(t)}},{key:"mouseOut",value:function(t){var e,n;try{this.crossH.nativeElement.style.visibility="hidden",this.crossV.nativeElement.style.visibility="hidden",this.segState.drag&&this.isMouseWithinPoint&&this.mousedown&&(this._segCanvasService.setGlobalXY(t),this.redrawImage(this._selectMetadata)),"canvasstyle"!==t.target.className&&!t.target.className.includes("unclosedOut")||(null===(e=t.relatedTarget)||void 0===e?void 0:e.className.includes("unclosedOut"))||(null===(n=t.relatedTarget)||void 0===n?void 0:n.className.includes("canvasstyle"))||(this.showDropdownLabelBox=!1,0!==this._selectMetadata.polygons.filter(function(t){return!t.label}).length&&(this._selectMetadata.polygons=this._selectMetadata.polygons.filter(function(t){return""!==t.label}),this._onChangeMetadata.emit(this._selectMetadata),this.redrawImage(this._selectMetadata),alert("Some bounding boxes will be deleted because they were not labelled."))),this.isMouseWithinPoint=!1}catch(i){console.log("mouseOut",i)}}},{key:"currentCursor",value:function(){return this._mouseCursorService.changeCursor(this.mouseCursor)}},{key:"positioningLabelListPopup",value:function(t){var e=this,n=t[this._selectMetadata.polygons.length-1].coorPt[this._selectMetadata.polygons[this._selectMetadata.polygons.length-1].coorPt.length-1].y*(100/document.documentElement.clientHeight)+8.5,i=t[this._selectMetadata.polygons.length-1].coorPt[this._selectMetadata.polygons[this._selectMetadata.polygons.length-1].coorPt.length-1].x*(100/document.documentElement.clientWidth)+2.5;n<9&&(n=9),n>76&&(n=76),i<2.5&&(i=2.5),i>66&&(i=66),this.floatdiv.nativeElement.style.top=n.toString()+"vh",this.floatdiv.nativeElement.style.left=i.toString()+"vw",this.showDropdownLabelBox=!0,this.labelSearch="",setTimeout(function(){e.lbltypetxt.nativeElement.focus()},100)}},{key:"getLabelList",value:function(){var t,e=this;this.labelList=[],this.allLabelList=[],(null!==(t=this._tabStatus[1].label_list)&&void 0!==t?t:[]).forEach(function(t){var n={name:t,count:0};e.labelList.push(n),e.allLabelList.push(n)})}},{key:"sortingLabelList",value:function(t,e){var n=this;t.forEach(function(t,i){var a=t.name;n.labelList[i].count=e.filter(function(t){return t.label===a}).length,n.allLabelList[i].count=e.filter(function(t){return t.label===a}).length}),this.labelList.sort(function(t,e){return t.count<e.count?1:e.count<t.count?-1:0}),this.allLabelList.sort(function(t,e){return t.count<e.count?1:e.count<t.count?-1:0})}},{key:"labelNameClicked",value:function(t){var e=this;this.showDropdownLabelBox=!1,this._onChangeAnnotationLabel.emit({label:t,index:this.annotateState.annotation}),this._selectMetadata.polygons[this.annotateState.annotation].label=t,this._undoRedoService.isStateChange(this._selectMetadata.polygons)&&this._undoRedoService.appendStages({meta:this._selectMetadata,method:"draw"}),this._selectMetadata.polygons=this._selectMetadata.polygons.map(function(t){return Object.assign(Object.assign({},t),{color:e.labelColorList.get(t.label)})}),this.emitMetadata()}},{key:"labelTypeTextChange",value:function(t){this.labelList=this.allLabelList.filter(function(e){return e.name.includes(t)})}},{key:"cancelClickAbilityToggleStatus",value:function(){this._clickAbilityToggle.emit(!1)}},{key:"updateLabelColor",value:function(){var n,i=this,a=[],o=e(this._selectMetadata.polygons.entries());try{for(o.s();!(n=o.n()).done;){var r=t(n.value,2),s=(r[0],r[1].id);a.push(s)}}catch(l){o.e(l)}finally{o.f()}this._selectMetadata.polygons=this._selectMetadata.polygons.map(function(t){return Object.assign(Object.assign({},t),{color:i.labelColorList.get(t.label),region:String(a.indexOf(t.id)+1)})}),this.redrawImage(this._selectMetadata),this.emitMetadata(),this._onCompleteRefresh.emit()}},{key:"ngOnDestroy",value:function(){this._annotateSelectState.setState(),this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),n}()).\u0275fac=function(t){return new(t||ln)(C.Jb(qe),C.Jb(T.a),C.Jb(Nt),C.Jb(ze),C.Jb(D),C.Jb(Te),C.Jb(It),C.Jb(Ne),C.Jb(Z),C.Jb(Y))},ln.\u0275cmp=C.Db({type:ln,selectors:[["image-labelling-segmentation"]],viewQuery:function(t,e){var n;1&t&&(C.Dc(Qe,!0),C.Dc(tn,!0),C.Dc(en,!0),C.Dc(nn,!0),C.Dc(an,!0),C.Dc(on,!0)),2&t&&(C.mc(n=C.Xb())&&(e.canvas=n.first),C.mc(n=C.Xb())&&(e.floatdiv=n.first),C.mc(n=C.Xb())&&(e.lbltypetxt=n.first),C.mc(n=C.Xb())&&(e.availablelbl=n.first),C.mc(n=C.Xb())&&(e.crossH=n.first),C.mc(n=C.Xb())&&(e.crossV=n.first))},hostBindings:function(t,e){1&t&&C.Wb("wheel",function(t){return e.mouseScroll(t)})("DOMMouseScroll",function(t){return e.mouseScroll(t)})("dblclick",function(t){return e.canvasDblClickEvent(t)})("keydown",function(t){return e.canvasKeyDownEvent(t)},!1,C.pc)("mousedown",function(t){return e.mouseDown(t)})("mouseup",function(t){return e.mouseUp(t)})("mousemove",function(t){return e.mouseMove(t)})("mouseout",function(t){return e.mouseOut(t)})},inputs:{_selectMetadata:"_selectMetadata",_imgSrc:"_imgSrc",_tabStatus:"_tabStatus",_projectName:"_projectName",_refreshAllLabelColor:"_refreshAllLabelColor"},outputs:{_onChangeMetadata:"_onChangeMetadata",_onChangeAnnotationLabel:"_onChangeAnnotationLabel",_clickAbilityToggle:"_clickAbilityToggle",_onCompleteRefresh:"_onCompleteRefresh",_onEnterLabel:"_onEnterLabel"},features:[C.vb],decls:17,vars:10,consts:[[1,"floatdiv","unclosedOut",3,"hidden"],["floatdiv",""],["autocomplete","off","spellcheck","false",1,"unclosedOut"],["type","text",1,"lbltypetxt","unclosedOut",3,"ngClass","ngModel","ngModelOptions","ngModelChange","keydown.enter"],["lbltypetxt",""],[1,"availablelbl","unclosedOut"],["availablelbl",""],[1,"lblList","unclosedOut"],["class","lblElement unclosedOut",3,"click",4,"ngFor","ngForOf"],["class","unclosedOut notExist",4,"ngIf"],[1,"canvasstyle",3,"ngStyle","click"],["canvasdrawing",""],["id","cross-h",1,"crosses"],["crossH",""],["id","cross-v",1,"crosses"],["crossV",""],[1,"lblElement","unclosedOut",3,"click"],[1,"lblName","unclosedOut"],[1,"lblCount","unclosedOut"],[1,"unclosedOut","notExist"],[1,"unclosedOut"]],template:function(t,e){1&t&&(C.Pb(0,"div"),C.Pb(1,"div",0,1),C.Pb(3,"form",2),C.Pb(4,"input",3,4),C.Wb("ngModelChange",function(t){return e.labelSearch=t})("ngModelChange",function(t){return e.labelTypeTextChange(t)})("keydown.enter",function(t){return e.validateInputLabel(t)}),C.Ob(),C.Ob(),C.Pb(6,"div",5,6),C.Pb(8,"ul",7),C.wc(9,rn,5,2,"li",8),C.wc(10,sn,7,6,"li",9),C.Ob(),C.Ob(),C.Ob(),C.Pb(11,"canvas",10,11),C.Wb("click",function(){return e.cancelClickAbilityToggleStatus()}),C.Ob(),C.Kb(13,"div",12,13),C.Kb(15,"div",14,15),C.Ob()),2&t&&(C.xb(1),C.gc("hidden",!e.showDropdownLabelBox),C.xb(3),C.gc("ngClass",e.invalidInput?"invalidInput":"validInput")("ngModel",e.labelSearch)("ngModelOptions",C.ic(7,cn)),C.xb(5),C.gc("ngForOf",e.labelList),C.xb(1),C.gc("ngIf",0===e.labelList.length),C.xb(1),C.gc("ngStyle",C.jc(8,un,e.currentCursor())))},directives:[Ft.n,Ft.g,Ft.h,Ft.a,m.j,Ft.f,Ft.i,m.k,m.l,m.m],pipes:[$.c],styles:[".floatdiv[_ngcontent-%COMP%]{position:absolute;z-index:10000}.lbltypetxt[_ngcontent-%COMP%]{height:4vh;border-radius:.2vh;border:.2vw solid grey;border-bottom:none;padding:0;text-indent:.4vw}.availablelbl[_ngcontent-%COMP%], .lbltypetxt[_ngcontent-%COMP%]{width:11vw;color:snow;font-size:2vh;background-color:#000;outline:none}.availablelbl[_ngcontent-%COMP%]{height:15vh;font-weight:700;border-radius:.2vh;border:.2vw solid grey;border-top:.1vh dotted snow;overflow:auto;scrollbar-width:none}.availablelbl[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.lblList[_ngcontent-%COMP%]{padding:0 .2vw}.lblElement[_ngcontent-%COMP%]{list-style-type:none;margin:.3vh 0;padding:0;justify-content:space-between;display:flex}.lblElement[_ngcontent-%COMP%]:hover{background-color:#111}.lblName[_ngcontent-%COMP%]{margin-left:.2vw;overflow:hidden;text-overflow:ellipsis}.lblCount[_ngcontent-%COMP%]{background-color:#222;margin-right:.2vw;padding:.1vh .2vw;border-radius:.2vw}.notExist[_ngcontent-%COMP%]{color:#999;font-size:1.5vh}.canvasstyle[_ngcontent-%COMP%]{position:fixed;left:2.2vw;right:auto;top:8vh;overflow:scroll;scrollbar-width:none;margin:0;padding:0;outline:none;border:none}#cross-h[_ngcontent-%COMP%]{left:0;width:100%;height:1px;margin-top:-1px;opacity:.4}#cross-v[_ngcontent-%COMP%]{top:0;height:100%;width:1px;margin-left:-1px;opacity:.4}.crosses[_ngcontent-%COMP%]{position:fixed;background-color:#dc1d46;box-shadow:0 0 5px #646464;pointer-events:none;visibility:hidden;z-index:100}"],changeDetection:0}),ln),dn=s("QWV2"),gn=["subLabelSelect"],bn=["renameInput"],fn=["deleteBtn"];function mn(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"image-labelling-object-detection",82),C.Wb("_onChangeMetadata",function(t){return C.qc(n),C.ac().onChangeMetadata(t)})("_onChangeAnnotationLabel",function(t){return C.qc(n),C.ac().onChangeAnnotationLabel(t)})("_onEnterLabel",function(t){return C.qc(n),C.ac().onProcessLabel(t)})("_clickAbilityToggle",function(t){return C.qc(n),C.ac().changeClickAbilityToggleStatus(t)})("_onRefresh",function(){C.qc(n);var t=C.ac();return t.completeRefreshLabelColor(),t.refreshAllBndBoxLabelColor()}),C.Ob(),C.Mb()}if(2&t){var i=C.ac();C.xb(1),C.gc("_selectMetadata",i.selectedMetaData)("_imgSrc",i.imgSrc)("_tabStatus",i.tabStatus)("_projectName",i.selectedProjectName)("_refreshAllLabelColor",i.refreshAllLabelColor)}}function vn(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"image-labelling-segmentation",83),C.Wb("_onChangeMetadata",function(t){return C.qc(n),C.ac().onChangeMetadata(t)})("_onChangeAnnotationLabel",function(t){return C.qc(n),C.ac().onChangeAnnotationLabel(t)})("_onEnterLabel",function(t){return C.qc(n),C.ac().onProcessLabel(t)})("_clickAbilityToggle",function(t){return C.qc(n),C.ac().changeClickAbilityToggleStatus(t)})("_onCompleteRefresh",function(){C.qc(n);var t=C.ac();return t.completeRefreshLabelColor(),t.refreshAllPolygonsLabelColorAndRegion()}),C.Ob(),C.Mb()}if(2&t){var i=C.ac();C.xb(1),C.gc("_selectMetadata",i.selectedMetaData)("_imgSrc",i.imgSrc)("_tabStatus",i.tabStatus)("_projectName",i.selectedProjectName)("_refreshAllLabelColor",i.refreshAllLabelColor)}}function pn(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"div",84),C.Pb(2,"label",85),C.Pb(3,"input",86),C.Wb("change",function(){return C.qc(n),C.ac().onSwitchSaveType()}),C.Ob(),C.Kb(4,"span",87),C.Pb(5,"p"),C.yc(6),C.bc(7,"translate"),C.Ob(),C.Ob(),C.Kb(8,"span",88),C.Pb(9,"label",85),C.Pb(10,"input",86),C.Wb("change",function(){return C.qc(n),C.ac().onSwitchSaveType()}),C.Ob(),C.Kb(11,"span",87),C.Pb(12,"p"),C.yc(13),C.bc(14,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Pb(15,"div",89),C.Wb("click",function(){return C.qc(n),C.ac().showAdvSettings()}),C.yc(16),C.bc(17,"translate"),C.Ob(),C.Pb(18,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("pascalVoc")}),C.yc(19,"Pascal VOC"),C.Ob(),C.Kb(20,"br"),C.Pb(21,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("yolo")}),C.yc(22,"YOLO"),C.Ob(),C.Kb(23,"br"),C.Pb(24,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("ocr")}),C.yc(25,"Text OCR"),C.Ob(),C.Kb(26,"br"),C.Pb(27,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("label")}),C.yc(28,"Label"),C.Ob(),C.Kb(29,"br"),C.Mb()}if(2&t){var i=C.ac();C.xb(3),C.gc("checked",i.saveType.saveCurrentImage),C.xb(3),C.zc(C.cc(7,5,"singleSave")),C.xb(4),C.gc("checked",i.saveType.saveBulk),C.xb(3),C.zc(C.cc(14,7,"bulkSave")),C.xb(3),C.zc(C.cc(17,9,"advModal.title"))}}function _n(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("coco")}),C.yc(2,"COCO"),C.Ob(),C.Kb(3,"br"),C.Pb(4,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("json")}),C.yc(5,"JSON"),C.Ob(),C.Kb(6,"br"),C.Pb(7,"button",90),C.Wb("click",function(){return C.qc(n),C.ac().onClickDownload("label")}),C.yc(8,"Label"),C.Ob(),C.Kb(9,"br"),C.Mb()}}function yn(t,e){1&t&&(C.Pb(0,"p",91),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.Ac(" ",C.cc(2,1,"advModal.instructionText")," "))}function xn(t,e){if(1&t&&(C.Pb(0,"div",92),C.Pb(1,"label",93),C.Pb(2,"input",86),C.Wb("change",function(){var t=e.$implicit;return t.isChoosen=!t.isChoosen}),C.Ob(),C.Kb(3,"span",87),C.Ob(),C.Pb(4,"label",94),C.yc(5),C.Ob(),C.Ob()),2&t){var n=e.$implicit;C.xb(2),C.gc("checked",n.isChoosen),C.xb(3),C.zc(n.label)}}function wn(t,e){1&t&&(C.Pb(0,"div"),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.Ac(" ",C.cc(2,1,"advModal.noLabel")," "))}function Sn(t,e){if(1&t){var n=C.Qb();C.Pb(0,"button",95),C.Wb("click",function(){return C.qc(n),C.ac().saveAdvSettings()}),C.yc(1),C.bc(2,"translate"),C.Ob()}2&t&&(C.xb(1),C.Ac(" ",C.cc(2,1,"advModal.btnSave")," "))}function kn(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"option",96),C.yc(2),C.Ob(),C.Mb()),2&t){var n=e.$implicit,i=C.ac(2);C.xb(1),C.gc("value",n)("selected",n===i.currentAnnotationLabel),C.xb(1),C.Ac(" ",n," ")}}function Cn(t,e){if(1&t&&(C.Nb(0),C.wc(1,kn,3,3,"ng-container",23),C.Mb()),2&t){var n=e.$implicit;C.xb(1),C.gc("ngForOf",n.label_list)}}function Pn(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"option",96),C.yc(2),C.Ob(),C.Mb()),2&t){var n=e.$implicit,i=C.ac().$implicit;C.xb(1),C.gc("value",n)("selected",i.label_list[0].label),C.xb(1),C.Ac(" ",n," ")}}function On(t,e){if(1&t&&(C.Nb(0),C.wc(1,Pn,3,3,"ng-container",23),C.Mb()),2&t){var n=e.$implicit;C.xb(1),C.gc("ngForOf",n.label_list)}}function Mn(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"div",97),C.yc(2),C.Ob(),C.Mb()),2&t){var n=C.ac();C.xb(2),C.Ac(" ",n.subLabelValidateMsg," ")}}function Ln(t,e){if(1&t){var n=C.Qb();C.Nb(0),C.Pb(1,"div",98),C.Pb(2,"label",99),C.yc(3),C.bc(4,"translate"),C.Ob(),C.Pb(5,"label",100),C.yc(6),C.bc(7,"translate"),C.Ob(),C.Kb(8,"span",101),C.Pb(9,"button",102),C.Wb("click",function(){C.qc(n);var t=e.index,i=C.ac(2).index;return C.ac(3).onRemoveSubLabel(i,t)}),C.yc(10," X "),C.Ob(),C.Ob(),C.Mb()}if(2&t){var i=e.$implicit;C.xb(3),C.Bc("",C.cc(4,4,"labellingArea.label"),": ",i.label,""),C.xb(3),C.Bc("",C.cc(7,6,"labellingArea.regionInfo"),": ",i.region,"")}}function In(t,e){if(1&t&&(C.Nb(0),C.Pb(1,"h2",19),C.yc(2),C.bc(3,"translate"),C.Ob(),C.wc(4,Ln,11,8,"ng-container",23),C.Mb()),2&t){var n=C.ac().$implicit;C.xb(2),C.zc(C.cc(3,2,"labellingArea.addedSubLabel")),C.xb(2),C.gc("ngForOf",n.subLabel)}}function An(t,e){if(1&t&&(C.Nb(0),C.wc(1,In,5,4,"ng-container",5),C.Mb()),2&t){var n=e.$implicit,i=e.index,a=C.ac(3);C.xb(1),C.gc("ngIf",(null==n||null==n.subLabel?null:n.subLabel.length)>0&&i===a.currentAnnotationIndex)}}function jn(t,e){if(1&t&&(C.Nb(0),C.wc(1,An,2,1,"ng-container",23),C.Mb()),2&t){var n=e.$implicit;C.xb(1),C.gc("ngForOf",null==n?null:n.polygons)}}function Bn(t,e){if(1&t&&(C.Nb(0),C.wc(1,jn,2,1,"ng-container",23),C.Mb()),2&t){var n=e.$implicit;C.xb(1),C.gc("ngForOf",n.annotation)}}function En(t,e){if(1&t&&(C.Pb(0,"tr"),C.Kb(1,"td",103),C.bc(2,"translate"),C.Kb(3,"td",103),C.bc(4,"translate"),C.Ob()),2&t){var n=e.$implicit;C.xb(1),C.hc("innerHTML",C.cc(2,2,n.shortcutKey),C.rc),C.xb(2),C.hc("innerHTML",C.cc(4,4,n.functionality),C.rc)}}function zn(t,e){if(1&t&&(C.Pb(0,"p",49),C.yc(1),C.bc(2,"translate"),C.Kb(3,"br"),C.yc(4),C.Ob()),2&t){var n=C.ac();C.xb(1),C.Ac(" ",C.cc(2,2,"location"),""),C.xb(3),C.Ac("",n.modalSpanLocationPath," ")}}function Dn(t,e){1&t&&(C.Pb(0,"label",97),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.zc(C.cc(2,1,"renameModal.fail")))}function Tn(t,e){1&t&&(C.Pb(0,"label",97),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.zc(C.cc(2,1,"renameModal.nameExist")))}function Nn(t,e){1&t&&(C.Pb(0,"label",97),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.zc(C.cc(2,1,"renameModal.illegal")))}function Rn(t,e){1&t&&(C.Pb(0,"label",97),C.yc(1),C.bc(2,"translate"),C.Ob()),2&t&&(C.xb(1),C.zc(C.cc(2,1,"renameModal.nameEmpty")))}function Fn(t,e){if(1&t&&C.Kb(0,"app-bar-chart",104),2&t){var n=C.ac();C.gc("labelStats",n.labelStats)}}function Wn(t,e){1&t&&(C.Pb(0,"div",105),C.Pb(1,"h3"),C.yc(2,"No Labels"),C.Ob(),C.Ob())}function Un(t,e){1&t&&(C.Pb(0,"div",106),C.Pb(1,"h3"),C.yc(2,"No Annotation"),C.Ob(),C.Ob())}function Xn(t,e){1&t&&(C.Pb(0,"div",107),C.Pb(1,"h3"),C.yc(2),C.bc(3,"translate"),C.Ob(),C.Ob()),2&t&&(C.xb(2),C.zc(C.cc(3,1,"addImageModal.notification")))}function Yn(t,e){if(1&t){var n=C.Qb();C.Pb(0,"div"),C.Pb(1,"div",108),C.Pb(2,"div",109),C.yc(3),C.Ob(),C.Pb(4,"span",110),C.Pb(5,"div",111),C.Wb("click",function(){C.qc(n);var t=e.index;return C.ac().deleteSelectedImage(t)}),C.yc(6,"\u2716"),C.Ob(),C.Ob(),C.Ob(),C.Kb(7,"img",112),C.Ob()}if(2&t){var i=e.$implicit,a=e.index,o=C.ac();C.xb(3),C.zc(o.imageNameList[a]),C.xb(4),C.gc("src",i,C.sc)}}function Kn(t,e){if(1&t&&(C.Pb(0,"div",113),C.Pb(1,"p",114),C.yc(2),C.Ob(),C.Ob()),2&t){var n=C.ac();C.xb(2),C.Ac(" ",n.isSelectedImagesAdding?"Adding the images to project folder. Please Wait...":"Finished added images to project folder"," ")}}var Zn,Hn,$n,Vn,Jn=[{path:"",component:(Zn=function(){function a(e,o,s,l,c,u,h,d,g,b,f,m){var C=this;r(this,a),this._router=e,this._imgLblApiService=o,this._modalService=s,this._dataSetService=l,this._annotateService=c,this._imgLblActionService=u,this._imgLblLayoutService=h,this._imgLblModeService=d,this._languageService=g,this._spinnerService=b,this._exportSaveFormatService=f,this._labelColorService=m,this.currentUrl="",this.selectedProjectName="",this.imgSrc="",this.loading=!1,this.thumbnailList=[],this.unsubscribe$=new x.a,this.subject$=new x.a,this.tabStatus=[{name:"labellingProject.project",closed:!1},{name:"labellingProject.label",closed:!1,label_list:[]},{name:"labellingProject.annotation",closed:!1,annotation:[]}],this.mainLabelRegionVal="",this.subLabelRegionVal="",this.subLabelValidateMsg="",this.currentAnnotationLabel="",this.currentAnnotationIndex=-1,this.currentImageDisplayIndex=-1,this.isLoading=!1,this.showLoading=!1,this.processingNum=0,this.unsupportedImageList=[],this.spanClass="",this.modalSpanMessage="",this.modalSpanLocationPath="",this.sliceNum=0,this.labelList=[],this.isOverlayOn=!1,this.blockLoadThumbnails=!1,this.totalUuid=0,this.labelChoosen=[],this.tempLabelChoosen=[],this.warningMessage="",this.imgPath="",this.imgPathSplit=[],this.newImageName="",this.selectedUuid="",this.renameImageErrorCode=-1,this.dontAskDelete=!1,this.labelledImage=0,this.unLabelledImage=0,this.labelStats=[],this.isFetching=!0,this.noLabel=!0,this.noAnnotation=!0,this.imageNameList=[],this.imageBase64List=[],this.isSelectedImagesAdding=!1,this.imageLoading=!1,this.progress="",this.refreshAllLabelColor=!1,this.modalExportOptions="modal-export-options",this.modalExportProject="modal-export-project",this.modalShortcutKeyInfo="modal-shortcut-key-info",this.modalUnsupportedImage="modal-unsupported-image",this.modalExportWarning="modalExportWarning",this.modalRenameImage="modal-rename-image",this.modalDeleteImage="modal-delete-image",this.modalIdProjectStats="modal-project-stats",this.modalAddImage="modal-add-image",this.modalSubmitAddedImage="modal-submit-added-image",this.modalImageLoadingProgress="modal-image-loading-progress",this.exportModalBodyStyle={minHeight:"15vh",maxHeight:"15vh",minWidth:"19.5vw",maxWidth:"19.5vw",margin:"15vw 71vh",overflow:"none"},this.saveModalBodyStyle={maxHeight:"80vh",minWidth:"28vw",maxWidth:"28vw",margin:"10vh 28vw",overflow:"none"},this.advModalBodyStyle={maxHeight:"80vh",minWidth:"18vw",maxWidth:"18vw",margin:"10vh 28vw",overflow:"none"},this.infoModalBodyStyle={maxHeight:"50vh",minWidth:"40vw",maxWidth:"40vw",margin:"20vh 23vw",padding:"0vh 0vw 3vh 0vw",overflow:"none"},this.exportProjectBodyStyle={minHeight:"10vh",maxHeight:"30vh",minWidth:"31vw",maxWidth:"31vw",margin:"15vw 71vh",overflow:"none"},this.exportWarningBodyStyle={minHeight:"10vh",maxHeight:"20vh",minWidth:"31vw",maxWidth:"31vw",margin:"15vw 71vh",overflow:"none"},this.unsupportedImageBodyStyle={minHeight:"18vh",maxHeight:"30vh",minWidth:"31vw",maxWidth:"31vw",margin:"15vw 71vh",overflow:"none"},this.renameImageBodyStyle={minHeight:"18vh",maxHeight:"30vh",minWidth:"20vw",maxWidth:"20vw",margin:"15vw 71vh",overflow:"none"},this.deleteImageBodyStyle={minHeight:"18vh",maxHeight:"30vh",minWidth:"20vw",maxWidth:"20vw",margin:"15vw 71vh",overflow:"none"},this.projectStatsBodyStyle={minHeight:"50vh",minWidth:"50vw",maxWidth:"50vw",margin:"7vw 36vh",overflow:"none"},this.addImageBodyStyle={height:"73vh",width:"83vw",margin:"5vw 5vh",overflowY:"none"},this.submitAddedImageBodyStyle={height:"27vh",width:"30vw",margin:"15vw 71vh",overflow:"none"},this.imageLoadingProgressBodyStyle={minHeight:"18vh",maxHeight:"30vh",minWidth:"20vw",maxWidth:"20vw",margin:"15vw 71vh",overflow:"none",background:"none"},this.saveType={saveCurrentImage:!0,saveBulk:!1},this.projectList={projects:[],isUploading:!1,isFetching:!1},this.startProject=function(e){C.isLoading=!0,C.selectedProjectName=e;var a=C._dataSetService.checkProjectStatus(e),o=C._dataSetService.updateProjectLoadStatus(e),r=C._dataSetService.checkExistProjectStatus(e),s=C._dataSetService.getThumbnailList;C.subjectSubscription=C.subject$.pipe(Object(p.a)(function(){return Object(w.a)([a])}),Object(_.a)(function(e){var n=t(e,1)[0],i=n.message,a=n.content;C.totalUuid=a[0].total_uuid,C.projectList={isUploading:C.projectList.isUploading,isFetching:C.projectList.isFetching,projects:C.projectList.projects.map(function(t){return t.project_name===a[0].project_name?Object.assign(Object.assign({},a[0]),{created_date:t.created_date}):t})};var o=a[0].is_loaded;return 1===i&&!o}),Object(p.a)(function(e){return t(e,1)[0].message?Object(w.a)([o,r]):[]}),Object(p.a)(function(a){var o=t(a,2);n(o[0]);var l=o[1],c=l.message,u=l.uuid_list,h=l.label_list;return 2===c?(C.labelList=i(h),C.tabStatus[1].label_list=C.labelList,u.length>0?u.map(function(t){return s(e,t)}):[]):Object(S.a)(500).pipe(Object(p.a)(function(){return r}),Object(_.a)(function(t){return 2===t.message}),Object(p.a)(function(t){return C.tabStatus[1].label_list=t.label_list,t.uuid_list.length>0?t.uuid_list.slice(C.sliceNum,C.sliceNum+=20).map(function(t){return s(e,t)}):[]}))}),Object(p.a)(function(t){return t})).subscribe(function(t){C.thumbnailList=[].concat(i(C.thumbnailList),[t]),C.onChangeSchema=Object.assign(Object.assign({},C.onChangeSchema),{totalNumThumbnail:C.thumbnailList.length})},function(t){},function(){C.isLoading=!1,C._annotateService.labelStaging$.pipe(Object(y.a)(C.unsubscribe$)).subscribe(function(t){var e=t.annotation;t.isDlbClick?(C.currentAnnotationIndex=e,C.tabStatus.forEach(function(t){var n=t.annotation;return null==n?void 0:n.forEach(function(t){var n=t.bnd_box,i=t.polygons,a=null!=n?n:i;if(a){var o=a[e],r=o.label,s=o.region;C.currentAnnotationLabel=r,C.mainLabelRegionVal=s||""}else console.log("missing prop bnd_box OR polygons")})}),C._imgLblActionService.setState({isActiveModal:!0,draw:!1,drag:!1,scroll:!1}),C.onDisplayModal()):(C.currentAnnotationLabel="",C.currentAnnotationIndex=e)}),C._imgLblActionService.action$.pipe(Object(y.a)(C.unsubscribe$)).subscribe(function(t){var e=t.clear,n=t.save,i=t.keyInfo;e&&(C.thumbnailList[0].bnd_box&&(C.thumbnailList[C.currentImageDisplayIndex].bnd_box=[]),C.thumbnailList[0].polygons&&(C.thumbnailList[C.currentImageDisplayIndex].polygons=[]),C.onChangeSchema=Object.assign(Object.assign({},C.onChangeSchema),{hasAnnotation:!1})),n&&(C.labelChoosen=C.tabStatus[1].label_list?C.tabStatus[1].label_list.map(function(t){return{label:t,isChoosen:!0}}):[],C.onDisplayModal("modal-save")),i&&C.onDisplayShortcutKeyInfo()}),C.navigateByAction({thumbnailAction:1}),C._spinnerService.hideSpinner()}),C.subject$.next()},this.loadThumbnails=function(){if(!C.blockLoadThumbnails&&C.sliceNum<C.totalUuid){C.blockLoadThumbnails=!0;var t=C._dataSetService.checkExistProjectStatus(C.selectedProjectName),e=C._dataSetService.getThumbnailList;C.subjectSubscription=C.subject$.pipe(Object(_.a)(),Object(p.a)(function(){return Object(S.a)(500).pipe(Object(p.a)(function(){return t}),Object(_.a)(function(t){return 2===t.message}),Object(p.a)(function(t){var n=t.uuid_list;return n.length>0?n.slice(C.sliceNum,C.sliceNum+=20).map(function(t){return e(C.selectedProjectName,t)}):[]}))}),Object(p.a)(function(t){return t})).subscribe(function(t){C.thumbnailList=[].concat(i(C.thumbnailList),[t]),C.onChangeSchema=Object.assign(Object.assign({},C.onChangeSchema),{totalNumThumbnail:C.thumbnailList.length})},function(t){},function(){C.blockLoadThumbnails=!1,C._spinnerService.hideSpinner()}),C.subject$.next()}},this.onCheckBboxMetadata=function(){C.tabStatus.forEach(function(t){var e=t.annotation;e&&(null==e||e.forEach(function(t){var e;null===(e=t.bnd_box)||void 0===e||e.forEach(function(t,e){if(t.x1>t.x2){var n=t.x1;t.x1=t.x2,t.x2=n}if(t.y1>t.y2){var i=t.y1;t.y1=t.y2,t.y2=i}})}))})},this.updateProjectProgress=function(){var t=C.selectedProjectName;C.onCheckBboxMetadata(),C._imgLblLayoutService.updateProjectProgress(C.tabStatus,t)},this.onChangeMetadata=function(t){C.tabStatus=C.tabStatus.map(function(e){return e.annotation?Object.assign(Object.assign({},e),{annotation:[t]}):e}),C.thumbnailList=C.thumbnailList.map(function(e,n){return C.currentImageDisplayIndex===n?t:e});var e=t.bnd_box?t.bnd_box.length>0:t.polygons.length>0;C.onChangeSchema=Object.assign(Object.assign({},C.onChangeSchema),{hasAnnotation:e}),C.updateProjectProgress()},this.onToggleTab=function(t){var e=t.name,n=t.closed;!C.tabStatus.some(function(t){return t.name.toLowerCase()===e.toLowerCase()&&t.closed===n})&&(C.tabStatus=C.tabStatus.map(function(t){return t.name.toLowerCase()===e.toLowerCase()?Object.assign(Object.assign({},t),{closed:n}):Object.assign({},t)})),C.tabClosedStatus={name:e,closed:n}},this.onExport=function(){C.modalSpanMessage="",C.modalSpanLocationPath="",C._modalService.open(C.modalExportOptions)},this.exportProject=function(t){"cfgdata"===t&&C.processingNum++;var e=C.selectedProjectName,n=C._imgLblApiService.exportProject(e,t),i=C._imgLblApiService.exportProjectStatus();C.subjectSubscription=C.subject$.pipe(Object(_.a)(),Object(p.a)(function(){return n}),Object(p.a)(function(t){return 1===t.message?Object(S.a)(500).pipe(Object(p.a)(function(){return i}),Object(_.a)(function(t){var e=t.export_status;return C.isOverlayOn=1===e,C.isLoading=1===e,0===e||2===e||3===e})):Object(k.a)(function(t){return console.error(t),t})})).subscribe(function(n){var i=n.export_status,a=n.project_config_path;"cfgdata"===t&&C.processingNum--,2===i?C._languageService._translate.get("exportSuccess").subscribe(function(t){C.toggleExportProjectModalMessage(!0),C.modalSpanMessage=e+t,C.modalSpanLocationPath=a,C.processIsSuccess(!0)}):C._languageService._translate.get("exportFailed").subscribe(function(t){C.toggleExportProjectModalMessage(!0),C.modalSpanMessage=t+e,C.processIsSuccess(!1)})},function(t){},function(){C.closeExportProjectModal()}),C.subject$.next()},this.toggleExportProjectModalMessage=function(t){t?C._modalService.open(C.modalExportProject):C._modalService.close(C.modalExportProject)},this.processIsSuccess=function(t){C.spanClass=t?"validation-success":"validation-error"},this.onReload=function(){var t=C.selectedProjectName,e=C._imgLblApiService.reloadProject(t),n=C._imgLblApiService.reloadProjectStatus(t),i=C._dataSetService.getThumbnailList,a=[];C.subjectSubscription=C.subject$.pipe(Object(_.a)(),Object(p.a)(function(){return e}),Object(p.a)(function(e){return 5!==(a=e.message)&&1===a?Object(S.a)(500).pipe(Object(p.a)(function(){return n}),Object(_.a)(function(t){var e=t.file_system_status,n=t.unsupported_image_list;return C.unsupportedImageList=n,3===e||0===e}),Object(p.a)(function(e){C.isLoading=!0;var n=[];C.thumbnailList.forEach(function(t){n.push(t.uuid)}),e.uuid_add_list.forEach(function(t){n.push(t),C.totalUuid++}),e.uuid_delete_list.forEach(function(t){n=n.filter(function(e){return e!==t}),C.totalUuid--}),C.sliceNum=0;var a=3===e.file_system_status&&n.length>0?n.slice(C.sliceNum,C.sliceNum+=20).map(function(e){return i(t,e)}):[];return C.thumbnailList=[],a}),Object(p.a)(function(t){return t})):Object(k.a)(function(t){return console.error(t),C.isLoading=!1,t});var a})).subscribe(function(t){C.isLoading=!0,a.push(t)},function(t){},function(){C.thumbnailList=a,C.onChangeSchema=Object.assign(Object.assign({},C.onChangeSchema),{totalNumThumbnail:C.thumbnailList.length}),C.currentImageDisplayIndex=-1,C.navigateByAction({thumbnailAction:1}),C.isLoading=!1,C.unsupportedImageList.length>0&&C._dataSetService.downloadUnsupportedImageList(t,C.unsupportedImageList).then(function(t){t&&C._modalService.open(C.modalUnsupportedImage)})}),C.subject$.next()},this.navigateByUrl=function(t){var e=t.url;e?C._router.navigate([e]):console.error("No url received from child component")},this.keyDownEvent=function(t){var e=t.key,n=t.repeat;if(C.selectedMetaData&&!C._modalService.isOpened()){var i=C.selectedMetaData;switch(e){case"ArrowLeft":C._imgLblActionService.action$.pipe(Object(_.a)()).subscribe(function(t){t.draw||n||C.navigateByAction({thumbnailAction:-1})});break;case"ArrowRight":C._imgLblActionService.action$.pipe(Object(_.a)()).subscribe(function(t){t.draw||n||C.navigateByAction({thumbnailAction:1})});break;case"F2":C.getImageNameFromPath(i),C.renameImageErrorCode=-1,C._modalService.open(C.modalRenameImage),C._renameInput.nativeElement.focus();break;case"Delete":if(-1!==C.currentAnnotationIndex)break;if(C.getImageNameFromPath(i),!C.dontAskDelete){C._modalService.open(C.modalDeleteImage),C._deleteBtn.nativeElement.focus();break}C.onSubmitDeleteImage()}}},this.navigateByAction=function(t){var e=t.thumbnailAction;if(e){var n=C._imgLblLayoutService.calculateIndex(e,C.currentImageDisplayIndex,C.thumbnailList.length);if(n!==C.currentImageDisplayIndex){C.currentImageDisplayIndex=n;var i=C.thumbnailList.find(function(t,e){return e===n}),a=C.thumbnailList.findIndex(function(t,e){return e===n});a+3===C.thumbnailList.length&&C.loadThumbnails(),i&&-1!==a&&!C.showLoading&&C.displayImage(Object.assign(Object.assign({},i),{thumbnailIndex:a}))}}},this.displayImage=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.selectedProjectName,i=t.thumbnailIndex,a=Object(v.c)(t,["thumbnailIndex"]);(null===(e=C.selectedMetaData)||void 0===e?void 0:e.uuid)!==a.uuid&&(C.showLoading=!0,C._imgLblApiService.getBase64Thumbnail(n,a.uuid).pipe(Object(_.a)()).subscribe(function(t){var e=t.message,n=t.img_src;if(1===e){C.selectedMetaData=a,C.imgSrc=n,C.currentImageDisplayIndex=i;var o=a.bnd_box?a.bnd_box.length>0:a.polygons&&a.polygons.length>0||!1;C.onChangeSchema=Object.assign(Object.assign({},C.onChangeSchema),{currentThumbnailIndex:i+1,thumbnailName:a.img_path,hasAnnotation:o})}},function(t){return console.error(t)},function(){return C.showLoading=!1}))},this.onProcessLabel=function(t){var e=t.selectedLabel,n=t.label_list,i=t.action,a=e&&!i?n.filter(function(t){return t!==e}):n;C._imgLblApiService.updateLabelList(C.selectedProjectName,a.length>0?a:[]).pipe(Object(_.a)()).subscribe(function(t){1===t.message?C.tabStatus=C._imgLblLayoutService.displayLabelList(C.tabStatus,a):console.error("Error while updating label")}),C.updateProjectProgress()},this.onChangeAnnotationLabel=function(t){t.index=C.currentAnnotationIndex;var e=C._labelColorService.getLabelColorList(C.selectedProjectName);C.selectedMetaData&&(C.selectedMetaData.polygons&&(C.selectedMetaData.polygons[t.index].label=t.label,C.selectedMetaData.polygons[t.index].color=e.get(t.label),C.currentAnnotationLabel=t.label),C.selectedMetaData.bnd_box&&(C.selectedMetaData.bnd_box[t.index].color=e.get(t.label))),C.tabStatus=C._imgLblLayoutService.changeAnnotationLabel(C.tabStatus,t),C.updateStateToRenderChild(),C.updateProjectProgress()},this.onDeleteAnnotation=function(t){C.tabStatus=C._imgLblLayoutService.deleteAnnotation(C.tabStatus,t),C.updateStateToRenderChild(),C.updateProjectProgress()},this.onDisplayModal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"modal-image-labelling";C.subLabelRegionVal="",C.subLabelValidateMsg="",C._modalService.open(t)},this.onCloseModal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"modal-image-labelling";C._imgLblActionService.setState({isActiveModal:!1,draw:!0,scroll:!0}),C._modalService.close(t)},this.onChangeInput=function(t,e){var n=t.target.value;"main"===e?C.mainLabelRegionVal=n:C.subLabelRegionVal=n},this.onSubmitLabel=function(){var t=C._subLabelSelect.nativeElement.value;if(t.trim()){var e=!1;C.tabStatus.forEach(function(n){var i=n.annotation;return null==i?void 0:i.forEach(function(n){var i=n.bnd_box,a=n.polygons,o=null!=i?i:a;if(o){var r=o[C.currentAnnotationIndex].subLabel;r&&(null==r?void 0:r.length)>0&&(null==r||r.some(function(n){var i=n.label;return e=i===t}))}else console.log("missing prop bnd_box OR polygons")})}),C.currentAnnotationLabel===t&&(e=!0),e?C.subLabelValidateMsg="Invalid of duplicate label: "+t:(C.tabStatus=C._imgLblLayoutService.submitLabel(C.tabStatus,t,C.currentAnnotationIndex,{mainLabelRegion:C.mainLabelRegionVal,subLabelRegion:C.subLabelRegionVal}),C.subLabelValidateMsg="",C.updateStateToRenderChild(),C.updateProjectProgress()),C.subLabelRegionVal=""}},this.onRemoveSubLabel=function(t,e){C.tabStatus=C._imgLblLayoutService.removeSubLabel(C.tabStatus,{selectedAnnoIndex:t,selectedSubLabelIndex:e}),C.updateStateToRenderChild(),C.updateProjectProgress()},this.updateStateToRenderChild=function(){C.tabStatus.forEach(function(t){var e=t.annotation;e&&(C.thumbnailList=C.thumbnailList.map(function(t){var n;return null!==(n=e.find(function(e){var n=e.uuid;return t.uuid===n}))&&void 0!==n?n:t}),C.selectedMetaData=e[0])})},this.resetProjectStatus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.selectedProjectName;t.trim()&&C._dataSetService.manualCloseProject(t).pipe(Object(y.a)(C.unsubscribe$)).subscribe(function(t){n(t),C._router.navigate(["/"])})},this.onSwitchSaveType=function(){C.saveType={saveCurrentImage:!C.saveType.saveCurrentImage,saveBulk:!C.saveType.saveBulk}},this.onClickDownload=function(t){return Object(v.a)(C,void 0,void 0,regeneratorRuntime.mark(function e(){var n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.labelChoosen.filter(function(t){return!0===t.isChoosen}).map(function(t){return t.label}),i=this.labelChoosen.map(function(t){return t.label}),this.saveType.saveBulk&&this.processingNum++,e.next=4,this._exportSaveFormatService.exportSaveFormat(Object.assign(Object.assign(Object.assign(Object.assign({},this.saveType),{saveFormat:t,metadata:this.selectedMetaData,index:this.currentAnnotationIndex,projectName:this.selectedProjectName,fullLabelList:i}),(this.saveType.saveBulk||"ocr"===t||"json"===t||"coco"===t)&&{projectFullMetadata:this.thumbnailList}),"json"!==t&&{labelList:n}));case 4:0===(a=e.sent).message&&(this.warningMessage=a.msg,this._modalService.open(this.modalExportWarning)),this.saveType.saveBulk&&this.processingNum--;case 6:case"end":return e.stop()}},e,this)}))},this.toggleProjectStats=function(){C.noLabel=!1,C.noAnnotation=!0,C._dataSetService.getProjectStats(C.selectedProjectName).pipe().subscribe(function(t){console.log(t),t&&(C.labelledImage=t.labeled_image,C.unLabelledImage=t.unlabeled_image,C.labelStats=[],t.label_per_class_in_project.forEach(function(t){t.count>0&&(C.noAnnotation=!1),C.labelStats.push({name:t.label,value:t.count})}),0===t.label_per_class_in_project.length&&(C.noLabel=!0,C.noAnnotation=!1),C.isFetching=!1,C._modalService.open(C.modalIdProjectStats))})},this._languageService.initializeLanguage("image-labelling",["image-labelling-en","image-labelling-cn","image-labelling-ms"])}return l(a,[{key:"ngOnInit",value:function(){this.currentUrl=this._router.url;var t=this._imgLblLayoutService.getRouteState(history).projectName;this.selectedProjectName=t,this.onChangeSchema=Object.assign(Object.assign({},this.onChangeSchema),{totalNumThumbnail:this.thumbnailList.length}),this.startProject(this.selectedProjectName)}},{key:"closeExportProjectModal",value:function(){this._modalService.close(this.modalExportOptions)}},{key:"getImageNameFromPath",value:function(t){this.imgPath=t.img_path;var e,n=window.navigator.userAgent;e=n.startsWith("Mac")||n.startsWith("Linux")?"/":"\\",this.imgPathSplit=this.imgPath.split(e);var i=this.imgPathSplit.pop();this.newImageName=i?i.split(".")[0]:"",this.imageExt=i?"."+i.split(".").pop():"",this.selectedUuid=t.uuid}},{key:"onWindowClose",value:function(t){this.resetProjectStatus(),t.preventDefault()}},{key:"onChangeLabel",value:function(t){this.onChangeAnnotationLabel({index:this.currentAnnotationIndex,label:t})}},{key:"onDisplayShortcutKeyInfo",value:function(){this._modalService.open(this.modalShortcutKeyInfo)}},{key:"onLoadMoreThumbnails",value:function(){this.loadThumbnails()}},{key:"onRenameImage",value:function(t){this.getImageNameFromPath(t),this.renameImageErrorCode=-1,this._modalService.open(this.modalRenameImage),this._renameInput.nativeElement.focus()}},{key:"onDeleteImage",value:function(t){if(-1===this.currentAnnotationIndex){if(this.getImageNameFromPath(t),!this.dontAskDelete)return this._modalService.open(this.modalDeleteImage),void this._deleteBtn.nativeElement.focus();this.onSubmitDeleteImage()}}},{key:"onChangeImageName",value:function(t){this.newImageName=t.target.value}},{key:"onSubmitRenameImage",value:function(){var t=this;""!==this.newImageName?this._imgLblApiService.renameImage(this.selectedUuid,this.newImageName+this.imageExt,this.selectedProjectName).subscribe(function(e){if(1===e.message){var n,i=t.thumbnailList.findIndex(function(e){return e.uuid===t.selectedUuid}),a=window.navigator.userAgent;n=a.startsWith("Mac")||a.startsWith("Linux")?"/":"\\",t.thumbnailList[i].img_path=t.imgPathSplit.join(n)+n+t.newImageName+t.imageExt,t.newImageName="",t._modalService.close(t.modalRenameImage)}else 3!==e.error_code&&(t.renameImageErrorCode=e.error_code)}):this.renameImageErrorCode=3}},{key:"onSubmitDeleteImage",value:function(){var t=this;this._imgLblApiService.deleteImage(this.selectedUuid,this.imgPath,this.selectedProjectName).subscribe(function(e){1===e.message&&(t.thumbnailList=t.thumbnailList.filter(function(t){return e.uuid_list.includes(t.uuid)}),t.totalUuid=e.uuid_list.length,t.onChangeSchema.currentThumbnailIndex===t.totalUuid+1?(t.onChangeSchema.currentThumbnailIndex--,t.currentImageDisplayIndex--,t.displayOtherImgAfterDelete()):t.displayOtherImgAfterDelete(),t.sliceNum--,t.thumbnailList.length<15&&t.onLoadMoreThumbnails(),t._modalService.close(t.modalDeleteImage))})}},{key:"displayOtherImgAfterDelete",value:function(){var t=this,e=this.thumbnailList.find(function(e,n){return n===t.currentImageDisplayIndex}),n=this.thumbnailList.findIndex(function(e,n){return n===t.currentImageDisplayIndex});n+3===this.thumbnailList.length&&this.loadThumbnails(),e&&-1!==n&&!this.showLoading&&this.displayImage(Object.assign(Object.assign({},e),{thumbnailIndex:n}))}},{key:"showAdvSettings",value:function(){this.tempLabelChoosen=this.labelChoosen.map(function(t){return Object.assign({},t)}),this.onDisplayModal("modal-adv")}},{key:"saveAdvSettings",value:function(){this.labelChoosen=this.tempLabelChoosen.map(function(t){return Object.assign({},t)}),this.onCloseModal("modal-adv")}},{key:"toggleAddImage",value:function(){this._modalService.open(this.modalAddImage)}},{key:"toggleSubmitAddedImage",value:function(){this._modalService.open(this.modalSubmitAddedImage)}},{key:"onCloseAddImageModal",value:function(){this.imageNameList.splice(0,this.imageNameList.length),this.imageBase64List.splice(0,this.imageBase64List.length)}},{key:"addNewImages",value:function(t){var e=this;this.selectedFiles=t.target.files,this.totalImage=this.selectedFiles.length;for(var n=function(t){var n=new FileReader;n.onload=function(){n.result&&(e.imageBase64List.includes(n.result)||e.imageBase64List.push(n.result),e.imageNameList.includes(e.selectedFiles[t].name)||e.imageNameList.push(e.selectedFiles[t].name),e.imageLoadingProgress(e.imageBase64List.length,e.totalImage))},e.selectedFiles[t]&&n.readAsDataURL(e.selectedFiles[t])},i=0;i<=this.selectedFiles.length;i++)n(i)}},{key:"imageLoadingProgress",value:function(t,e){this._modalService.open(this.modalImageLoadingProgress),this.progress=(t/e*100).toFixed(0).trim()+"%",this.imageLoading=t<this.totalImage,t===this.totalImage&&(this.totalImage=0,this._modalService.close(this.modalImageLoadingProgress))}},{key:"deleteSelectedImage",value:function(t){this.imageNameList.splice(t,1),this.imageBase64List.splice(t,1)}},{key:"submitAddedImages",value:function(){var t=this;this._modalService.close(this.modalSubmitAddedImage),this._modalService.close(this.modalAddImage),this.isOverlayOn=!0,this.isSelectedImagesAdding=!0;var e=this._imgLblApiService.submitSelectedImageFile(this.selectedProjectName,this.imageNameList,this.imageBase64List),n=this._imgLblApiService.addImagesStatus(this.selectedProjectName);this.subjectSubscription=this.subject$.pipe(Object(_.a)(),Object(p.a)(function(){return e}),Object(p.a)(function(t){return 1===t.message?Object(S.a)(500).pipe(Object(p.a)(function(){return n}),Object(_.a)(function(t){var e=t.add_image_status;return 0===e||1===e})):Object(k.a)(function(t){return console.error(t),t})})).subscribe(function(e){0===e.add_image_status&&t.onCloseAddImageModal(),1===e.add_image_status&&(t.onCloseAddImageModal(),console.log("Operation add image to project folder failed"))},function(){console.error("Error happened in add image operation, check log for information")},function(){t.isOverlayOn=!1,t.isSelectedImagesAdding=!1,t.onReload()}),this.subject$.next()}},{key:"changeClickAbilityToggleStatus",value:function(t){this.clickAbilityToggle=t}},{key:"refreshLabelColor",value:function(){this.refreshAllLabelColor=!0}},{key:"completeRefreshLabelColor",value:function(){this.refreshAllLabelColor=!1}},{key:"refreshAllPolygonsLabelColorAndRegion",value:function(){var n,i=this,a=new Map,o=this._labelColorService.getLabelColorList(this.selectedProjectName),r=e(this.thumbnailList.entries());try{for(r.s();!(n=r.n()).done;){var s=t(n.value,2),l=s[0],c=s[1].polygons;if(void 0!==c){var u,h=[],d=e(c.entries());try{for(d.s();!(u=d.n()).done;){var g=t(u.value,2),b=(g[0],g[1].id);h.push(b)}}catch(y){d.e(y)}finally{d.f()}a.set(l,h),h=[]}}}catch(y){r.e(y)}finally{r.f()}var f,m=e(this.thumbnailList.entries());try{for(m.s();!(f=m.n()).done;){var v=t(f.value,2),p=v[0],_=v[1].polygons;void 0!==_&&function(){var t=a.get(p);void 0!==t&&(i.thumbnailList[p].polygons=_.map(function(e){return Object.assign(Object.assign({},e),{color:o.get(e.label),region:String(t.indexOf(e.id)+1)})}))}()}}catch(y){m.e(y)}finally{m.f()}}},{key:"refreshAllBndBoxLabelColor",value:function(){var n,i=this._labelColorService.getLabelColorList(this.selectedProjectName),a=e(this.thumbnailList.entries());try{for(a.s();!(n=a.n()).done;){var o=t(n.value,2),r=o[0],s=o[1].bnd_box;void 0!==s&&(this.thumbnailList[r].bnd_box=s.map(function(t){return Object.assign(Object.assign({},t),{color:i.get(t.label)})}))}}catch(l){a.e(l)}finally{a.f()}}},{key:"shortcutKeyInfo",value:function(){return[{no:1,shortcutKey:"info.shortcut.1.key",functionality:"info.shortcut.1.functionality"},{no:2,shortcutKey:"info.shortcut.2.key",functionality:"info.shortcut.2.functionality"},{no:3,shortcutKey:"info.shortcut.3.key",functionality:"info.shortcut.3.functionality"},{no:4,shortcutKey:"info.shortcut.4.key",functionality:"info.shortcut.4.functionality"},{no:5,shortcutKey:"info.shortcut.5.key",functionality:"info.shortcut.5.functionality"},{no:6,shortcutKey:"info.shortcut.6.key",functionality:"info.shortcut.6.functionality"},{no:7,shortcutKey:"info.shortcut.7.key",functionality:"info.shortcut.7.functionality"},{no:8,shortcutKey:"info.shortcut.8.key",functionality:"info.shortcut.8.functionality"},{no:9,shortcutKey:"info.shortcut.9.key",functionality:"info.shortcut.9.functionality"},{no:10,shortcutKey:"info.shortcut.10.key",functionality:"info.shortcut.10.functionality"},{no:11,shortcutKey:"info.shortcut.11.key",functionality:"info.shortcut.11.functionality"},{no:12,shortcutKey:"info.shortcut.12.key",functionality:"info.shortcut.12.functionality"}]}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this._imgLblModeService.setState(null),this._imgLblActionService.setState(null),this.resetProjectStatus()}}]),a}(),Zn.\u0275fac=function(t){return new(t||Zn)(C.Jb(P.a),C.Jb(A),C.Jb(j.a),C.Jb(B.a),C.Jb(D),C.Jb(T.a),C.Jb(N),C.Jb(I.a),C.Jb(R.a),C.Jb(F.a),C.Jb(X),C.Jb(Y))},Zn.\u0275cmp=C.Db({type:Zn,selectors:[["image-labelling-layout"]],viewQuery:function(t,e){var n;1&t&&(C.Dc(gn,!0),C.Dc(bn,!0),C.Dc(fn,!0)),2&t&&(C.mc(n=C.Xb())&&(e._subLabelSelect=n.first),C.mc(n=C.Xb())&&(e._renameInput=n.first),C.mc(n=C.Xb())&&(e._deleteBtn=n.first))},hostBindings:function(t,e){1&t&&C.Wb("keydown",function(t){return e.keyDownEvent(t)},!1,C.pc)("beforeunload",function(t){return e.onWindowClose(t)},!1,C.pc)},decls:194,vars:223,consts:[[1,"layout-container"],[3,"_onChange"],[3,"_totalUuid","_onChange","_tabStatus","_onClick"],[1,"content-container"],[3,"_onChange","_currentUrl","_tabStatus","_clickAbilityToggleStatus","_clickAbilityToggle"],[4,"ngIf"],[3,"_onChange","_selectMetadata","_totalUuid","_thumbnailList","_tabStatus","_changeClickAbilityToggleStatus","_projectName","_onClose","_onClickThumbnail","_onClickLabel","_onEnterLabel","_onChangeAnnotationLabel","_onDeleteAnnotation","_loadMoreThumbnails","_onRenameImage","_onDeleteImage","_clickAbilityToggleStatus","_refreshLabelColor"],[3,"_onChange","_tabClosedStatus","_onClick","_onExport","_onReload","_onOpenProjectStats","_onAddImage"],[3,"_thumbnailInfo","_imgSrc"],["id","modal-save",3,"id","modalBodyStyle","scrollable"],[1,"save-format-list"],[1,"save-format-content"],["id","modal-adv",3,"id","modalBodyStyle","modalTitle","scrollable","zIndex"],[1,"modal-adv-container"],["class","modal-adv-instruction",4,"ngIf"],["class","margin-bottom",4,"ngFor","ngForOf"],["class","button-style modal-adv-btn",3,"click",4,"ngIf"],["id","modal-image-labelling",3,"id","scrollable","showHeader"],[1,"modal-button","close-button","float-right",3,"click"],[1,"font-title"],[1,"main-label-container"],[1,"font-label"],[1,"static-select",3,"change"],[4,"ngFor","ngForOf"],["type","text",1,"static-input",3,"value","placeholder","change"],[1,"hr-line"],[1,"sub-label-container"],[1,"static-select"],["subLabelSelect",""],[1,"button-style","addsublabel-btn",3,"click"],[3,"id","modalBodyStyle","modalTitle","scrollable"],[1,"export-content-container"],[1,"modal-button-container"],[1,"button-style","confg-btn",3,"click"],[1,"button-style","confgdata-btn",3,"click"],[1,"with-data"],[1,"help-icon-container"],["src","assets/icons/help.svg","alt","tips",1,"help-icon"],[1,"tooltiptext"],[3,"id","modalBodyStyle","scrollable"],[1,"table-box"],[1,"shortcut-key-info-header"],["id","keyInfo"],[1,"modal-content-container"],[1,"modal-message-container"],["class","message",4,"ngIf"],[3,"ngClass"],[1,"error-msg",3,"innerHTML"],[3,"id","modalBodyStyle","modalTitle","scrollable","zIndex"],[1,"message"],["type","text",1,"static-input",3,"value","placeholder","change","keydown.enter"],["renameInput",""],["class","validate-msg",4,"ngIf"],[1,"button-style","renameimg-btn",3,"click"],[1,"font-delete-img"],["type","checkbox",1,"checkbox",3,"checked","change"],[1,"button-style","deleteimg-btn",3,"click"],["deleteBtn",""],[1,"display-modal-container"],[1,"chart-container"],[3,"labelledImage","unLabelledImage"],[3,"labelStats",4,"ngIf"],["style","margin: 13vh 12vw",4,"ngIf"],["style","margin: 13vh 10vw",4,"ngIf"],[3,"id","modalBodyStyle","modalTitle","scrollable","_close"],[1,"image-container","scroll"],["class","note",4,"ngIf"],[1,"bottom"],[1,"button-style","deleteimg-btn",3,"ngClass","disabled","click"],["type","file","id","image","accept",".png, .jpg, .jpeg, .webp, .bmp","multiple","",3,"change"],["for","image",1,"button-style","deleteimg-btn"],["type","file","id","folder","multiple","","directory","","webkitdirectory","","mozdirectory","",3,"change"],["for","folder",1,"button-style","deleteimg-btn"],[1,"image-added"],[3,"id","modalBodyStyle","modalTitle","scrollable","showHeader","zIndex"],[1,"center"],[1,"circle"],[1,"progress"],[3,"_modalUnsupportedImage","_unsupportedImageBodyStyle","_unsupportedImageList"],[3,"_loading"],[3,"_processingNum"],["class","overlay",4,"ngIf"],[3,"_selectMetadata","_imgSrc","_tabStatus","_projectName","_refreshAllLabelColor","_onChangeMetadata","_onChangeAnnotationLabel","_onEnterLabel","_clickAbilityToggle","_onRefresh"],[3,"_selectMetadata","_imgSrc","_tabStatus","_projectName","_refreshAllLabelColor","_onChangeMetadata","_onChangeAnnotationLabel","_onEnterLabel","_clickAbilityToggle","_onCompleteRefresh"],[1,"switch-container"],[1,"switch"],["type","checkbox",1,"checkBox",3,"checked","change"],[1,"slider","round"],[1,"space-verticle"],[1,"adv-settings",3,"click"],[1,"save-format-btn",3,"click"],[1,"modal-adv-instruction"],[1,"margin-bottom"],[1,"switch-2","no-margin-left"],[1,"modal-adv-label"],[1,"button-style","modal-adv-btn",3,"click"],[3,"value","selected"],[1,"validate-msg"],[1,"sub-label-flex-container","sub-label-padding"],[1,"font-label","flex-first"],[1,"font-label","flex-second"],[1,"flex-third"],[1,"button-style","removesublabel-btn",3,"click"],[3,"innerHTML"],[3,"labelStats"],[2,"margin","13vh 12vw"],[2,"margin","13vh 10vw"],[1,"note"],[1,"delete-image-container"],[1,"file-name"],[1,"delete-image"],[1,"delete-btn",3,"click"],["alt","added image",1,"image",3,"src"],[1,"overlay"],[2,"margin-top","40vh","color","rgba(255, 255, 255, 0.9)","text-align","center","font-size","3vh"]],template:function(t,e){1&t&&(C.Pb(0,"div",0),C.Pb(1,"div"),C.Kb(2,"page-header",1),C.Pb(3,"image-labelling-info",2),C.Wb("_onClick",function(t){return e.navigateByAction(t)}),C.Ob(),C.Ob(),C.Pb(4,"div",3),C.Pb(5,"image-labelling-left-sidebar",4),C.Wb("_clickAbilityToggle",function(t){return e.changeClickAbilityToggleStatus(t)}),C.Ob(),C.wc(6,mn,2,5,"ng-container",5),C.wc(7,vn,2,5,"ng-container",5),C.Pb(8,"image-labelling-project",6),C.Wb("_onClose",function(t){return e.onToggleTab(t)})("_onClickThumbnail",function(t){return e.displayImage(t)})("_onClickLabel",function(t){return e.onProcessLabel(t)})("_onEnterLabel",function(t){return e.onProcessLabel(t)})("_onChangeAnnotationLabel",function(t){return e.onChangeAnnotationLabel(t)})("_onDeleteAnnotation",function(t){return e.onDeleteAnnotation(t)})("_loadMoreThumbnails",function(){return e.onLoadMoreThumbnails()})("_onRenameImage",function(t){return e.onRenameImage(t)})("_onDeleteImage",function(t){return e.onDeleteImage(t)})("_clickAbilityToggleStatus",function(t){return e.changeClickAbilityToggleStatus(t)})("_refreshLabelColor",function(){return e.refreshLabelColor()}),C.Ob(),C.Pb(9,"image-labelling-right-sidebar",7),C.Wb("_onClick",function(t){return e.onToggleTab(t)})("_onExport",function(){return e.onExport()})("_onReload",function(){return e.onReload()})("_onOpenProjectStats",function(){return e.toggleProjectStats()})("_onAddImage",function(){return e.toggleAddImage()}),C.Ob(),C.Ob(),C.Kb(10,"image-labelling-footer",8),C.Ob(),C.Pb(11,"modal",9),C.Pb(12,"div",10),C.Pb(13,"div",11),C.wc(14,pn,30,11,"ng-container",5),C.wc(15,_n,10,0,"ng-container",5),C.Ob(),C.Ob(),C.Ob(),C.Pb(16,"modal",12),C.bc(17,"translate"),C.Pb(18,"div",13),C.wc(19,yn,3,3,"p",14),C.wc(20,xn,6,2,"div",15),C.wc(21,wn,3,3,"div",5),C.wc(22,Sn,3,3,"button",16),C.Ob(),C.Ob(),C.Pb(23,"modal",17),C.Pb(24,"button",18),C.Wb("click",function(){return e.onCloseModal()}),C.yc(25,"\u2716"),C.Ob(),C.Pb(26,"div"),C.Pb(27,"h2",19),C.yc(28),C.bc(29,"translate"),C.Ob(),C.Pb(30,"div",20),C.Pb(31,"label",21),C.yc(32),C.bc(33,"translate"),C.Ob(),C.Pb(34,"select",22),C.Wb("change",function(t){return e.onChangeLabel(t.target.value)}),C.wc(35,Cn,2,1,"ng-container",23),C.Ob(),C.Pb(36,"label",21),C.yc(37),C.bc(38,"translate"),C.Ob(),C.Pb(39,"input",24),C.Wb("change",function(t){return e.onChangeInput(t,"main")}),C.bc(40,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Kb(41,"hr",25),C.Pb(42,"div"),C.Pb(43,"h2",19),C.yc(44),C.bc(45,"translate"),C.Ob(),C.Pb(46,"div",26),C.Pb(47,"label",21),C.yc(48),C.bc(49,"translate"),C.Ob(),C.Pb(50,"select",27,28),C.wc(52,On,2,1,"ng-container",23),C.Ob(),C.Pb(53,"label",21),C.yc(54),C.bc(55,"translate"),C.Ob(),C.Pb(56,"input",24),C.Wb("change",function(t){return e.onChangeInput(t,"sub")}),C.bc(57,"translate"),C.Ob(),C.Pb(58,"button",29),C.Wb("click",function(){return e.onSubmitLabel()}),C.yc(59),C.bc(60,"translate"),C.Ob(),C.Ob(),C.wc(61,Mn,3,1,"ng-container",5),C.Ob(),C.Kb(62,"hr",25),C.wc(63,Bn,2,1,"ng-container",23),C.Ob(),C.Pb(64,"modal",30),C.bc(65,"translate"),C.Pb(66,"div",31),C.Pb(67,"div",32),C.Pb(68,"button",33),C.Wb("click",function(){return e.exportProject("cfg")}),C.yc(69),C.bc(70,"translate"),C.Ob(),C.Pb(71,"button",34),C.Wb("click",function(){return e.exportProject("cfgdata")}),C.yc(72),C.bc(73,"translate"),C.Kb(74,"br"),C.Pb(75,"span",35),C.yc(76),C.bc(77,"translate"),C.Ob(),C.Ob(),C.Pb(78,"div",36),C.Kb(79,"img",37),C.Pb(80,"span",38),C.Pb(81,"p"),C.yc(82),C.bc(83,"translate"),C.Ob(),C.Pb(84,"p"),C.yc(85),C.bc(86,"translate"),C.Ob(),C.Pb(87,"p"),C.yc(88),C.bc(89,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Ob(),C.Ob(),C.Ob(),C.Pb(90,"modal",39),C.Pb(91,"div",40),C.Pb(92,"table"),C.Pb(93,"caption",41),C.yc(94),C.bc(95,"translate"),C.Ob(),C.Kb(96,"th",42),C.wc(97,En,5,6,"tr",23),C.Ob(),C.Ob(),C.Ob(),C.Pb(98,"modal",30),C.bc(99,"translate"),C.Kb(100,"br"),C.Pb(101,"div",43),C.Pb(102,"div",44),C.wc(103,zn,5,4,"p",45),C.Ob(),C.Pb(104,"div",46),C.Kb(105,"p",47),C.Ob(),C.Ob(),C.Ob(),C.Pb(106,"modal",48),C.bc(107,"translate"),C.Kb(108,"br"),C.Pb(109,"div",43),C.Pb(110,"div",44),C.Pb(111,"p",49),C.yc(112),C.bc(113,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Ob(),C.Pb(114,"modal",30),C.bc(115,"translate"),C.Pb(116,"div",43),C.Pb(117,"label",21),C.yc(118),C.bc(119,"translate"),C.Ob(),C.Pb(120,"input",50,51),C.Wb("change",function(t){return e.onChangeImageName(t)})("keydown.enter",function(t){return e.onChangeImageName(t),e.onSubmitRenameImage()}),C.bc(122,"translate"),C.Ob(),C.Kb(123,"br"),C.Kb(124,"br"),C.wc(125,Dn,3,3,"label",52),C.wc(126,Tn,3,3,"label",52),C.wc(127,Nn,3,3,"label",52),C.wc(128,Rn,3,3,"label",52),C.Pb(129,"button",53),C.Wb("click",function(){return e.onSubmitRenameImage()}),C.yc(130),C.bc(131,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Pb(132,"modal",30),C.bc(133,"translate"),C.Pb(134,"div",43),C.Pb(135,"p",54),C.yc(136),C.bc(137,"translate"),C.Ob(),C.Pb(138,"p",54),C.Pb(139,"input",55),C.Wb("change",function(){return e.dontAskDelete=!e.dontAskDelete}),C.Ob(),C.yc(140),C.bc(141,"translate"),C.Ob(),C.Pb(142,"button",56,57),C.Wb("click",function(){return e.onSubmitDeleteImage()}),C.yc(144),C.bc(145,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Pb(146,"modal",30),C.bc(147,"translate"),C.Pb(148,"div",58),C.Pb(149,"div",59),C.Kb(150,"app-pie-chart",60),C.wc(151,Fn,1,1,"app-bar-chart",61),C.wc(152,Wn,3,0,"div",62),C.wc(153,Un,3,0,"div",63),C.Ob(),C.Ob(),C.Ob(),C.Pb(154,"modal",64),C.Wb("_close",function(){return e.onCloseAddImageModal()}),C.bc(155,"translate"),C.Kb(156,"br"),C.Pb(157,"div",65),C.wc(158,Xn,4,3,"div",66),C.wc(159,Yn,8,2,"div",23),C.Ob(),C.Pb(160,"div",67),C.Pb(161,"button",68),C.Wb("click",function(){return e.toggleSubmitAddedImage()}),C.yc(162),C.bc(163,"translate"),C.Ob(),C.Pb(164,"input",69),C.Wb("change",function(t){return e.addNewImages(t)}),C.Ob(),C.Pb(165,"label",70),C.yc(166),C.bc(167,"translate"),C.Ob(),C.Pb(168,"input",71),C.Wb("change",function(t){return e.addNewImages(t)}),C.Ob(),C.Pb(169,"label",72),C.yc(170),C.bc(171,"translate"),C.Ob(),C.Pb(172,"label",73),C.yc(173),C.bc(174,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Pb(175,"modal",48),C.bc(176,"translate"),C.Pb(177,"div",43),C.Pb(178,"p",54),C.yc(179),C.bc(180,"translate"),C.Ob(),C.Pb(181,"button",56),C.Wb("click",function(){return e.submitAddedImages()}),C.yc(182),C.bc(183,"translate"),C.Ob(),C.Ob(),C.Ob(),C.Pb(184,"modal",74),C.bc(185,"translate"),C.Pb(186,"div",75),C.Kb(187,"div",76),C.Pb(188,"div",77),C.yc(189),C.Ob(),C.Ob(),C.Ob(),C.Kb(190,"unsupported-image-modal",78),C.Kb(191,"spinner",79),C.Kb(192,"toastr",80),C.wc(193,Kn,3,1,"div",81)),2&t&&(C.xb(2),C.gc("_onChange",e.onChangeSchema),C.xb(1),C.gc("_totalUuid",e.totalUuid)("_onChange",e.onChangeSchema)("_tabStatus",e.tabStatus),C.xb(2),C.gc("_onChange",e.onChangeSchema)("_currentUrl",e.currentUrl)("_tabStatus",e.tabStatus)("_clickAbilityToggleStatus",e.clickAbilityToggle),C.xb(1),C.gc("ngIf",e._router.url.includes("imglabel/bndbox")),C.xb(1),C.gc("ngIf",e._router.url.includes("imglabel/seg")),C.xb(1),C.gc("_onChange",e.onChangeSchema)("_selectMetadata",e.selectedMetaData)("_totalUuid",e.totalUuid)("_thumbnailList",e.thumbnailList)("_tabStatus",e.tabStatus)("_changeClickAbilityToggleStatus",e.clickAbilityToggle)("_projectName",e.selectedProjectName),C.xb(1),C.gc("_onChange",e.onChangeSchema)("_tabClosedStatus",e.tabClosedStatus),C.xb(1),C.gc("_thumbnailInfo",e.selectedMetaData)("_imgSrc",e.imgSrc),C.xb(1),C.gc("id","modal-save")("modalBodyStyle",e.saveModalBodyStyle)("scrollable",!0),C.xb(3),C.gc("ngIf",null==e.selectedMetaData?null:e.selectedMetaData.bnd_box),C.xb(1),C.gc("ngIf",null==e.selectedMetaData?null:e.selectedMetaData.polygons),C.xb(1),C.gc("id","modal-adv")("modalBodyStyle",e.advModalBodyStyle)("modalTitle",C.cc(17,145,"advModal.title"))("scrollable",!0)("zIndex",2),C.xb(3),C.gc("ngIf",0!==e.tempLabelChoosen.length),C.xb(1),C.gc("ngForOf",e.tempLabelChoosen),C.xb(1),C.gc("ngIf",0===e.tempLabelChoosen.length),C.xb(1),C.gc("ngIf",0!==e.tempLabelChoosen.length),C.xb(1),C.gc("id","modal-image-labelling")("scrollable",!0)("showHeader",!1),C.xb(5),C.zc(C.cc(29,147,"labellingArea.mainLabel")),C.xb(4),C.Ac("",C.cc(33,149,"labellingArea.label"),": "),C.xb(3),C.gc("ngForOf",e.tabStatus),C.xb(2),C.Ac("",C.cc(38,151,"labellingArea.regionInfo"),": "),C.xb(2),C.gc("value",e.mainLabelRegionVal)("placeholder",C.cc(40,153,"labellingArea.mainRegionInfo")),C.xb(5),C.zc(C.cc(45,155,"labellingArea.subLabel")),C.xb(4),C.Ac("",C.cc(49,157,"labellingArea.label"),": "),C.xb(4),C.gc("ngForOf",e.tabStatus),C.xb(2),C.Ac("",C.cc(55,159,"labellingArea.regionInfo"),": "),C.xb(2),C.gc("value",e.subLabelRegionVal)("placeholder",C.cc(57,161,"labellingArea.subRegionInfo")),C.xb(3),C.Ac(" ",C.cc(60,163,"labellingArea.add")," "),C.xb(2),C.gc("ngIf",e.subLabelValidateMsg),C.xb(2),C.gc("ngForOf",e.tabStatus),C.xb(1),C.gc("id",e.modalExportOptions)("modalBodyStyle",e.exportModalBodyStyle)("modalTitle",C.cc(65,165,"exportModal.exportOptions"))("scrollable",!1),C.xb(5),C.Ac(" ",C.cc(70,167,"exportModal.configFile")," "),C.xb(3),C.Ac(" ",C.cc(73,169,"exportModal.zipFile")," "),C.xb(4),C.zc(C.cc(77,171,"exportModal.withData")),C.xb(6),C.Ac("",C.cc(83,173,"configFileInfoTitle"),":"),C.xb(3),C.zc(C.cc(86,175,"configFileInfoDest1")),C.xb(3),C.zc(C.cc(89,177,"configFileInfoDest2")),C.xb(2),C.gc("id",e.modalShortcutKeyInfo)("modalBodyStyle",e.infoModalBodyStyle)("scrollable",!0),C.xb(4),C.Ac(" ",C.cc(95,179,"info.header")," "),C.xb(3),C.gc("ngForOf",e.shortcutKeyInfo()),C.xb(1),C.gc("id",e.modalExportProject)("modalBodyStyle",e.exportProjectBodyStyle)("modalTitle",C.cc(99,181,"exportTitle"))("scrollable",!1),C.xb(5),C.gc("ngIf",e.modalSpanLocationPath.trim()),C.xb(1),C.gc("ngClass",e.spanClass),C.xb(1),C.gc("innerHTML",e.modalSpanMessage,C.rc),C.xb(1),C.gc("id",e.modalExportWarning)("modalBodyStyle",e.exportWarningBodyStyle)("modalTitle",C.cc(107,183,"exportTitle"))("scrollable",!1)("zIndex",2),C.xb(6),C.zc(C.cc(113,185,e.warningMessage)),C.xb(2),C.gc("id",e.modalRenameImage)("modalBodyStyle",e.renameImageBodyStyle)("modalTitle",C.cc(115,187,"renameModal.renameImg"))("scrollable",!1),C.xb(4),C.Ac("",C.cc(119,189,"renameModal.imageName"),": "),C.xb(2),C.gc("value",e.newImageName)("placeholder",C.cc(122,191,"renameModal.typeNewName")),C.xb(5),C.gc("ngIf",0===e.renameImageErrorCode),C.xb(1),C.gc("ngIf",1===e.renameImageErrorCode),C.xb(1),C.gc("ngIf",2===e.renameImageErrorCode),C.xb(1),C.gc("ngIf",3===e.renameImageErrorCode),C.xb(2),C.Ac(" ",C.cc(131,193,"renameModal.submit")," "),C.xb(2),C.gc("id",e.modalDeleteImage)("modalBodyStyle",e.deleteImageBodyStyle)("modalTitle",C.cc(133,195,"deleteModal.deleteImg"))("scrollable",!1),C.xb(4),C.Cc("",C.cc(137,197,"deleteModal.confirmation")," ",e.newImageName,"",e.imageExt," ?"),C.xb(3),C.gc("checked",e.dontAskDelete),C.xb(1),C.Ac(" ",C.cc(141,199,"deleteModal.dontask")," "),C.xb(4),C.Ac(" ",C.cc(145,201,"deleteModal.confirm")," "),C.xb(2),C.gc("id",e.modalIdProjectStats)("modalBodyStyle",e.projectStatsBodyStyle)("modalTitle",C.cc(147,203,"projectStats"))("scrollable",!1),C.xb(4),C.gc("labelledImage",e.labelledImage)("unLabelledImage",e.unLabelledImage),C.xb(1),C.gc("ngIf",!e.noLabel&&!e.noAnnotation),C.xb(1),C.gc("ngIf",e.noLabel),C.xb(1),C.gc("ngIf",e.noAnnotation),C.xb(1),C.gc("id",e.modalAddImage)("modalBodyStyle",e.addImageBodyStyle)("modalTitle",C.cc(155,205,"addImageModal.addImage"))("scrollable",!1),C.xb(4),C.gc("ngIf",0===e.imageNameList.length),C.xb(1),C.gc("ngForOf",e.imageBase64List),C.xb(2),C.gc("ngClass",0===e.imageBase64List.length?"disabled-create-btn":null)("disabled",0===e.imageBase64List.length),C.xb(1),C.Ac(" ",C.cc(163,207,"addImageModal.submit")," "),C.xb(4),C.zc(C.cc(167,209,"addImageModal.addImage")),C.xb(4),C.Ac(" ",C.cc(171,211,"addImageModal.addFolder"),""),C.xb(3),C.Bc(" ",C.cc(174,213,"addImageModal.imageAdded")," ",e.imageBase64List.length,""),C.xb(2),C.gc("id",e.modalSubmitAddedImage)("modalBodyStyle",e.submitAddedImageBodyStyle)("modalTitle",C.cc(176,215,"addImageModal.submit"))("scrollable",!1)("zIndex",2),C.xb(4),C.zc(C.cc(180,217,"addImageModal.confirmation")),C.xb(3),C.Ac(" ",C.cc(183,219,"addImageModal.confirm")," "),C.xb(2),C.gc("id",e.modalImageLoadingProgress)("modalBodyStyle",e.imageLoadingProgressBodyStyle)("modalTitle",C.cc(185,221,"imageLoadingProgressModal.title"))("scrollable",!1)("showHeader",!1)("zIndex",3),C.xb(5),C.zc(e.progress),C.xb(1),C.gc("_modalUnsupportedImage",e.modalUnsupportedImage)("_unsupportedImageBodyStyle",e.unsupportedImageBodyStyle)("_unsupportedImageList",e.unsupportedImageList),C.xb(1),C.gc("_loading",e.isLoading),C.xb(1),C.gc("_processingNum",e.processingNum),C.xb(1),C.gc("ngIf",e.isOverlayOn))},directives:[K.a,it,Dt,m.l,le,he,fe,me.a,m.k,m.j,ve.a,pe.a,_e.a,Ie,Ge,hn,Ft.j,Ft.m,dn.a],pipes:[$.c],styles:['.layout-container[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;min-width:97.8vw;max-width:97.8vw}.modal-button[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;background:#262a2e;color:azure}.close-button[_ngcontent-%COMP%]{border:none;cursor:pointer}.float-right[_ngcontent-%COMP%]{float:right}.font-title[_ngcontent-%COMP%]{font-size:1.7vw}.font-label[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.main-label-container[_ngcontent-%COMP%]{min-width:35vw;max-width:35vw}.main-label-container[_ngcontent-%COMP%], .sub-label-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.sub-label-container[_ngcontent-%COMP%]{min-width:45vw;max-width:45vw}.sub-label-flex-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1 1 100%;min-width:0}.static-select[_ngcontent-%COMP%]{-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:5vh;margin:0;-moz-text-align-last:center;text-align-last:center;background:#363636}.static-input[_ngcontent-%COMP%], .static-select[_ngcontent-%COMP%]{min-height:4vh;max-height:4vh;min-width:10vw;max-width:10vw;line-height:3vh;font-size:.9vw;color:#fff}.static-input[_ngcontent-%COMP%]{border-radius:2vw;border:none;outline:none;background-color:#363636;padding:0 1vw}.hr-line[_ngcontent-%COMP%]{margin:5vh 0}.sub-label-padding[_ngcontent-%COMP%]{padding:0 0 2vh}.validate-msg[_ngcontent-%COMP%]{color:red;font-size:1vw}.flex-first[_ngcontent-%COMP%]{flex:1 1 35%}.flex-second[_ngcontent-%COMP%]{flex:1 1 55%}.flex-third[_ngcontent-%COMP%]{flex:0 0 5%}.flex-fourth[_ngcontent-%COMP%]{line-height:1vh;font-size:1vw;padding:.5vw;background:#262a2e;color:azure;flex:0 0 5%}.modal[_ngcontent-%COMP%]{z-index:1000;padding-top:10vh;top:0;width:100%;height:100%;overflow:auto;background-color:transparent;scrollbar-width:none;position:fixed;background:rgba(0,0,0,.8)}.modal-content-container[_ngcontent-%COMP%]{margin-left:1.3vw}.modal-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:1vw 1vw 1vw 2vw}.export-content-container[_ngcontent-%COMP%]{margin-left:.5vw}.button-style[_ngcontent-%COMP%]{border-radius:1vh;border:none;outline:none;color:#fff;cursor:pointer}.confg-btn[_ngcontent-%COMP%]{margin-right:.7vw}.confg-btn[_ngcontent-%COMP%], .confgdata-btn[_ngcontent-%COMP%]{padding:1vh .5vw;background-color:#2d8ceb;font-size:2vh;min-width:7.5vw}.with-data[_ngcontent-%COMP%]{font-size:1.5vh}.error-msg[_ngcontent-%COMP%]{padding-top:1vh;font-size:2vh}.help-icon[_ngcontent-%COMP%]{height:3vh}.help-icon-container[_ngcontent-%COMP%]{padding-right:1vw;padding-left:.4vw}.help-icon-container[_ngcontent-%COMP%]   .tooltiptext[_ngcontent-%COMP%]{visibility:hidden;width:15vw;background-color:#000;color:#fff;text-align:left;border-radius:6px;padding:1vh .5vw;position:absolute;top:65%;margin-left:-60px;text-align:justify;text-justify:inter-word}.help-icon-container[_ngcontent-%COMP%]:hover   .tooltiptext[_ngcontent-%COMP%]{visibility:visible}.message[_ngcontent-%COMP%]{font-size:1vw;overflow-wrap:break-word}.modal-message-container[_ngcontent-%COMP%]{padding-right:3.5vw}.save-format-list[_ngcontent-%COMP%]{left:0;top:0;width:100%;height:100%;overflow:auto}.save-format-content[_ngcontent-%COMP%]{margin:auto;padding:10px}.switch-container[_ngcontent-%COMP%]{font-size:small;align-content:center;text-align:center}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:4em;height:1.8em;margin-left:auto;margin-right:auto}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.switch[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background:#000;background-size:100% 100%;background-position:50%}.switch[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translateX(2.2em)}.switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.8s}.switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:1.6em;width:1.6em;left:.14em;bottom:.15em;background-color:snow;transition:.8s}.switch[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]{border-radius:1.2em}.switch[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]:before{border-radius:50%}.switch[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:8px;margin-top:.5em;outline:none}.switch-2[_ngcontent-%COMP%]{position:relative;display:inline-block;width:2.5em;height:1.2em;margin-left:auto;margin-right:auto}.switch-2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.switch-2[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background:#000;background-size:100% 100%;background-position:50%}.switch-2[_ngcontent-%COMP%]   .checkBox[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translateX(1.5em)}.switch-2[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.5s}.switch-2[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:1.2em;width:1.2em;left:.14em;background-color:snow;transition:.5s}.switch-2[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]{border-radius:1.2em}.switch-2[_ngcontent-%COMP%]   .round[_ngcontent-%COMP%]:before{border-radius:50%}.switch-2[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:8px;margin-top:.5em;outline:none}.no-margin-left[_ngcontent-%COMP%]{margin-left:0}.space-verticle[_ngcontent-%COMP%]{background-color:transparent;outline:none;border:none;margin-left:1.5em;margin-right:1.5em}.save-format-btn[_ngcontent-%COMP%]{width:90%;height:6em;margin-top:2%;margin-bottom:2%;margin-left:4.5%;background:#000;background-size:100% 100%;background-position:50%;font-size:medium;outline:none;border:none;color:snow;overflow:hidden;border-radius:5px}.save-format-btn[_ngcontent-%COMP%]:hover{text-shadow:0 0 30px #888;box-shadow:5px 5px 10px #888,-5px -5px 10px #888;cursor:pointer}.save-format-btn[_ngcontent-%COMP%]:active:hover{border:3px dashed green}.adv-settings[_ngcontent-%COMP%]{padding:1vh;margin:1vh 1.5vw;color:#ccc;font-size:.6vw;cursor:pointer;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;background:#30353a;border-radius:.5vh;float:right}.adv-settings[_ngcontent-%COMP%]:hover{background:#373d42}.modal-adv-container[_ngcontent-%COMP%]{margin:1vh 1vw}.modal-adv-instruction[_ngcontent-%COMP%]{color:#fff;opacity:.5}.modal-adv-label[_ngcontent-%COMP%]{font-size:1.5vh;margin-left:2vw;white-space:nowrap;width:9vw;overflow:hidden;text-overflow:ellipsis;display:inline-block}.modal-adv-btn[_ngcontent-%COMP%]{float:right;padding:.5vh 1vw;background-color:#2d8ceb;font-size:1.5vh;min-width:3vw}.shortcut-key-info-header[_ngcontent-%COMP%]{font-size:1.2vw;color:#fff;text-align:center;margin-bottom:2vh}.table-box[_ngcontent-%COMP%]{width:100%;height:90%;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%], td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border-collapse:collapse;text-align:center;color:#fff}th[_ngcontent-%COMP%]{top:0;background:#262a2e;color:#fff;border-top:none!important}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1.5vh}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){color:#bebebe}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:60px;text-align:center;background:#262a2e}.validation-error[_ngcontent-%COMP%]{margin:1px;color:red}.validation-success[_ngcontent-%COMP%]{margin:1px;color:green}.label[_ngcontent-%COMP%]{color:#fff;font-size:2vh;margin-right:1vw}.margin-bottom[_ngcontent-%COMP%]{margin-bottom:.5vh}.deleteimg-btn[_ngcontent-%COMP%], .renameimg-btn[_ngcontent-%COMP%]{margin-top:.7vw}.addsublabel-btn[_ngcontent-%COMP%], .deleteimg-btn[_ngcontent-%COMP%], .renameimg-btn[_ngcontent-%COMP%]{padding:1vh .5vw;background-color:#2d8ceb;margin-right:.7vw;font-size:2vh;min-width:7.5vw;float:right}.removesublabel-btn[_ngcontent-%COMP%]{padding:1vh .5vw;background-color:#ff3f3f;margin-right:.7vw;font-size:2vh;min-width:2vw;float:right}.font-delete-img[_ngcontent-%COMP%]{line-height:4vh;font-size:1vw}.checkbox[_ngcontent-%COMP%]{height:1.5vh;width:1.5vw}.chart-container[_ngcontent-%COMP%]{display:flex;width:100%}.image-container[_ngcontent-%COMP%]{height:57vh;width:80vw;margin-left:auto;margin-right:auto;position:relative;display:grid;grid-template-columns:repeat(5,-webkit-max-content);grid-template-columns:repeat(5,max-content);grid-gap:7px;overflow:auto}.image[_ngcontent-%COMP%]{height:25vh;width:14.5vw;justify-content:center;margin-left:2px;border:solid #a9a9a9}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:10px;background-color:#000}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar{width:1.2vw}.scroll[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#525353}.bottom[_ngcontent-%COMP%]{margin:10px}.delete-image-container[_ngcontent-%COMP%]{height:4.3vh;width:14.5vw;position:relative;margin-left:2px;border:solid #a9a9a9;border-width:3px 3px 0}.delete-image[_ngcontent-%COMP%]{float:right;margin-right:.8rem;margin-bottom:5px}.delete-btn[_ngcontent-%COMP%]{font-size:12px;position:absolute;margin-bottom:2px;cursor:pointer}.file-name[_ngcontent-%COMP%]{font-size:1.7vh;margin:3px;inline-size:175px;overflow-wrap:break-word}.file-name[_ngcontent-%COMP%], .note[_ngcontent-%COMP%]{position:absolute;text-align:center}.note[_ngcontent-%COMP%]{margin:20vh 20vw}input[type=file][_ngcontent-%COMP%]{width:0;height:0;z-index:-1;position:absolute;overflow:hidden;opacity:0}label[for=folder][_ngcontent-%COMP%], label[for=image][_ngcontent-%COMP%]{text-align:center}.disabled-create-btn[_ngcontent-%COMP%]{cursor:not-allowed;background-color:#444!important;color:#777!important}.file-path[_ngcontent-%COMP%]{position:absolute;font-size:1.4vh;margin:3px;inline-size:175px;overflow-wrap:break-word;text-align:center}.image-added[_ngcontent-%COMP%], .image-moved[_ngcontent-%COMP%]{position:absolute;margin:.5rem}.folder-moved[_ngcontent-%COMP%]{position:absolute;margin-top:.5rem;margin-left:25vw}.overlay[_ngcontent-%COMP%]{z-index:1000;position:absolute;background-color:rgba(0,0,0,.9);width:99.9vw;height:99.7vh;cursor:not-allowed}.center[_ngcontent-%COMP%]{position:relative;justify-content:center;align-content:center;align-items:center}.circle[_ngcontent-%COMP%]{position:absolute;margin-left:30px;width:200px;height:200px;border-radius:50%;-webkit-animation:loop 2s linear infinite;animation:loop 2s linear infinite;cursor:progress}@-webkit-keyframes loop{0%{transform:rotate(0deg);box-shadow:2px 5px 1px #076aff}50%{transform:rotate(180deg);box-shadow:2px 5px 1px #076aff}to{transform:rotate(1turn);box-shadow:2px 5px 1px #076aff}}@keyframes loop{0%{transform:rotate(0deg);box-shadow:2px 5px 1px #076aff}50%{transform:rotate(180deg);box-shadow:2px 5px 1px #076aff}to{transform:rotate(1turn);box-shadow:2px 5px 1px #076aff}}.circle[_ngcontent-%COMP%]:before{position:absolute;left:0;top:0;height:100%;width:100%;border-radius:70%;box-shadow:0 0 5px #fff}.progress[_ngcontent-%COMP%]{position:absolute;margin-top:80px;margin-left:90px;color:#fff;font-size:40px;font-family:Arial,Helvetica,sans-serif}']}),Zn)}],Gn=((Hn=function t(){r(this,t)}).\u0275mod=C.Hb({type:Hn}),Hn.\u0275inj=C.Gb({factory:function(t){return new(t||Hn)},imports:[[P.d.forChild(Jn)]]}),Hn),qn=s("KZX/"),Qn=(($n=function t(){r(this,t)}).\u0275mod=C.Hb({type:$n}),$n.\u0275inj=C.Gb({factory:function(t){return new(t||$n)},imports:[[m.b,qn.a,$.b]]}),$n),ti=s("kEuV"),ei=s("b4Th"),ni=s("fMmW"),ii=s("n8vG"),ai=((Vn=function t(){r(this,t)}).\u0275mod=C.Hb({type:Vn}),Vn.\u0275inj=C.Gb({factory:function(t){return new(t||Vn)},imports:[[m.b,qn.a,$.b,Gn,ti.a,P.d,ei.a,Qn,ni.a,ii.a]]}),Vn)},xOOu:function(t,e,n){t.exports=function t(e,n,i){function a(r,s){if(!n[r]){if(!e[r]){if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[r]={exports:{}};e[r][0].call(c.exports,function(t){return a(e[r][1][t]||t)},c,c.exports,t,e,n,i)}return n[r].exports}for(var o=!1,r=0;r<i.length;r++)a(i[r]);return a}({1:[function(t,e,n){"use strict";var i=t("./utils"),a=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,a,r,s,l,c=[],u=0,h=t.length,d=h,g="string"!==i.getTypeOf(t);u<t.length;)d=h-u,a=g?(e=t[u++],n=u<h?t[u++]:0,u<h?t[u++]:0):(e=t.charCodeAt(u++),n=u<h?t.charCodeAt(u++):0,u<h?t.charCodeAt(u++):0),r=(3&e)<<4|n>>4,s=1<d?(15&n)<<2|a>>6:64,l=2<d?63&a:64,c.push(o.charAt(e>>2)+o.charAt(r)+o.charAt(s)+o.charAt(l));return c.join("")},n.decode=function(t){var e,n,i,r,s,l,c=0,u=0,h="data:";if(t.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var d,g=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===o.charAt(64)&&g--,t.charAt(t.length-2)===o.charAt(64)&&g--,g%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=a.uint8array?new Uint8Array(0|g):new Array(0|g);c<t.length;)e=o.indexOf(t.charAt(c++))<<2|(r=o.indexOf(t.charAt(c++)))>>4,n=(15&r)<<4|(s=o.indexOf(t.charAt(c++)))>>2,i=(3&s)<<6|(l=o.indexOf(t.charAt(c++))),d[u++]=e,64!==s&&(d[u++]=n),64!==l&&(d[u++]=i);return d}},{"./support":30,"./utils":32}],2:[function(t,e,n){"use strict";var i=t("./external"),a=t("./stream/DataWorker"),o=t("./stream/DataLengthProbe"),r=t("./stream/Crc32Probe");function s(t,e,n,i,a){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=i,this.compressedContent=a}o=t("./stream/DataLengthProbe"),s.prototype={getContentWorker:function(){var t=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(t,e,n){return t.pipe(new r).pipe(new o("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",e)},e.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var i=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(t){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){"use strict";var i=t("./utils"),a=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==i.getTypeOf(t)?function(t,e,n,i){var o=a,r=0+n;t^=-1;for(var s=0;s<r;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}(0|e,t,t.length):function(t,e,n,i){var o=a,r=0+n;t^=-1;for(var s=0;s<r;s++)t=t>>>8^o[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){"use strict";var i;i="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:i}},{lie:37}],7:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,a=t("pako"),o=t("./utils"),r=t("./stream/GenericWorker"),s=i?"uint8array":"array";function l(t,e){r.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}n.magic="\b\0",o.inherits(l,r),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,t.data),!1)},l.prototype.flush=function(){r.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(t){return new l("Deflate",t)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){"use strict";function i(t,e){var n,i="";for(n=0;n<e;n++)i+=String.fromCharCode(255&t),t>>>=8;return i}function a(t,e,n,a,r,u){var h,d,g=t.file,b=t.compression,f=u!==s.utf8encode,m=o.transformTo("string",u(g.name)),v=o.transformTo("string",s.utf8encode(g.name)),p=g.comment,_=o.transformTo("string",u(p)),y=o.transformTo("string",s.utf8encode(p)),x=v.length!==g.name.length,w=y.length!==p.length,S="",k="",C="",P=g.dir,O=g.date,M={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(M.crc32=t.crc32,M.compressedSize=t.compressedSize,M.uncompressedSize=t.uncompressedSize);var L=0;e&&(L|=8),f||!x&&!w||(L|=2048);var I=0,A=0;P&&(I|=16),"UNIX"===r?(A=798,I|=function(t,e){var n=t;return t||(n=e?16893:33204),(65535&n)<<16}(g.unixPermissions,P)):(A=20,I|=function(t){return 63&(t||0)}(g.dosPermissions)),h=O.getUTCHours(),h<<=6,h|=O.getUTCMinutes(),h<<=5,h|=O.getUTCSeconds()/2,d=O.getUTCFullYear()-1980,d<<=4,d|=O.getUTCMonth()+1,d<<=5,d|=O.getUTCDate(),x&&(k=i(1,1)+i(l(m),4)+v,S+="up"+i(k.length,2)+k),w&&(C=i(1,1)+i(l(_),4)+y,S+="uc"+i(C.length,2)+C);var j="";return j+="\n\0",j+=i(L,2),j+=b.magic,j+=i(h,2),j+=i(d,2),j+=i(M.crc32,4),j+=i(M.compressedSize,4),j+=i(M.uncompressedSize,4),j+=i(m.length,2),j+=i(S.length,2),{fileRecord:c.LOCAL_FILE_HEADER+j+m+S,dirRecord:c.CENTRAL_FILE_HEADER+i(A,2)+j+i(_.length,2)+"\0\0\0\0"+i(I,4)+i(a,4)+m+S+_}}var o=t("../utils"),r=t("../stream/GenericWorker"),s=t("../utf8"),l=t("../crc32"),c=t("../signature");function u(t,e,n,i){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,r),u.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,r.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-i-1))/n:100}}))},u.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=a(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=a(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:function(t){return c.DATA_DESCRIPTOR+i(t.crc32,4)+i(t.compressedSize,4)+i(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=function(t,e,n,a,r){var s=o.transformTo("string",r(a));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(t,2)+i(t,2)+i(e,4)+i(n,4)+i(s.length,2)+s}(this.dirRecords.length,this.bytesWritten-t,t,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},u.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(t){var e=this._sources;if(!r.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},u.prototype.lock=function(){r.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var i=t("../compressions"),a=t("./ZipFileWorker");n.generateWorker=function(t,e,n){var o=new a(e.streamFiles,n,e.platform,e.encodeFileName),r=0;try{t.forEach(function(t,n){r++;var a=function(t,e){var n=t||e,a=i[n];if(!a)throw new Error(n+" is not a valid compression method !");return a}(n.options.compression,e.compression),s=n.dir,l=n.date;n._compressWorker(a,n.options.compressionOptions||e.compressionOptions||{}).withStreamInfo("file",{name:t,dir:s,date:l,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(o)}),o.entriesCount=r}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new i;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.5.0",i.loadAsync=function(t,e){return(new i).loadAsync(t,e)},i.external=t("./external"),e.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){"use strict";var i=t("./utils"),a=t("./external"),o=t("./utf8"),r=(i=t("./utils"),t("./zipEntries")),s=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(t){return new a.Promise(function(e,n){var i=t.decompressed.getContentWorker().pipe(new s);i.on("error",function(t){n(t)}).on("end",function(){i.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var n=this;return e=i.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),l.isNode&&l.isStream(t)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var n=new r(e);return n.load(t),n}).then(function(t){var n=[a.Promise.resolve(t)],i=t.files;if(e.checkCRC32)for(var o=0;o<i.length;o++)n.push(c(i[o]));return a.Promise.all(n)}).then(function(t){for(var i=t.shift(),a=i.files,o=0;o<a.length;o++){var r=a[o];n.file(r.fileNameStr,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:e.createFolders})}return i.zipComment.length&&(n.comment=i.zipComment),n})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){"use strict";var i=t("../utils"),a=t("../stream/GenericWorker");function o(t,e){a.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}i.inherits(o,a),o.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){"use strict";var i=t("readable-stream").Readable;function a(t,e,n){i.call(this,e),this._helper=t;var a=this;t.on("data",function(t,e){a.push(t)||a._helper.pause(),n&&n(e)}).on("error",function(t){a.emit("error",t)}).on("end",function(){a.push(null)})}t("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},e.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,n){"use strict";function i(t,e,n){var i,a,s=o.getTypeOf(e),h=o.extend(n||{},l);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(t=f(t)),h.createFolders&&(i=b(t))&&m.call(this,i,!0),n&&void 0!==n.binary||(h.binary=!("string"===s&&!1===h.binary&&!1===h.base64)),(e instanceof c&&0===e.uncompressedSize||h.dir||!e||0===e.length)&&(h.base64=!1,h.binary=!0,e="",h.compression="STORE",s="string"),a=e instanceof c||e instanceof r?e:d.isNode&&d.isStream(e)?new g(t,e):o.prepareContent(t,e,h.binary,h.optimizedBinaryString,h.base64);var v=new u(t,a,h);this.files[t]=v}var a=t("./utf8"),o=t("./utils"),r=t("./stream/GenericWorker"),s=t("./stream/StreamHelper"),l=t("./defaults"),c=t("./compressedObject"),u=t("./zipObject"),h=t("./generate"),d=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),b=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},f=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:l.createFolders,t=f(t),this.files[t]||i.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function v(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var p={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,i;for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,i))},filter:function(t){var e=[];return this.forEach(function(n,i){t(n,i)&&e.push(i)}),e},file:function(t,e,n){if(1!==arguments.length)return i.call(this,t=this.root+t,e,n),this;if(v(t)){var a=t;return this.filter(function(t,e){return!e.dir&&a.test(t)})}var o=this.files[this.root+t];return o&&!o.dir?o:null},folder:function(t){if(!t)return this;if(v(t))return this.filter(function(e,n){return n.dir&&t.test(e)});var e=m.call(this,this.root+t),n=this.clone();return n.root=e.name,n},remove:function(t){var e=this.files[t=this.root+t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter(function(e,n){return n.name.slice(0,t.length)===t}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=o.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");o.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS"),e=h.generateWorker(this,n,n.comment||this.comment||"")}catch(t){(e=new r("error")).error(t)}return new s(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=p},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){"use strict";var i=t("./DataReader");function a(t){i.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(a,i),a.prototype.byteAt=function(t){return this.data[this.zero+t]},a.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),a=t.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===e&&this.data[o+1]===n&&this.data[o+2]===i&&this.data[o+3]===a)return o-this.zero;return-1},a.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),a=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&n===o[1]&&i===o[2]&&a===o[3]},a.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){"use strict";var i=t("../utils");function a(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=a},{"../utils":32}],19:[function(t,e,n){"use strict";var i=t("./Uint8ArrayReader");function a(t){i.call(this,t)}t("../utils").inherits(a,i),a.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){"use strict";var i=t("./DataReader");function a(t){i.call(this,t)}t("../utils").inherits(a,i),a.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},a.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},a.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},a.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){"use strict";var i=t("./ArrayReader");function a(t){i.call(this,t)}t("../utils").inherits(a,i),a.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){"use strict";var i=t("../utils"),a=t("../support"),o=t("./ArrayReader"),r=t("./StringReader"),s=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=i.getTypeOf(t);return i.checkSupport(e),"string"!==e||a.uint8array?"nodebuffer"===e?new s(t):a.uint8array?new l(i.transformTo("uint8array",t)):new o(i.transformTo("array",t)):new r(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK\x03\x04",n.CENTRAL_FILE_HEADER="PK\x01\x02",n.CENTRAL_DIRECTORY_END="PK\x05\x06",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,e,n){"use strict";var i=t("./GenericWorker"),a=t("../utils");function o(t){i.call(this,"ConvertWorker to "+t),this.destType=t}a.inherits(o,i),o.prototype.processChunk=function(t){this.push({data:a.transformTo(this.destType,t.data),meta:t.meta})},e.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){"use strict";var i=t("./GenericWorker"),a=t("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,i),o.prototype.processChunk=function(t){this.streamInfo.crc32=a(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){"use strict";var i=t("../utils"),a=t("./GenericWorker");function o(t){a.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}i.inherits(o,a),o.prototype.processChunk=function(t){t&&(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+t.data.length),a.prototype.processChunk.call(this,t)},e.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){"use strict";var i=t("../utils"),a=t("./GenericWorker");function o(t){a.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=i.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}i.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){"use strict";function i(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=i},{}],29:[function(t,e,n){"use strict";var i=t("../utils"),a=t("./ConvertWorker"),o=t("./GenericWorker"),r=t("../base64"),s=t("../support"),l=t("../external"),c=null;if(s.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function u(t,e,n){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=n,i.checkSupport(r),this._worker=t.pipe(new a(r)),t.lock()}catch(t){this._worker=new o("error"),this._worker.error(t)}}u.prototype={accumulate:function(t){return function(t,e){return new l.Promise(function(n,a){var o=[],s=t._internalType,l=t._outputType,c=t._mimeType;t.on("data",function(t,n){o.push(t),e&&e(n)}).on("error",function(t){o=[],a(t)}).on("end",function(){try{var t=function(t,e,n){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),n);case"base64":return r.encode(e);default:return i.transformTo(t,e)}}(l,function(t,e){var n,i=0,a=null,o=0;for(n=0;n<e.length;n++)o+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(a=new Uint8Array(o),n=0;n<e.length;n++)a.set(e[n],i),i+=e[n].length;return a;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(s,o),c);n(t)}catch(t){a(t)}o=[]}).resume()})}(this,t)},on:function(t,e){var n=this;return this._worker.on(t,"data"===t?function(t){e.call(n,t.data,t.meta)}:function(){i.delay(e,arguments,n)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(t){try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),n.blob=0===a.getBlob("application/zip").size}catch(t){n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch(t){n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";for(var i=t("./utils"),a=t("./support"),o=t("./nodejsUtils"),r=t("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){r.call(this,"utf-8 decode"),this.leftOver=null}function u(){r.call(this,"utf-8 encode")}s[254]=s[254]=1,n.utf8encode=function(t){return a.nodebuffer?o.newBufferFrom(t,"utf-8"):function(t){var e,n,i,o,r,s=t.length,l=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=a.uint8array?new Uint8Array(l):new Array(l),o=r=0;r<l;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[r++]=n:(n<2048?e[r++]=192|n>>>6:(n<65536?e[r++]=224|n>>>12:(e[r++]=240|n>>>18,e[r++]=128|n>>>12&63),e[r++]=128|n>>>6&63),e[r++]=128|63&n);return e}(t)},n.utf8decode=function(t){return a.nodebuffer?i.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,n,a,o,r=t.length,l=new Array(2*r);for(e=n=0;e<r;)if((a=t[e++])<128)l[n++]=a;else if(4<(o=s[a]))l[n++]=65533,e+=o-1;else{for(a&=2===o?31:3===o?15:7;1<o&&e<r;)a=a<<6|63&t[e++],o--;1<o?l[n++]=65533:a<65536?l[n++]=a:(l[n++]=55296|(a-=65536)>>10&1023,l[n++]=56320|1023&a)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)}(t=i.transformTo(a.uint8array?"uint8array":"array",t))},i.inherits(c,r),c.prototype.processChunk=function(t){var e=i.transformTo(a.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var o=e;(e=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),e.set(o,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var r=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0||0===n?e:n+s[t[n]]>e?n:e}(e),l=e;r!==e.length&&(a.uint8array?(l=e.subarray(0,r),this.leftOver=e.subarray(r,e.length)):(l=e.slice(0,r),this.leftOver=e.slice(r,e.length))),this.push({data:n.utf8decode(l),meta:t.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,i.inherits(u,r),u.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";var i=t("./support"),a=t("./base64"),o=t("./nodejsUtils"),r=t("set-immediate-shim"),s=t("./external");function l(t){return t}function c(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}n.newBlob=function(e,i){n.checkSupport("blob");try{return new Blob([e],{type:i})}catch(t){try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return a.append(e),a.getBlob(i)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(t,e,n){var i=[],a=0,o=t.length;if(o<=n)return String.fromCharCode.apply(null,t);for(;a<o;)i.push(String.fromCharCode.apply(null,"array"===e||"nodebuffer"===e?t.slice(a,Math.min(a+n,o)):t.subarray(a,Math.min(a+n,o)))),a+=n;return i.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(t){return!1}}()}};function h(t){var e=65536,i=n.getTypeOf(t),a=!0;if("uint8array"===i?a=u.applyCanBeUsed.uint8array:"nodebuffer"===i&&(a=u.applyCanBeUsed.nodebuffer),a)for(;1<e;)try{return u.stringifyByChunk(t,i,e)}catch(t){e=Math.floor(e/2)}return u.stringifyByChar(t)}function d(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}n.applyFromCharCode=h;var g={};g.string={string:l,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return g.string.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:function(t){return c(t,o.allocBuffer(t.length))}},g.array={string:h,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(t)}},g.arraybuffer={string:function(t){return h(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(new Uint8Array(t))}},g.uint8array={string:h,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return o.newBufferFrom(t)}},g.nodebuffer={string:h,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return g.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:l},n.transformTo=function(t,e){if(e=e||"",!t)return e;n.checkSupport(t);var i=n.getTypeOf(e);return g[i][t](e)},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":i.nodebuffer&&o.isBuffer(t)?"nodebuffer":i.uint8array&&t instanceof Uint8Array?"uint8array":i.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!i[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,i="";for(n=0;n<(t||"").length;n++)i+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return i},n.delay=function(t,e,n){r(function(){t.apply(n||null,e||[])})},n.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},n.prepareContent=function(t,e,o,r,l){return s.Promise.resolve(e).then(function(t){return i.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise(function(e,n){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(t){n(t.target.error)},i.readAsArrayBuffer(t)}):t}).then(function(e){var u=n.getTypeOf(e);return u?("arraybuffer"===u?e=n.transformTo("uint8array",e):"string"===u&&(l?e=a.decode(e):o&&!0!==r&&(e=function(t){return c(t,i.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,n){"use strict";var i=t("./reader/readerFor"),a=t("./utils"),o=t("./signature"),r=t("./zipEntry"),s=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(e)+", expected "+a.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var i=this.reader.readString(4)===e;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=a.transformTo(s.uint8array?"uint8array":"array",t);this.zipComment=this.loadOptions.decodeFileName(e)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)this.reader.setIndex((e=this.files[t]).localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(t=new r({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=e-n;if(0<i)this.isSignature(e,o.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(t){this.reader=i(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){"use strict";var i=t("./reader/readerFor"),a=t("./utils"),o=t("./compressedObject"),r=t("./crc32"),s=t("./utf8"),l=t("./compressions"),c=t("./support");function u(t,e){this.options=t,this.loadOptions=e}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,i,a=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<a;)e=t.readInt(2),n=t.readInt(2),i=t.readData(n),this.extraFields[e]={id:e,length:n,value:i};t.setIndex(a)},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=a.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var o=a.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=i(t.value);return 1!==e.readInt(1)||r(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=i(t.value);return 1!==e.readInt(1)||r(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}},e.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){"use strict";function i(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var a=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),r=t("./utf8"),s=t("./compressedObject"),l=t("./stream/GenericWorker");i.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var o=!this._dataBinary;o&&!i&&(e=e.pipe(new r.Utf8EncodeWorker)),!o&&i&&(e=e.pipe(new r.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new a(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof s&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new r.Utf8EncodeWorker)),s.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof l?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)i.prototype[c[h]]=u;e.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,n){(function(t){"use strict";var n,i,a=t.MutationObserver||t.WebKitMutationObserver;if(a){var o=0,r=new a(u),s=t.document.createTextNode("");r.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var t,e;i=!0;for(var n=c.length;n;){for(e=c,c=[],t=-1;++t<n;)e[t]();n=c.length}i=!1}e.exports=function(t){1!==c.push(t)||i||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){"use strict";var i=t("immediate");function a(){}var o={},r=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==a&&g(this,t)}function u(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(t,e,n){i(function(){var i;try{i=e(n)}catch(i){return o.reject(t,i)}i===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,i)})}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function g(t,e){var n=!1;function i(e){n||(n=!0,o.reject(t,e))}function a(e){n||(n=!0,o.resolve(t,e))}var r=b(function(){e(a,i)});"error"===r.status&&i(r.value)}function b(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}(e.exports=c).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===r)return this;var n=new this.constructor(a);return this.state!==l?h(n,this.state===s?t:e,this.outcome):this.queue.push(new u(n,t,e)),n},u.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){o.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},o.resolve=function(t,e){var n=b(d,e);if("error"===n.status)return o.reject(t,n.value);var i=n.value;if(i)g(t,i);else{t.state=s,t.outcome=e;for(var a=-1,r=t.queue.length;++a<r;)t.queue[a].callFulfilled(e)}return t},o.reject=function(t,e){t.state=r,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:o.resolve(new this(a),t)},c.reject=function(t){var e=new this(a);return o.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,i=!1;if(!n)return this.resolve([]);for(var r=new Array(n),s=0,l=-1,c=new this(a);++l<n;)u(t[l],l);return c;function u(t,a){e.resolve(t).then(function(t){r[a]=t,++s!==n||i||(i=!0,o.resolve(c,r))},function(t){i||(i=!0,o.reject(c,t))})}},c.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,n=!1;if(!e)return this.resolve([]);for(var i=-1,r=new this(a);++i<e;)this.resolve(t[i]).then(function(t){n||(n=!0,o.resolve(r,t))},function(t){n||(n=!0,o.reject(r,t))});return r}},{immediate:36}],38:[function(t,e,n){"use strict";var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){"use strict";var i=t("./zlib/deflate"),a=t("./utils/common"),o=t("./utils/strings"),r=t("./zlib/messages"),s=t("./zlib/zstream"),l=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw new Error(r[n]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var u;if(u="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(n=i.deflateSetDictionary(this.strm,u)))throw new Error(r[n]);this._dict_set=!0}}function u(t,e){var n=new c(e);if(n.push(t,!0),n.err)throw n.msg||r[n.err];return n.result}c.prototype.push=function(t,e){var n,r,s=this.strm,c=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:!0===e?4:0,s.input="string"==typeof t?o.string2buf(t):"[object ArrayBuffer]"===l.call(t)?new Uint8Array(t):t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(c),s.next_out=0,s.avail_out=c),1!==(n=i.deflate(s,r))&&0!==n)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==r&&2!==r)||this.onData("string"===this.options.to?o.buf2binstring(a.shrinkBuf(s.output,s.next_out)):a.shrinkBuf(s.output,s.next_out))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===r?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==r||(this.onEnd(0),!(s.avail_out=0))},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){0===t&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=c,n.deflate=u,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,u(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){"use strict";var i=t("./zlib/inflate"),a=t("./utils/common"),o=t("./utils/strings"),r=t("./zlib/constants"),s=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),u=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,e.windowBits);if(n!==r.Z_OK)throw new Error(s[n]);this.header=new c,i.inflateGetHeader(this.strm,this.header)}function d(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}h.prototype.push=function(t,e){var n,s,l,c,h,d,g=this.strm,b=this.options.chunkSize,f=this.options.dictionary,m=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?r.Z_FINISH:r.Z_NO_FLUSH,g.input="string"==typeof t?o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?new Uint8Array(t):t,g.next_in=0,g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new a.Buf8(b),g.next_out=0,g.avail_out=b),(n=i.inflate(g,r.Z_NO_FLUSH))===r.Z_NEED_DICT&&f&&(d="string"==typeof f?o.string2buf(f):"[object ArrayBuffer]"===u.call(f)?new Uint8Array(f):f,n=i.inflateSetDictionary(this.strm,d)),n===r.Z_BUF_ERROR&&!0===m&&(n=r.Z_OK,m=!1),n!==r.Z_STREAM_END&&n!==r.Z_OK)return this.onEnd(n),!(this.ended=!0);g.next_out&&(0!==g.avail_out&&n!==r.Z_STREAM_END&&(0!==g.avail_in||s!==r.Z_FINISH&&s!==r.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(g.output,g.next_out),c=g.next_out-l,h=o.buf2string(g.output,l),g.next_out=c,g.avail_out=b-c,c&&a.arraySet(g.output,g.output,l,c,0),this.onData(h)):this.onData(a.shrinkBuf(g.output,g.next_out)))),0===g.avail_in&&0===g.avail_out&&(m=!0)}while((0<g.avail_in||0===g.avail_out)&&n!==r.Z_STREAM_END);return n===r.Z_STREAM_END&&(s=r.Z_FINISH),s===r.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===r.Z_OK):s!==r.Z_SYNC_FLUSH||(this.onEnd(r.Z_OK),!(g.avail_out=0))},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===r.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var a={arraySet:function(t,e,n,i,a){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+i),a);else for(var o=0;o<i;o++)t[a+o]=e[n+o]},flattenChunks:function(t){var e,n,i,a,o,r;for(e=i=0,n=t.length;e<n;e++)i+=t[e].length;for(r=new Uint8Array(i),e=a=0,n=t.length;e<n;e++)r.set(o=t[e],a),a+=o.length;return r}},o={arraySet:function(t,e,n,i,a){for(var o=0;o<i;o++)t[a+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],42:[function(t,e,n){"use strict";var i=t("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var r=new i.Buf8(256),s=0;s<256;s++)r[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function l(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var n="",r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n}r[254]=r[254]=1,n.string2buf=function(t){var e,n,a,o,r,s=t.length,l=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(a=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(a-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new i.Buf8(l),o=r=0;r<l;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(a=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(a-56320),o++),n<128?e[r++]=n:(n<2048?e[r++]=192|n>>>6:(n<65536?e[r++]=224|n>>>12:(e[r++]=240|n>>>18,e[r++]=128|n>>>12&63),e[r++]=128|n>>>6&63),e[r++]=128|63&n);return e},n.buf2binstring=function(t){return l(t,t.length)},n.binstring2buf=function(t){for(var e=new i.Buf8(t.length),n=0,a=e.length;n<a;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,i,a,o,s=e||t.length,c=new Array(2*s);for(n=i=0;n<s;)if((a=t[n++])<128)c[i++]=a;else if(4<(o=r[a]))c[i++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;1<o&&n<s;)a=a<<6|63&t[n++],o--;1<o?c[i++]=65533:a<65536?c[i++]=a:(c[i++]=55296|(a-=65536)>>10&1023,c[i++]=56320|1023&a)}return l(c,i)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0||0===n?e:n+r[t[n]]>e?n:e}},{"./common":41}],43:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){for(var a=65535&t|0,o=t>>>16&65535|0,r=0;0!==n;){for(n-=r=2e3<n?2e3:n;o=o+(a=a+e[i++]|0)|0,--r;);a%=65521,o%=65521}return a|o<<16|0}},{}],44:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){"use strict";var i=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,a){var o=i,r=a+n;t^=-1;for(var s=a;s<r;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],46:[function(t,e,n){"use strict";var i,a=t("../utils/common"),o=t("./trees"),r=t("./adler32"),s=t("./crc32"),l=t("./messages"),c=-2,u=258,h=262,d=113;function g(t,e){return t.msg=l[e],e}function b(t){return(t<<1)-(4<t?9:0)}function f(t){for(var e=t.length;0<=--e;)t[e]=0}function m(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(a.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function v(t,e){o._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,m(t.strm)}function p(t,e){t.pending_buf[t.pending++]=e}function _(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function y(t,e){var n,i,a=t.max_chain_length,o=t.strstart,r=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-h?t.strstart-(t.w_size-h):0,c=t.window,d=t.w_mask,g=t.prev,b=t.strstart+u,f=c[o+r-1],m=c[o+r];t.prev_length>=t.good_match&&(a>>=2),s>t.lookahead&&(s=t.lookahead);do{if(c[(n=e)+r]===m&&c[n+r-1]===f&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<b);if(i=u-(b-o),o=b-u,r<i){if(t.match_start=e,s<=(r=i))break;f=c[o+r-1],m=c[o+r]}}}while((e=g[e&d])>l&&0!=--a);return r<=t.lookahead?r:t.lookahead}function x(t){var e,n,i,o,l,c,u,d,g,b,f=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-h)){for(a.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=n=t.hash_size;i=t.head[--e],t.head[e]=f<=i?i-f:0,--n;);for(e=n=f;i=t.prev[--e],t.prev[e]=f<=i?i-f:0,--n;);o+=f}if(0===t.strm.avail_in)break;if(u=t.window,d=t.strstart+t.lookahead,b=void 0,(g=o)<(b=(c=t.strm).avail_in)&&(b=g),n=0===b?0:(c.avail_in-=b,a.arraySet(u,c.input,c.next_in,b,d),1===c.state.wrap?c.adler=r(c.adler,u,b,d):2===c.state.wrap&&(c.adler=s(c.adler,u,b,d)),c.next_in+=b,c.total_in+=b,b),t.lookahead+=n,t.lookahead+t.insert>=3)for(t.ins_h=t.window[l=t.strstart-t.insert],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<h&&0!==t.strm.avail_in)}function w(t,e){for(var n,i;;){if(t.lookahead<h){if(x(t),t.lookahead<h&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-h&&(t.match_length=y(t,n)),t.match_length>=3)if(i=o._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function S(t,e){for(var n,i,a;;){if(t.lookahead<h){if(x(t),t.lookahead<h&&0===e)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-h&&(t.match_length=y(t,n),t.match_length<=5&&(1===t.strategy||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){for(a=t.strstart+t.lookahead-3,i=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=a&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(v(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=o._tr_tally(t,0,t.window[t.strstart-1]))&&v(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function k(t,e,n,i,a){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=a}function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(1146),this.dyn_dtree=new a.Buf16(122),this.bl_tree=new a.Buf16(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(16),this.heap=new a.Buf16(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:d,t.adler=2===e.wrap?0:1,e.last_flush=0,o._tr_init(e),0):g(t,c)}function O(t){var e=P(t);return 0===e&&function(t){t.window_size=2*t.w_size,f(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0}(t.state),e}function M(t,e,n,i,o,r){if(!t)return c;var s=1;if(-1===e&&(e=6),i<0?(s=0,i=-i):15<i&&(s=2,i-=16),o<1||9<o||8!==n||i<8||15<i||e<0||9<e||r<0||4<r)return g(t,c);8===i&&(i=9);var l=new C;return(t.state=l).strm=t,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new a.Buf8(2*l.w_size),l.head=new a.Buf16(l.hash_size),l.prev=new a.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new a.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=r,l.method=n,O(t)}i=[new k(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(x(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,v(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-h&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&v(t,!1),1)}),new k(4,4,8,4,w),new k(4,5,16,8,w),new k(4,6,32,32,w),new k(4,4,16,16,S),new k(8,16,32,32,S),new k(8,16,128,128,S),new k(8,32,128,256,S),new k(32,128,258,1024,S),new k(32,258,258,4096,S)],n.deflateInit=function(t,e){return M(t,e,8,15,8,0)},n.deflateInit2=M,n.deflateReset=O,n.deflateResetKeep=P,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?c:(t.state.gzhead=e,0):c},n.deflate=function(t,e){var n,a,r,l;if(!t||!t.state||5<e||e<0)return t?g(t,c):c;if(a=t.state,!t.output||!t.input&&0!==t.avail_in||666===a.status&&4!==e)return g(t,0===t.avail_out?-5:c);if(a.strm=t,n=a.last_flush,a.last_flush=e,42===a.status)if(2===a.wrap)t.adler=0,p(a,31),p(a,139),p(a,8),a.gzhead?(p(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),p(a,255&a.gzhead.time),p(a,a.gzhead.time>>8&255),p(a,a.gzhead.time>>16&255),p(a,a.gzhead.time>>24&255),p(a,9===a.level?2:2<=a.strategy||a.level<2?4:0),p(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(p(a,255&a.gzhead.extra.length),p(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=s(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(p(a,0),p(a,0),p(a,0),p(a,0),p(a,0),p(a,9===a.level?2:2<=a.strategy||a.level<2?4:0),p(a,3),a.status=d);else{var h=8+(a.w_bits-8<<4)<<8;h|=(2<=a.strategy||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(h|=32),h+=31-h%31,a.status=d,_(a,h),0!==a.strstart&&(_(a,t.adler>>>16),_(a,65535&t.adler)),t.adler=1}if(69===a.status)if(a.gzhead.extra){for(r=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>r&&(t.adler=s(t.adler,a.pending_buf,a.pending-r,r)),m(t),r=a.pending,a.pending!==a.pending_buf_size));)p(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>r&&(t.adler=s(t.adler,a.pending_buf,a.pending-r,r)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(t.adler=s(t.adler,a.pending_buf,a.pending-r,r)),m(t),r=a.pending,a.pending===a.pending_buf_size)){l=1;break}l=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,p(a,l)}while(0!==l);a.gzhead.hcrc&&a.pending>r&&(t.adler=s(t.adler,a.pending_buf,a.pending-r,r)),0===l&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){r=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>r&&(t.adler=s(t.adler,a.pending_buf,a.pending-r,r)),m(t),r=a.pending,a.pending===a.pending_buf_size)){l=1;break}l=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,p(a,l)}while(0!==l);a.gzhead.hcrc&&a.pending>r&&(t.adler=s(t.adler,a.pending_buf,a.pending-r,r)),0===l&&(a.status=103)}else a.status=103;if(103===a.status&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&m(t),a.pending+2<=a.pending_buf_size&&(p(a,255&t.adler),p(a,t.adler>>8&255),t.adler=0,a.status=d)):a.status=d),0!==a.pending){if(m(t),0===t.avail_out)return a.last_flush=-1,0}else if(0===t.avail_in&&b(e)<=b(n)&&4!==e)return g(t,-5);if(666===a.status&&0!==t.avail_in)return g(t,-5);if(0!==t.avail_in||0!==a.lookahead||0!==e&&666!==a.status){var y=2===a.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(x(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(a,e):3===a.strategy?function(t,e){for(var n,i,a,r,s=t.window;;){if(t.lookahead<=u){if(x(t),t.lookahead<=u&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&0<t.strstart&&(i=s[a=t.strstart-1])===s[++a]&&i===s[++a]&&i===s[++a]){r=t.strstart+u;do{}while(i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&i===s[++a]&&a<r);t.match_length=u-(r-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=o._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(a,e):i[a.level].func(a,e);if(3!==y&&4!==y||(a.status=666),1===y||3===y)return 0===t.avail_out&&(a.last_flush=-1),0;if(2===y&&(1===e?o._tr_align(a):5!==e&&(o._tr_stored_block(a,0,0,!1),3===e&&(f(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),m(t),0===t.avail_out))return a.last_flush=-1,0}return 4!==e?0:a.wrap<=0?1:(2===a.wrap?(p(a,255&t.adler),p(a,t.adler>>8&255),p(a,t.adler>>16&255),p(a,t.adler>>24&255),p(a,255&t.total_in),p(a,t.total_in>>8&255),p(a,t.total_in>>16&255),p(a,t.total_in>>24&255)):(_(a,t.adler>>>16),_(a,65535&t.adler)),m(t),0<a.wrap&&(a.wrap=-a.wrap),0!==a.pending?0:1)},n.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&e!==d&&666!==e?g(t,c):(t.state=null,e===d?g(t,-3):0):c},n.deflateSetDictionary=function(t,e){var n,i,o,s,l,u,h,d,g=e.length;if(!t||!t.state)return c;if(2===(s=(n=t.state).wrap)||1===s&&42!==n.status||n.lookahead)return c;for(1===s&&(t.adler=r(t.adler,e,g,0)),n.wrap=0,g>=n.w_size&&(0===s&&(f(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new a.Buf8(n.w_size),a.arraySet(d,e,g-n.w_size,n.w_size,0),e=d,g=n.w_size),l=t.avail_in,u=t.next_in,h=t.input,t.avail_in=g,t.next_in=0,t.input=e,x(n);n.lookahead>=3;){for(i=n.strstart,o=n.lookahead-2;n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--o;);n.strstart=i,n.lookahead=2,x(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=u,t.input=h,t.avail_in=l,n.wrap=s,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){"use strict";e.exports=function(t,e){var n,i,a,o,r,s,l,c,u,h,d,g,b,f,m,v,p,_,y,x,w,S,k,C,P;C=t.input,a=(i=t.next_in)+(t.avail_in-5),P=t.output,r=(o=t.next_out)-(e-t.avail_out),s=o+(t.avail_out-257),l=(n=t.state).dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,g=n.hold,b=n.bits,f=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,p=(1<<n.distbits)-1;t:do{b<15&&(g+=C[i++]<<b,g+=C[i++]<<(b+=8),b+=8),_=f[g&v];e:for(;;){if(g>>>=y=_>>>24,b-=y,0==(y=_>>>16&255))P[o++]=65535&_;else{if(!(16&y)){if(0==(64&y)){_=f[(65535&_)+(g&(1<<y)-1)];continue e}if(32&y){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}x=65535&_,(y&=15)&&(b<y&&(g+=C[i++]<<b,b+=8),x+=g&(1<<y)-1,g>>>=y,b-=y),b<15&&(g+=C[i++]<<b,g+=C[i++]<<(b+=8),b+=8),_=m[g&p];n:for(;;){if(g>>>=y=_>>>24,b-=y,!(16&(y=_>>>16&255))){if(0==(64&y)){_=m[(65535&_)+(g&(1<<y)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(w=65535&_,b<(y&=15)&&(g+=C[i++]<<b,(b+=8)<y&&(g+=C[i++]<<b,b+=8)),l<(w+=g&(1<<y)-1)){t.msg="invalid distance too far back",n.mode=30;break t}if(g>>>=y,b-=y,(y=o-r)<w){if(u<(y=w-y)&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(k=d,(S=0)===h){if(S+=c-y,y<x){for(x-=y;P[o++]=d[S++],--y;);S=o-w,k=P}}else if(h<y){if(S+=c+h-y,(y-=h)<x){for(x-=y;P[o++]=d[S++],--y;);if(S=0,h<x){for(x-=y=h;P[o++]=d[S++],--y;);S=o-w,k=P}}}else if(S+=h-y,y<x){for(x-=y;P[o++]=d[S++],--y;);S=o-w,k=P}for(;2<x;)P[o++]=k[S++],P[o++]=k[S++],P[o++]=k[S++],x-=3;x&&(P[o++]=k[S++],1<x&&(P[o++]=k[S++]))}else{for(S=o-w;P[o++]=P[S++],P[o++]=P[S++],P[o++]=P[S++],2<(x-=3););x&&(P[o++]=P[S++],1<x&&(P[o++]=P[S++]))}break}}break}}while(i<a&&o<s);i-=x=b>>3,g&=(1<<(b-=x<<3))-1,t.next_in=i,t.next_out=o,t.avail_in=i<a?a-i+5:5-(i-a),t.avail_out=o<s?s-o+257:257-(o-s),n.hold=g,n.bits=b}},{}],49:[function(t,e,n){"use strict";var i=t("../utils/common"),a=t("./adler32"),o=t("./crc32"),r=t("./inffast"),s=t("./inftrees"),l=-2;function c(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function h(t){var e;return t&&t.state?(t.total_in=t.total_out=(e=t.state).total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(852),e.distcode=e.distdyn=new i.Buf32(592),e.sane=1,e.back=-1,0):l}function d(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,h(t)):l}function g(t,e){var n,i;return t&&t.state?(i=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?l:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,d(t))):l}function b(t,e){var n,i;return t?(i=new u,(t.state=i).window=null,0!==(n=g(t,e))&&(t.state=null),n):l}var f,m,v=!0;function p(t){if(v){var e;for(f=new i.Buf32(512),m=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(1,t.lens,0,288,f,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(2,t.lens,0,32,m,0,t.work,{bits:5}),v=!1}t.lencode=f,t.lenbits=9,t.distcode=m,t.distbits=5}function _(t,e,n,a){var o,r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new i.Buf8(r.wsize)),a>=r.wsize?(i.arraySet(r.window,e,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(a<(o=r.wsize-r.wnext)&&(o=a),i.arraySet(r.window,e,n-a,o,r.wnext),(a-=o)?(i.arraySet(r.window,e,n-a,a,0),r.wnext=a,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0}n.inflateReset=d,n.inflateReset2=g,n.inflateResetKeep=h,n.inflateInit=function(t){return b(t,15)},n.inflateInit2=b,n.inflate=function(t,e){var n,u,h,d,g,b,f,m,v,y,x,w,S,k,C,P,O,M,L,I,A,j,B,E,z=0,D=new i.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return l;12===(n=t.state).mode&&(n.mode=13),g=t.next_out,h=t.output,d=t.next_in,u=t.input,m=n.hold,v=n.bits,y=b=t.avail_in,x=f=t.avail_out,j=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;v<16;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(2&n.wrap&&35615===m){D[n.check=0]=255&m,D[1]=m>>>8&255,n.check=o(n.check,D,2,0),v=m=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&m)){t.msg="unknown compression method",n.mode=30;break}if(v-=4,A=8+(15&(m>>>=4)),0===n.wbits)n.wbits=A;else if(A>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<A,t.adler=n.check=1,n.mode=512&m?10:12,v=m=0;break;case 2:for(;v<16;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(n.flags=m,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(D[0]=255&m,D[1]=m>>>8&255,n.check=o(n.check,D,2,0)),v=m=0,n.mode=3;case 3:for(;v<32;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}n.head&&(n.head.time=m),512&n.flags&&(D[0]=255&m,D[1]=m>>>8&255,D[2]=m>>>16&255,D[3]=m>>>24&255,n.check=o(n.check,D,4,0)),v=m=0,n.mode=4;case 4:for(;v<16;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(D[0]=255&m,D[1]=m>>>8&255,n.check=o(n.check,D,2,0)),v=m=0,n.mode=5;case 5:if(1024&n.flags){for(;v<16;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(D[0]=255&m,D[1]=m>>>8&255,n.check=o(n.check,D,2,0)),v=m=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(b<(w=n.length)&&(w=b),w&&(n.head&&(A=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,u,d,w,A)),512&n.flags&&(n.check=o(n.check,u,w,d)),b-=w,d+=w,n.length-=w),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===b)break t;for(w=0;A=u[d+w++],n.head&&A&&n.length<65536&&(n.head.name+=String.fromCharCode(A)),A&&w<b;);if(512&n.flags&&(n.check=o(n.check,u,w,d)),b-=w,d+=w,A)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===b)break t;for(w=0;A=u[d+w++],n.head&&A&&n.length<65536&&(n.head.comment+=String.fromCharCode(A)),A&&w<b;);if(512&n.flags&&(n.check=o(n.check,u,w,d)),b-=w,d+=w,A)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;v<16;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(m!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}v=m=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;v<32;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}t.adler=n.check=c(m),v=m=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=g,t.avail_out=f,t.next_in=d,t.avail_in=b,n.hold=m,n.bits=v,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){m>>>=7&v,v-=7&v,n.mode=27;break}for(;v<3;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}switch(n.last=1&m,v-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(p(n),n.mode=20,6!==e)break;m>>>=2,v-=2;break t;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}m>>>=2,v-=2;break;case 14:for(m>>>=7&v,v-=7&v;v<32;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if((65535&m)!=(m>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&m,v=m=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(w=n.length){if(b<w&&(w=b),f<w&&(w=f),0===w)break t;i.arraySet(h,u,d,w,g),b-=w,d+=w,f-=w,g+=w,n.length-=w;break}n.mode=12;break;case 17:for(;v<14;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(n.nlen=257+(31&m),v-=5,n.ndist=1+(31&(m>>>=5)),v-=5,n.ncode=4+(15&(m>>>=5)),m>>>=4,v-=4,286<n.nlen||30<n.ndist){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;v<3;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}n.lens[T[n.have++]]=7&m,m>>>=3,v-=3}for(;n.have<19;)n.lens[T[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j=s(0,n.lens,0,19,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,j){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;P=(z=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,O=65535&z,!((C=z>>>24)<=v);){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(O<16)m>>>=C,v-=C,n.lens[n.have++]=O;else{if(16===O){for(E=C+2;v<E;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(m>>>=C,v-=C,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}A=n.lens[n.have-1],w=3+(3&m),m>>>=2,v-=2}else if(17===O){for(E=C+3;v<E;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}v-=C,A=0,w=3+(7&(m>>>=C)),m>>>=3,v-=3}else{for(E=C+7;v<E;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}v-=C,A=0,w=11+(127&(m>>>=C)),m>>>=7,v-=7}if(n.have+w>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;w--;)n.lens[n.have++]=A}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,j=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,j){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,j=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,B={bits:n.distbits}),n.distbits=B.bits,j){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(6<=b&&258<=f){t.next_out=g,t.avail_out=f,t.next_in=d,t.avail_in=b,n.hold=m,n.bits=v,r(t,x),g=t.next_out,h=t.output,f=t.avail_out,d=t.next_in,u=t.input,b=t.avail_in,m=n.hold,v=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;P=(z=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,O=65535&z,!((C=z>>>24)<=v);){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(P&&0==(240&P)){for(M=C,L=P,I=O;P=(z=n.lencode[I+((m&(1<<M+L)-1)>>M)])>>>16&255,O=65535&z,!(M+(C=z>>>24)<=v);){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}m>>>=M,v-=M,n.back+=M}if(m>>>=C,v-=C,n.back+=C,n.length=O,0===P){n.mode=26;break}if(32&P){n.back=-1,n.mode=12;break}if(64&P){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&P,n.mode=22;case 22:if(n.extra){for(E=n.extra;v<E;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,v-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;P=(z=n.distcode[m&(1<<n.distbits)-1])>>>16&255,O=65535&z,!((C=z>>>24)<=v);){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(0==(240&P)){for(M=C,L=P,I=O;P=(z=n.distcode[I+((m&(1<<M+L)-1)>>M)])>>>16&255,O=65535&z,!(M+(C=z>>>24)<=v);){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}m>>>=M,v-=M,n.back+=M}if(m>>>=C,v-=C,n.back+=C,64&P){t.msg="invalid distance code",n.mode=30;break}n.offset=O,n.extra=15&P,n.mode=24;case 24:if(n.extra){for(E=n.extra;v<E;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,v-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===f)break t;if(n.offset>(w=x-f)){if((w=n.offset-w)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}S=w>n.wnext?n.wsize-(w-=n.wnext):n.wnext-w,w>n.length&&(w=n.length),k=n.window}else k=h,S=g-n.offset,w=n.length;for(f<w&&(w=f),f-=w,n.length-=w;h[g++]=k[S++],--w;);0===n.length&&(n.mode=21);break;case 26:if(0===f)break t;h[g++]=n.length,f--,n.mode=21;break;case 27:if(n.wrap){for(;v<32;){if(0===b)break t;b--,m|=u[d++]<<v,v+=8}if(t.total_out+=x-=f,n.total+=x,x&&(t.adler=n.check=n.flags?o(n.check,h,x,g-x):a(n.check,h,x,g-x)),x=f,(n.flags?m:c(m))!==n.check){t.msg="incorrect data check",n.mode=30;break}v=m=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;v<32;){if(0===b)break t;b--,m+=u[d++]<<v,v+=8}if(m!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}v=m=0}n.mode=29;case 29:j=1;break t;case 30:j=-3;break t;case 31:return-4;case 32:default:return l}return t.next_out=g,t.avail_out=f,t.next_in=d,t.avail_in=b,n.hold=m,n.bits=v,(n.wsize||x!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&_(t,t.output,t.next_out,x-t.avail_out)?(n.mode=31,-4):(x-=t.avail_out,t.total_in+=y-=t.avail_in,t.total_out+=x,n.total+=x,n.wrap&&x&&(t.adler=n.check=n.flags?o(n.check,h,x,t.next_out-x):a(n.check,h,x,t.next_out-x)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==y&&0===x||4===e)&&0===j&&(j=-5),j)},n.inflateEnd=function(t){if(!t||!t.state)return l;var e=t.state;return e.window&&(e.window=null),t.state=null,0},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?l:((n.head=e).done=!1,0):l},n.inflateSetDictionary=function(t,e){var n,i=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?l:11===n.mode&&a(1,e,i,0)!==n.check?-3:_(t,e,i,i)?(n.mode=31,-4):(n.havedict=1,0):l},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){"use strict";var i=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,l,c,u,h,d){var g,b,f,m,v,p,_,y,x,w=d.bits,S=0,k=0,C=0,P=0,O=0,M=0,L=0,I=0,A=0,j=0,B=null,E=0,z=new i.Buf16(16),D=new i.Buf16(16),T=null,N=0;for(S=0;S<=15;S++)z[S]=0;for(k=0;k<l;k++)z[e[n+k]]++;for(O=w,P=15;1<=P&&0===z[P];P--);if(P<O&&(O=P),0===P)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(C=1;C<P&&0===z[C];C++);for(O<C&&(O=C),S=I=1;S<=15;S++)if(I<<=1,(I-=z[S])<0)return-1;if(0<I&&(0===t||1!==P))return-1;for(D[1]=0,S=1;S<15;S++)D[S+1]=D[S]+z[S];for(k=0;k<l;k++)0!==e[n+k]&&(h[D[e[n+k]]++]=k);if(p=0===t?(B=T=h,19):1===t?(B=a,E-=257,T=o,N-=257,256):(B=r,T=s,-1),S=C,v=u,L=k=j=0,f=-1,m=(A=1<<(M=O))-1,1===t&&852<A||2===t&&592<A)return 1;for(;;){for(_=S-L,x=h[k]<p?(y=0,h[k]):h[k]>p?(y=T[N+h[k]],B[E+h[k]]):(y=96,0),g=1<<S-L,C=b=1<<M;c[v+(j>>L)+(b-=g)]=_<<24|y<<16|x|0,0!==b;);for(g=1<<S-1;j&g;)g>>=1;if(0!==g?(j&=g-1,j+=g):j=0,k++,0==--z[S]){if(S===P)break;S=e[n+h[k]]}if(O<S&&(j&m)!==f){for(0===L&&(L=O),v+=C,I=1<<(M=S-L);M+L<P&&!((I-=z[M+L])<=0);)M++,I<<=1;if(A+=1<<M,1===t&&852<A||2===t&&592<A)return 1;c[f=j&m]=O<<24|M<<16|v-u|0}}return 0!==j&&(c[v+j]=S-L<<24|64<<16|0),d.bits=O,0}},{"../utils/common":41}],51:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){"use strict";var i=t("../utils/common");function a(t){for(var e=t.length;0<=--e;)t[e]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],r=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);a(c);var u=new Array(60);a(u);var h=new Array(512);a(h);var d=new Array(256);a(d);var g=new Array(29);a(g);var b,f,m,v=new Array(30);function p(t,e,n,i,a){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=a,this.has_stree=t&&t.length}function _(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function y(t){return t<256?h[t]:h[256+(t>>>7)]}function x(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function w(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,x(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function S(t,e,n){w(t,n[2*e],n[2*e+1])}function k(t,e){for(var n=0;n|=1&t,t>>>=1,n<<=1,0<--e;);return n>>>1}function C(t,e,n){var i,a,o=new Array(16),r=0;for(i=1;i<=15;i++)o[i]=r=r+n[i-1]<<1;for(a=0;a<=e;a++){var s=t[2*a+1];0!==s&&(t[2*a]=k(o[s]++,s))}}function P(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function O(t){8<t.bi_valid?x(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function M(t,e,n,i){var a=2*e,o=2*n;return t[a]<t[o]||t[a]===t[o]&&i[e]<=i[n]}function L(t,e,n){for(var i=t.heap[n],a=n<<1;a<=t.heap_len&&(a<t.heap_len&&M(e,t.heap[a+1],t.heap[a],t.depth)&&a++,!M(e,i,t.heap[a],t.depth));)t.heap[n]=t.heap[a],n=a,a<<=1;t.heap[n]=i}function I(t,e,n){var i,a,s,l,c=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],a=t.pending_buf[t.l_buf+c],c++,0===i?S(t,a,e):(S(t,(s=d[a])+256+1,e),0!==(l=o[s])&&w(t,a-=g[s],l),S(t,s=y(--i),n),0!==(l=r[s])&&w(t,i-=v[s],l)),c<t.last_lit;);S(t,256,e)}function A(t,e){var n,i,a,o=e.dyn_tree,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(a=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[a]=0,t.opt_len--,s&&(t.static_len-=r[2*a+1]);for(e.max_code=c,n=t.heap_len>>1;1<=n;n--)L(t,o,n);for(a=l;n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],L(t,o,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,o[2*a]=o[2*n]+o[2*i],t.depth[a]=(t.depth[n]>=t.depth[i]?t.depth[n]:t.depth[i])+1,o[2*n+1]=o[2*i+1]=a,t.heap[1]=a++,L(t,o,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,i,a,o,r,s,l=e.dyn_tree,c=e.max_code,u=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,g=e.stat_desc.extra_base,b=e.stat_desc.max_length,f=0;for(o=0;o<=15;o++)t.bl_count[o]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)b<(o=l[2*l[2*(i=t.heap[n])+1]+1]+1)&&(o=b,f++),l[2*i+1]=o,c<i||(t.bl_count[o]++,r=0,g<=i&&(r=d[i-g]),t.opt_len+=(s=l[2*i])*(o+r),h&&(t.static_len+=s*(u[2*i+1]+r)));if(0!==f){do{for(o=b-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[b]--,f-=2}while(0<f);for(o=b;0!==o;o--)for(i=t.bl_count[o];0!==i;)c<(a=t.heap[--n])||(l[2*a+1]!==o&&(t.opt_len+=(o-l[2*a+1])*l[2*a],l[2*a+1]=o),i--)}}(t,e),C(o,c,t.bl_count)}function j(t,e,n){var i,a,o=-1,r=e[1],s=0,l=7,c=4;for(0===r&&(l=138,c=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)a=r,r=e[2*(i+1)+1],++s<l&&a===r||(s<c?t.bl_tree[2*a]+=s:0!==a?(a!==o&&t.bl_tree[2*a]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=a,c=(s=0)===r?(l=138,3):a===r?(l=6,3):(l=7,4))}function B(t,e,n){var i,a,o=-1,r=e[1],s=0,l=7,c=4;for(0===r&&(l=138,c=3),i=0;i<=n;i++)if(a=r,r=e[2*(i+1)+1],!(++s<l&&a===r)){if(s<c)for(;S(t,a,t.bl_tree),0!=--s;);else 0!==a?(a!==o&&(S(t,a,t.bl_tree),s--),S(t,16,t.bl_tree),w(t,s-3,2)):s<=10?(S(t,17,t.bl_tree),w(t,s-3,3)):(S(t,18,t.bl_tree),w(t,s-11,7));o=a,c=(s=0)===r?(l=138,3):a===r?(l=6,3):(l=7,4)}}a(v);var E=!1;function z(t,e,n,a){w(t,0+(a?1:0),3),function(t,e,n,a){O(t),x(t,n),x(t,~n),i.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n)}n._tr_init=function(t){E||(function(){var t,e,n,i,a,l=new Array(16);for(i=n=0;i<28;i++)for(g[i]=n,t=0;t<1<<o[i];t++)d[n++]=i;for(d[n-1]=i,i=a=0;i<16;i++)for(v[i]=a,t=0;t<1<<r[i];t++)h[a++]=i;for(a>>=7;i<30;i++)for(v[i]=a<<7,t=0;t<1<<r[i]-7;t++)h[256+a++]=i;for(e=0;e<=15;e++)l[e]=0;for(t=0;t<=143;)c[2*t+1]=8,t++,l[8]++;for(;t<=255;)c[2*t+1]=9,t++,l[9]++;for(;t<=279;)c[2*t+1]=7,t++,l[7]++;for(;t<=287;)c[2*t+1]=8,t++,l[8]++;for(C(c,287,l),t=0;t<30;t++)u[2*t+1]=5,u[2*t]=k(t,5);b=new p(c,o,257,286,15),f=new p(u,r,0,30,15),m=new p(new Array(0),s,0,19,7)}(),E=!0),t.l_desc=new _(t.dyn_ltree,b),t.d_desc=new _(t.dyn_dtree,f),t.bl_desc=new _(t.bl_tree,m),t.bi_buf=0,t.bi_valid=0,P(t)},n._tr_stored_block=z,n._tr_flush_block=function(t,e,n,i){var a,o,r=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),A(t,t.l_desc),A(t,t.d_desc),r=function(t){var e;for(j(t,t.dyn_ltree,t.l_desc.max_code),j(t,t.dyn_dtree,t.d_desc.max_code),A(t,t.bl_desc),e=18;3<=e&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),(o=t.static_len+3+7>>>3)<=(a=t.opt_len+3+7>>>3)&&(a=o)):a=o=n+5,n+4<=a&&-1!==e?z(t,e,n,i):4===t.strategy||o===a?(w(t,2+(i?1:0),3),I(t,c,u)):(w(t,4+(i?1:0),3),function(t,e,n,i){var a;for(w(t,e-257,5),w(t,n-1,5),w(t,i-4,4),a=0;a<i;a++)w(t,t.bl_tree[2*l[a]+1],3);B(t,t.dyn_ltree,e-1),B(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),I(t,t.dyn_ltree,t.dyn_dtree)),P(t),i&&O(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(d[n]+256+1)]++,t.dyn_dtree[2*y(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){w(t,2,3),S(t,256,c),function(t){16===t.bi_valid?(x(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)}}])}();